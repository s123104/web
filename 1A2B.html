<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€²éšç‰ˆ1A2Bå°è©±å¼éŠæˆ² ğŸ§ </title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1'
                        },
                        secondary: {
                            50: '#fef3c7',
                            100: '#fde68a',
                            500: '#f59e0b',
                            600: '#d97706'
                        },
                        neutral: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a'
                        }
                    },
                    fontFamily: {
                        'sans': ['Inter', 'Noto Sans TC', 'system-ui', 'sans-serif']
                    },
                    spacing: {
                        '18': '4.5rem',
                        '88': '22rem'
                    }
                }
            }
        }
    </script>
    
    <style>
        /* è‡ªè¨‚CSSå¢å¼· */
        .game-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out forwards;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result-a {
            background: linear-gradient(90deg, #10b981, #059669);
            color: white;
        }
        
        .result-b {
            background: linear-gradient(90deg, #f59e0b, #d97706);
            color: white;
        }
        
        .achievement-badge {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 5px #ffd700; }
            to { box-shadow: 0 0 20px #ffd700, 0 0 30px #ffd700; }
        }
    </style>
</head>

<body class="bg-gradient-to-br from-primary-50 to-secondary-50 min-h-screen font-sans">
    <!-- Header å€åŸŸ -->
    <header class="bg-white shadow-sm border-b border-neutral-200">
        <div class="max-w-4xl mx-auto px-4 py-4 sm:px-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-brain text-primary-600 text-2xl"></i>
                    <h1 class="text-xl sm:text-2xl font-bold text-neutral-800 tracking-tight">1A2B æ™ºæ…§éŠæˆ²</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- ä½¿ç”¨è€…ç­‰ç´šé¡¯ç¤º -->
                    <div class="hidden sm:flex items-center space-x-2 bg-primary-50 px-3 py-1 rounded-full">
                        <i class="fas fa-star text-secondary-500"></i>
                        <span class="text-sm font-medium text-primary-700" id="userLevel">Lv.1</span>
                    </div>
                    <!-- è¨­å®šæŒ‰éˆ• -->
                    <button id="settingsBtn" class="p-2 text-neutral-600 hover:text-primary-600 transition-colors duration-200">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
    <main class="max-w-4xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
        
        <!-- éŠæˆ²ç‹€æ…‹é¢æ¿ -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
            <div class="game-card rounded-xl p-4 text-center">
                <div class="text-2xl font-bold text-primary-600" id="currentRound">0</div>
                <div class="text-sm text-neutral-600">å›åˆæ•¸</div>
            </div>
            <div class="game-card rounded-xl p-4 text-center">
                <div class="text-2xl font-bold text-secondary-600" id="gameTime">00:00</div>
                <div class="text-sm text-neutral-600">éŠæˆ²æ™‚é–“</div>
            </div>
            <div class="game-card rounded-xl p-4 text-center">
                <div class="text-2xl font-bold text-neutral-700" id="difficulty">4ä½æ•¸</div>
                <div class="text-sm text-neutral-600">éŠæˆ²é›£åº¦</div>
            </div>
        </div>

        <!-- å°è©±å¼éŠæˆ²ä»‹é¢ -->
        <div class="game-card rounded-2xl p-6 mb-6">
            
            <!-- éŠæˆ²å°è©±å€åŸŸ -->
            <div id="gameDialog" class="space-y-4 mb-6 h-64 overflow-y-auto">
                <!-- å°è©±å…§å®¹å°‡å‹•æ…‹æ·»åŠ  -->
            </div>

            <!-- éŠæˆ²æ§åˆ¶å€åŸŸ -->
            <div id="gameControls" class="space-y-4">
                
                <!-- é›£åº¦é¸æ“‡ (åˆå§‹ç‹€æ…‹) -->
                <div id="difficultySelection" class="text-center">
                    <h3 class="text-lg font-semibold text-neutral-800 mb-4">ğŸ¯ é¸æ“‡éŠæˆ²é›£åº¦</h3>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                        <button class="difficulty-btn bg-green-100 hover:bg-green-200 text-green-800 px-4 py-3 rounded-lg font-medium transition-all duration-200 transform hover:scale-105" data-digits="3">
                            3ä½æ•¸ ğŸ˜Š
                        </button>
                        <button class="difficulty-btn bg-blue-100 hover:bg-blue-200 text-blue-800 px-4 py-3 rounded-lg font-medium transition-all duration-200 transform hover:scale-105" data-digits="4">
                            4ä½æ•¸ ğŸ¤”
                        </button>
                        <button class="difficulty-btn bg-orange-100 hover:bg-orange-200 text-orange-800 px-4 py-3 rounded-lg font-medium transition-all duration-200 transform hover:scale-105" data-digits="5">
                            5ä½æ•¸ ğŸ˜¤
                        </button>
                        <button id="hardMode" class="difficulty-btn bg-red-100 hover:bg-red-200 text-red-800 px-4 py-3 rounded-lg font-medium transition-all duration-200 transform hover:scale-105 opacity-50 cursor-not-allowed" data-digits="6" disabled>
                            6ä½æ•¸ ğŸ”’
                        </button>
                    </div>
                    
                    <!-- å…’ç«¥æ¨¡å¼é–‹é—œ -->
                    <div class="mt-4 flex items-center justify-center space-x-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="childMode" class="rounded border-neutral-300 text-primary-600 focus:ring-primary-500">
                            <span class="text-sm font-medium text-neutral-700">ğŸ‘¶ å…’ç«¥æç¤ºæ¨¡å¼</span>
                        </label>
                    </div>
                </div>

                <!-- çŒœæ¸¬è¼¸å…¥å€åŸŸ (éŠæˆ²ä¸­) -->
                <div id="guessInput" class="hidden">
                    <div class="flex space-x-3">
                        <input type="text" id="numberInput" placeholder="è¼¸å…¥æ‚¨çš„çŒœæ¸¬..." 
                               class="flex-1 px-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-lg text-center font-mono tracking-widest">
                        <button id="submitGuess" class="bg-primary-600 hover:bg-primary-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 transform hover:scale-105">
                            çŒœæ¸¬ ğŸ¯
                        </button>
                    </div>
                    
                    <!-- å…’ç«¥æ¨¡å¼æç¤ºå€åŸŸ -->
                    <div id="childHints" class="hidden mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                        <div class="text-sm font-medium text-yellow-800 mb-2">ğŸ’¡ æç¤ºèªªæ˜:</div>
                        <div class="text-xs text-yellow-700 space-y-1">
                            <div>ğŸ”µ è¡¨ç¤ºæ•¸å­—å’Œä½ç½®éƒ½æ­£ç¢º (A)</div>
                            <div>ğŸŸ¡ è¡¨ç¤ºæ•¸å­—æ­£ç¢ºä½†ä½ç½®éŒ¯èª¤ (B)</div>
                            <div class="mt-2">
                                <button id="showHint" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-xs transition-colors duration-200">
                                    ä½¿ç”¨æç¤º (å‰©é¤˜: <span id="hintCount">3</span>æ¬¡)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- éŠæˆ²çµæŸæ§åˆ¶ -->
                <div id="gameEndControls" class="hidden text-center space-y-3">
                    <button id="newGameBtn" class="bg-primary-600 hover:bg-primary-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 transform hover:scale-105">
                        ğŸ”„ é–‹å§‹æ–°éŠæˆ²
                    </button>
                    <button id="viewStatsBtn" class="bg-neutral-600 hover:bg-neutral-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 transform hover:scale-105">
                        ğŸ“Š æŸ¥çœ‹çµ±è¨ˆ
                    </button>
                </div>
            </div>
        </div>

        <!-- æ­·å²è¨˜éŒ„é¢æ¿ -->
        <div id="historyPanel" class="game-card rounded-2xl p-6 mb-6">
            <h3 class="text-lg font-semibold text-neutral-800 mb-4 flex items-center">
                <i class="fas fa-history text-primary-600 mr-2"></i>
                æœ¬å±€è¨˜éŒ„
            </h3>
            <div id="gameHistory" class="space-y-2 max-h-48 overflow-y-auto">
                <div class="text-sm text-neutral-600 text-center py-8">å°šæœªé–‹å§‹éŠæˆ²</div>
            </div>
        </div>

        <!-- æˆå°±èˆ‡çµ±è¨ˆé¢æ¿ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- æˆå°±å¾½ç«  -->
            <div class="game-card rounded-2xl p-6">
                <h3 class="text-lg font-semibold text-neutral-800 mb-4 flex items-center">
                    <i class="fas fa-trophy text-secondary-600 mr-2"></i>
                    æˆå°±å¾½ç« 
                </h3>
                <div id="achievements" class="grid grid-cols-2 gap-3">
                    <!-- æˆå°±å¾½ç« å°‡å‹•æ…‹æ·»åŠ  -->
                </div>
            </div>

            <!-- æœ€ä½³è¨˜éŒ„ -->
            <div class="game-card rounded-2xl p-6">
                <h3 class="text-lg font-semibold text-neutral-800 mb-4 flex items-center">
                    <i class="fas fa-medal text-primary-600 mr-2"></i>
                    æœ€ä½³è¨˜éŒ„
                </h3>
                <div id="bestRecords" class="space-y-3">
                    <!-- æœ€ä½³è¨˜éŒ„å°‡å‹•æ…‹æ·»åŠ  -->
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-12 py-6 text-center text-sm text-neutral-600">
        <div class="max-w-4xl mx-auto px-4">
            <p>ğŸ§  1A2Bæ™ºæ…§éŠæˆ² - è¨“ç·´é‚è¼¯æ€ç¶­çš„æœ€ä½³é¸æ“‡</p>
            <p class="mt-1">Made with â¤ï¸ by AI Assistant</p>
        </div>
    </footer>

    <!-- éš±è—å½©è›‹æŒ‰éˆ• -->
    <div id="easterEggBtn" class="fixed bottom-4 right-4 w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center cursor-pointer shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-110 opacity-70 hover:opacity-100">
        <i class="fas fa-magic text-white text-lg"></i>
    </div>

    <!-- è¨­å®šå½ˆçª— -->
    <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-6 mx-4 w-full max-w-md">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-neutral-800">âš™ï¸ éŠæˆ²è¨­å®š</h3>
                <button id="closeSettings" class="text-neutral-500 hover:text-neutral-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-neutral-700 mb-2">ğŸµ éŸ³æ•ˆè¨­å®š</label>
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" id="soundEnabled" checked class="rounded border-neutral-300 text-primary-600 focus:ring-primary-500">
                        <span class="text-sm">å•Ÿç”¨éŸ³æ•ˆ</span>
                    </label>
                </div>
                <div>
                    <label class="block text-sm font-medium text-neutral-700 mb-2">ğŸ“Š é‡ç½®æ•¸æ“š</label>
                    <button id="resetData" class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg text-sm transition-colors duration-200">
                        æ¸…é™¤æ‰€æœ‰éŠæˆ²è¨˜éŒ„
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- å½©è›‹æ¨¡æ…‹æ¡† -->
    <div id="easterEggModal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
        <div class="bg-gradient-to-br from-purple-600 to-pink-600 rounded-2xl p-8 mx-4 w-full max-w-md text-center text-white">
            <h3 class="text-2xl font-bold mb-4">ğŸ‰ æ­å–œç™¼ç¾å½©è›‹ï¼</h3>
            <p class="mb-4">æ‚¨å·²è§£é–ç‰¹æ®Šæˆå°±ï¼šã€Œæ¢ç´¢è€…ã€ï¼</p>
            <div class="text-6xl mb-4">ğŸ”®</div>
            <p class="text-sm mb-6">å‚³èªªä¸­ï¼Œåªæœ‰çœŸæ­£çš„æ™ºè€…æ‰èƒ½ç™¼ç¾é€™å€‹éš±è—çš„ç§˜å¯†...</p>
            <button id="closeEasterEgg" class="bg-white text-purple-600 px-6 py-2 rounded-lg font-medium hover:bg-gray-100 transition-colors duration-200">
                ç¹¼çºŒæ¢ç´¢ âœ¨
            </button>
        </div>
    </div>

    <script>
        // éŠæˆ²ä¸»é¡åˆ¥ - æ¨¡çµ„åŒ–ç®¡ç†æ•´å€‹éŠæˆ²ç‹€æ…‹èˆ‡é‚è¼¯
        class Game1A2B {
            constructor() {
                this.gameState = {
                    isPlaying: false,
                    answer: '',
                    rounds: 0,
                    maxRounds: 15,
                    digits: 4,
                    childMode: false,
                    hintsUsed: 0,
                    maxHints: 3,
                    startTime: null,
                    gameHistory: []
                };
                
                this.userData = this.loadUserData();
                this.achievements = this.initAchievements();
                this.timer = null;
                this.easterEggClicks = 0;
                
                this.init();
            }

            // åˆå§‹åŒ–éŠæˆ²
            init() {
                this.bindEvents();
                this.updateUI();
                this.addWelcomeMessage();
                this.checkEasterEgg();
            }

            // äº‹ä»¶ç¶å®š - é›†ä¸­ç®¡ç†æ‰€æœ‰UIäº¤äº’
            bindEvents() {
                // é›£åº¦é¸æ“‡
                document.querySelectorAll('.difficulty-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        if (!e.target.disabled) {
                            this.startGame(parseInt(e.target.dataset.digits));
                        }
                    });
                });

                // çŒœæ¸¬æäº¤
                document.getElementById('submitGuess').addEventListener('click', () => this.submitGuess());
                document.getElementById('numberInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.submitGuess();
                });

                // æ–°éŠæˆ²
                document.getElementById('newGameBtn').addEventListener('click', () => this.resetGame());
                
                // è¨­å®šç›¸é—œ
                document.getElementById('settingsBtn').addEventListener('click', () => this.showSettings());
                document.getElementById('closeSettings').addEventListener('click', () => this.hideSettings());
                document.getElementById('resetData').addEventListener('click', () => this.resetUserData());

                // å…’ç«¥æ¨¡å¼
                document.getElementById('childMode').addEventListener('change', (e) => {
                    this.gameState.childMode = e.target.checked;
                });

                // æç¤ºæŒ‰éˆ•
                document.getElementById('showHint').addEventListener('click', () => this.showHint());

                // å½©è›‹ç›¸é—œ
                document.getElementById('easterEggBtn').addEventListener('click', () => this.triggerEasterEgg());
                document.getElementById('closeEasterEgg').addEventListener('click', () => this.hideEasterEgg());

                // çµ±è¨ˆæŸ¥çœ‹
                document.getElementById('viewStatsBtn').addEventListener('click', () => this.showStats());
            }

            // é–‹å§‹æ–°éŠæˆ²
            startGame(digits) {
                this.gameState = {
                    ...this.gameState,
                    isPlaying: true,
                    answer: this.generateAnswer(digits),
                    digits: digits,
                    rounds: 0,
                    hintsUsed: 0,
                    startTime: new Date(),
                    gameHistory: [],
                    childMode: document.getElementById('childMode').checked
                };

                this.updateUI();
                this.startTimer();
                this.addMessage(`ğŸ® éŠæˆ²é–‹å§‹ï¼æˆ‘å·²ç¶“æƒ³å¥½äº†ä¸€å€‹${digits}ä½æ•¸çš„æ•¸å­—ï¼Œè«‹é–‹å§‹çŒœæ¸¬å§ï¼`, 'system');
                
                if (this.gameState.childMode) {
                    this.addMessage(`ğŸ‘¶ å…’ç«¥æ¨¡å¼å·²å•Ÿç”¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¦–è¦ºæç¤ºè¼”åŠ©éŠæˆ²ï¼`, 'system');
                }
            }

            // ç”Ÿæˆéš¨æ©Ÿç­”æ¡ˆ - ç¢ºä¿æ•¸å­—ä¸é‡è¤‡
            generateAnswer(digits) {
                const numbers = '0123456789'.split('');
                let answer = '';
                
                // ç¬¬ä¸€ä½ä¸èƒ½æ˜¯0
                const firstDigit = Math.floor(Math.random() * 9) + 1;
                answer += firstDigit;
                numbers.splice(firstDigit, 1);
                
                // ç”Ÿæˆå‰©é¤˜ä½æ•¸
                for (let i = 1; i < digits; i++) {
                    const randomIndex = Math.floor(Math.random() * numbers.length);
                    answer += numbers[randomIndex];
                    numbers.splice(randomIndex, 1);
                }
                
                return answer;
            }

            // æäº¤çŒœæ¸¬
            submitGuess() {
                const input = document.getElementById('numberInput');
                const guess = input.value.trim();
                
                if (!this.validateGuess(guess)) return;

                const result = this.calculateResult(guess, this.gameState.answer);
                this.gameState.rounds++;
                this.gameState.gameHistory.push({ guess, result, round: this.gameState.rounds });

                this.addGuessMessage(guess, result);
                
                // æª¢æŸ¥éŠæˆ²çµæŸæ¢ä»¶
                if (result.A === this.gameState.digits) {
                    this.endGame(true);
                } else if (this.gameState.rounds >= this.gameState.maxRounds) {
                    this.endGame(false);
                } else {
                    input.value = '';
                    this.updateUI();
                }
            }

            // é©—è­‰çŒœæ¸¬è¼¸å…¥
            validateGuess(guess) {
                if (guess.length !== this.gameState.digits) {
                    this.addMessage(`âŒ è«‹è¼¸å…¥${this.gameState.digits}ä½æ•¸ï¼`, 'error');
                    return false;
                }

                if (!/^\d+$/.test(guess)) {
                    this.addMessage(`âŒ è«‹åªè¼¸å…¥æ•¸å­—ï¼`, 'error');
                    return false;
                }

                if (new Set(guess).size !== guess.length) {
                    this.addMessage(`âŒ æ•¸å­—ä¸èƒ½é‡è¤‡ï¼`, 'error');
                    return false;
                }

                return true;
            }

            // è¨ˆç®—Aå’ŒBçš„çµæœ
            calculateResult(guess, answer) {
                let A = 0, B = 0;
                
                for (let i = 0; i < guess.length; i++) {
                    if (guess[i] === answer[i]) {
                        A++;
                    } else if (answer.includes(guess[i])) {
                        B++;
                    }
                }
                
                return { A, B };
            }

            // æ·»åŠ çŒœæ¸¬çµæœè¨Šæ¯
            addGuessMessage(guess, result) {
                const resultText = `${result.A}A${result.B}B`;
                
                // ä¸»å°è©±å€é¡¯ç¤º
                this.addMessage(`ç¬¬${this.gameState.rounds}å›åˆï¼šçŒœæ¸¬ ${guess} â†’ ${resultText}`, 'user');
                
                // æ­·å²è¨˜éŒ„å€é¡¯ç¤º
                this.updateHistoryPanel();
                
                // å…’ç«¥æ¨¡å¼è¦–è¦ºåŒ–
                if (this.gameState.childMode) {
                    this.showVisualResult(guess, result);
                }
            }

            // å…’ç«¥æ¨¡å¼è¦–è¦ºåŒ–çµæœ
            showVisualResult(guess, result) {
                const visual = 'ğŸ”µ'.repeat(result.A) + 'ğŸŸ¡'.repeat(result.B) + 'âš«'.repeat(this.gameState.digits - result.A - result.B);
                this.addMessage(`è¦–è¦ºæç¤ºï¼š${visual}`, 'hint');
            }

            // çµæŸéŠæˆ²
            endGame(won) {
                this.gameState.isPlaying = false;
                this.stopTimer();
                
                const timeSpent = this.getGameTime();
                const score = {
                    won,
                    rounds: this.gameState.rounds,
                    time: timeSpent,
                    difficulty: `${this.gameState.digits}ä½æ•¸`,
                    hintsUsed: this.gameState.hintsUsed,
                    answer: this.gameState.answer
                };

                if (won) {
                    this.addMessage(`ğŸ‰ æ­å–œï¼æ‚¨åœ¨ç¬¬${this.gameState.rounds}å›åˆçŒœä¸­äº†ç­”æ¡ˆï¼š${this.gameState.answer}`, 'success');
                    this.addMessage(`â±ï¸ ç”¨æ™‚ï¼š${timeSpent}`, 'success');
                    this.updateUserData(score);
                    this.checkAchievements(score);
                } else {
                    this.addMessage(`ğŸ˜¢ éŠæˆ²çµæŸï¼ç­”æ¡ˆæ˜¯ï¼š${this.gameState.answer}`, 'error');
                    this.addMessage(`ğŸ’ª åˆ¥ç°å¿ƒï¼Œå†è©¦ä¸€æ¬¡å§ï¼`, 'system');
                }

                this.updateUI();
            }

            // è¨ˆç®—Aå’ŒBï¼Œä¸¦æä¾›æç¤ºåŠŸèƒ½
            showHint() {
                if (this.gameState.hintsUsed >= this.gameState.maxHints) {
                    this.addMessage(`âŒ æç¤ºæ¬¡æ•¸å·²ç”¨å®Œï¼`, 'error');
                    return;
                }

                this.gameState.hintsUsed++;
                
                // æä¾›éƒ¨åˆ†ä½ç½®æç¤º
                const hintIndex = Math.floor(Math.random() * this.gameState.digits);
                const hintDigit = this.gameState.answer[hintIndex];
                
                this.addMessage(`ğŸ’¡ æç¤ºï¼šç¬¬${hintIndex + 1}ä½æ˜¯æ•¸å­— ${hintDigit}`, 'hint');
                this.updateUI();
            }

            // æ·»åŠ å°è©±è¨Šæ¯ - æ”¯æ´ä¸åŒé¡å‹çš„è¨Šæ¯æ¨£å¼
            addMessage(text, type = 'system') {
                const dialog = document.getElementById('gameDialog');
                const messageDiv = document.createElement('div');
                messageDiv.className = `slide-in p-3 rounded-lg ${this.getMessageStyle(type)}`;
                messageDiv.textContent = text;
                
                dialog.appendChild(messageDiv);
                dialog.scrollTop = dialog.scrollHeight;
            }

            // å–å¾—è¨Šæ¯æ¨£å¼
            getMessageStyle(type) {
                const styles = {
                    system: 'bg-blue-50 text-blue-800 border-l-4 border-blue-400',
                    user: 'bg-green-50 text-green-800 border-l-4 border-green-400',
                    error: 'bg-red-50 text-red-800 border-l-4 border-red-400',
                    success: 'bg-emerald-50 text-emerald-800 border-l-4 border-emerald-400',
                    hint: 'bg-yellow-50 text-yellow-800 border-l-4 border-yellow-400'
                };
                return styles[type] || styles.system;
            }

            // æ›´æ–°æ­·å²è¨˜éŒ„é¢æ¿
            updateHistoryPanel() {
                const historyEl = document.getElementById('gameHistory');
                historyEl.innerHTML = '';
                
                if (this.gameState.gameHistory.length === 0) {
                    historyEl.innerHTML = '<div class="text-sm text-neutral-600 text-center py-4">å°šç„¡è¨˜éŒ„</div>';
                    return;
                }

                this.gameState.gameHistory.forEach(entry => {
                    const entryDiv = document.createElement('div');
                    entryDiv.className = 'flex justify-between items-center py-2 px-3 bg-neutral-50 rounded-lg text-sm';
                    entryDiv.innerHTML = `
                        <span class="font-mono">${entry.guess}</span>
                        <span class="font-semibold">${entry.result.A}A${entry.result.B}B</span>
                    `;
                    historyEl.appendChild(entryDiv);
                });
            }

            // è¨ˆæ™‚å™¨ç®¡ç†
            startTimer() {
                this.timer = setInterval(() => {
                    document.getElementById('gameTime').textContent = this.getGameTime();
                }, 1000);
            }

            stopTimer() {
                if (this.timer) {
                    clearInterval(this.timer);
                    this.timer = null;
                }
            }

            getGameTime() {
                if (!this.gameState.startTime) return '00:00';
                const diff = new Date() - this.gameState.startTime;
                const minutes = Math.floor(diff / 60000);
                const seconds = Math.floor((diff % 60000) / 1000);
                return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            // ä½¿ç”¨è€…è³‡æ–™ç®¡ç† - LocalStorage æŒä¹…åŒ–
            loadUserData() {
                const defaultData = {
                    uid: this.generateUID(),
                    level: 1,
                    experience: 0,
                    gamesPlayed: 0,
                    gamesWon: 0,
                    bestScores: {},
                    unlockedFeatures: [],
                    history: [],
                    achievements: []
                };

                const saved = localStorage.getItem('1a2b_userdata');
                return saved ? { ...defaultData, ...JSON.parse(saved) } : defaultData;
            }

            saveUserData() {
                localStorage.setItem('1a2b_userdata', JSON.stringify(this.userData));
            }

            updateUserData(score) {
                this.userData.gamesPlayed++;
                if (score.won) {
                    this.userData.gamesWon++;
                    
                    // æ›´æ–°æœ€ä½³è¨˜éŒ„
                    const key = score.difficulty;
                    if (!this.userData.bestScores[key] || score.rounds < this.userData.bestScores[key].rounds) {
                        this.userData.bestScores[key] = {
                            rounds: score.rounds,
                            time: score.time,
                            date: new Date().toLocaleDateString()
                        };
                    }
                    
                    // å¢åŠ ç¶“é©—å€¼
                    this.addExperience(score);
                }

                // æ·»åŠ æ­·å²è¨˜éŒ„
                this.userData.history.unshift({
                    date: new Date().toLocaleDateString(),
                    difficulty: score.difficulty,
                    rounds: score.rounds,
                    time: score.time,
                    won: score.won,
                    hintsUsed: score.hintsUsed
                });

                // ä¿æŒæœ€è¿‘20å ´è¨˜éŒ„
                this.userData.history = this.userData.history.slice(0, 20);
                
                this.saveUserData();
                this.updateUI();
            }

            // ç¶“é©—å€¼èˆ‡å‡ç´šç³»çµ±
            addExperience(score) {
                let exp = 10; // åŸºç¤ç¶“é©—

                // é›£åº¦åŠ æˆ
                exp += (score.difficulty.length - 2) * 5;
                
                // å›åˆæ•¸åŠ æˆï¼ˆè¶Šå°‘å›åˆè¶Šé«˜åˆ†ï¼‰
                exp += Math.max(0, 20 - score.rounds);
                
                // ç„¡æç¤ºåŠ æˆ
                if (score.hintsUsed === 0) exp += 15;

                this.userData.experience += exp;
                
                // æª¢æŸ¥å‡ç´š
                this.checkLevelUp();
            }

            checkLevelUp() {
                const newLevel = Math.floor(this.userData.experience / 100) + 1;
                if (newLevel > this.userData.level) {
                    this.userData.level = newLevel;
                    this.addMessage(`ğŸŠ æ­å–œå‡ç´šåˆ° Lv.${newLevel}ï¼`, 'success');
                    this.checkUnlocks();
                }
            }

            checkUnlocks() {
                // è§£é–6ä½æ•¸æ¨¡å¼
                if (this.userData.level >= 5 && !this.userData.unlockedFeatures.includes('6digits')) {
                    this.userData.unlockedFeatures.push('6digits');
                    this.addMessage(`ğŸ”“ è§£é–æ–°åŠŸèƒ½ï¼š6ä½æ•¸å›°é›£æ¨¡å¼ï¼`, 'success');
                    document.getElementById('hardMode').disabled = false;
                    document.getElementById('hardMode').classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }

            // æˆå°±ç³»çµ±
            initAchievements() {
                return [
                    { id: 'first_win', name: 'åˆæ¬¡å‹åˆ©', desc: 'å®Œæˆç¬¬ä¸€å ´éŠæˆ²', icon: 'ğŸ†', unlocked: false },
                    { id: 'quick_win', name: 'ç¥é€ŸçŒœæ‰‹', desc: '5å›åˆå…§å®Œæˆ4ä½æ•¸', icon: 'âš¡', unlocked: false },
                    { id: 'perfect_game', name: 'å®Œç¾éŠæˆ²', desc: 'ä¸ä½¿ç”¨æç¤ºå®ŒæˆéŠæˆ²', icon: 'ğŸ’', unlocked: false },
                    { id: 'hard_mode', name: 'æŒ‘æˆ°è€…', desc: 'å®Œæˆ6ä½æ•¸å›°é›£æ¨¡å¼', icon: 'ğŸ”¥', unlocked: false },
                    { id: 'explorer', name: 'æ¢ç´¢è€…', desc: 'ç™¼ç¾éš±è—å½©è›‹', icon: 'ğŸ”®', unlocked: false },
                    { id: 'veteran', name: 'è€æ‰‹', desc: 'éŠç©é”åˆ°50å ´', icon: 'ğŸ–ï¸', unlocked: false }
                ];
            }

            checkAchievements(score) {
                const achievements = [];

                // æª¢æŸ¥å„ç¨®æˆå°±æ¢ä»¶
                if (score.won && !this.userData.achievements.includes('first_win')) {
                    achievements.push('first_win');
                }

                if (score.won && score.rounds <= 5 && score.difficulty === '4ä½æ•¸' && !this.userData.achievements.includes('quick_win')) {
                    achievements.push('quick_win');
                }

                if (score.won && score.hintsUsed === 0 && !this.userData.achievements.includes('perfect_game')) {
                    achievements.push('perfect_game');
                }

                if (score.won && score.difficulty === '6ä½æ•¸' && !this.userData.achievements.includes('hard_mode')) {
                    achievements.push('hard_mode');
                }

                if (this.userData.gamesPlayed >= 50 && !this.userData.achievements.includes('veteran')) {
                    achievements.push('veteran');
                }

                // è§£é–æ–°æˆå°±
                achievements.forEach(id => {
                    this.userData.achievements.push(id);
                    const achievement = this.achievements.find(a => a.id === id);
                    achievement.unlocked = true;
                    this.addMessage(`ğŸ† è§£é–æˆå°±ï¼š${achievement.name} - ${achievement.desc}`, 'success');
                });

                this.updateUI();
            }

            // å½©è›‹åŠŸèƒ½
            checkEasterEgg() {
                // ç›£è½ç‰¹æ®ŠæŒ‰éµçµ„åˆ
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.shiftKey && e.key === 'E') {
                        this.triggerEasterEgg();
                    }
                });
            }

            triggerEasterEgg() {
                this.easterEggClicks++;
                
                if (this.easterEggClicks >= 3) {
                    document.getElementById('easterEggModal').classList.remove('hidden');
                    document.getElementById('easterEggModal').classList.add('flex');
                    
                    // è§£é–æ¢ç´¢è€…æˆå°±
                    if (!this.userData.achievements.includes('explorer')) {
                        this.userData.achievements.push('explorer');
                        const achievement = this.achievements.find(a => a.id === 'explorer');
                        achievement.unlocked = true;
                        this.saveUserData();
                    }
                    
                    this.easterEggClicks = 0;
                }
            }

            hideEasterEgg() {
                document.getElementById('easterEggModal').classList.add('hidden');
                document.getElementById('easterEggModal').classList.remove('flex');
            }

            // UIæ›´æ–°æ–¹æ³•
            updateUI() {
                // æ›´æ–°éŠæˆ²ç‹€æ…‹é¡¯ç¤º
                document.getElementById('currentRound').textContent = this.gameState.rounds;
                document.getElementById('difficulty').textContent = `${this.gameState.digits}ä½æ•¸`;
                document.getElementById('userLevel').textContent = `Lv.${this.userData.level}`;

                // æ ¹æ“šéŠæˆ²ç‹€æ…‹é¡¯ç¤º/éš±è—æ§åˆ¶é …
                if (this.gameState.isPlaying) {
                    document.getElementById('difficultySelection').classList.add('hidden');
                    document.getElementById('guessInput').classList.remove('hidden');
                    document.getElementById('gameEndControls').classList.add('hidden');
                    
                    // å…’ç«¥æ¨¡å¼æç¤º
                    if (this.gameState.childMode) {
                        document.getElementById('childHints').classList.remove('hidden');
                        document.getElementById('hintCount').textContent = this.gameState.maxHints - this.gameState.hintsUsed;
                    } else {
                        document.getElementById('childHints').classList.add('hidden');
                    }
                } else {
                    document.getElementById('difficultySelection').classList.remove('hidden');
                    document.getElementById('guessInput').classList.add('hidden');
                    
                    if (this.gameState.rounds > 0) {
                        document.getElementById('gameEndControls').classList.remove('hidden');
                    }
                }

                // æ›´æ–°æˆå°±é¡¯ç¤º
                this.updateAchievementsDisplay();
                
                // æ›´æ–°æœ€ä½³è¨˜éŒ„é¡¯ç¤º
                this.updateBestRecordsDisplay();
                
                // æª¢æŸ¥è§£é–ç‹€æ…‹
                this.updateUnlockStatus();
            }

            updateAchievementsDisplay() {
                const container = document.getElementById('achievements');
                container.innerHTML = '';

                this.achievements.forEach(achievement => {
                    const achievementEl = document.createElement('div');
                    achievementEl.className = `p-3 rounded-lg text-center transition-all duration-200 ${
                        achievement.unlocked 
                            ? 'achievement-badge text-white transform hover:scale-105' 
                            : 'bg-neutral-100 text-neutral-600'
                    }`;
                    
                    achievementEl.innerHTML = `
                        <div class="text-2xl mb-1">${achievement.icon}</div>
                        <div class="text-xs font-medium">${achievement.name}</div>
                        <div class="text-xs opacity-75">${achievement.desc}</div>
                    `;
                    
                    container.appendChild(achievementEl);
                });
            }

            updateBestRecordsDisplay() {
                const container = document.getElementById('bestRecords');
                container.innerHTML = '';

                if (Object.keys(this.userData.bestScores).length === 0) {
                    container.innerHTML = '<div class="text-sm text-neutral-600 text-center py-4">å°šç„¡è¨˜éŒ„</div>';
                    return;
                }

                Object.entries(this.userData.bestScores).forEach(([difficulty, record]) => {
                    const recordEl = document.createElement('div');
                    recordEl.className = 'flex justify-between items-center p-3 bg-neutral-50 rounded-lg';
                    recordEl.innerHTML = `
                        <div>
                            <div class="font-medium text-neutral-800">${difficulty}</div>
                            <div class="text-xs text-neutral-600">${record.date}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-primary-600">${record.rounds}å›åˆ</div>
                            <div class="text-xs text-neutral-600">${record.time}</div>
                        </div>
                    `;
                    container.appendChild(recordEl);
                });
            }

            updateUnlockStatus() {
                // æ›´æ–°6ä½æ•¸æŒ‰éˆ•è§£é–ç‹€æ…‹
                const hardModeBtn = document.getElementById('hardMode');
                if (this.userData.unlockedFeatures.includes('6digits')) {
                    hardModeBtn.disabled = false;
                    hardModeBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }

            // è¼”åŠ©æ–¹æ³•
            generateUID() {
                return Math.random().toString(36).substr(2, 9);
            }

            addWelcomeMessage() {
                this.addMessage('ğŸ¯ æ­¡è¿ä¾†åˆ°1A2Bæ™ºæ…§éŠæˆ²ï¼', 'system');
                this.addMessage('ğŸ’¡ è¦å‰‡èªªæ˜ï¼šAè¡¨ç¤ºæ•¸å­—å’Œä½ç½®éƒ½æ­£ç¢ºï¼ŒBè¡¨ç¤ºæ•¸å­—æ­£ç¢ºä½†ä½ç½®éŒ¯èª¤', 'system');
                this.addMessage('ğŸ® è«‹é¸æ“‡éŠæˆ²é›£åº¦é–‹å§‹æŒ‘æˆ°ï¼', 'system');
            }

            resetGame() {
                this.gameState = {
                    ...this.gameState,
                    isPlaying: false,
                    rounds: 0,
                    gameHistory: []
                };
                
                this.stopTimer();
                document.getElementById('gameTime').textContent = '00:00';
                document.getElementById('gameDialog').innerHTML = '';
                document.getElementById('gameHistory').innerHTML = '<div class="text-sm text-neutral-600 text-center py-4">å°šç„¡è¨˜éŒ„</div>';
                
                this.addWelcomeMessage();
                this.updateUI();
            }

            showSettings() {
                document.getElementById('settingsModal').classList.remove('hidden');
                document.getElementById('settingsModal').classList.add('flex');
            }

            hideSettings() {
                document.getElementById('settingsModal').classList.add('hidden');
                document.getElementById('settingsModal').classList.remove('flex');
            }

            resetUserData() {
                if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰éŠæˆ²è¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                    localStorage.removeItem('1a2b_userdata');
                    location.reload();
                }
            }

            showStats() {
                const winRate = this.userData.gamesPlayed > 0 ? 
                    Math.round((this.userData.gamesWon / this.userData.gamesPlayed) * 100) : 0;
                
                this.addMessage(`ğŸ“Š æ‚¨çš„çµ±è¨ˆæ•¸æ“šï¼š`, 'system');
                this.addMessage(`ğŸ® ç¸½éŠæˆ²å ´æ¬¡ï¼š${this.userData.gamesPlayed}`, 'system');
                this.addMessage(`ğŸ† å‹åˆ©å ´æ¬¡ï¼š${this.userData.gamesWon}`, 'system');
                this.addMessage(`ğŸ“ˆ å‹ç‡ï¼š${winRate}%`, 'system');
                this.addMessage(`â­ ç•¶å‰ç­‰ç´šï¼šLv.${this.userData.level}`, 'system');
                this.addMessage(`ğŸ’« ç¶“é©—å€¼ï¼š${this.userData.experience}`, 'system');
            }
        }

        // å•Ÿå‹•éŠæˆ² - DOMè¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            const game = new Game1A2B();
            
            // æ·»åŠ æ»¾å‹•å‹•ç•«æ•ˆæœ
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('slide-in');
                    }
                });
            });

            document.querySelectorAll('.game-card').forEach(card => {
                observer.observe(card);
            });
        });
    </script>
</body>
</html>