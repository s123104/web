<!DOCTYPE html>
<html lang="zh-TW" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#3b82f6">
    <meta name="color-scheme" content="light dark">
    
    <title>é€²éšç‰ˆ 1A2B å°è©±å¼éŠæˆ² | æ™ºæ…§çŒœæ•¸å­—æŒ‘æˆ°</title>
    <meta name="description" content="çµåˆå‡ç´šç³»çµ±ã€æˆå°±å¾½ç« ã€å…’ç«¥æ¨¡å¼çš„é€²éš 1A2B çŒœæ•¸å­—éŠæˆ²ï¼Œæ”¯æ´ 3-6 ä½æ•¸é›£åº¦èª¿æ•´">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+TC:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'Noto Sans TC', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a'
                        },
                        success: {
                            50: '#f0fdf4',
                            500: '#22c55e',
                            700: '#15803d'
                        },
                        warning: {
                            50: '#fffbeb',
                            500: '#f59e0b',
                            700: '#d97706'
                        },
                        error: {
                            50: '#fef2f2',
                            500: '#ef4444',
                            700: '#dc2626'
                        }
                    },
                    animation: {
                        'bounce-in': 'bounceIn 0.6s ease-out',
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'pulse-gentle': 'pulse 2s infinite',
                        'wiggle': 'wiggle 1s ease-in-out infinite',
                        'celebrate': 'celebrate 0.8s ease-out'
                    }
                }
            }
        }
    </script>
    
    <style>
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes wiggle {
            0%, 7% { transform: rotateZ(0); }
            15% { transform: rotateZ(-15deg); }
            20% { transform: rotateZ(10deg); }
            25% { transform: rotateZ(-10deg); }
            30% { transform: rotateZ(6deg); }
            35% { transform: rotateZ(-4deg); }
            40%, 100% { transform: rotateZ(0); }
        }
        
        @keyframes celebrate {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            50% { transform: scale(1.2) rotate(5deg); }
            75% { transform: scale(1.1) rotate(-2deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        
        .number-input {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            letter-spacing: 0.3em;
            text-align: center;
        }
        
        .achievement-badge {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #f59e0b 100%);
            animation: pulse 2s infinite;
        }
        
        .game-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .chat-bubble {
            max-width: 80%;
            word-wrap: break-word;
        }
        
        .chat-bot {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .chat-user {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .difficulty-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.8);
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 font-sans">
    <!-- éŠæˆ²å®¹å™¨ -->
    <div id="gameContainer" class="min-h-screen flex flex-col">
        
        <!-- é ‚éƒ¨ç‹€æ…‹åˆ— -->
        <header class="bg-white/80 backdrop-blur-sm border-b border-gray-200 px-4 py-3 sticky top-0 z-50">
            <div class="max-w-4xl mx-auto flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-brain text-white text-lg"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-lg text-gray-800">1A2B æ™ºæ…§æŒ‘æˆ°</h1>
                        <p class="text-sm text-gray-600" id="playerLevel">ç­‰ç´š 1 æ–°æ‰‹ç©å®¶</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="text-center">
                        <div class="text-xs text-gray-500">ç¶“é©—å€¼</div>
                        <div class="text-sm font-semibold text-blue-600" id="expDisplay">0 XP</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xs text-gray-500">éŠæˆ²æ¬¡æ•¸</div>
                        <div class="text-sm font-semibold text-green-600" id="gamesPlayed">0</div>
                    </div>
                    <button id="settingsBtn" class="p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors">
                        <i class="fas fa-cog text-lg"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
        <main class="flex-1 max-w-4xl mx-auto w-full px-4 py-6">
            
            <!-- æ­¡è¿ç•«é¢ -->
            <div id="welcomeScreen" class="text-center space-y-8">
                <div class="space-y-4">
                    <div class="inline-block p-4 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full animate-bounce-in">
                        <i class="fas fa-gamepad text-white text-4xl"></i>
                    </div>
                    <h2 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                        æ­¡è¿ä¾†åˆ° 1A2B æ™ºæ…§æŒ‘æˆ°ï¼
                    </h2>
                    <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                        é€™æ˜¯ä¸€å€‹çµåˆå‡ç´šç³»çµ±ã€æˆå°±å¾½ç« çš„é€²éšçŒœæ•¸å­—éŠæˆ²ã€‚æŒ‘æˆ°æ‚¨çš„é‚è¼¯æ€ç¶­ï¼Œå¾ 3 ä½æ•¸é–‹å§‹ï¼Œé€æ­¥è§£é–æ›´é«˜é›£åº¦ï¼
                    </p>
                </div>

                <!-- é›£åº¦é¸æ“‡ -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 max-w-4xl mx-auto">
                    <div class="difficulty-card bg-white rounded-xl p-6 shadow-lg border-2 border-green-200 cursor-pointer transition-all duration-300" data-digits="3">
                        <div class="text-center space-y-3">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto">
                                <i class="fas fa-seedling text-green-600 text-xl"></i>
                            </div>
                            <h3 class="font-bold text-lg text-gray-800">åˆç´šæ¨¡å¼</h3>
                            <p class="text-sm text-gray-600">3 ä½æ•¸å­—</p>
                            <div class="text-xs text-green-600 font-medium">âœ¨ é©åˆæ–°æ‰‹</div>
                        </div>
                    </div>

                    <div class="difficulty-card bg-white rounded-xl p-6 shadow-lg border-2 border-blue-200 cursor-pointer transition-all duration-300" data-digits="4">
                        <div class="text-center space-y-3">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto">
                                <i class="fas fa-star text-blue-600 text-xl"></i>
                            </div>
                            <h3 class="font-bold text-lg text-gray-800">æ¨™æº–æ¨¡å¼</h3>
                            <p class="text-sm text-gray-600">4 ä½æ•¸å­—</p>
                            <div class="text-xs text-blue-600 font-medium">ğŸ¯ ç¶“å…¸ç©æ³•</div>
                        </div>
                    </div>

                    <div class="difficulty-card bg-white rounded-xl p-6 shadow-lg border-2 border-orange-200 cursor-pointer transition-all duration-300" data-digits="5" id="hardMode">
                        <div class="text-center space-y-3">
                            <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto">
                                <i class="fas fa-fire text-orange-600 text-xl"></i>
                            </div>
                            <h3 class="font-bold text-lg text-gray-800">é€²éšæ¨¡å¼</h3>
                            <p class="text-sm text-gray-600">5 ä½æ•¸å­—</p>
                            <div class="text-xs text-orange-600 font-medium">ğŸ”¥ æŒ‘æˆ°æ€ç¶­</div>
                        </div>
                    </div>

                    <div class="difficulty-card bg-white rounded-xl p-6 shadow-lg border-2 border-purple-200 cursor-pointer transition-all duration-300 opacity-50" data-digits="6" id="expertMode">
                        <div class="text-center space-y-3">
                            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto">
                                <i class="fas fa-crown text-purple-600 text-xl"></i>
                            </div>
                            <h3 class="font-bold text-lg text-gray-800">å¤§å¸«æ¨¡å¼</h3>
                            <p class="text-sm text-gray-600">6 ä½æ•¸å­—</p>
                            <div class="text-xs text-purple-600 font-medium">ğŸ”’ éœ€ç­‰ç´š 5</div>
                        </div>
                    </div>
                </div>

                <!-- å…’ç«¥æ¨¡å¼é–‹é—œ -->
                <div class="flex items-center justify-center space-x-3 bg-white rounded-xl p-4 shadow-lg max-w-md mx-auto">
                    <i class="fas fa-child text-yellow-500 text-xl"></i>
                    <span class="font-medium text-gray-700">å…’ç«¥å‹å–„æ¨¡å¼</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="childModeToggle" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                </div>
            </div>

            <!-- éŠæˆ²ç•«é¢ -->
            <div id="gameScreen" class="hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    
                    <!-- å°è©±å€åŸŸ -->
                    <div class="lg:col-span-2 space-y-4">
                        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
                            <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                                        <i class="fas fa-robot text-lg"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold">AI åŠ©æ‰‹å°è—</h3>
                                        <p class="text-sm opacity-90">æ­£åœ¨å¹«æ‚¨åˆ†æé‚è¼¯...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="chatArea" class="h-80 overflow-y-auto p-4 space-y-3 bg-gray-50">
                                <!-- å°è©±å…§å®¹å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                            </div>
                        </div>

                        <!-- è¼¸å…¥å€åŸŸ -->
                        <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-4">
                            <div class="space-y-4">
                                <div class="flex items-center space-x-2">
                                    <label class="font-medium text-gray-700">ç¬¬ <span id="currentRound">1</span> å›åˆ</label>
                                    <div class="flex-1 bg-gray-200 rounded-full h-2">
                                        <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-300" style="width: 6.67%"></div>
                                    </div>
                                    <span class="text-sm text-gray-500">æœ€å¤š 15 å›åˆ</span>
                                </div>
                                
                                <div class="flex space-x-3">
                                    <input 
                                        type="text" 
                                        id="guessInput" 
                                        class="flex-1 number-input px-4 py-3 border border-gray-300 rounded-lg focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all"
                                        placeholder="è¼¸å…¥æ‚¨çš„çŒœæ¸¬..."
                                        maxlength="6"
                                    >
                                    <button 
                                        id="submitGuess" 
                                        class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 font-medium"
                                    >
                                        æäº¤ <i class="fas fa-paper-plane ml-1"></i>
                                    </button>
                                </div>

                                <!-- å…’ç«¥æ¨¡å¼æç¤º -->
                                <div id="childHints" class="hidden bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-yellow-700">
                                            <i class="fas fa-lightbulb mr-1"></i>
                                            é‚„æœ‰ <span id="hintsLeft">3</span> æ¬¡æç¤ºæ©Ÿæœƒ
                                        </span>
                                        <button id="useHint" class="text-sm bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 transition-colors">
                                            ä½¿ç”¨æç¤º âœ¨
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å´é‚Šè³‡è¨Šå€ -->
                    <div class="space-y-4">
                        <!-- éŠæˆ²ç‹€æ…‹ -->
                        <div class="stat-card rounded-xl p-4 border border-gray-200">
                            <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
                                <i class="fas fa-chart-line mr-2 text-blue-500"></i>
                                éŠæˆ²ç‹€æ…‹
                            </h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">ç›®æ¨™ä½æ•¸ï¼š</span>
                                    <span id="targetDigits" class="font-medium text-blue-600">4</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">å·²ç”¨æ™‚é–“ï¼š</span>
                                    <span id="gameTimer" class="font-medium text-green-600">00:00</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">ç›®å‰å›åˆï¼š</span>
                                    <span id="roundDisplay" class="font-medium text-orange-600">1/15</span>
                                </div>
                            </div>
                        </div>

                        <!-- æ­·å²è¨˜éŒ„ -->
                        <div class="stat-card rounded-xl p-4 border border-gray-200">
                            <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
                                <i class="fas fa-history mr-2 text-purple-500"></i>
                                çŒœæ¸¬è¨˜éŒ„
                            </h3>
                            <div id="guessHistory" class="space-y-2 text-sm max-h-40 overflow-y-auto">
                                <p class="text-gray-500 text-center py-4">å°šç„¡è¨˜éŒ„</p>
                            </div>
                        </div>

                        <!-- æˆå°±å±•ç¤º -->
                        <div class="stat-card rounded-xl p-4 border border-gray-200">
                            <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
                                <i class="fas fa-trophy mr-2 text-yellow-500"></i>
                                æˆå°±å¾½ç« 
                            </h3>
                            <div id="achievementDisplay" class="grid grid-cols-3 gap-2">
                                <!-- æˆå°±å¾½ç« å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- éŠæˆ²çµæŸç•«é¢ -->
            <div id="gameEndScreen" class="hidden text-center space-y-6">
                <div class="space-y-4">
                    <div id="victoryIcon" class="inline-block p-6 bg-gradient-to-r from-green-400 to-blue-500 rounded-full animate-celebrate">
                        <i class="fas fa-trophy text-white text-5xl"></i>
                    </div>
                    <h2 id="gameEndTitle" class="text-4xl font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">
                        æ­å–œéé—œï¼
                    </h2>
                    <p id="gameEndMessage" class="text-lg text-gray-600 max-w-2xl mx-auto">
                        æ‚¨åœ¨ç¬¬ X å›åˆæˆåŠŸçŒœå‡ºç­”æ¡ˆï¼
                    </p>
                </div>

                <!-- æˆç¸¾çµ±è¨ˆ -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto">
                    <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-200">
                        <div class="text-center space-y-2">
                            <i class="fas fa-clock text-blue-500 text-2xl"></i>
                            <h3 class="font-semibold text-gray-800">éŠæˆ²æ™‚é–“</h3>
                            <p id="finalTime" class="text-2xl font-bold text-blue-600">02:34</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-200">
                        <div class="text-center space-y-2">
                            <i class="fas fa-target text-green-500 text-2xl"></i>
                            <h3 class="font-semibold text-gray-800">å®Œæˆå›åˆ</h3>
                            <p id="finalRounds" class="text-2xl font-bold text-green-600">7</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-200">
                        <div class="text-center space-y-2">
                            <i class="fas fa-star text-yellow-500 text-2xl"></i>
                            <h3 class="font-semibold text-gray-800">ç²å¾—ç¶“é©—</h3>
                            <p id="expGained" class="text-2xl font-bold text-yellow-600">+50 XP</p>
                        </div>
                    </div>
                </div>

                <!-- æ–°è§£é–å…§å®¹ -->
                <div id="unlockedContent" class="hidden space-y-4">
                    <h3 class="text-xl font-semibold text-purple-600">ğŸ‰ æ–°å…§å®¹è§£é–ï¼</h3>
                    <div id="unlockedItems" class="flex flex-wrap justify-center gap-3">
                        <!-- è§£é–é …ç›®å°‡åœ¨é€™è£¡é¡¯ç¤º -->
                    </div>
                </div>

                <!-- æ“ä½œæŒ‰éˆ• -->
                <div class="flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto">
                    <button id="playAgainBtn" class="flex-1 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 font-medium">
                        <i class="fas fa-redo mr-2"></i>å†ç©ä¸€æ¬¡
                    </button>
                    <button id="changeDifficultyBtn" class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all duration-300 font-medium">
                        <i class="fas fa-cogs mr-2"></i>æ›´æ›é›£åº¦
                    </button>
                </div>
            </div>

        </main>

        <!-- è¨­å®šé¢æ¿ -->
        <div id="settingsPanel" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6 space-y-6">
                    <div class="flex items-center justify-between">
                        <h2 class="text-xl font-bold text-gray-800">éŠæˆ²è¨­å®š</h2>
                        <button id="closeSettings" class="text-gray-500 hover:text-gray-700 text-xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <!-- å€‹äººçµ±è¨ˆ -->
                    <div class="space-y-4">
                        <h3 class="font-semibold text-gray-700 border-b pb-2">å€‹äººçµ±è¨ˆ</h3>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div class="text-center p-3 bg-blue-50 rounded-lg">
                                <div class="text-blue-600 font-bold text-lg" id="totalGames">0</div>
                                <div class="text-gray-600">ç¸½éŠæˆ²æ•¸</div>
                            </div>
                            <div class="text-center p-3 bg-green-50 rounded-lg">
                                <div class="text-green-600 font-bold text-lg" id="winRate">0%</div>
                                <div class="text-gray-600">å‹ç‡</div>
                            </div>
                            <div class="text-center p-3 bg-purple-50 rounded-lg">
                                <div class="text-purple-600 font-bold text-lg" id="avgRounds">0</div>
                                <div class="text-gray-600">å¹³å‡å›åˆ</div>
                            </div>
                            <div class="text-center p-3 bg-yellow-50 rounded-lg">
                                <div class="text-yellow-600 font-bold text-lg" id="bestScore">-</div>
                                <div class="text-gray-600">æœ€ä½³æˆç¸¾</div>
                            </div>
                        </div>
                    </div>

                    <!-- æ’è¡Œæ¦œ -->
                    <div class="space-y-4">
                        <h3 class="font-semibold text-gray-700 border-b pb-2">æœ¬åœ°æ’è¡Œæ¦œ</h3>
                        <div id="leaderboard" class="space-y-2 text-sm">
                            <!-- æ’è¡Œæ¦œå…§å®¹ -->
                        </div>
                    </div>

                    <!-- æ•¸æ“šç®¡ç† -->
                    <div class="space-y-4">
                        <h3 class="font-semibold text-gray-700 border-b pb-2">æ•¸æ“šç®¡ç†</h3>
                        <div class="space-y-2">
                            <button id="exportData" class="w-full px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                <i class="fas fa-download mr-2"></i>åŒ¯å‡ºéŠæˆ²æ•¸æ“š
                            </button>
                            <button id="resetData" class="w-full px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                                <i class="fas fa-trash mr-2"></i>é‡ç½®æ‰€æœ‰æ•¸æ“š
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æˆå°±è§£é–é€šçŸ¥ -->
        <div id="achievementNotification" class="hidden fixed top-4 right-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-4 rounded-lg shadow-lg z-50 animate-slide-up">
            <div class="flex items-center space-x-3">
                <i class="fas fa-trophy text-2xl"></i>
                <div>
                    <div class="font-bold">æˆå°±è§£é–ï¼</div>
                    <div id="achievementText" class="text-sm opacity-90"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== éŠæˆ²æ ¸å¿ƒé¡åˆ¥å®šç¾© =====
        
        class Game1A2B {
            constructor() {
                this.gameState = {
                    isPlaying: false,
                    currentScreen: 'welcome', // welcome, game, end
                    digits: 4,
                    maxRounds: 15,
                    currentRound: 1,
                    target: '',
                    guesses: [],
                    startTime: null,
                    childMode: false,
                    hintsUsed: 0,
                    maxHints: 3
                };
                
                this.playerData = this.loadPlayerData();
                this.achievements = this.initAchievements();
                this.gameTimer = null;
                
                this.initEventListeners();
                this.updateUI();
                this.checkUnlockedModes();
            }
            
            // è¼‰å…¥ç©å®¶æ•¸æ“š
            loadPlayerData() {
                const defaultData = {
                    uid: this.generateUID(),
                    level: 1,
                    experience: 0,
                    gamesPlayed: 0,
                    gamesWon: 0,
                    bestScores: {
                        3: null,
                        4: null,
                        5: null,
                        6: null
                    },
                    unlockedModes: {
                        3: true,
                        4: true,
                        5: false,
                        6: false
                    },
                    achievements: [],
                    history: []
                };
                
                const saved = localStorage.getItem('1a2b_player_data');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        return { ...defaultData, ...data };
                    } catch (e) {
                        console.warn('ç„¡æ³•è¼‰å…¥ç©å®¶æ•¸æ“šï¼Œä½¿ç”¨é è¨­å€¼');
                        return defaultData;
                    }
                }
                
                this.savePlayerData(defaultData);
                return defaultData;
            }
            
            // å„²å­˜ç©å®¶æ•¸æ“š
            savePlayerData(data = null) {
                const dataToSave = data || this.playerData;
                localStorage.setItem('1a2b_player_data', JSON.stringify(dataToSave));
            }
            
            // ç”Ÿæˆå”¯ä¸€è­˜åˆ¥ç¢¼
            generateUID() {
                return 'player_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            
            // åˆå§‹åŒ–æˆå°±ç³»çµ±
            initAchievements() {
                return {
                    firstWin: { name: 'åˆè©¦å•¼è²', desc: 'å®Œæˆç¬¬ä¸€å ´éŠæˆ²', icon: 'fa-baby', earned: false },
                    speedRunner: { name: 'é–ƒé›»çŒœæ‰‹', desc: 'åœ¨ 5 å›åˆå…§å®Œæˆ 4 ä½æ•¸', icon: 'fa-bolt', earned: false },
                    persistent: { name: 'é¥è€Œä¸æ¨', desc: 'å®Œæˆ 10 å ´éŠæˆ²', icon: 'fa-mountain', earned: false },
                    genius: { name: 'æ•¸å­—å¤©æ‰', desc: 'å®Œæˆ 6 ä½æ•¸æŒ‘æˆ°', icon: 'fa-brain', earned: false },
                    perfectGame: { name: 'å®Œç¾éŠæˆ²', desc: 'æœªä½¿ç”¨æç¤ºå®Œæˆå›°é›£æ¨¡å¼', icon: 'fa-crown', earned: false },
                    veteran: { name: 'éŠæˆ²è€å…µ', desc: 'é”åˆ°ç­‰ç´š 5', icon: 'fa-medal', earned: false }
                };
            }
            
            // æª¢æŸ¥è§£é–æ¨¡å¼
            checkUnlockedModes() {
                // æ ¹æ“šç­‰ç´šè§£é–æ¨¡å¼
                if (this.playerData.level >= 3) {
                    this.playerData.unlockedModes[5] = true;
                }
                if (this.playerData.level >= 5) {
                    this.playerData.unlockedModes[6] = true;
                }
                
                // æ›´æ–°UI
                const hardMode = document.getElementById('hardMode');
                const expertMode = document.getElementById('expertMode');
                
                if (this.playerData.unlockedModes[5]) {
                    hardMode.classList.remove('opacity-50');
                } else {
                    hardMode.classList.add('opacity-50');
                }
                
                if (this.playerData.unlockedModes[6]) {
                    expertMode.classList.remove('opacity-50');
                    expertMode.querySelector('.text-xs').innerHTML = 'ğŸ‘‘ å¤§å¸«æŒ‘æˆ°';
                } else {
                    expertMode.classList.add('opacity-50');
                }
            }
            
            // åˆå§‹åŒ–äº‹ä»¶ç›£è½å™¨
            initEventListeners() {
                // é›£åº¦é¸æ“‡
                document.querySelectorAll('.difficulty-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const digits = parseInt(e.currentTarget.dataset.digits);
                        if (this.playerData.unlockedModes[digits]) {
                            this.startNewGame(digits);
                        } else {
                            this.showNotification('æ­¤æ¨¡å¼å°šæœªè§£é–ï¼éœ€è¦é”åˆ°æ›´é«˜ç­‰ç´š', 'warning');
                        }
                    });
                });
                
                // å…’ç«¥æ¨¡å¼åˆ‡æ›
                document.getElementById('childModeToggle').addEventListener('change', (e) => {
                    this.gameState.childMode = e.target.checked;
                });
                
                // éŠæˆ²è¼¸å…¥
                const guessInput = document.getElementById('guessInput');
                const submitBtn = document.getElementById('submitGuess');
                
                guessInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.submitGuess();
                    }
                    
                    // åªå…è¨±æ•¸å­—è¼¸å…¥
                    if (!/\d/.test(e.key) && !['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                        e.preventDefault();
                    }
                });
                
                guessInput.addEventListener('input', (e) => {
                    // ç§»é™¤é‡è¤‡æ•¸å­—
                    let value = e.target.value;
                    let uniqueValue = '';
                    for (let char of value) {
                        if (!uniqueValue.includes(char)) {
                            uniqueValue += char;
                        }
                    }
                    if (value !== uniqueValue) {
                        e.target.value = uniqueValue;
                    }
                });
                
                submitBtn.addEventListener('click', () => this.submitGuess());
                
                // æç¤ºæŒ‰éˆ•
                document.getElementById('useHint').addEventListener('click', () => this.useHint());
                
                // éŠæˆ²çµæŸæŒ‰éˆ•
                document.getElementById('playAgainBtn').addEventListener('click', () => {
                    this.startNewGame(this.gameState.digits);
                });
                
                document.getElementById('changeDifficultyBtn').addEventListener('click', () => {
                    this.showScreen('welcome');
                });
                
                // è¨­å®šé¢æ¿
                document.getElementById('settingsBtn').addEventListener('click', () => {
                    document.getElementById('settingsPanel').classList.remove('hidden');
                    this.updateSettingsPanel();
                });
                
                document.getElementById('closeSettings').addEventListener('click', () => {
                    document.getElementById('settingsPanel').classList.add('hidden');
                });
                
                // æ•¸æ“šç®¡ç†
                document.getElementById('exportData').addEventListener('click', () => this.exportData());
                document.getElementById('resetData').addEventListener('click', () => this.resetData());
            }
            
            // é–‹å§‹æ–°éŠæˆ²
            startNewGame(digits) {
                this.gameState = {
                    ...this.gameState,
                    isPlaying: true,
                    digits: digits,
                    currentRound: 1,
                    target: this.generateTarget(digits),
                    guesses: [],
                    startTime: Date.now(),
                    hintsUsed: 0
                };
                
                this.showScreen('game');
                this.startTimer();
                this.updateGameUI();
                this.addChatMessage('bot', this.getWelcomeMessage(digits));
                
                document.getElementById('guessInput').focus();
            }
            
            // ç”Ÿæˆç›®æ¨™æ•¸å­—
            generateTarget(digits) {
                const available = '0123456789'.split('');
                let target = '';
                
                for (let i = 0; i < digits; i++) {
                    const randomIndex = Math.floor(Math.random() * available.length);
                    target += available[randomIndex];
                    available.splice(randomIndex, 1);
                }
                
                console.log('ç›®æ¨™æ•¸å­—ï¼ˆé–‹ç™¼ç”¨ï¼‰:', target); // é–‹ç™¼æ™‚å¯ç”¨
                return target;
            }
            
            // ç²å¾—æ­¡è¿è¨Šæ¯
            getWelcomeMessage(digits) {
                const messages = {
                    3: 'æ­¡è¿ä¾†åˆ°åˆç´šæ¨¡å¼ï¼æˆ‘å¹«æ‚¨æº–å‚™äº†ä¸€å€‹ 3 ä½æ•¸å­—ï¼Œæ¯å€‹æ•¸å­—éƒ½ä¸ç›¸åŒå–”ï¼ğŸŒŸ',
                    4: 'æº–å‚™å¥½äº†å—ï¼Ÿé€™æ˜¯ç¶“å…¸çš„ 4 ä½æ•¸æŒ‘æˆ°ï¼é‹ç”¨é‚è¼¯æ¨ç†æ‰¾å‡ºç­”æ¡ˆå§ï¼ğŸ¯',
                    5: 'å“‡ï¼é€²éšæ¨¡å¼éœ€è¦æ›´å¼·çš„é‚è¼¯æ€ç¶­ï¼Œ5 ä½æ•¸å­—ç­‰è‘—æ‚¨ä¾†ç ´è§£ï¼ğŸ”¥',
                    6: 'æ­å–œé€²å…¥å¤§å¸«ç´šæŒ‘æˆ°ï¼6 ä½æ•¸å­—æ˜¯çœŸæ­£é«˜æ‰‹çš„æˆ°å ´ï¼ğŸ‘‘'
                };
                
                let message = messages[digits] || 'è®“æˆ‘å€‘é–‹å§‹é€™å ´æ™ºæ…§æŒ‘æˆ°ï¼';
                
                if (this.gameState.childMode) {
                    message += '\n\nğŸˆ å…’ç«¥æ¨¡å¼å·²å•Ÿå‹•ï¼š\nğŸ”µ = Aï¼ˆæ•¸å­—å’Œä½ç½®éƒ½å°ï¼‰\nğŸŸ¡ = Bï¼ˆæ•¸å­—å°ä½†ä½ç½®ä¸å°ï¼‰\næ‚¨é‚„å¯ä»¥ä½¿ç”¨ 3 æ¬¡æç¤ºå–”ï¼';
                }
                
                return message;
            }
            
            // æäº¤çŒœæ¸¬
            submitGuess() {
                const input = document.getElementById('guessInput');
                const guess = input.value.trim();
                
                if (!this.validateGuess(guess)) {
                    return;
                }
                
                const result = this.calculateResult(guess, this.gameState.target);
                this.gameState.guesses.push({ guess, result, round: this.gameState.currentRound });
                
                // æ›´æ–°èŠå¤©
                this.addChatMessage('user', `æˆ‘çŒœï¼š${guess}`);
                this.addChatMessage('bot', this.formatResult(result, guess));
                
                // æª¢æŸ¥æ˜¯å¦ç²å‹
                if (result.A === this.gameState.digits) {
                    this.endGame(true);
                    return;
                }
                
                // æª¢æŸ¥æ˜¯å¦é”åˆ°æœ€å¤§å›åˆæ•¸
                if (this.gameState.currentRound >= this.gameState.maxRounds) {
                    this.endGame(false);
                    return;
                }
                
                this.gameState.currentRound++;
                this.updateGameUI();
                input.value = '';
                input.focus();
            }
            
            // é©—è­‰çŒœæ¸¬
            validateGuess(guess) {
                if (guess.length !== this.gameState.digits) {
                    this.showNotification(`è«‹è¼¸å…¥ ${this.gameState.digits} ä½æ•¸å­—`, 'warning');
                    return false;
                }
                
                if (!/^\d+$/.test(guess)) {
                    this.showNotification('åªèƒ½è¼¸å…¥æ•¸å­—', 'warning');
                    return false;
                }
                
                if (new Set(guess).size !== guess.length) {
                    this.showNotification('æ•¸å­—ä¸èƒ½é‡è¤‡', 'warning');
                    return false;
                }
                
                return true;
            }
            
            // è¨ˆç®—çµæœ
            calculateResult(guess, target) {
                let A = 0, B = 0;
                
                for (let i = 0; i < guess.length; i++) {
                    if (guess[i] === target[i]) {
                        A++;
                    } else if (target.includes(guess[i])) {
                        B++;
                    }
                }
                
                return { A, B };
            }
            
            // æ ¼å¼åŒ–çµæœè¨Šæ¯
            formatResult(result, guess) {
                let message = `çµæœï¼š${result.A}A${result.B}B`;
                
                if (this.gameState.childMode) {
                    message += '\n' + 'ğŸ”µ'.repeat(result.A) + 'ğŸŸ¡'.repeat(result.B);
                }
                
                // æ ¹æ“šçµæœçµ¦äºˆé¼“å‹µ
                if (result.A === this.gameState.digits) {
                    message += '\n\nğŸ‰ å¤ªæ£’äº†ï¼æ‚¨æˆåŠŸç ´è§£äº†å¯†ç¢¼ï¼';
                } else if (result.A > 0) {
                    message += `\n\nå¾ˆå¥½ï¼æœ‰ ${result.A} å€‹æ•¸å­—ä½ç½®å®Œå…¨æ­£ç¢ºï¼`;
                } else if (result.B > 0) {
                    message += `\n\nä¸éŒ¯ï¼æœ‰ ${result.B} å€‹æ•¸å­—å­˜åœ¨ä½†ä½ç½®éœ€è¦èª¿æ•´ï¼`;
                } else {
                    message += '\n\né€™äº›æ•¸å­—éƒ½ä¸åœ¨ç­”æ¡ˆä¸­ï¼Œè©¦è©¦å…¶ä»–æ•¸å­—å§ï¼';
                }
                
                return message;
            }
            
            // ä½¿ç”¨æç¤º
            useHint() {
                if (this.gameState.hintsUsed >= this.gameState.maxHints) {
                    this.showNotification('æç¤ºæ¬¡æ•¸å·²ç”¨å®Œ', 'warning');
                    return;
                }
                
                this.gameState.hintsUsed++;
                
                // éš¨æ©Ÿçµ¦å‡ºä¸€å€‹ä½ç½®çš„æ­£ç¢ºæ•¸å­—
                const randomIndex = Math.floor(Math.random() * this.gameState.target.length);
                const hintDigit = this.gameState.target[randomIndex];
                
                this.addChatMessage('bot', `ğŸ’¡ æç¤ºï¼šç¬¬ ${randomIndex + 1} ä½æ•¸å­—æ˜¯ ${hintDigit}`);
                
                document.getElementById('hintsLeft').textContent = this.gameState.maxHints - this.gameState.hintsUsed;
                
                if (this.gameState.hintsUsed >= this.gameState.maxHints) {
                    document.getElementById('useHint').disabled = true;
                    document.getElementById('useHint').textContent = 'æç¤ºå·²ç”¨å®Œ';
                }
            }
            
            // éŠæˆ²çµæŸ
            endGame(won) {
                this.gameState.isPlaying = false;
                clearInterval(this.gameTimer);
                
                const endTime = Date.now();
                const totalTime = Math.floor((endTime - this.gameState.startTime) / 1000);
                const rounds = won ? this.gameState.currentRound : this.gameState.maxRounds;
                
                // è¨˜éŒ„éŠæˆ²æ­·å²
                const gameRecord = {
                    date: new Date().toISOString().split('T')[0],
                    digits: this.gameState.digits,
                    won: won,
                    rounds: rounds,
                    time: totalTime,
                    hintsUsed: this.gameState.hintsUsed,
                    target: this.gameState.target
                };
                
                this.playerData.history.push(gameRecord);
                this.playerData.gamesPlayed++;
                
                if (won) {
                    this.playerData.gamesWon++;
                    
                    // æ›´æ–°æœ€ä½³æˆç¸¾
                    const currentBest = this.playerData.bestScores[this.gameState.digits];
                    if (!currentBest || rounds < currentBest) {
                        this.playerData.bestScores[this.gameState.digits] = rounds;
                    }
                    
                    // è¨ˆç®—ç¶“é©—å€¼
                    const expGained = this.calculateExperience(rounds, totalTime, this.gameState.digits, this.gameState.hintsUsed);
                    this.playerData.experience += expGained;
                    
                    // æª¢æŸ¥å‡ç´š
                    this.checkLevelUp();
                    
                    // æª¢æŸ¥æˆå°±
                    this.checkAchievements();
                    
                    this.showGameEndScreen(true, rounds, totalTime, expGained);
                } else {
                    this.addChatMessage('bot', `éŠæˆ²çµæŸï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${this.gameState.target}`);
                    this.showGameEndScreen(false, rounds, totalTime, 0);
                }
                
                this.savePlayerData();
            }
            
            // è¨ˆç®—ç¶“é©—å€¼
            calculateExperience(rounds, time, digits, hints) {
                let baseExp = digits * 10; // åŸºç¤ç¶“é©—
                
                // å›åˆæ•¸çå‹µï¼ˆè¶Šå°‘å›åˆè¶Šå¤šç¶“é©—ï¼‰
                const roundBonus = Math.max(0, (15 - rounds) * 5);
                
                // æ™‚é–“çå‹µï¼ˆè¶Šå¿«è¶Šå¤šç¶“é©—ï¼‰
                const timeBonus = Math.max(0, Math.floor((300 - time) / 10));
                
                // æç¤ºæ‡²ç½°
                const hintPenalty = hints * 10;
                
                return Math.max(10, baseExp + roundBonus + timeBonus - hintPenalty);
            }
            
            // æª¢æŸ¥å‡ç´š
            checkLevelUp() {
                const requiredExp = this.playerData.level * 100;
                if (this.playerData.experience >= requiredExp) {
                    this.playerData.level++;
                    this.playerData.experience -= requiredExp;
                    this.showNotification(`ğŸ‰ æ­å–œå‡ç´šåˆ°ç­‰ç´š ${this.playerData.level}ï¼`, 'success');
                    this.checkUnlockedModes();
                }
            }
            
            // æª¢æŸ¥æˆå°±
            checkAchievements() {
                const newAchievements = [];
                
                // åˆè©¦å•¼è²
                if (this.playerData.gamesWon === 1 && !this.playerData.achievements.includes('firstWin')) {
                    newAchievements.push('firstWin');
                }
                
                // é–ƒé›»çŒœæ‰‹
                if (this.gameState.digits === 4 && this.gameState.currentRound <= 5 && !this.playerData.achievements.includes('speedRunner')) {
                    newAchievements.push('speedRunner');
                }
                
                // é¥è€Œä¸æ¨
                if (this.playerData.gamesPlayed >= 10 && !this.playerData.achievements.includes('persistent')) {
                    newAchievements.push('persistent');
                }
                
                // æ•¸å­—å¤©æ‰
                if (this.gameState.digits === 6 && !this.playerData.achievements.includes('genius')) {
                    newAchievements.push('genius');
                }
                
                // å®Œç¾éŠæˆ²
                if (this.gameState.digits >= 5 && this.gameState.hintsUsed === 0 && !this.playerData.achievements.includes('perfectGame')) {
                    newAchievements.push('perfectGame');
                }
                
                // éŠæˆ²è€å…µ
                if (this.playerData.level >= 5 && !this.playerData.achievements.includes('veteran')) {
                    newAchievements.push('veteran');
                }
                
                // é¡¯ç¤ºæ–°æˆå°±
                newAchievements.forEach(achievementId => {
                    this.playerData.achievements.push(achievementId);
                    this.showAchievementUnlock(achievementId);
                });
            }
            
            // é¡¯ç¤ºæˆå°±è§£é–
            showAchievementUnlock(achievementId) {
                const achievement = this.achievements[achievementId];
                const notification = document.getElementById('achievementNotification');
                const text = document.getElementById('achievementText');
                
                text.textContent = `${achievement.name}: ${achievement.desc}`;
                notification.classList.remove('hidden');
                
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 4000);
            }
            
            // é¡¯ç¤ºéŠæˆ²çµæŸç•«é¢
            showGameEndScreen(won, rounds, time, exp) {
                const title = document.getElementById('gameEndTitle');
                const message = document.getElementById('gameEndMessage');
                const icon = document.getElementById('victoryIcon');
                
                if (won) {
                    title.textContent = 'ğŸ‰ æ­å–œéé—œï¼';
                    message.textContent = `æ‚¨åœ¨ç¬¬ ${rounds} å›åˆæˆåŠŸçŒœå‡º ${this.gameState.digits} ä½æ•¸å­—ï¼`;
                    icon.innerHTML = '<i class="fas fa-trophy text-white text-5xl"></i>';
                } else {
                    title.textContent = 'ğŸ˜… å†æ¥å†å²ï¼';
                    message.textContent = `å¾ˆéºæ†¾ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ ${this.gameState.target}ï¼Œä¸‹æ¬¡å†æŒ‘æˆ°å§ï¼`;
                    icon.innerHTML = '<i class="fas fa-heart text-white text-5xl"></i>';
                }
                
                // æ›´æ–°çµ±è¨ˆ
                document.getElementById('finalTime').textContent = this.formatTime(time);
                document.getElementById('finalRounds').textContent = rounds;
                document.getElementById('expGained').textContent = `+${exp} XP`;
                
                this.showScreen('end');
            }
            
            // æ ¼å¼åŒ–æ™‚é–“
            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            // é–‹å§‹è¨ˆæ™‚å™¨
            startTimer() {
                this.gameTimer = setInterval(() => {
                    if (this.gameState.startTime) {
                        const elapsed = Math.floor((Date.now() - this.gameState.startTime) / 1000);
                        document.getElementById('gameTimer').textContent = this.formatTime(elapsed);
                    }
                }, 1000);
            }
            
            // æ·»åŠ èŠå¤©è¨Šæ¯
            addChatMessage(sender, message) {
                const chatArea = document.getElementById('chatArea');
                const messageDiv = document.createElement('div');
                messageDiv.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'} animate-fade-in`;
                
                messageDiv.innerHTML = `
                    <div class="chat-bubble chat-${sender} px-4 py-2 rounded-lg">
                        ${message.replace(/\n/g, '<br>')}
                    </div>
                `;
                
                chatArea.appendChild(messageDiv);
                chatArea.scrollTop = chatArea.scrollHeight;
            }
            
            // æ›´æ–°éŠæˆ²UI
            updateGameUI() {
                document.getElementById('targetDigits').textContent = this.gameState.digits;
                document.getElementById('currentRound').textContent = this.gameState.currentRound;
                document.getElementById('roundDisplay').textContent = `${this.gameState.currentRound}/${this.gameState.maxRounds}`;
                
                // æ›´æ–°é€²åº¦æ¢
                const progress = (this.gameState.currentRound / this.gameState.maxRounds) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;
                
                // æ›´æ–°çŒœæ¸¬æ­·å²
                this.updateGuessHistory();
                
                // æ›´æ–°å…’ç«¥æ¨¡å¼UI
                if (this.gameState.childMode) {
                    document.getElementById('childHints').classList.remove('hidden');
                    document.getElementById('hintsLeft').textContent = this.gameState.maxHints - this.gameState.hintsUsed;
                } else {
                    document.getElementById('childHints').classList.add('hidden');
                }
                
                // æ›´æ–°è¼¸å…¥æ¡†ä½”ä½ç¬¦
                document.getElementById('guessInput').placeholder = `è¼¸å…¥ ${this.gameState.digits} ä½æ•¸å­—...`;
                document.getElementById('guessInput').maxLength = this.gameState.digits;
            }
            
            // æ›´æ–°çŒœæ¸¬æ­·å²
            updateGuessHistory() {
                const historyDiv = document.getElementById('guessHistory');
                
                if (this.gameState.guesses.length === 0) {
                    historyDiv.innerHTML = '<p class="text-gray-500 text-center py-4">å°šç„¡è¨˜éŒ„</p>';
                    return;
                }
                
                historyDiv.innerHTML = this.gameState.guesses.slice(-5).reverse().map(item => `
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                        <span class="font-mono">${item.guess}</span>
                        <span class="text-sm font-medium text-blue-600">${item.result.A}A${item.result.B}B</span>
                    </div>
                `).join('');
            }
            
            // æ›´æ–°æ•´é«”UI
            updateUI() {
                document.getElementById('playerLevel').textContent = `ç­‰ç´š ${this.playerData.level} ${this.getLevelTitle()}`;
                document.getElementById('expDisplay').textContent = `${this.playerData.experience} XP`;
                document.getElementById('gamesPlayed').textContent = this.playerData.gamesPlayed;
                
                this.updateAchievementDisplay();
            }
            
            // ç²å¾—ç­‰ç´šç¨±è™Ÿ
            getLevelTitle() {
                const titles = {
                    1: 'æ–°æ‰‹ç©å®¶',
                    2: 'è¦‹ç¿’çŒœæ‰‹',
                    3: 'é‚è¼¯é”äºº',
                    4: 'æ¨ç†å°ˆå®¶',
                    5: 'æ•¸å­—å¤§å¸«'
                };
                return titles[Math.min(this.playerData.level, 5)] || 'å‚³å¥‡ç©å®¶';
            }
            
            // æ›´æ–°æˆå°±é¡¯ç¤º
            updateAchievementDisplay() {
                const achievementDiv = document.getElementById('achievementDisplay');
                
                achievementDiv.innerHTML = Object.entries(this.achievements).map(([id, achievement]) => {
                    const earned = this.playerData.achievements.includes(id);
                    return `
                        <div class="text-center p-2 rounded-lg border ${earned ? 'bg-yellow-50 border-yellow-200' : 'bg-gray-50 border-gray-200'}" title="${achievement.desc}">
                            <i class="fas ${achievement.icon} text-lg ${earned ? 'text-yellow-600' : 'text-gray-400'}"></i>
                            <div class="text-xs mt-1 ${earned ? 'text-yellow-700' : 'text-gray-500'}">${achievement.name}</div>
                        </div>
                    `;
                }).join('');
            }
            
            // é¡¯ç¤ºæŒ‡å®šç•«é¢
            showScreen(screen) {
                document.getElementById('welcomeScreen').classList.add('hidden');
                document.getElementById('gameScreen').classList.add('hidden');
                document.getElementById('gameEndScreen').classList.add('hidden');
                
                document.getElementById(`${screen}Screen`).classList.remove('hidden');
                this.gameState.currentScreen = screen;
                
                if (screen === 'game') {
                    document.getElementById('chatArea').innerHTML = '';
                }
            }
            
            // é¡¯ç¤ºé€šçŸ¥
            showNotification(message, type = 'info') {
                // ç°¡å–®çš„é€šçŸ¥å¯¦ç¾
                const colors = {
                    success: 'bg-green-500',
                    warning: 'bg-yellow-500',
                    error: 'bg-red-500',
                    info: 'bg-blue-500'
                };
                
                const notification = document.createElement('div');
                notification.className = `fixed top-4 left-1/2 transform -translate-x-1/2 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-slide-up`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
            
            // æ›´æ–°è¨­å®šé¢æ¿
            updateSettingsPanel() {
                document.getElementById('totalGames').textContent = this.playerData.gamesPlayed;
                document.getElementById('winRate').textContent = this.playerData.gamesPlayed > 0 ? 
                    Math.round((this.playerData.gamesWon / this.playerData.gamesPlayed) * 100) + '%' : '0%';
                
                // è¨ˆç®—å¹³å‡å›åˆæ•¸
                const avgRounds = this.playerData.history.filter(g => g.won).length > 0 ?
                    Math.round(this.playerData.history.filter(g => g.won).reduce((sum, g) => sum + g.rounds, 0) / this.playerData.history.filter(g => g.won).length) : 0;
                document.getElementById('avgRounds').textContent = avgRounds;
                
                // æœ€ä½³æˆç¸¾
                const bestScore = Math.min(...Object.values(this.playerData.bestScores).filter(s => s !== null));
                document.getElementById('bestScore').textContent = isFinite(bestScore) ? bestScore : '-';
                
                // æ’è¡Œæ¦œ
                this.updateLeaderboard();
            }
            
            // æ›´æ–°æ’è¡Œæ¦œ
            updateLeaderboard() {
                const leaderboard = document.getElementById('leaderboard');
                const topGames = this.playerData.history
                    .filter(g => g.won)
                    .sort((a, b) => a.rounds - b.rounds)
                    .slice(0, 5);
                
                if (topGames.length === 0) {
                    leaderboard.innerHTML = '<p class="text-gray-500 text-center py-4">æš«ç„¡è¨˜éŒ„</p>';
                    return;
                }
                
                leaderboard.innerHTML = topGames.map((game, index) => `
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                        <span class="font-bold text-${index === 0 ? 'yellow' : index === 1 ? 'gray' : 'orange'}-600">#${index + 1}</span>
                        <span>${game.digits}ä½æ•¸ - ${game.rounds}å›åˆ</span>
                        <span class="text-xs text-gray-500">${game.date}</span>
                    </div>
                `).join('');
            }
            
            // åŒ¯å‡ºæ•¸æ“š
            exportData() {
                const dataStr = JSON.stringify(this.playerData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `1a2b_game_data_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
                this.showNotification('æ•¸æ“šå·²åŒ¯å‡º', 'success');
            }
            
            // é‡ç½®æ•¸æ“š
            resetData() {
                if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰éŠæˆ²æ•¸æ“šå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                    localStorage.removeItem('1a2b_player_data');
                    location.reload();
                }
            }
        }
        
        // åˆå§‹åŒ–éŠæˆ²
        document.addEventListener('DOMContentLoaded', () => {
            window.game = new Game1A2B();
        });
    </script>
</body>
</html>