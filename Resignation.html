<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <!-- SEO: åŸºæœ¬ Meta æ¨™ç±¤ -->
    <title>é›¢è·é›†é»å¡ - ä½ çš„è·å ´ç”Ÿå­˜å£“åŠ›è¨ˆ</title>
    <meta name="description" content="è¨˜éŒ„æ¯æ—¥è·å ´å¿ƒæƒ…èˆ‡é³¥äº‹ï¼Œé›†æ»¿é›¢è·é»æ•¸ï¼Œé‚å‘è‡ªç”±ï¼æä¾›å­ä¸–æŒ‡æ•¸åˆ†æã€æ•¸æ“šåŒ¯å‡ºèˆ‡ AI æ´å¯Ÿï¼Œæ˜¯ä½ æœ€ä½³çš„è·å ´å£“åŠ›ç®¡ç†å·¥å…·ã€‚">
    <meta name="keywords" content="é›¢è·, é›†é»å¡, è·å ´å£“åŠ›, å·¥ä½œå¿ƒæƒ…, å­ä¸–, åŠ ç­, æ…£è€é—†, PWA, å‰ç«¯å·¥å…·, AIåˆ†æ">
    <link rel="canonical" href="https://your-domain.com/index.html"> <!-- TODO: è«‹å°‡æ­¤è™•æ›¿æ›ç‚ºæ‚¨çš„æ­£å¼ç¶²å€ -->

    <!-- SEO: Open Graph (for Facebook, LinkedIn, etc.) -->
    <meta property="og:title" content="é›¢è·é›†é»å¡ - ä½ çš„è·å ´ç”Ÿå­˜å£“åŠ›è¨ˆ">
    <meta property="og:description" content="è¨˜éŒ„æ¯æ—¥è·å ´å¿ƒæƒ…èˆ‡é³¥äº‹ï¼Œé›†æ»¿é›¢è·é»æ•¸ï¼Œé‚å‘è‡ªç”±ï¼æä¾›å­ä¸–æŒ‡æ•¸åˆ†æèˆ‡ AI æ´å¯Ÿã€‚">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-domain.com/index.html"> <!-- TODO: è«‹å°‡æ­¤è™•æ›¿æ›ç‚ºæ‚¨çš„æ­£å¼ç¶²å€ -->
    <meta property="og:image" content="https://your-domain.com/og-image.png"> <!-- TODO: è«‹æº–å‚™ä¸€å¼µ 1200x630 çš„é è¦½åœ– -->
    <meta property="og:site_name" content="é›¢è·é›†é»å¡">
    <meta property="og:locale" content="zh_TW">

    <!-- SEO: Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="é›¢è·é›†é»å¡ - ä½ çš„è·å ´ç”Ÿå­˜å£“åŠ›è¨ˆ">
    <meta name="twitter:description" content="è¨˜éŒ„æ¯æ—¥è·å ´å¿ƒæƒ…èˆ‡é³¥äº‹ï¼Œé›†æ»¿é›¢è·é»æ•¸ï¼Œé‚å‘è‡ªç”±ï¼æä¾›å­ä¸–æŒ‡æ•¸åˆ†æèˆ‡ AI æ´å¯Ÿã€‚">
    <meta name="twitter:image" content="https://your-domain.com/twitter-image.png"> <!-- TODO: è«‹æº–å‚™ä¸€å¼µé©åˆ Twitter çš„é è¦½åœ– -->

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3da35d">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="é›¢è·é›†é»å¡">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMzZGEzNWQiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik05IDEyTDExIDE0TDE1IDEwTTIxIDEyQzIxIDE2Ljk3MDYgMTYuOTcwNiAyMSAxMiAyMUM3LjAyOTQ0IDIxIDMgMTYuOTcwNiAzIDEyQzMgNy4wMjk0NCA3LjAyOTQ0IDMgMTIgM0MxNi45NzA2IDMgMjEgNy4wMjk0NCAyMSAxMloiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8L3N2Zz4KPC9zdmc+">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNCIgZmlsbD0iIzNkYTM1ZCIvPgo8cGF0aCBkPSJNOSAxMkwxMSAxNEwxNSAxME0yMSAxMkMyMSAxNi45NzA2IDE2Ljk3MDYgMjEgMTIgMjFDNy4wMjk0NCAyMSAzIDE2Ljk3MDYgMyAxMkMzIDcuMDI5NDQgNy4wMjk0NCAzIDEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTJaIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8L3N2Zz4K">

    <!-- SEO: JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "é›¢è·é›†é»å¡",
      "description": "è¨˜éŒ„æ¯æ—¥è·å ´å¿ƒæƒ…èˆ‡é³¥äº‹ï¼Œé›†æ»¿é›¢è·é»æ•¸ï¼Œé‚å‘è‡ªç”±ï¼æä¾›å­ä¸–æŒ‡æ•¸åˆ†æã€æ•¸æ“šåŒ¯å‡ºèˆ‡ AI æ´å¯Ÿï¼Œæ˜¯ä½ æœ€ä½³çš„è·å ´å£“åŠ›ç®¡ç†å·¥å…·ã€‚",
      "applicationCategory": "ProductivityApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "ratingCount": "125"
      }
    }
    </script>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Kalam:wght@400;700&family=Caveat:wght@400;600;700&family=Dancing+Script:wght@400;600;700&family=Indie+Flower&family=Shadows+Into+Light&family=Amatic+SC:wght@400;700&display=swap" rel="stylesheet">

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.9.1/chart.min.js"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 50: '#f0f9f4', 100: '#dcf4e4', 200: '#bbe8cc', 300: '#8cd5a8', 400: '#5bb97d', 500: '#3da35d', 600: '#2d8049', 700: '#26663d', 800: '#215233', 900: '#1d432b' },
                        secondary: { 50: '#fefce8', 100: '#fef9c3', 200: '#fef08a', 300: '#fde047', 400: '#facc15', 500: '#eab308', 600: '#ca8a04', 700: '#a16207', 800: '#854d0e', 900: '#713f12' },
                        accent: { 50: '#fdf2f8', 100: '#fce7f3', 200: '#fbcfe8', 300: '#f9a8d4', 400: '#f472b6', 500: '#ec4899', 600: '#db2777', 700: '#be185d', 800: '#9d174d', 900: '#831843' },
                        neutral: { 50: '#fafafa', 100: '#f5f5f5', 200: '#e5e5e5', 300: '#d4d4d4', 400: '#a3a3a3', 500: '#737373', 600: '#525252', 700: '#404040', 800: '#262626', 900: '#171717' }
                    },
                    fontFamily: {
                        'sans': ['Noto Sans TC', 'sans-serif'], 'handwrite-1': ['Kalam', 'cursive'], 'handwrite-2': ['Caveat', 'cursive'], 'handwrite-3': ['Dancing Script', 'cursive'], 'handwrite-4': ['Indie Flower', 'cursive'], 'handwrite-5': ['Shadows Into Light', 'cursive'], 'handwrite-6': ['Amatic SC', 'cursive']
                    },
                    animation: {
                        'bounce-in': 'bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55)', 'fade-in': 'fadeIn 1s ease-out', 'slide-up': 'slideUp 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94)', 'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite', 'wiggle': 'wiggle 1s ease-in-out infinite', 'float': 'float 6s ease-in-out infinite', 'glow': 'glow 2s ease-in-out infinite alternate', 'quote-slide': 'quoteSlide 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)', 'quote-fade': 'quoteFade 0.6s ease-out'
                    }
                }
            }
        }
    </script>

    <style>
        /* ç¦æ­¢é›™æ“Šç¸®æ”¾ */
        * { touch-action: manipulation; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        input, textarea { -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text; }
        .hidden { display: none; }
        
        /* å‹•ç•«é—œéµå¹€ */
        @keyframes bounceIn { 0% { opacity: 0; transform: scale(0.3) translateY(50px); } 30% { opacity: 0.9; transform: scale(1.1); } 60% { opacity: 1; transform: scale(0.89); } 80% { transform: scale(1.05); } 100% { opacity: 1; transform: scale(1) translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(60px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(100px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes wiggle { 0%, 7% { transform: rotateZ(0); } 15% { transform: rotateZ(-15deg); } 20% { transform: rotateZ(10deg); } 25% { transform: rotateZ(-10deg); } 30% { transform: rotateZ(6deg); } 35% { transform: rotateZ(-4deg); } 40%, 100% { transform: rotateZ(0); } }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
        @keyframes glow { from { box-shadow: 0 0 20px rgba(61, 163, 93, 0.4); } to { box-shadow: 0 0 30px rgba(61, 163, 93, 0.8), 0 0 40px rgba(61, 163, 93, 0.4); } }
        @keyframes quoteSlide { from { opacity: 0; transform: translateY(-50px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes quoteFade { 0% { opacity: 0; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.05); } 100% { opacity: 1; transform: scale(1); } }
        
        /* ç²¾ç·»æ ¼å­æ¨£å¼ */
        .grid-cell { transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); position: relative; overflow: hidden; background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%); border: 2px solid #e5e7eb; box-shadow: 0 2px 8px rgba(0,0,0,0.06); min-height: 40px; }
        .grid-cell::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(145deg, transparent 0%, rgba(61, 163, 93, 0.05) 100%); opacity: 0; transition: opacity 0.3s ease; }
        .grid-cell:hover::before { opacity: 1; }
        .grid-cell:hover { transform: scale(1.08) translateY(-3px); box-shadow: 0 12px 35px rgba(61, 163, 93, 0.2); border-color: #3da35d; z-index: 10; }
        .grid-cell.filled { background: linear-gradient(145deg, #dcf4e4 0%, #bbe8cc 100%); border-color: #3da35d; box-shadow: 0 4px 15px rgba(61, 163, 93, 0.15); }
        .grid-cell.filled:hover { background: linear-gradient(145deg, #bbe8cc 0%, #8cd5a8 100%); box-shadow: 0 12px 40px rgba(61, 163, 93, 0.3); }
        
        /* æ–°å¢å¿ƒæƒ…çš„ CSS */
        .grid-cell.mood-money { background: linear-gradient(145deg, #fef9c3, #fde047); border-color: #ca8a04; }
        .grid-cell.mood-burnout { background: linear-gradient(145deg, #fecaca, #fca5a5); border-color: #ef4444; }
        .grid-cell.mood-annoying { background: linear-gradient(145deg, #e0e7ff, #c7d2fe); border-color: #6366f1; }
        .grid-cell.mood-stuck { background: linear-gradient(145deg, #e5e5e5, #d4d4d4); border-color: #737373; }
        
        .grid-cell.long-pressing { transform: scale(0.95); box-shadow: inset 0 4px 12px rgba(61, 163, 93, 0.2); }
        
        /* æ‰‹å¯«å­—é«”æ¨£å¼ */
        .date-text-1 { font-family: 'Kalam', cursive; } .date-text-2 { font-family: 'Caveat', cursive; } .date-text-3 { font-family: 'Dancing Script', cursive; } .date-text-4 { font-family: 'Indie Flower', cursive; } .date-text-5 { font-family: 'Shadows Into Light', cursive; } .date-text-6 { font-family: 'Amatic SC', cursive; }
        .date-text { color: #2d8049; font-weight: 700; text-shadow: 0 1px 3px rgba(0,0,0,0.12); transform: rotate(-2deg); transition: all 0.3s ease; }
        .grid-cell.mood-money .date-text { color: #a16207; }
        .grid-cell.mood-burnout .date-text { color: #b91c1c; }
        .grid-cell.mood-annoying .date-text { color: #4338ca; }
        .grid-cell.mood-stuck .date-text { color: #525252; }
        
        /* ç»ç’ƒè³ªæ„Ÿæ•ˆæœ */
        .glass-effect { background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.18); }
        
        /* å­ä¸–èªéŒ„æ¨£å¼ */
        .quote-container { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 20px; padding: 24px; margin: 20px 0; box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3); position: relative; overflow: hidden; animation: quote-slide 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .quote-container::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent); transform: rotate(45deg); animation: shine 3s infinite; }
        @keyframes shine { 0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); } 50% { transform: translateX(100%) translateY(100%) rotate(45deg); } 100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); } }
        
        /* é€²åº¦ç’°å½¢ */
        .progress-ring { transform: rotate(-90deg); }
        .progress-ring-circle { transition: stroke-dasharray 0.5s ease-in-out; }
        
        /* æ¨¡æ…‹æ¡†æ¨£å¼ */
        .modal-backdrop { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px); }
        .modal-content { background: white; border-radius: 24px; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25); transform: scale(0.9) translateY(20px); transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); max-width: 90vw; max-height: 90vh; overflow-y: auto; }
        .modal-open .modal-content { transform: scale(1) translateY(0); }
        
        /* è‡ªè¨‚æ»¾å‹•æ¢ */
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; } ::-webkit-scrollbar-thumb { background: #3da35d; border-radius: 4px; } ::-webkit-scrollbar-thumb:hover { background: #2d8049; }
        
        /* éŸ¿æ‡‰å¼ä¿®æ­£ */
        @media (max-width: 768px) { .stats-container { display: block !important; } .stats-container > div { margin-bottom: 1.5rem; } .grid-cell { min-height: 35px; } }
        
        /* æ—¥æœŸé¸æ“‡å™¨æ¨£å¼ */
        input[type="date"] { appearance: none; -webkit-appearance: none; background: white; border: 2px solid #e5e7eb; border-radius: 12px; padding: 12px 16px; font-size: 16px; color: #374151; cursor: pointer; }
        input[type="date"]:focus { outline: none; border-color: #3da35d; box-shadow: 0 0 0 3px rgba(61, 163, 93, 0.1); }
        
        /* åˆ†äº«æŒ‰éˆ• & æ¨¡æ…‹çª— CSS */
        .share-trigger { position: fixed; bottom: 20px; right: 20px; width: 56px; height: 56px; background-color: #3da35d; color: white; border-radius: 50%; border: none; font-size: 24px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 20px rgba(0,0,0,0.2); cursor: pointer; z-index: 1000; transition: all 0.3s ease; }
        .share-trigger:hover { transform: scale(1.1); background-color: #2d8049; }
        .share-modal { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 1050; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
        .share-modal.show { opacity: 1; visibility: visible; }
        .share-modal__content { background: #fff; border-radius: 16px; padding: 1.5rem; width: 90%; max-width: 400px; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2); position: relative; text-align: center; transform: scale(0.95); transition: transform 0.3s; }
        .share-modal.show .share-modal__content { transform: scale(1); }
        .share-modal__close { position: absolute; top: 0.5rem; right: 0.5rem; background: transparent; border: none; font-size: 1.8rem; line-height: 1; cursor: pointer; color: #aaa; }
        .share-modal__header h3 { margin: 0; font-size: 1.25rem; color: #333; }
        .share-modal__header p { margin-top: 0.25rem; color: #666; font-size: 0.9rem; }
        .share-modal__options { margin: 1.5rem 0; display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
        .share-btn { padding: 0.75rem; font-size: 0.9rem; border: none; border-radius: 8px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .share-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .share-btn--copy { background: #f3f3f3; color: #333; } .share-btn--copy:hover { background: #e1e1e1; }
        .share-btn--threads { background: #1c1c1c; color: #fff; } .share-btn--threads:hover { background: #000; }
        .share-btn--twitter { background: #1da1f2; color: #fff; } .share-btn--twitter:hover { background: #0d8ddb; }
        .share-btn--line { background: #00c300; color: #fff; } .share-btn--line:hover { background: #00a000; }
        .share-modal__footer small { color: #999; font-size: 0.75rem; } .share-modal__footer a { color: #555; text-decoration: none; } .share-modal__footer a:hover { text-decoration: underline; }

        /* AI åŒ¯å‡ºæ¨¡æ…‹çª— */
        #aiExportModal .ai-prompt-area { background-color: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 1rem; margin-top: 1rem; }
        #aiExportModal .ai-prompt-area pre { white-space: pre-wrap; word-wrap: break-word; font-size: 0.8rem; max-height: 200px; overflow-y: auto; }
        #aiExportModal .prompt-copy-btn { position: absolute; top: 10px; right: 10px; background: #e9ecef; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.75rem; }
    </style>
</head>

<body class="bg-gradient-to-br from-primary-50 via-white to-accent-50 min-h-screen font-sans overflow-x-hidden">
    <!-- èƒŒæ™¯è£é£¾å…ƒç´  -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-20 left-10 w-32 h-32 bg-primary-200 rounded-full opacity-20 animate-float"></div>
        <div class="absolute bottom-20 right-20 w-24 h-24 bg-accent-200 rounded-full opacity-20 animate-float" style="animation-delay: -2s;"></div>
        <div class="absolute top-1/2 left-1/3 w-16 h-16 bg-secondary-200 rounded-full opacity-20 animate-float" style="animation-delay: -4s;"></div>
    </div>

    <!-- Header å€åŸŸ -->
    <header class="relative text-center py-6 sm:py-8 md:py-12 animate-fade-in">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-primary-800 mb-3 sm:mb-4 tracking-wide relative">
                <span class="inline-block animate-wiggle">ğŸ“‹</span> é›¢è·é›†é»å¡ <span class="inline-block animate-pulse-slow">âœ¨</span>
            </h1>
            <p class="text-base sm:text-lg md:text-xl text-primary-600 font-medium" id="progressText">å…±100æ ¼ï¼Œé›†æ»¿é›¢è·</p>
        </div>
    </header>

    <!-- å­ä¸–èªéŒ„é¡¯ç¤ºå€ -->
    <div id="quoteDisplay" class="container mx-auto px-4 mb-6" style="display: none;">
        <div class="quote-container text-center">
            <i class="fas fa-quote-left text-2xl mb-4 opacity-70"></i>
            <p class="text-lg sm:text-xl font-handwrite-3 leading-relaxed mb-4" id="quoteText"></p>
            <button onclick="hideQuote()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-full text-sm transition-all duration-300"><i class="fas fa-times mr-2"></i>æ”¶èµ·</button>
        </div>
    </div>

    <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
    <main class="container mx-auto px-4 pb-8">
        <!-- é›†é»å¡æ ¼å­å€åŸŸ -->
        <div class="glass-effect rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8 mb-6 animate-slide-up">
            <div class="text-center mb-4">
                <h2 class="text-xl sm:text-2xl font-bold text-primary-800 mb-2"><i class="fas fa-calendar-check mr-2"></i>æˆ‘çš„é›¢è·é›†é»é€²åº¦</h2>
                <p class="text-primary-600 text-xs sm:text-sm"><i class="fas fa-info-circle mr-1"></i>çŸ­æŒ‰æ¨™è¨˜æ—¥æœŸï¼Œé•·æŒ‰è¨˜éŒ„è©³ç´°äº‹ä»¶</p>
            </div>
            <div class="grid grid-cols-8 md:grid-cols-10 gap-1 sm:gap-2 max-w-4xl mx-auto" id="gridContainer"></div>
        </div>
        
        <!-- çµ±è¨ˆèˆ‡é€²åº¦å€åŸŸ -->
        <div class="stats-container grid md:grid-cols-2 gap-4 mb-6">
            <!-- é€²åº¦çµ±è¨ˆ -->
            <div class="glass-effect rounded-2xl shadow-xl p-4 sm:p-6 animate-slide-up" style="animation-delay: 0.2s">
                <h3 class="text-lg sm:text-xl font-bold text-primary-800 mb-4 flex items-center"><i class="fas fa-chart-pie mr-2 text-primary-600"></i>é€²åº¦çµ±è¨ˆ</h3>
                <div class="flex items-center justify-center mb-4">
                    <div class="relative w-24 h-24 sm:w-32 sm:h-32">
                        <svg class="progress-ring w-24 h-24 sm:w-32 sm:h-32" viewBox="0 0 120 120">
                            <circle cx="60" cy="60" r="54" fill="none" stroke="#e5e7eb" stroke-width="8"/>
                            <circle cx="60" cy="60" r="54" fill="none" stroke="#3da35d" stroke-width="8" stroke-linecap="round" class="progress-ring-circle" id="progressCircle" stroke-dasharray="0 339.292"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="text-center">
                                <div class="text-xl sm:text-2xl font-bold text-primary-700" id="filledCount">0</div>
                                <div class="text-xs text-primary-600">å·²å®Œæˆ</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="space-y-2 sm:space-y-3">
                    <div class="flex justify-between items-center"><span class="text-xs sm:text-sm text-neutral-600"><i class="fas fa-calendar-day mr-1 sm:mr-2 text-primary-500"></i>å¥½æ—¥å­</span><span class="font-semibold text-primary-700" id="goodDaysCount">0</span></div>
                    <div class="flex justify-between items-center"><span class="text-xs sm:text-sm text-neutral-600"><i class="fas fa-calendar-times mr-1 sm:mr-2 text-red-500"></i>çˆ›æ—¥å­</span><span class="font-semibold text-red-600" id="badDaysCount">0</span></div>
                    <div class="flex justify-between items-center"><span class="text-xs sm:text-sm text-neutral-600"><i class="fas fa-percentage mr-1 sm:mr-2 text-accent-500"></i>å®Œæˆç‡</span><span class="font-semibold text-accent-600" id="completionRate">0%</span></div>
                </div>
                <div class="mt-4 sm:mt-6 space-y-2">
                    <button onclick="openAiExportModal()" class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white px-3 py-2 sm:px-4 sm:py-3 rounded-xl text-xs sm:text-sm font-medium transition-all duration-300 transform hover:scale-105"><i class="fas fa-robot mr-2"></i>åŒ¯å‡ºè‡³ AI åˆ†æ</button>
                    <button onclick="showClearConfirm()" class="w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-3 py-2 sm:px-4 sm:py-3 rounded-xl text-xs sm:text-sm font-medium transition-all duration-300 transform hover:scale-105"><i class="fas fa-trash-alt mr-2"></i>æ¸…ç©ºæ‰€æœ‰è¨˜éŒ„</button>
                </div>
            </div>
            
            <!-- æ¯æ—¥è¶¨å‹¢åœ–è¡¨ -->
            <div class="glass-effect rounded-2xl shadow-xl p-4 sm:p-6 animate-slide-up" style="animation-delay: 0.4s">
                <h3 class="text-lg sm:text-xl font-bold text-primary-800 mb-4 flex items-center"><i class="fas fa-chart-line mr-2 text-primary-600"></i>æ¯æ—¥è¶¨å‹¢</h3>
                <div class="relative h-48 sm:h-64"><canvas id="dailyChart" class="w-full h-full"></canvas></div>
                <div class="mt-4 text-center"><p class="text-primary-600 text-xs sm:text-sm"><i class="fas fa-sync-alt fa-spin mr-1"></i>åœ–è¡¨å°‡æ–¼æ¯æ—¥ 00:00 è‡ªå‹•æ›´æ–°</p></div>
            </div>
        </div>

        <!-- å­ä¸–æŒ‡æ•¸ & è¿‘æœŸè¨˜éŒ„ -->
        <div class="grid md:grid-cols-2 gap-4 mb-6">
            <!-- å­ä¸–æŒ‡æ•¸çµ±è¨ˆ -->
            <div class="glass-effect rounded-2xl shadow-xl p-4 sm:p-6 animate-slide-up" style="animation-delay: 0.6s">
                <h3 class="text-lg sm:text-xl font-bold text-primary-800 mb-4 flex items-center"><i class="fas fa-fire-alt mr-2 text-red-500"></i>å­ä¸–æŒ‡æ•¸åˆ†æ</h3>
                <div class="bg-red-50 p-6 rounded-2xl text-center">
                    <div class="text-sm text-red-700 mb-2">ç¸½å­ä¸–æŒ‡æ•¸</div>
                    <div id="annoyanceIndexTotal" class="text-5xl font-bold text-red-600">0</div>
                    <p id="annoyanceLevel" class="text-red-500 font-semibold mt-2">å…§å¿ƒæ¯«ç„¡æ³¢ç€¾</p>
                </div>
                <div class="mt-4">
                    <p class="text-sm text-neutral-600 mb-2 font-semibold">ä¸»è¦å­ä¸–ä¾†æºï¼š</p>
                    <ul id="topAnnoyanceKeywords" class="text-sm text-neutral-500 space-y-1">
                        <li>å°šç„¡æ•¸æ“š</li>
                    </ul>
                </div>
            </div>
            
            <!-- è¿‘æœŸè¨˜éŒ„ -->
            <div class="glass-effect rounded-2xl shadow-xl p-4 sm:p-6 animate-slide-up" style="animation-delay: 0.8s">
                <h3 class="text-lg sm:text-xl font-bold text-primary-800 mb-4 flex items-center"><i class="fas fa-history mr-2 text-primary-600"></i>è¿‘æœŸè¨˜éŒ„</h3>
                <div id="recentRecords" class="space-y-3 max-h-64 overflow-y-auto">
                    <p class="text-neutral-500 text-center py-8"><i class="fas fa-inbox text-3xl mb-2 block"></i>å°šç„¡è¨˜éŒ„ï¼Œé–‹å§‹ä½ çš„é›¢è·é›†é»ä¹‹æ—…å§ï¼</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer å€åŸŸ -->
    <footer class="text-center py-6 text-primary-600 animate-fade-in" style="animation-delay: 1.0s">
        <div class="container mx-auto px-4">
            <p class="text-sm sm:text-base mb-3 font-handwrite-4">çœŸçš„åšä¸äº†ï¼Œæ²’æœ‰ä¸€å¤©æ˜¯é©åˆä¸Šç­çš„ã€‚</p>
            <p class="text-xs opacity-75 mb-4"><i class="fas fa-heart text-red-400 mr-1"></i>é›¢è·Day - PWAç‰ˆæœ¬</p>
            <div class="flex justify-center gap-4 text-xs flex-wrap">
                <span class="bg-primary-100 px-3 py-1 rounded-full"><i class="fas fa-wifi mr-1"></i><span id="onlineStatus">ç·šä¸Š</span></span>
                <span class="bg-accent-100 px-3 py-1 rounded-full"><i class="fas fa-save mr-1"></i>å·²è‡ªå‹•å„²å­˜</span>
            </div>
        </div>
    </footer>

    <!-- åˆ†äº«æŒ‰éˆ• -->
    <button id="shareBtn" class="share-trigger" aria-label="åˆ†äº«æ­¤é é¢">
        <i class="fas fa-share-alt"></i>
    </button>
    
    <!-- åˆ†äº«æ¨¡æ…‹çª— -->
    <div id="shareModal" class="share-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="share-modal-title">
      <div class="share-modal__overlay" tabindex="-1" onclick="closeShareModal()"></div>
      <div class="share-modal__content">
        <button id="closeShareModal" class="share-modal__close" aria-label="é—œé–‰åˆ†äº«çª—å£" onclick="closeShareModal()">Ã—</button>
        <div class="share-modal__header">
          <h3 id="share-modal-title">åˆ†äº«ä½ çš„é›¢è·é€²åº¦</h3>
          <p>è®“æœ‹å‹ä¸€èµ·è¦‹è­‰ä½ çš„è‡ªç”±ä¹‹è·¯ï¼</p>
        </div>
        <div class="share-modal__options">
          <button id="copyLinkBtn" class="share-btn share-btn--copy"><i class="fas fa-copy"></i>è¤‡è£½é€£çµ</button>
          <button id="shareToThreadsBtn" class="share-btn share-btn--threads"><i class="fab fa-threads"></i>Threads</button>
          <button id="shareToTwitterBtn" class="share-btn share-btn--twitter"><i class="fab fa-twitter"></i>Twitter</button>
          <button id="shareToLineBtn" class="share-btn share-btn--line"><i class="fab fa-line"></i>LINE</button>
        </div>
        <div class="share-modal__footer">
          <small>ç”± <a href="https://github.com/your-github" target="_blank" rel="noopener">ä½ çš„åå­—</a> è£½ä½œ</small> <!-- TODO: æ›¿æ›æˆä½ çš„ GitHub æˆ–å€‹äººç¶²ç«™ -->
        </div>
      </div>
    </div>
    
    <!-- äº‹ä»¶è¨˜éŒ„æ¨¡æ…‹æ¡† -->
    <div id="eventModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50 p-4">
        <div class="modal-content p-6 sm:p-8 w-full max-w-lg">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full mx-auto mb-4 flex items-center justify-center"><i class="fas fa-edit text-white text-xl"></i></div>
                <h3 class="text-xl font-bold text-primary-800 mb-2">è¨˜éŒ„äº‹ä»¶</h3>
                <p class="text-neutral-600 text-sm">è¨˜éŒ„é€™ä¸€å¤©çš„å¿ƒæƒ…èˆ‡äº‹ä»¶</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-neutral-700 mb-2">é¸æ“‡æ—¥æœŸ</label>
                    <input type="date" id="eventDate" class="w-full">
                </div>
                <div>
                    <label class="block text-sm font-medium text-neutral-700 mb-2">ä»Šå¤©å¿ƒæƒ…å¦‚ä½•ï¼Ÿ (é›¢è·å››å¤§åŸå› )</label>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                        <button type="button" class="mood-btn" data-mood="money"><div class="mood-icon-wrapper" id="moodIconMoney"></div><div class="text-xs mt-1">éŒ¢é€”èŒ«èŒ«</div></button>
                        <button type="button" class="mood-btn" data-mood="burnout"><div class="mood-icon-wrapper" id="moodIconBurnout"></div><div class="text-xs mt-1">èº«å¿ƒä¿±ç–²</div></button>
                        <button type="button" class="mood-btn" data-mood="annoying"><div class="mood-icon-wrapper" id="moodIconAnnoying"></div><div class="text-xs mt-1">é³¥äº‹ä¸€å †</div></button>
                        <button type="button" class="mood-btn" data-mood="stuck"><div class="mood-icon-wrapper" id="moodIconStuck"></div><div class="text-xs mt-1">ç¼ºä¹æˆé•·</div></button>
                    </div>
                </div>
                <div>
                    <label for="eventDescription" class="block text-sm font-medium text-neutral-700 mb-2">äº‹ä»¶æè¿°</label>
                    <textarea id="eventDescription" rows="3" placeholder="ä»Šå¤©ç™¼ç”Ÿäº†ä»€éº¼é³¥äº‹ï¼Ÿ" class="w-full px-4 py-3 border border-neutral-300 rounded-xl resize-none focus:border-primary-400 focus:ring-2 focus:ring-primary-100 transition-all duration-200"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-neutral-700 mb-2">çˆ›äº‹æ¨™ç±¤</label>
                    <div id="presetButtonsContainer" class="flex flex-wrap gap-2 mb-2"></div>
                    <div class="flex gap-2">
                        <input type="text" id="customPresetInput" placeholder="æ–°å¢è‡ªè¨‚çˆ›äº‹" class="flex-grow px-3 py-2 border border-neutral-300 rounded-lg text-sm">
                        <button onclick="addCustomPreset()" class="bg-primary-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-primary-600">æ–°å¢</button>
                    </div>
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeEventModal()" class="flex-1 bg-neutral-200 hover:bg-neutral-300 text-neutral-700 px-6 py-3 rounded-xl font-medium transition-all duration-200">å–æ¶ˆ</button>
                <button onclick="saveEvent()" class="flex-1 bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200">å„²å­˜</button>
            </div>
        </div>
    </div>

    <!-- AI åŒ¯å‡ºæ¨¡æ…‹çª— -->
    <div id="aiExportModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50 p-4">
        <div class="modal-content p-6 sm:p-8 w-full max-w-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-primary-800"><i class="fas fa-robot mr-2"></i>åŒ¯å‡ºè‡³ AI åˆ†æ</h3>
                <button onclick="closeAiExportModal()" class="text-neutral-500 hover:text-neutral-800 text-2xl">Ã—</button>
            </div>
            <div class="space-y-4">
                <div>
                    <h4 class="font-semibold text-neutral-700 mb-2">1. è¤‡è£½ä½ çš„æ•¸æ“š</h4>
                    <p class="text-sm text-neutral-600 mb-2">ä»¥ä¸‹æ˜¯æ‚¨æ‰€æœ‰è¨˜éŒ„çš„ JSON æ ¼å¼æ•¸æ“šã€‚é»æ“ŠæŒ‰éˆ•ä¸€éµè¤‡è£½ã€‚</p>
                    <div class="relative">
                        <pre class="bg-neutral-100 p-4 rounded-lg text-xs max-h-40 overflow-auto">
                            <code id="jsonDataOutput"></code>
                        </pre>
                        <button id="copyJsonBtn" class="absolute top-2 right-2 bg-neutral-200 hover:bg-neutral-300 text-xs px-2 py-1 rounded">è¤‡è£½</button>
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold text-neutral-700 mb-2">2. é¸æ“‡ä¸€å€‹ AI æ¨¡å‹ä¸¦è²¼ä¸Šæå•</h4>
                    <p class="text-sm text-neutral-600 mb-2">å°‡è¤‡è£½çš„æ•¸æ“šè²¼åˆ° Prompt ä¸­ `[æ­¤è™•è²¼ä¸Šæ‚¨çš„ JSON æ•¸æ“š]` çš„ä½ç½®ï¼Œç„¶å¾Œå°‡å®Œæ•´çš„ Prompt è²¼åˆ°æ‚¨é¸æ“‡çš„ AI èŠå¤©è¦–çª—ä¸­ã€‚</p>
                    <div class="ai-prompt-area">
                        <div class="relative">
                            <h5 class="font-semibold text-sm mb-1">é€šç”¨ Prompt (GPT/Claude/Gemini/Grok)</h5>
                            <pre id="aiPromptTemplate" class="text-neutral-700"><code>ä½ æ˜¯ä¸€ä½è³‡æ·±çš„è·æ¶¯æ•™ç·´èˆ‡å¿ƒç†è«®è©¢å¸«ã€‚è«‹æ ¹æ“šä»¥ä¸‹ JSON æ ¼å¼çš„è·å ´å¿ƒæƒ…æ—¥èªŒï¼Œé€²è¡Œæ·±å…¥åˆ†æã€‚æ—¥èªŒä¸­åŒ…å«äº†æ¯æ—¥çš„å¿ƒæƒ…åˆ†é¡ï¼ˆmoney: è–ªè³‡ç¦åˆ©, burnout: èº«å¿ƒä¿±ç–², annoying: é³¥äº‹ä¸€å †, stuck: ç¼ºä¹æˆé•·ï¼‰ã€äº‹ä»¶æè¿°ä»¥åŠè‡ªå‹•è¨ˆç®—çš„å­ä¸–æŒ‡æ•¸ã€‚

ä½ çš„ä»»å‹™æ˜¯ï¼š
1.  **æ¨¡å¼è­˜åˆ¥**ï¼šæ‰¾å‡ºå°è‡´æˆ‘ç”¢ç”Ÿè² é¢æƒ…ç·’çš„ä¸»è¦æ¨¡å¼æˆ–é‡è¤‡å‡ºç¾çš„ä¸»é¡Œã€‚
2.  **å£“åŠ›æºåˆ†æ**ï¼šæ ¹æ“š 'annoyanceIndex' å’Œäº‹ä»¶æè¿°ï¼Œåˆ†ææˆ‘æœ€å¤§çš„å£“åŠ›ä¾†æºæ˜¯ä»€éº¼ã€‚
3.  **è¶¨å‹¢æ´å¯Ÿ**ï¼šåˆ†ææˆ‘çš„æƒ…ç·’æ˜¯å¦æœ‰æ™‚é–“ä¸Šçš„è¶¨å‹¢ï¼ˆä¾‹å¦‚ï¼Œé€±æœ«å‰æ›´ç³Ÿï¼Œæˆ–æœˆåˆæ›´ç³Ÿï¼‰ã€‚
4.  **æå‡ºå»ºè­°**ï¼šåŸºæ–¼ä»¥ä¸Šåˆ†æï¼Œæä¾› 3-5 å€‹å…·é«”ã€å¯è¡Œçš„å»ºè­°ï¼Œå¹«åŠ©æˆ‘æ”¹å–„ç›®å‰çš„å·¥ä½œç‹€æ³æˆ–è¦åŠƒä¸‹ä¸€æ­¥çš„è·æ¶¯ç™¼å±•ã€‚

è«‹ä»¥æœ‰æ¢ç†ã€å¯Œæœ‰åŒç†å¿ƒä¸”å°ˆæ¥­çš„å£å»å›ç­”ã€‚

é€™æ˜¯æˆ‘çš„æ•¸æ“šï¼š
[æ­¤è™•è²¼ä¸Šæ‚¨çš„ JSON æ•¸æ“š]
</code></pre>
                            <button class="prompt-copy-btn" onclick="copyPrompt('aiPromptTemplate')">è¤‡è£½ Prompt</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-6 text-center">
                <button onclick="closeAiExportModal()" class="bg-primary-500 hover:bg-primary-600 text-white px-8 py-3 rounded-xl font-medium transition-all duration-200">å®Œæˆ</button>
            </div>
        </div>
    </div>
    
    <!-- ç¢ºèªæ¸…ç©ºæ¨¡æ…‹æ¡† -->
    <div id="confirmModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50 p-4">
        <div class="modal-content p-6 sm:p-8 w-full max-w-md text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><i class="fas fa-exclamation-triangle text-white text-xl"></i></div>
            <h3 class="text-xl font-bold text-neutral-800 mb-3">ç¢ºèªæ¸…ç©º</h3>
            <p class="text-neutral-600 mb-6">ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚</p>
            <div class="flex gap-3">
                <button onclick="closeConfirmModal()" class="flex-1 bg-neutral-200 hover:bg-neutral-300 text-neutral-700 px-6 py-3 rounded-xl font-medium transition-all duration-200">å–æ¶ˆ</button>
                <button onclick="confirmClearAll()" class="flex-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200">ç¢ºèªæ¸…ç©º</button>
            </div>
        </div>
    </div>
    
    <!-- PWA å®‰è£æç¤º -->
    <div id="installPrompt" class="fixed bottom-4 left-4 right-4 bg-gradient-to-r from-primary-600 to-primary-700 text-white p-4 rounded-2xl shadow-2xl transform translate-y-full transition-transform duration-500 z-40">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <i class="fas fa-mobile-alt text-2xl mr-3"></i>
                <div>
                    <div class="font-semibold">å®‰è£æ‡‰ç”¨ç¨‹å¼</div>
                    <div class="text-sm opacity-90">é›¢ç·šä½¿ç”¨ï¼Œéš¨æ™‚è¨˜éŒ„</div>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="dismissInstallPrompt()" class="px-3 py-1 text-sm bg-white/20 rounded-lg">ç¨å¾Œ</button>
                <button onclick="installPWA()" class="px-3 py-1 text-sm bg-white text-primary-600 rounded-lg font-semibold">å®‰è£</button>
            </div>
        </div>
    </div>

<script>
    // å…¨åŸŸè®Šæ•¸
    let deferredPrompt;
    let installPromptShown = false;
    let filledDates = new Map();
    let customPresets = [];
    let longPressTimer = null;
    let isLongPress = false;
    let currentCell = null;
    let dailyChart = null;
    
    const STORAGE_KEY = 'resignationCard_v4';
    const PRESETS_KEY = 'resignationCard_presets_v1';
    const TOTAL_CELLS = 100;
    
    /**
     * @description å¿ƒæƒ…åœ–ç¤º SVG
     * æ ¹æ“šé›¢è·å››å¤§åŸå› è¨­è¨ˆ
     */
    const moodIcons = {
        money: `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mx-auto stroke-current text-yellow-600"><path d="M9 10a1 1 0 11-2 0 1 1 0 012 0zm6 0a1 1 0 11-2 0 1 1 0 012 0zm-4 5a4 4 0 01-4-4h8a4 4 0 01-4 4zm4.5-8.5a1.5 1.5 0 00-3 0h3zm-4-3a.5.5 0 001 0h-1zM12 2a10 10 0 100 20 10 10 0 000-20z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`,
        burnout: `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mx-auto stroke-current text-red-600"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zM9 15s1.5-2 3-2 3 2 3 2M9 9h.01M15 9h.01" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`,
        annoying: `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mx-auto stroke-current text-indigo-600"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zM8 9l8 6M8 15L16 9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`,
        stuck: `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mx-auto stroke-current text-gray-600"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zM9 12h6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`
    };
    
    // å­ä¸–èªéŒ„åº«
    const quotes = [ "äººå®¶æœ‰çš„æ˜¯èƒŒæ™¯ï¼Œæˆ‘æœ‰çš„åªæ˜¯èƒŒå½±ã€‚", "å¸Œæœ›å¤§å®¶ä¸è¦è¦ºå¾—è‡ªå·±ä¸€ç„¡æ˜¯è™•ï¼Œæˆ‘å€‘è‡³å°‘é‚„å¯ä»¥è®“åˆ¥äººè¦ºå¾—å¾ˆç…©ã€‚", "æˆ‘æœ€å¤§çš„ç¼ºé»ï¼Œå°±æ˜¯ç¼ºé»éŒ¢ã€‚", "é¸æ“‡æ¯”åŠªåŠ›æ›´é‡è¦ï¼Œæ‰€ä»¥æˆ‘é¸æ“‡ä¸åŠªåŠ›ã€‚", "å¦‚æœä½ è¦ºå¾—è‡ªå·±ç´¯å¾—è·Ÿç‹—ä¸€æ¨£ï¼Œé‚£è£¡çœŸçš„æ˜¯èª¤æœƒäº†ï¼Œå› ç‚ºç‹—éƒ½æ²’ä½ é€™éº¼ç´¯ã€‚", "ä»¥å‰æˆ‘ä»¥ç‚ºéŒ¢å¯ä»¥è²·åˆ°ä¸€åˆ‡ï¼Œå¾Œä¾†æˆ‘ç™¼ç¾ä¸¦ä¸æ˜¯ï¼Œå› ç‚ºæˆ‘éŒ¢ä¸å¤ ã€‚", "å°æ™‚å€™æˆ‘ä»¥ç‚ºå¯ä»¥æ‹¯æ•‘å…¨ä¸–ç•Œï¼Œé•·å¤§å¾Œç™¼ç¾å…¨ä¸–ç•Œéƒ½æ‹¯æ•‘ä¸äº†æˆ‘ã€‚", "æˆ‘æœ€å¤§çš„æŠ—å£“é©æ‡‰èƒ½åŠ›æ˜¯ï¼šä»¥ä¸è®Šçš„è–ªæ°´æ‡‰è¬è®Šçš„ç‰©åƒ¹ã€‚", "çœ‹æ™‚é–“ä¸æ˜¯ç‚ºäº†èµ·åºŠï¼Œè€Œæ˜¯çœ‹é‚„èƒ½ç¡å¤šä¹…ã€‚", "å¾ˆå¤šäººèªªæŠ–è…³æœƒè®Šçª®ï¼Œè¬›å¾—å¥½åƒæˆ‘åŸæœ¬å¤šæœ‰éŒ¢çš„æ¨£å­ã€‚", "ä¸åŠªåŠ›ä¸€ä¸‹ï¼Œä½ æ€éº¼æœƒçŸ¥é“ä»€éº¼å«åšçµ•æœ›ã€‚", "æ£‰è¢«ä»¥å¤–çš„åœ°æ–¹ï¼Œéƒ½æ˜¯é æ–¹ï¼Œè«‹å…ˆä¸è¦å«æˆ‘èµ·åºŠã€‚", "è¦å¥½å¥½æ´»ä¸‹å»ï¼Œå› ç‚ºæ¯å¤©éƒ½æœ‰æ–°çš„æ‰“æ“Šã€‚", "æ¯”ä¸€å€‹äººåƒç«é‹æ›´å¯‚å¯çš„æ˜¯ï¼Œä¸€å€‹äººæ²’æœ‰éŒ¢åƒç«é‹ã€‚", "æœ‰äº›äº‹æƒ…åšä¸åˆ°çš„è©±ï¼Œå°±ç•™åˆ°æ˜å¤©åšå§ï¼Œé‹æ°£å¥½çš„è©±ï¼Œæ˜å¤©æ­»äº†å°±ä¸ç”¨åšäº†ã€‚", "åŠªåŠ›ä¸ä¸€å®šæœƒæˆåŠŸï¼Œä½†æ˜¯ä¸åŠªåŠ›æœƒå¾ˆè¼•é¬†ã€‚", "è¬è¬é‚£äº›æ›¾ç¶“æ“Šå€’æˆ‘çš„äººï¼Œèººè‘—çœŸèˆ’æœã€‚", "ä¸Šä¸å»çš„è–ªæ°´ï¼Œä¸‹ä¸å»çš„æˆ¿åƒ¹ã€‚", "ä¸Šç­æ‰“å¡åˆ¶ï¼Œä¸‹ç­è²¬ä»»åˆ¶ï¼Œäººç”Ÿå¥½å­ä¸–ã€‚", "è¢«è€é—†ç½µå®Œæƒ³å»å‹•ç‰©åœ’ï¼Œå› ç‚ºåœ¨é‚£è£¡ï¼Œæˆ‘æ‰çœŸçš„åƒå€‹äººã€‚", "èª°èªªéŒ¢è²·ä¸åˆ°è‡ªç”±ï¼Œä½ è€é—†ä¸å°±è²·åˆ°ä½ äº†ã€‚", "çœŸæ‡·å¿µå°æ™‚å€™å“­å®Œå°±ç¡ï¼Œç¾åœ¨å“­å®Œé‚„æ˜¯è¦ä¸Šç­ã€‚", "ä»¥å‰å¸¸å¸¸æ€è€ƒè‡ªå·±é©åˆä»€éº¼å·¥ä½œï¼Œç¾åœ¨ç™¼ç¾è‡ªå·±æœ€é©åˆä¸å·¥ä½œã€‚", "æº–æ™‚ä¸‹ç­éœ€è¦çš„ä¸æ˜¯åŠªåŠ›ï¼Œæ˜¯å‹‡æ°£ã€‚", "æˆåŠŸçš„éƒ½æ˜¯é ˜å°æœ‰æ–¹ï¼Œå¤±æ•—çš„å°±æ˜¯ä¸‹å±¬ç„¡èƒ½ã€‚", "å¤±æ•—ä¸¦ä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯ï¼Œä½ ç›¸ä¿¡é€™å¥è©±ã€‚", "ä¸–ç•Œä¸Š99%çš„äº‹å¯ä»¥é éŒ¢è§£æ±ºï¼Œå‰©ä¸‹çš„1%æ˜¯éœ€è¦æ›´å¤šéŒ¢ã€‚", "é‚£äº›é¼“å‹µå¤§å®¶è·³å‡ºèˆ’é©åœˆçš„ï¼Œå•é¡Œæ˜¯æˆ‘å¾ä¾†æ²’èˆ’é©éã€‚", "ä½ å¿…é ˆéå¸¸åŠªåŠ›ï¼Œæ‰å¯ä»¥è­‰æ˜è‡ªå·±çœŸçš„ç„¡èƒ½ç‚ºåŠ›ã€‚", "æˆ‘ä¸€ç›´æŠŠéŒ¢è¦–ç‚ºç©ºæ°£ï¼Œå› ç‚ºæ²’æœ‰å®ƒæˆ‘å°±æ´»ä¸ä¸‹å»ã€‚", "é†œå°é´¨è®Šå¤©éµä¸¦ä¸æ˜¯å› ç‚ºä»–å¤šåŠªåŠ›ï¼Œè€Œæ˜¯å› ç‚ºä»–çš„è€æ¯å°±æ˜¯å¤©éµã€‚", "è¦ºå¾—ä¸Šç­å¾ˆç´¯å—ï¼Ÿé‚£å°±çœ‹çœ‹æ‰‹ä¸Šçš„ä¿¡ç”¨å¡è·Ÿæˆ¿è²¸å¸³å–®å§ï¼Œå¿ƒæœƒæ›´ç´¯å–”ã€‚", "å‡ºç¤¾æœƒä¸ƒå¹´ï¼Œè‡³ä»Šåªè²·å¾—èµ·è‡ªå·±çš„å¡”ä½ã€‚", "æˆ‘çš„éŒ¢åŒ…å°±åƒæ´‹è”¥ï¼Œæ‰“é–‹å®ƒå°±æœƒæƒ³å“­ã€‚", "æˆ‘å¾ä¾†æ²’å–œæ­¡éå·¥ä½œï¼Œæˆ‘çš„ç›®æ¨™æ˜¯å¾—éä¸”éã€‚", "äººç”Ÿå°±æ˜¯é€™æ¨£ï¼Œä¸€å¤©åˆ°æ™šåšçš„é‚£äº›äº‹ï¼Œå…¨æ˜¯æˆ‘ä¸æ„›åšçš„ã€‚", "ä¸Šç­æ˜æ˜æ˜¯ç‚ºåˆ¥äººè³ºå¤§éŒ¢ï¼Œå¯æœ€å¾Œç«Ÿé‚„è¦åéä¾†è¬è¬ä»–çµ¦ä½ ä¸€å€‹å·¥ä½œæ©Ÿæœƒã€‚", "æ¯åˆ°æ˜ŸæœŸä¸€ï¼Œå°±æ·±åˆ»æ„Ÿå—å‡æœŸåªæ˜¯çŸ­æš«çš„æ„›äº†æˆ‘ä¸€ä¸‹ã€‚", "ä¸–ç•Œä¸Šæœ€çŸ­çš„è·é›¢ï¼Œå°±æ˜¯å‡æœŸé–‹å§‹åˆ°çµæŸã€‚", "æ­£ç¾©éƒ½èƒ½é²åˆ°ï¼Œç‚ºä»€éº¼ä¸Šç­ä¸èƒ½ï¼Ÿ", "æ™´å¤©é©åˆå‡ºéŠã€é›¨å¤©é©åˆç¡è¦ºï¼Œæ¼«é•·çš„æ­²æœˆè£¡ï¼Œç«Ÿç„¶æ²’æœ‰ä¸€å¤©é©åˆä¸Šç­ã€‚", "ä¸Šç­æ˜¯æœƒå‘¼å¸çš„ç—›ï¼Œä»–æ´»åœ¨æˆ‘èº«ä¸Šæ¯å€‹è§’è½ã€‚", "æ—©çŸ¥é“äººé–“æœ‰ä¸Šç­é€™ç¨®äº‹ï¼Œæˆ‘ç•¶åˆå°±ä¸æ‡‰è©²ä¸‹å‡¡ã€‚", "é¬§é˜ä¸€éŸ¿ï¼Œè…¦å­è£¡å°±å‡ºç¾äº†500å¤šæ¢è«‹å‡ç†ç”±ï¼Œä½†æ²’æœ‰ä¸€æ¢æ˜¯é è­œçš„ã€‚", "å·¥ä½œæœ€é‡è¦çš„å½¢å¼ä¹‹ä¸€ï¼Œæ˜¯ä¼‘æ¯ã€‚", "ç”Ÿæ´»ç”Ÿæ´»ï¼Œå°±æ˜¯ç”Ÿä¸‹ä¾†å¹¹æ´»ã€‚"];
    const handwriteFonts = ['date-text-1', 'date-text-2', 'date-text-3', 'date-text-4', 'date-text-5', 'date-text-6'];

    /**
     * @description å­ä¸–æŒ‡æ•¸é—œéµå­—èˆ‡åˆ†æ•¸
     * ä½¿ç”¨ Map æ–¹ä¾¿æ“´å……èˆ‡ç®¡ç†
     */
    const annoyanceKeywords = new Map([
        ['è€é—†', 5], ['ä¸»ç®¡', 5], ['åŠ ç­', 4], ['æœƒè­°', 3], ['é–‹æœƒ', 3],
        ['å ±å‘Š', 3], ['éœ€æ±‚', 3], ['ç™½ç—´', 4], ['æ™ºéšœ', 4], ['åŒ—ä¸ƒ', 4],
        ['è±¬éšŠå‹', 4], ['ç„¡èƒ½', 4], ['ç™½ç›®', 3], ['é åŒ—', 3], ['å¹¹', 3],
        ['åª½çš„', 3], ['è–ªæ°´', 5], ['åŠ è–ª', 5], ['æ”¿æ²»', 4], ['ç”©é‹', 4]
    ]);
    
    /**
     * @description åˆå§‹åŒ–æ‡‰ç”¨
     */
    document.addEventListener('DOMContentLoaded', function() {
        loadData();
        generateGrid();
        renderMoodIcons();
        renderPresetButtons();
        updateAllStats();
        initChart();
        updateOnlineStatus();
        setupShareModal();
        scheduleDailyUpdate();
        
        // æ·»åŠ é€²å ´å‹•ç•«
        setTimeout(() => document.querySelector('#gridContainer').classList.add('animate-bounce-in'), 500);
    });

    // --- PWA & æ ¸å¿ƒåŠŸèƒ½ ---
    window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; if (!installPromptShown) setTimeout(showInstallPrompt, 5000); });
    function showInstallPrompt() { document.getElementById('installPrompt').style.transform = 'translateY(0)'; installPromptShown = true; }
    function dismissInstallPrompt() { document.getElementById('installPrompt').style.transform = 'translateY(100%)'; }
    async function installPWA() { if (deferredPrompt) { deferredPrompt.prompt(); const { outcome } = await deferredPrompt.userChoice; if (outcome === 'accepted') dismissInstallPrompt(); deferredPrompt = null; } }
    if ('serviceWorker' in navigator) { navigator.serviceWorker.register(createServiceWorker()).then(() => console.log('SW registered')).catch(err => console.log('SW registration failed', err)); }
    function createServiceWorker() { const swCode = `const CACHE_NAME = 'resignation-card-v4'; self.addEventListener('install', e => e.waitUntil(caches.open(CACHE_NAME))); self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(res => res || fetch(e.request))));`; return URL.createObjectURL(new Blob([swCode], { type: 'application/javascript' })); }
    function updateOnlineStatus() { const status = document.getElementById('onlineStatus'); status.textContent = navigator.onLine ? 'ç·šä¸Š' : 'é›¢ç·š'; status.parentElement.className = `px-3 py-1 rounded-full ${navigator.onLine ? 'bg-primary-100' : 'bg-neutral-300'}`; }
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);

    /**
     * @description è¼‰å…¥æœ¬åœ°å„²å­˜è³‡æ–™
     */
    function loadData() {
        try {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) filledDates = new Map(JSON.parse(saved).dates || []);
            
            const savedPresets = localStorage.getItem(PRESETS_KEY);
            customPresets = savedPresets ? JSON.parse(savedPresets) : ['é–‹ä¸å®Œçš„æœƒ', 'æ…£è€é—†', 'è±¬éšŠå‹', 'è‡¨æ™‚æ’ä»¶'];
        } catch (e) {
            console.error('è¼‰å…¥è³‡æ–™å¤±æ•—:', e);
            filledDates = new Map();
            customPresets = ['é–‹ä¸å®Œçš„æœƒ', 'æ…£è€é—†', 'è±¬éšŠå‹', 'è‡¨æ™‚æ’ä»¶'];
        }
    }

    /**
     * @description å„²å­˜è³‡æ–™åˆ°æœ¬åœ°
     */
    function saveData() {
        try {
            const data = { dates: Array.from(filledDates.entries()), lastModified: new Date().toISOString() };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            localStorage.setItem(PRESETS_KEY, JSON.stringify(customPresets));
        } catch (e) { console.error('å„²å­˜è³‡æ–™å¤±æ•—:', e); }
    }

    /**
     * @description ç”Ÿæˆ 100 æ ¼é›†é»å¡
     */
    function generateGrid() {
        const container = document.getElementById('gridContainer');
        container.innerHTML = '';
        for (let i = 0; i < TOTAL_CELLS; i++) {
            const cell = document.createElement('div');
            cell.className = 'grid-cell aspect-square cursor-pointer flex items-center justify-center text-center relative';
            cell.dataset.index = i;
            if (filledDates.has(i)) fillCell(cell, filledDates.get(i));
            setupCellEvents(cell, i);
            container.appendChild(cell);
        }
    }

    /**
     * @description ç¶å®šæ ¼å­äº‹ä»¶ (é•·æŒ‰/çŸ­æŒ‰)
     */
    function setupCellEvents(cell, index) {
        const start = (e) => { e.preventDefault(); startLongPress(cell, index); };
        const end = (e) => { e.preventDefault(); endLongPress(cell, index); };
        
        cell.addEventListener('touchstart', start, { passive: false });
        cell.addEventListener('touchend', end, { passive: false });
        cell.addEventListener('touchcancel', cancelLongPress, { passive: false });
        cell.addEventListener('mousedown', start);
        cell.addEventListener('mouseup', end);
        cell.addEventListener('mouseleave', cancelLongPress);
    }
    
    function startLongPress(cell, index) {
        isLongPress = false;
        currentCell = cell;
        cell.classList.add('long-pressing');
        longPressTimer = setTimeout(() => {
            isLongPress = true;
            cell.classList.remove('long-pressing');
            openEventModal(index);
            if (navigator.vibrate) navigator.vibrate(50);
        }, 800);
    }

    function endLongPress(cell, index) {
        clearTimeout(longPressTimer);
        cell.classList.remove('long-pressing');
        if (!isLongPress) handleQuickMark(index, cell);
        currentCell = null;
    }

    function cancelLongPress() {
        clearTimeout(longPressTimer);
        if (currentCell) currentCell.classList.remove('long-pressing');
        currentCell = null;
        isLongPress = false;
    }
    
    /**
     * @description è™•ç†çŸ­æŒ‰å¿«é€Ÿæ¨™è¨˜
     */
    function handleQuickMark(index, cell) {
        if (filledDates.has(index)) {
            clearCell(cell);
            filledDates.delete(index);
        } else {
            const today = new Date();
            const data = {
                date: formatDate(today),
                displayDate: `${today.getMonth() + 1}/${today.getDate()}`,
                mood: 'good',
                description: '',
                timestamp: today.toISOString(),
                fontStyle: getRandomFontStyle(),
                annoyanceIndex: 0
            };
            fillCell(cell, data);
            filledDates.set(index, data);
            animateCell(cell);
            showRandomQuote();
        }
        saveData();
        updateAllStats();
    }
    
    function formatDate(date) { return date.toISOString().split('T')[0]; }
    function getRandomFontStyle() { return handwriteFonts[Math.floor(Math.random() * handwriteFonts.length)]; }
    function animateCell(cell) { cell.style.animation = 'bounceIn 0.8s'; setTimeout(() => cell.style.animation = '', 800); }

    function fillCell(cell, data) {
        cell.classList.add('filled');
        cell.classList.remove('mood-money', 'mood-burnout', 'mood-annoying', 'mood-stuck');
        if (data.mood !== 'good') cell.classList.add(`mood-${data.mood}`);
        const fontClass = data.fontStyle || 'date-text-1';
        cell.innerHTML = `<span class="date-text ${fontClass} text-xs sm:text-sm">${data.displayDate}</span>`;
    }

    function clearCell(cell) {
        cell.classList.remove('filled', 'mood-money', 'mood-burnout', 'mood-annoying', 'mood-stuck');
        cell.innerHTML = '';
    }

    // --- äº‹ä»¶æ¨¡æ…‹çª— ---
    /**
     * @description é–‹å•Ÿäº‹ä»¶æ¨¡æ…‹çª—
     * @param {number} index - æ ¼å­ç´¢å¼•
     */
    function openEventModal(index) {
        const modal = document.getElementById('eventModal');
        modal.dataset.currentIndex = index; // é—œéµä¿®æ­£ï¼šå°‡ index ç¶å®šåˆ° modal DOM ä¸Š

        const data = filledDates.get(index);
        document.getElementById('eventDate').value = data ? data.date : formatDate(new Date());
        document.getElementById('eventDescription').value = data ? data.description || '' : '';
        setMood(data ? data.mood : 'money');

        modal.classList.remove('hidden');
        modal.classList.add('flex', 'modal-open');
    }
    
    function closeEventModal() {
        const modal = document.getElementById('eventModal');
        modal.classList.remove('modal-open');
        setTimeout(() => modal.classList.add('hidden'), 300);
    }

    function renderMoodIcons() {
        Object.keys(moodIcons).forEach(mood => {
            document.getElementById(`moodIcon${mood.charAt(0).toUpperCase() + mood.slice(1)}`).innerHTML = moodIcons[mood];
        });
        document.querySelectorAll('.mood-btn').forEach(btn => btn.onclick = () => setMood(btn.dataset.mood));
    }

    function setMood(mood) {
        document.querySelectorAll('.mood-btn').forEach(btn => {
            const isSelected = btn.dataset.mood === mood;
            btn.classList.toggle('bg-gray-200', isSelected);
            btn.classList.toggle('border-2', isSelected);
            btn.classList.toggle('border-primary-500', isSelected);
            btn.dataset.selected = isSelected;
        });
    }

    /**
     * @description å„²å­˜äº‹ä»¶
     */
    function saveEvent() {
        const modal = document.getElementById('eventModal');
        const index = parseInt(modal.dataset.currentIndex, 10); // å¾ modal DOM å–å› index
        if (isNaN(index)) {
            console.error("å„²å­˜å¤±æ•—ï¼šç„¡æ•ˆçš„æ ¼å­ç´¢å¼•ã€‚");
            showAlert("å„²å­˜å¤±æ•—ï¼Œè«‹é‡è©¦ã€‚");
            return;
        }

        const mood = document.querySelector('.mood-btn[data-selected="true"]').dataset.mood;
        const description = document.getElementById('eventDescription').value.trim();
        const dateInput = document.getElementById('eventDate').value;
        const selectedDate = new Date(dateInput + 'T00:00:00');
        
        const data = {
            date: dateInput,
            displayDate: `${selectedDate.getMonth() + 1}/${selectedDate.getDate()}`,
            mood,
            description,
            timestamp: new Date().toISOString(),
            fontStyle: filledDates.get(index)?.fontStyle || getRandomFontStyle(),
            annoyanceIndex: calculateAnnoyanceIndex(description)
        };
        
        const cell = document.querySelector(`[data-index="${index}"]`);
        fillCell(cell, data);
        filledDates.set(index, data);
        
        animateCell(cell);
        saveData();
        updateAllStats();
        closeEventModal();
        showRandomQuote();
        if (filledDates.size === TOTAL_CELLS) setTimeout(showCompletionMessage, 500);
    }
    
    // --- çˆ›äº‹æŒ‰éˆ• ---
    function renderPresetButtons() {
        const container = document.getElementById('presetButtonsContainer');
        container.innerHTML = customPresets.map(preset => 
            `<button class="bg-gray-100 text-gray-700 text-xs px-3 py-1.5 rounded-full hover:bg-gray-200" onclick="appendPreset('${preset}')">${preset}</button>`
        ).join('');
    }

    function appendPreset(text) {
        const textarea = document.getElementById('eventDescription');
        textarea.value += (textarea.value ? ' ' : '') + text;
    }

    function addCustomPreset() {
        const input = document.getElementById('customPresetInput');
        const text = input.value.trim();
        if (text && !customPresets.includes(text)) {
            customPresets.push(text);
            saveData();
            renderPresetButtons();
        }
        input.value = '';
    }

    // --- å­ä¸–æŒ‡æ•¸ ---
    function calculateAnnoyanceIndex(text) {
        let score = 0;
        if (!text) return 0;
        annoyanceKeywords.forEach((value, key) => {
            const matches = text.match(new RegExp(key, 'g')) || [];
            score += matches.length * value;
        });
        return score;
    }

    function updateAnnoyanceStats() {
        let totalAnnoyance = 0;
        const keywordCounts = new Map();

        filledDates.forEach(data => {
            totalAnnoyance += data.annoyanceIndex || 0;
            annoyanceKeywords.forEach((_, key) => {
                const matches = (data.description || '').match(new RegExp(key, 'g')) || [];
                if (matches.length > 0) {
                    keywordCounts.set(key, (keywordCounts.get(key) || 0) + matches.length);
                }
            });
        });

        document.getElementById('annoyanceIndexTotal').textContent = totalAnnoyance;
        
        let levelText = "å…§å¿ƒæ¯«ç„¡æ³¢ç€¾";
        if (totalAnnoyance > 200) levelText = "åœ°ç„ç´šå­ä¸–ï¼Œè«‹å³åˆ»é€ƒé›¢";
        else if (totalAnnoyance > 100) levelText = "é‡åº¦å­ä¸–ï¼Œè€ƒæ…®è½‰è·";
        else if (totalAnnoyance > 50) levelText = "ä¸­åº¦å­ä¸–ï¼Œå¶çˆ¾æƒ³é€ƒè·‘";
        else if (totalAnnoyance > 10) levelText = "è¼•åº¦å­ä¸–ï¼Œé‚„èƒ½å¿å—";
        document.getElementById('annoyanceLevel').textContent = levelText;

        const topKeywords = Array.from(keywordCounts.entries())
            .sort((a, b) => b[1] - a[1])
            .slice(0, 3);
        
        const topKeywordsList = document.getElementById('topAnnoyanceKeywords');
        if (topKeywords.length > 0) {
            topKeywordsList.innerHTML = topKeywords.map(([key, count]) => 
                `<li>- ${key} (å‡ºç¾ ${count} æ¬¡)</li>`
            ).join('');
        } else {
            topKeywordsList.innerHTML = `<li>å°šç„¡æ•¸æ“š</li>`;
        }
    }

    // --- çµ±è¨ˆ & åœ–è¡¨ ---
    function updateAllStats() {
        updateProgress();
        updateRecentRecords();
        updateChart();
        updateAnnoyanceStats();
    }
    
    function updateProgress() {
        const totalCount = filledDates.size;
        const goodDays = Array.from(filledDates.values()).filter(d => d.mood === 'good').length;
        const badDays = totalCount - goodDays;
        const percentage = (totalCount / TOTAL_CELLS * 100).toFixed(1);
        
        document.getElementById('filledCount').textContent = totalCount;
        document.getElementById('goodDaysCount').textContent = goodDays;
        document.getElementById('badDaysCount').textContent = badDays;
        document.getElementById('completionRate').textContent = `${percentage}%`;
        
        const circle = document.getElementById('progressCircle');
        const circumference = 2 * Math.PI * 54;
        circle.style.strokeDasharray = `${(totalCount / TOTAL_CELLS) * circumference} ${circumference}`;
        
        const progressText = document.getElementById('progressText');
        if (totalCount === 0) { progressText.textContent = 'å…±100æ ¼ï¼Œé›†æ»¿é›¢è·'; }
        else if (totalCount === TOTAL_CELLS) { progressText.textContent = 'ğŸ‰ æ­å–œé›†æ»¿ï¼æº–å‚™é›¢è·ï¼'; }
        else { progressText.textContent = `é‚„å·® ${TOTAL_CELLS - totalCount} æ ¼å°±é›¢è·äº†ï¼åŠ æ²¹ï¼`; }
    }

    function updateRecentRecords() {
        const container = document.getElementById('recentRecords');
        const records = Array.from(filledDates.entries()).map(([index, data]) => ({ index, ...data })).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).slice(0, 5);
        if (records.length === 0) { container.innerHTML = `<p class="text-neutral-500 text-center py-8"><i class="fas fa-inbox text-3xl mb-2 block"></i>å°šç„¡è¨˜éŒ„ï¼Œé–‹å§‹ä½ çš„é›¢è·é›†é»ä¹‹æ—…å§ï¼</p>`; return; }
        container.innerHTML = records.map(r => `<div class="flex items-start gap-4 p-4 bg-white/50 rounded-xl hover:bg-white/70 transition-all duration-200"><div class="text-2xl">${r.mood === 'good' ? '<i class="fas fa-smile text-primary-500"></i>' : moodIcons[r.mood]}</div><div class="flex-1"><div class="flex items-center justify-between mb-1"><span class="font-medium text-neutral-800">æ ¼å­ #${r.index + 1}</span><span class="text-xs text-neutral-500">${new Date(r.timestamp).toLocaleDateString()}</span></div><p class="text-sm text-neutral-600 leading-relaxed">${r.description || 'å¿«é€Ÿæ¨™è¨˜'}</p></div></div>`).join('');
    }

    function initChart() {
        const ctx = document.getElementById('dailyChart').getContext('2d');
        const dailyData = getDailyData();
        dailyChart = new Chart(ctx, {
            type: 'line',
            data: { labels: dailyData.labels, datasets: [{ label: 'å¥½æ—¥å­', data: dailyData.good, borderColor: '#3da35d', backgroundColor: 'rgba(61, 163, 93, 0.1)', borderWidth: 3, fill: true, tension: 0.4 }, { label: 'çˆ›æ—¥å­', data: dailyData.bad, borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.1)', borderWidth: 3, fill: true, tension: 0.4 }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } }
        });
    }

    function getDailyData() {
        const now = new Date(); const labels = []; const goodData = []; const badData = [];
        for (let i = 13; i >= 0; i--) {
            const date = new Date(now); date.setDate(date.getDate() - i); const dateStr = formatDate(date);
            labels.push(`${date.getMonth() + 1}/${date.getDate()}`);
            let goodCount = 0; let badCount = 0;
            filledDates.forEach(data => { if (data.date === dateStr) { if (data.mood === 'good') goodCount++; else badCount++; } });
            goodData.push(goodCount); badData.push(badCount);
        }
        return { labels, good: goodData, bad: badData };
    }

    function updateChart() { if (dailyChart) { const dailyData = getDailyData(); dailyChart.data.labels = dailyData.labels; dailyChart.data.datasets[0].data = dailyData.good; dailyChart.data.datasets[1].data = dailyData.bad; dailyChart.update('none'); } }

    /**
     * @description å®‰æ’æ¯æ—¥è‡ªå‹•æ›´æ–°åœ–è¡¨
     */
    function scheduleDailyUpdate() {
        const now = new Date();
        const tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
        const msUntilMidnight = tomorrow - now + 1000; // åŠ ä¸€ç§’ç¢ºä¿éåˆå¤œ
        console.log(`ä¸‹ä¸€æ¬¡åœ–è¡¨è‡ªå‹•æ›´æ–°å°‡åœ¨ ${Math.round(msUntilMidnight / 1000 / 60)} åˆ†é˜å¾Œã€‚`);

        setTimeout(() => {
            console.log("åˆå¤œå·²åˆ°ï¼Œæ­£åœ¨è‡ªå‹•æ›´æ–°æ¯æ—¥è¶¨å‹¢åœ–è¡¨...");
            updateChart();
            scheduleDailyUpdate(); // å†æ¬¡å®‰æ’ä¸‹ä¸€æ¬¡æ›´æ–°
        }, msUntilMidnight);
    }
    
    // --- æ¨¡æ…‹çª— & æç¤º ---
    function showRandomQuote() {
        const display = document.getElementById('quoteDisplay');
        document.getElementById('quoteText').textContent = quotes[Math.floor(Math.random() * quotes.length)];
        display.style.display = 'block';
        display.querySelector('.quote-container').style.animation = 'quote-slide 0.8s';
        setTimeout(() => display.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
        setTimeout(hideQuote, 8000);
    }
    function hideQuote() { document.getElementById('quoteDisplay').style.display = 'none'; }
    function showAlert(message) { alert(message); }
    function showClearConfirm() { if (filledDates.size === 0) return; const modal = document.getElementById('confirmModal'); modal.classList.remove('hidden'); modal.classList.add('flex', 'modal-open'); }
    function closeConfirmModal() { const modal = document.getElementById('confirmModal'); modal.classList.remove('modal-open'); setTimeout(() => modal.classList.add('hidden'), 300); }
    function confirmClearAll() { filledDates.clear(); saveData(); generateGrid(); updateAllStats(); closeConfirmModal(); }

    // --- AI æ•¸æ“šåŒ¯å‡º ---
    function openAiExportModal() {
        const data = {
            exportDate: new Date().toISOString(),
            summary: {
                totalRecords: filledDates.size,
                totalAnnoyanceIndex: Array.from(filledDates.values()).reduce((sum, d) => sum + (d.annoyanceIndex || 0), 0)
            },
            records: Array.from(filledDates.entries()).map(([index, data]) => ({ cellIndex: index, ...data }))
        };
        document.getElementById('jsonDataOutput').textContent = JSON.stringify(data, null, 2);
        const modal = document.getElementById('aiExportModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex', 'modal-open');
    }

    function closeAiExportModal() {
        const modal = document.getElementById('aiExportModal');
        modal.classList.remove('modal-open');
        setTimeout(() => modal.classList.add('hidden'), 300);
    }

    async function copyToClipboard(text, buttonElement) {
        try {
            await navigator.clipboard.writeText(text);
            const originalText = buttonElement.textContent;
            buttonElement.textContent = 'å·²è¤‡è£½!';
            setTimeout(() => { buttonElement.textContent = originalText; }, 2000);
        } catch (err) {
            console.error('è¤‡è£½å¤±æ•—:', err);
            showAlert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ã€‚');
        }
    }
    
    document.getElementById('copyJsonBtn').addEventListener('click', function() {
        const jsonText = document.getElementById('jsonDataOutput').textContent;
        copyToClipboard(jsonText, this);
    });

    function copyPrompt(templateId) {
        const jsonText = document.getElementById('jsonDataOutput').textContent;
        const promptTemplate = document.getElementById(templateId).textContent;
        const fullPrompt = promptTemplate.replace('[æ­¤è™•è²¼ä¸Šæ‚¨çš„ JSON æ•¸æ“š]', jsonText);
        const button = document.querySelector(`#${templateId} + .prompt-copy-btn`);
        copyToClipboard(fullPrompt, button);
    }

    // --- åˆ†äº«åŠŸèƒ½ ---
    function setupShareModal() {
        const shareBtn = document.getElementById('shareBtn');
        const shareModal = document.getElementById('shareModal');
        const copyLinkBtn = document.getElementById('copyLinkBtn');
        const shareToThreadsBtn = document.getElementById('shareToThreadsBtn');
        const shareToTwitterBtn = document.getElementById('shareToTwitterBtn');
        const shareToLineBtn = document.getElementById('shareToLineBtn');

        shareBtn.addEventListener('click', () => {
            shareModal.classList.add('show');
            shareModal.setAttribute('aria-hidden', 'false');
        });

        window.closeShareModal = function() {
            shareModal.classList.remove('show');
            shareModal.setAttribute('aria-hidden', 'true');
        }

        shareModal.addEventListener('click', e => { if (e.target === shareModal) closeShareModal(); });
        document.addEventListener('keydown', e => { if (e.key === 'Escape' && shareModal.classList.contains('show')) closeShareModal(); });

        copyLinkBtn.addEventListener('click', () => copyToClipboard(window.location.href, copyLinkBtn));
        shareToThreadsBtn.addEventListener('click', () => window.open(`https://www.threads.net/intent/post?text=${encodeURIComponent(document.title + " " + window.location.href)}`, '_blank'));
        shareToTwitterBtn.addEventListener('click', () => window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(document.title)}&url=${encodeURIComponent(window.location.href)}`, '_blank'));
        shareToLineBtn.addEventListener('click', () => window.open(`https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(window.location.href)}`, '_blank'));
    }

    // éµç›¤å¿«æ·éµ
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeEventModal();
            closeConfirmModal();
            closeAiExportModal();
            closeShareModal();
            hideQuote();
        }
    });

    // PWA Manifest å‹•æ…‹ç”Ÿæˆ
    const manifest = { "name": "é›¢è·é›†é»å¡", "short_name": "é›¢è·é›†é»", "description": "è¨˜éŒ„æ¯ä¸€å¤©çš„é›¢è·é›†é»ï¼Œé‚å‘è‡ªç”±ä¹‹è·¯", "start_url": "/", "display": "standalone", "background_color": "#f0f9f4", "theme_color": "#3da35d", "icons": [{ "src": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMzZGEzNWQiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik05IDEyTDExIDE0TDE1IDEwTTIxIDEyQzIxIDE2Ljk3MDYgMTYuOTcwNiAyMSAxMiAyMUM3LjAyOTQ0IDIxIDMgMTYuOTcwNiAzIDEyQzMgNy4wMjk0NCA3LjAyOTQ0IDMgMTIgM0MxNi45NzA2IDMgMjEgNy4wMjk0NCAyMSAxMloiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8L3N2Zz4KPC9zdmc+", "sizes": "192x192", "type": "image/svg+xml" }] };
    const link = document.createElement('link');
    link.rel = 'manifest';
    link.href = URL.createObjectURL(new Blob([JSON.stringify(manifest)], {type: 'application/json'}));
    document.head.appendChild(link);
</script>

</body>
</html>