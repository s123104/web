<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>今天想吃什麼</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Leaflet.js -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <style>
        #map { height: 100vh; }
        .bottom-drawer { position: fixed; bottom: 0; background: white; border-radius: 24px 24px 0 0; }
        .wheel-container { width: 280px; height: 280px; border-radius: 50%; border: 8px solid #F8B400; }
        .wheel-segment { position: absolute; width: 100%; height: 100%; clip-path: polygon(50% 50%, 0 0, 0 100%); }
    </style>
</head>
<body x-data="app()" x-init="init()">
    <!-- 地圖容器 -->
    <div id="map"></div>

    <!-- 隨機推薦按鈕 -->
    <button class="fixed bottom-20 right-4 bg-yellow-500 text-white p-4 rounded-full" @click="randomSelect()">
        隨機選擇
    </button>

    <!-- 底部抽屜（列表） -->
    <div class="bottom-drawer p-4" x-show="currentView === 'list'">
        <h2 class="text-xl font-bold">附近餐廳</h2>
        <template x-for="restaurant in filteredRestaurants" :key="restaurant.id">
            <div class="flex mb-2">
                <img :src="restaurant.image" class="w-16 h-16 rounded" />
                <div class="ml-4">
                    <h3 x-text="restaurant.name"></h3>
                    <p x-text="restaurant.type"></p>
                    <p x-text="restaurant.distance + ' 公尺'"></p>
                </div>
            </div>
        </template>
    </div>

    <script>
        function app() {
            return {
                currentView: 'map',
                restaurants: [
                    { id: 1, name: '老王牛肉麵', type: '中式', distance: 100, image: 'https://via.placeholder.com/150', lat: 25.033, lng: 121.565 },
                    { id: 2, name: 'Tokyo拉麵', type: '日式', distance: 200, image: 'https://via.placeholder.com/150', lat: 25.034, lng: 121.566 }
                ],
                filteredRestaurants: [],
                map: null,
                async init() {
                    // 初始化地圖
                    this.map = L.map('map').setView([25.033, 121.565], 13);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                    }).addTo(this.map);

                    // 獲取位置
                    navigator.geolocation.getCurrentPosition((pos) => {
                        const { latitude, longitude } = pos.coords;
                        this.map.setView([latitude, longitude], 15);
                        L.marker([latitude, longitude]).addTo(this.map);
                        this.updateDistances(latitude, longitude);
                    });

                    this.filteredRestaurants = [...this.restaurants];
                },
                updateDistances(lat, lng) {
                    this.restaurants.forEach(r => {
                        r.distance = Math.sqrt(Math.pow(r.lat - lat, 2) + Math.pow(r.lng - lng, 2)) * 111000; // 簡化距離計算
                    });
                    this.filteredRestaurants = [...this.restaurants];
                },
                randomSelect() {
                    const idx = Math.floor(Math.random() * this.filteredRestaurants.length);
                    Swal.fire({ title: '今天吃：', text: this.filteredRestaurants[idx].name });
                }
            };
        }
    </script>
</body>
</html>