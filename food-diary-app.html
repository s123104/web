<!DOCTYPE html>

<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美食日記 - 記錄每一餐的美好</title>


<!-- Tailwind CSS CDN with Apple-inspired custom config -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    // Apple風格的温暖色彩系統
                    primary: {
                        50: '#fff8f0',
                        100: '#feecdc',
                        200: '#fcd9bd',
                        300: '#fdba8c',
                        400: '#ff8a4c',
                        500: '#ff6b35', // 主色調 - 温暖橙色
                        600: '#ea580c',
                        700: '#c2410c',
                        800: '#9a3412',
                        900: '#7c2d12'
                    },
                    secondary: {
                        50: '#f0f9ff',
                        100: '#e0f2fe',
                        200: '#bae6fd',
                        300: '#7dd3fc',
                        400: '#38bdf8',
                        500: '#0ea5e9', // 清新藍色
                        600: '#0284c7',
                        700: '#0369a1',
                        800: '#075985',
                        900: '#0c4a6e'
                    },
                    accent: {
                        50: '#fdf4ff',
                        100: '#fae8ff',
                        200: '#f5d0fe',
                        300: '#f0abfc',
                        400: '#e879f9',
                        500: '#d946ef', // 可愛粉紫
                        600: '#c026d3',
                        700: '#a21caf',
                        800: '#86198f',
                        900: '#701a75'
                    },
                    success: {
                        50: '#f0fdf4',
                        100: '#dcfce7',
                        200: '#bbf7d0',
                        300: '#86efac',
                        400: '#4ade80',
                        500: '#22c55e', // 成功綠色
                        600: '#16a34a',
                        700: '#15803d',
                        800: '#166534',
                        900: '#14532d'
                    },
                    neutral: {
                        50: '#fafafa',
                        100: '#f5f5f5',
                        200: '#e5e5e5',
                        300: '#d4d4d4',
                        400: '#a3a3a3',
                        500: '#737373',
                        600: '#525252',
                        700: '#404040',
                        800: '#262626',
                        900: '#171717'
                    }
                },
                fontFamily: {
                    'sans': ['SF Pro Display', 'Inter', 'Noto Sans TC', 'system-ui', 'sans-serif']
                },
                spacing: {
                    '4.5': '1.125rem',
                    '5.5': '1.375rem',
                    '18': '4.5rem',
                    '88': '22rem'
                },
                borderRadius: {
                    '4xl': '2rem',
                    '5xl': '2.5rem'
                },
                boxShadow: {
                    'apple': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                    'apple-lg': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                    'apple-xl': '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                    'inner-light': 'inset 0 2px 4px 0 rgba(255, 255, 255, 0.06)'
                },
                animation: {
                    'gentle-bounce': 'gentleBounce 0.6s ease-out',
                    'fade-slide-up': 'fadeSlideUp 0.8s ease-out',
                    'scale-in': 'scaleIn 0.4s ease-out',
                    'wiggle': 'wiggle 1s ease-in-out infinite',
                    'heart-beat': 'heartBeat 1.5s ease-in-out infinite'
                }
            }
        }
    }
</script>

<!-- SF Pro Display Font (Apple's font) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+TC:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<!-- Heroicons (Apple-style icons) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    /* Apple風格的自定義動畫 */
    @keyframes gentleBounce {
        0%, 20%, 60%, 100% {
            transform: translateY(0);
        }
        40% {
            transform: translateY(-8px);
        }
        80% {
            transform: translateY(-4px);
        }
    }
    
    @keyframes fadeSlideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes scaleIn {
        from {
            opacity: 0;
            transform: scale(0.95);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }
    
    @keyframes wiggle {
        0%, 7% {
            transform: rotateZ(0);
        }
        15% {
            transform: rotateZ(-15deg);
        }
        20% {
            transform: rotateZ(10deg);
        }
        25% {
            transform: rotateZ(-10deg);
        }
        30% {
            transform: rotateZ(6deg);
        }
        35% {
            transform: rotateZ(-4deg);
        }
        40%, 100% {
            transform: rotateZ(0);
        }
    }
    
    @keyframes heartBeat {
        0% {
            transform: scale(1);
        }
        14% {
            transform: scale(1.1);
        }
        28% {
            transform: scale(1);
        }
        42% {
            transform: scale(1.1);
        }
        70% {
            transform: scale(1);
        }
    }
    
    /* Apple風格的背景漸層 */
    .apple-gradient {
        background: linear-gradient(135deg, 
            #fff8f0 0%, 
            #feecdc 25%, 
            #f0f9ff 50%, 
            #fdf4ff 75%, 
            #f0fdf4 100%);
    }
    
    /* 玻璃擬態效果 - Apple風格 */
    .glass-card {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
    }
    
    /* 漂浮卡片效果 */
    .floating-card {
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    .floating-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
    
    /* Apple風格的按鈕 */
    .apple-button {
        background: linear-gradient(135deg, #ff6b35, #ff8a4c);
        border: none;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        position: relative;
        overflow: hidden;
    }
    
    .apple-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(255, 107, 53, 0.3);
    }
    
    .apple-button:active {
        transform: translateY(0);
    }
    
    /* 可愛的檔案上傳區域 */
    .cute-upload-area {
        transition: all 0.3s ease;
        border: 2px dashed #ff8a4c;
        background: linear-gradient(135deg, rgba(255, 248, 240, 0.5), rgba(254, 236, 220, 0.5));
    }
    
    .cute-upload-area:hover {
        border-color: #ff6b35;
        background: linear-gradient(135deg, rgba(255, 248, 240, 0.8), rgba(254, 236, 220, 0.8));
        transform: scale(1.02);
    }
    
    .cute-upload-area.dragover {
        border-color: #ff6b35;
        background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(255, 138, 76, 0.1));
        transform: scale(1.05);
    }
    
    /* 可愛的彩蛋按鈕 */
    .cute-easter-egg {
        position: fixed;
        bottom: 24px;
        right: 24px;
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: linear-gradient(135deg, #d946ef, #ff6b35);
        border: none;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        box-shadow: 0 8px 16px rgba(217, 70, 239, 0.3);
        z-index: 1000;
    }
    
    .cute-easter-egg:hover {
        transform: scale(1.15) rotate(10deg);
        box-shadow: 0 12px 24px rgba(217, 70, 239, 0.4);
    }
    
    /* 營養卡片的可愛樣式 */
    .nutrition-card {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 248, 240, 0.7));
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    .nutrition-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
    
    /* 自定義捲軸樣式 (WebKit) */
    ::-webkit-scrollbar {
        width: 8px;
    }
    
    ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #ff6b35, #ff8a4c);
        border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #ea580c, #ff6b35);
    }
    
    /* 表單元素的Apple風格 */
    .apple-input {
        background: rgba(255, 255, 255, 0.8);
        border: 1px solid rgba(255, 138, 76, 0.2);
        transition: all 0.3s ease;
    }
    
    .apple-input:focus {
        background: rgba(255, 255, 255, 0.95);
        border-color: #ff6b35;
        box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        outline: none;
    }
</style>


</head>

<body class="min-h-screen apple-gradient font-sans">
    <!-- Header 區域 - Apple風格 -->
    <header class="sticky top-0 z-50 glass-card">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-primary-400 to-primary-600 rounded-2xl flex items-center justify-center shadow-apple animate-gentle-bounce">
                        <i class="fas fa-heart text-white text-xl animate-heart-beat"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-neutral-800 tracking-tight">美食日記</h1>
                        <p class="text-sm text-neutral-500 hidden md:block">記錄每一餐的美好時光</p>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-4 text-sm text-neutral-600">
                    <span class="bg-primary-50 px-3 py-1 rounded-full">今天也要好好吃飯喔 🍽️</span>
                </div>
            </div>
        </div>
    </header>


<!-- 主要內容區域 -->
<main class="container mx-auto px-6 py-8 max-w-5xl">
    
    <!-- 歡迎訊息區塊 -->
    <section class="mb-12 text-center opacity-0 translate-y-8" id="welcomeSection">
        <div class="inline-block">
            <h2 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary-500 to-accent-500 mb-4">
                哈囉！今天吃什麼呢？
            </h2>
            <p class="text-lg text-neutral-600 max-w-2xl mx-auto leading-relaxed">
                用照片記錄每一餐的美好，讓我們一起打造健康又快樂的飲食日記吧！ ✨
            </p>
        </div>
    </section>
    
    <!-- 上傳食物照片區塊 -->
    <section class="mb-16 opacity-0 translate-y-8" id="uploadSection">
        <div class="glass-card rounded-4xl shadow-apple-lg p-8 md:p-10 floating-card">
            <div class="flex items-center mb-8">
                <div class="w-12 h-12 bg-gradient-to-br from-primary-400 to-primary-600 rounded-2xl flex items-center justify-center mr-4 shadow-apple">
                    <i class="fas fa-camera text-white text-xl"></i>
                </div>
                <div>
                    <h3 class="text-2xl md:text-3xl font-bold text-neutral-800">分享今天的美食</h3>
                    <p class="text-neutral-500 mt-1">拍張照片，記錄這美好的一餐</p>
                </div>
            </div>
            
            <form id="foodUploadForm" class="space-y-8">
                <!-- 餐別選單 -->
                <div class="space-y-3">
                    <label for="mealType" class="block text-lg font-semibold text-neutral-700 flex items-center">
                        <i class="fas fa-clock text-primary-500 mr-2"></i>
                        這是哪一餐呢？
                    </label>
                    <select id="mealType" class="w-full px-6 py-4 rounded-2xl apple-input text-neutral-700 text-lg font-medium">
                        <option value="">請選擇餐別 🤔</option>
                        <option value="breakfast">🌅 早餐 - 美好的一天開始</option>
                        <option value="lunch">🍱 午餐 - 元氣滿滿的午後</option>
                        <option value="dinner">🍽️ 晚餐 - 溫馨的晚間時光</option>
                        <option value="snack">🍪 點心 - 甜蜜的小確幸</option>
                    </select>
                </div>
                
                <!-- 說明輸入框 -->
                <div class="space-y-3">
                    <label for="foodDescription" class="block text-lg font-semibold text-neutral-700 flex items-center">
                        <i class="fas fa-pen text-secondary-500 mr-2"></i>
                        分享一下今天吃了什麼吧
                    </label>
                    <textarea id="foodDescription" rows="4" 
                        placeholder="例如：香噴噴的小籠包配上脆嫩的蛋餅，還有濃醇的豆漿，真是完美的早餐組合！😋" 
                        class="w-full px-6 py-4 rounded-2xl apple-input text-neutral-700 resize-none text-lg leading-relaxed"></textarea>
                </div>
                
                <!-- 照片上傳欄位 -->
                <div class="space-y-3">
                    <label for="foodPhoto" class="block text-lg font-semibold text-neutral-700 flex items-center">
                        <i class="fas fa-image text-accent-500 mr-2"></i>
                        上傳美食照片
                    </label>
                    <div class="cute-upload-area rounded-3xl p-8 text-center cursor-pointer" id="uploadArea">
                        <input type="file" id="foodPhoto" accept=".jpg,.jpeg,.png,.webp" class="hidden">
                        <div id="uploadPlaceholder">
                            <div class="w-16 h-16 bg-gradient-to-br from-primary-400 to-accent-400 rounded-2xl flex items-center justify-center mx-auto mb-4 animate-gentle-bounce">
                                <i class="fas fa-cloud-upload-alt text-white text-2xl"></i>
                            </div>
                            <h4 class="text-xl font-semibold text-neutral-700 mb-2">點擊上傳美食照片</h4>
                            <p class="text-neutral-500">支援 JPG、PNG、WEBP 格式</p>
                            <p class="text-sm text-neutral-400 mt-2">或直接拖拽檔案到這裡</p>
                        </div>
                        <div id="uploadPreview" class="hidden">
                            <img id="previewImage" class="max-w-full h-48 object-cover rounded-2xl mx-auto mb-4 shadow-apple">
                            <p id="fileName" class="text-lg font-medium text-neutral-600"></p>
                            <button type="button" id="removePhoto" class="mt-3 text-red-500 hover:text-red-600 transition-colors">
                                <i class="fas fa-trash mr-1"></i>重新選擇
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 送出按鈕 -->
                <button type="submit" class="w-full apple-button text-white font-bold py-5 px-8 rounded-2xl text-lg shadow-apple-lg">
                    <i class="fas fa-heart mr-3"></i>
                    紀錄這美好的一餐
                    <i class="fas fa-sparkles ml-3"></i>
                </button>
            </form>
        </div>
    </section>
    
    <!-- 查詢當日三餐摘要區塊 -->
    <section class="mb-16 opacity-0 translate-y-8" id="querySection">
        <div class="glass-card rounded-4xl shadow-apple-lg p-8 md:p-10 floating-card">
            <div class="flex items-center mb-8">
                <div class="w-12 h-12 bg-gradient-to-br from-secondary-400 to-secondary-600 rounded-2xl flex items-center justify-center mr-4 shadow-apple">
                    <i class="fas fa-search text-white text-xl"></i>
                </div>
                <div>
                    <h3 class="text-2xl md:text-3xl font-bold text-neutral-800">查看飲食紀錄</h3>
                    <p class="text-neutral-500 mt-1">回顧過往的美食時光</p>
                </div>
            </div>
            
            <div class="flex flex-col lg:flex-row gap-6 items-end">
                <div class="flex-1">
                    <label for="queryDate" class="block text-lg font-semibold text-neutral-700 mb-3 flex items-center">
                        <i class="fas fa-calendar-alt text-secondary-500 mr-2"></i>
                        選擇想查看的日期
                    </label>
                    <input type="date" id="queryDate" class="w-full px-6 py-4 rounded-2xl apple-input text-neutral-700 text-lg">
                </div>
                <button id="queryBtn" class="w-full lg:w-auto bg-gradient-to-r from-secondary-500 to-secondary-600 hover:from-secondary-600 hover:to-secondary-700 text-white font-bold py-4 px-8 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-apple-lg text-lg">
                    <i class="fas fa-search mr-2"></i>
                    開始查詢
                </button>
            </div>
        </div>
    </section>
    
    <!-- 查詢結果區塊 -->
    <section class="opacity-0 translate-y-8" id="resultsSection">
        <div class="glass-card rounded-4xl shadow-apple-lg p-8 md:p-10">
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-gradient-to-br from-success-400 to-success-600 rounded-2xl flex items-center justify-center mr-4 shadow-apple">
                        <i class="fas fa-chart-pie text-white text-xl"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl md:text-3xl font-bold text-neutral-800">飲食摘要</h3>
                        <p class="text-neutral-500 mt-1">這一天的營養總覽</p>
                    </div>
                </div>
                <span id="selectedDate" class="text-lg font-medium text-neutral-600 bg-gradient-to-r from-primary-50 to-accent-50 px-4 py-2 rounded-2xl border border-primary-200"></span>
            </div>
            
            <div id="resultsContainer" class="space-y-8">
                <!-- 結果將動態生成 -->
            </div>
            
            <div id="noDataMessage" class="hidden text-center py-16">
                <div class="w-24 h-24 bg-gradient-to-br from-neutral-200 to-neutral-300 rounded-3xl flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-utensils text-neutral-400 text-3xl"></i>
                </div>
                <h4 class="text-2xl font-bold text-neutral-600 mb-3">這一天還沒有記錄呢</h4>
                <p class="text-neutral-500 text-lg mb-6">開始記錄您的美食時光吧！</p>
                <button onclick="document.getElementById('uploadSection').scrollIntoView({behavior: 'smooth'})" 
                    class="apple-button text-white font-semibold py-3 px-6 rounded-2xl">
                    <i class="fas fa-plus mr-2"></i>開始記錄
                </button>
            </div>
        </div>
    </section>
</main>

<!-- Footer -->
<footer class="mt-20 py-12 text-center">
    <div class="container mx-auto px-6">
        <div class="bg-gradient-to-r from-primary-500 to-accent-500 text-transparent bg-clip-text">
            <p class="text-lg font-semibold">© 2025 美食日記</p>
            <p class="text-sm mt-2 text-neutral-500">用心記錄，用愛品嚐每一餐的美好 ❤️</p>
        </div>
    </div>
</footer>

<!-- 可愛的彩蛋按鈕 -->
<button class="cute-easter-egg animate-wiggle" id="easterEggBtn" title="發現小驚喜！">
    <i class="fas fa-gift text-white text-xl"></i>
</button>

<!-- 彩蛋模態框 -->
<div id="easterEggModal" class="fixed inset-0 bg-black/40 backdrop-blur-md z-50 hidden flex items-center justify-center p-6">
    <div class="glass-card rounded-4xl p-10 max-w-lg w-full transform scale-95 opacity-0 transition-all duration-500" id="modalContent">
        <div class="text-center">
            <div class="w-20 h-20 bg-gradient-to-br from-accent-400 to-primary-500 rounded-3xl flex items-center justify-center mx-auto mb-6 animate-heart-beat shadow-apple-lg">
                <i class="fas fa-star text-white text-3xl"></i>
            </div>
            <h3 class="text-3xl font-bold text-neutral-800 mb-4">🎉 哇！發現小驚喜</h3>
            <p class="text-neutral-600 text-lg mb-8 leading-relaxed">
                恭喜您發現了隱藏的小彩蛋！作為獎勵，讓我為您提供一些貼心的飲食小建議吧～
            </p>
            <div class="space-y-4">
                <button id="getAdviceBtn" class="w-full bg-gradient-to-r from-accent-500 to-primary-500 text-white font-bold py-4 px-8 rounded-2xl hover:from-accent-600 hover:to-primary-600 transition-all duration-300 transform hover:scale-105 shadow-apple-lg text-lg">
                    <i class="fas fa-lightbulb mr-2"></i>
                    獲得今日飲食建議
                </button>
                <button id="closeModalBtn" class="w-full bg-neutral-200 text-neutral-700 font-semibold py-4 px-8 rounded-2xl hover:bg-neutral-300 transition-all duration-300 text-lg">
                    <i class="fas fa-times mr-2"></i>
                    關閉
                </button>
            </div>
            <div id="adviceContent" class="hidden mt-8 p-6 bg-gradient-to-r from-primary-50 to-accent-50 rounded-3xl border border-primary-200">
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-primary-400 to-accent-500 rounded-xl flex items-center justify-center flex-shrink-0 mt-1">
                        <i class="fas fa-heart text-white text-sm"></i>
                    </div>
                    <p class="text-primary-800 text-lg leading-relaxed"></p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // === Apple風格的美食日記應用程式 ===
    class CuteFoodDiaryApp {
        constructor() {
            this.meals = JSON.parse(localStorage.getItem('cuteFoodDiary') || '{}');
            this.currentUploadedFile = null;
            this.init();
        }
        
        init() {
            this.setupEventListeners();
            this.setupIntersectionObserver();
            this.setDefaultDate();
            this.startLoadAnimations();
            this.setupDragAndDrop();
        }
        
        // 設置進場動畫序列
        startLoadAnimations() {
            const sections = ['welcomeSection', 'uploadSection', 'querySection', 'resultsSection'];
            sections.forEach((sectionId, index) => {
                setTimeout(() => {
                    const section = document.getElementById(sectionId);
                    section.style.animation = 'fadeSlideUp 0.8s ease-out forwards';
                }, index * 200);
            });
        }
        
        // 設置事件監聽器
        setupEventListeners() {
            // 檔案上傳相關
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('foodPhoto');
            
            uploadArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', this.handleFileUpload.bind(this));
            
            // 移除照片按鈕
            document.getElementById('removePhoto').addEventListener('click', this.removePhoto.bind(this));
            
            // 表單提交
            document.getElementById('foodUploadForm').addEventListener('submit', this.handleFormSubmit.bind(this));
            
            // 查詢功能
            document.getElementById('queryBtn').addEventListener('click', this.handleQuery.bind(this));
            
            // 彩蛋功能
            document.getElementById('easterEggBtn').addEventListener('click', this.showEasterEgg.bind(this));
            document.getElementById('closeModalBtn').addEventListener('click', this.hideEasterEgg.bind(this));
            document.getElementById('getAdviceBtn').addEventListener('click', this.showAdvice.bind(this));
            
            // ESC鍵關閉模態框
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !document.getElementById('easterEggModal').classList.contains('hidden')) {
                    this.hideEasterEgg();
                }
            });
            
            // 點擊模態框外部關閉
            document.getElementById('easterEggModal').addEventListener('click', (e) => {
                if (e.target.id === 'easterEggModal') {
                    this.hideEasterEgg();
                }
            });
        }
        
        // 設置拖拽上傳功能
        setupDragAndDrop() {
            const uploadArea = document.getElementById('uploadArea');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, this.preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => {
                    uploadArea.classList.add('dragover');
                }, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => {
                    uploadArea.classList.remove('dragover');
                }, false);
            });
            
            uploadArea.addEventListener('drop', this.handleDrop.bind(this), false);
        }
        
        preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                document.getElementById('foodPhoto').files = files;
                this.handleFileUpload({ target: { files: files } });
            }
        }
        
        // 設置滾動觀察器
        setupIntersectionObserver() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.animation = 'fadeSlideUp 0.8s ease-out forwards';
                    }
                });
            }, { threshold: 0.2 });
            
            document.querySelectorAll('section').forEach(section => {
                observer.observe(section);
            });
        }
        
        // 設置預設日期
        setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('queryDate').value = today;
        }
        
        // 處理檔案上傳
        handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // 檢查檔案大小 (限制5MB)
            if (file.size > 5 * 1024 * 1024) {
                this.showNotification('檔案太大了！請選擇小於 5MB 的圖片', 'error');
                return;
            }
            
            // 檢查檔案類型
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                this.showNotification('請選擇 JPG、PNG 或 WEBP 格式的圖片', 'error');
                return;
            }
            
            this.currentUploadedFile = file;
            
            const placeholder = document.getElementById('uploadPlaceholder');
            const preview = document.getElementById('uploadPreview');
            const previewImage = document.getElementById('previewImage');
            const fileName = document.getElementById('fileName');
            
            // 顯示預覽圖片
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                fileName.textContent = `📸 ${file.name}`;
                placeholder.classList.add('hidden');
                preview.classList.remove('hidden');
                preview.style.animation = 'scaleIn 0.4s ease-out';
            };
            reader.readAsDataURL(file);
        }
        
        // 移除照片
        removePhoto() {
            this.currentUploadedFile = null;
            document.getElementById('foodPhoto').value = '';
            document.getElementById('uploadPlaceholder').classList.remove('hidden');
            document.getElementById('uploadPreview').classList.add('hidden');
        }
        
        // 處理表單提交
        handleFormSubmit(event) {
            event.preventDefault();
            
            const mealType = document.getElementById('mealType').value;
            const description = document.getElementById('foodDescription').value.trim();
            
            // 表單驗證
            if (!mealType) {
                this.showNotification('請選擇餐別喔！ 🤔', 'warning');
                document.getElementById('mealType').focus();
                return;
            }
            
            if (!description) {
                this.showNotification('請分享一下您吃了什麼吧！ 😊', 'warning');
                document.getElementById('foodDescription').focus();
                return;
            }
            
            if (description.length < 5) {
                this.showNotification('描述太簡短了，請多分享一些細節吧！ ✨', 'warning');
                return;
            }
            
            // 儲存記錄
            const today = new Date().toISOString().split('T')[0];
            if (!this.meals[today]) {
                this.meals[today] = {};
            }
            
            this.meals[today][mealType] = {
                description,
                photo: this.currentUploadedFile ? this.currentUploadedFile.name : null,
                timestamp: new Date().toISOString(),
                nutrition: this.generateSmartNutrition(description)
            };
            
            localStorage.setItem('cuteFoodDiary', JSON.stringify(this.meals));
            
            // 重置表單與動畫
            document.getElementById('foodUploadForm').reset();
            this.removePhoto();
            
            // 成功動畫
            const submitBtn = event.target.querySelector('button[type="submit"]');
            submitBtn.style.animation = 'gentleBounce 0.6s ease-out';
            
            this.showNotification('美食記錄已保存！繼續享受美好的一餐吧！ 🎉', 'success');
            
            // 如果查詢的是今天，自動刷新結果
            const queryDate = document.getElementById('queryDate').value;
            if (queryDate === today) {
                setTimeout(() => this.displayResults(today), 1000);
            }
        }
        
        // 智慧營養分析（基於描述關鍵字）
        generateSmartNutrition(description) {
            const desc = description.toLowerCase();
            let calories = 300; // 基礎熱量
            let protein = 15;
            let carbs = 40;
            let fat = 10;
            
            // 高熱量食物關鍵字
            const highCalorieKeywords = ['炸', '油', '肉', '起司', '奶油', '蛋糕', '甜點', '巧克力'];
            const proteinKeywords = ['肉', '蛋', '魚', '豆', '奶', '雞', '豬', '牛'];
            const carbKeywords = ['飯', '麵', '粥', '餅', '包', '麵包', '義大利麵'];
            const healthyKeywords = ['菜', '水果', '沙拉', '蔬菜', '清淡'];
            
            // 調整營養數值
            if (highCalorieKeywords.some(keyword => desc.includes(keyword))) {
                calories += Math.floor(Math.random() * 300) + 200;
                fat += Math.floor(Math.random() * 20) + 10;
            }
            
            if (proteinKeywords.some(keyword => desc.includes(keyword))) {
                protein += Math.floor(Math.random() * 25) + 15;
            }
            
            if (carbKeywords.some(keyword => desc.includes(keyword))) {
                carbs += Math.floor(Math.random() * 40) + 30;
            }
            
            if (healthyKeywords.some(keyword => desc.includes(keyword))) {
                calories = Math.max(150, calories - Math.floor(Math.random() * 100));
                fat = Math.max(5, fat - Math.floor(Math.random() * 8));
            }
            
            return { calories, protein, carbs, fat };
        }
        
        // 處理查詢功能
        handleQuery() {
            const selectedDate = document.getElementById('queryDate').value;
            if (!selectedDate) {
                this.showNotification('請選擇要查詢的日期喔！ 📅', 'warning');
                return;
            }
            
            document.getElementById('selectedDate').textContent = this.formatDate(selectedDate);
            this.displayResults(selectedDate);
            
            // 平滑滾動到結果區域
            document.getElementById('resultsSection').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }
        
        // 格式化日期顯示
        formatDate(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (dateString === today.toISOString().split('T')[0]) {
                return '今天 🌟';
            } else if (dateString === yesterday.toISOString().split('T')[0]) {
                return '昨天 ⭐';
            } else {
                return date.toLocaleDateString('zh-TW', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    weekday: 'long'
                });
            }
        }
        
        // 顯示查詢結果
        displayResults(date) {
            const container = document.getElementById('resultsContainer');
            const noDataMessage = document.getElementById('noDataMessage');
            const dayMeals = this.meals[date];
            
            if (!dayMeals || Object.keys(dayMeals).length === 0) {
                container.classList.add('hidden');
                noDataMessage.classList.remove('hidden');
                noDataMessage.style.animation = 'scaleIn 0.4s ease-out';
                return;
            }
            
            container.classList.remove('hidden');
            noDataMessage.classList.add('hidden');
            
            const mealTypes = {
                breakfast: { icon: '🌅', name: '早餐', color: 'from-yellow-400 to-orange-500', bg: 'from-yellow-50 to-orange-50' },
                lunch: { icon: '🍱', name: '午餐', color: 'from-blue-400 to-blue-600', bg: 'from-blue-50 to-blue-100' },
                dinner: { icon: '🍽️', name: '晚餐', color: 'from-purple-400 to-purple-600', bg: 'from-purple-50 to-purple-100' },
                snack: { icon: '🍪', name: '點心', color: 'from-pink-400 to-pink-600', bg: 'from-pink-50 to-pink-100' }
            };
            
            let totalNutrition = { calories: 0, protein: 0, carbs: 0, fat: 0 };
            
            // 生成餐點卡片
            container.innerHTML = Object.entries(dayMeals).map(([mealType, meal]) => {
                totalNutrition.calories += meal.nutrition.calories;
                totalNutrition.protein += meal.nutrition.protein;
                totalNutrition.carbs += meal.nutrition.carbs;
                totalNutrition.fat += meal.nutrition.fat;
                
                const mealInfo = mealTypes[mealType];
                
                return `
                    <div class="nutrition-card rounded-4xl p-8 group">
                        <div class="flex items-center mb-6">
                            <div class="w-16 h-16 bg-gradient-to-br ${mealInfo.color} rounded-2xl flex items-center justify-center mr-4 shadow-apple group-hover:scale-110 transition-transform duration-300">
                                <span class="text-3xl">${mealInfo.icon}</span>
                            </div>
                            <div>
                                <h4 class="text-2xl font-bold text-neutral-800">${mealInfo.name}</h4>
                                <p class="text-neutral-500">${new Date(meal.timestamp).toLocaleTimeString('zh-TW', {hour: '2-digit', minute: '2-digit'})}</p>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r ${mealInfo.bg} rounded-2xl p-6 mb-6">
                            <p class="text-neutral-700 text-lg leading-relaxed">${meal.description}</p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-gradient-to-br from-red-50 to-red-100 p-4 rounded-2xl text-center">
                                <div class="w-8 h-8 bg-gradient-to-br from-red-400 to-red-500 rounded-xl flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-fire text-white text-sm"></i>
                                </div>
                                <p class="text-red-600 font-semibold text-sm">熱量</p>
                                <p class="text-red-800 text-xl font-bold">${meal.nutrition.calories}</p>
                                <p class="text-red-600 text-xs">kcal</p>
                            </div>
                            <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-2xl text-center">
                                <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-blue-500 rounded-xl flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-dumbbell text-white text-sm"></i>
                                </div>
                                <p class="text-blue-600 font-semibold text-sm">蛋白質</p>
                                <p class="text-blue-800 text-xl font-bold">${meal.nutrition.protein}</p>
                                <p class="text-blue-600 text-xs">g</p>
                            </div>
                            <div class="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-2xl text-center">
                                <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-green-500 rounded-xl flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-seedling text-white text-sm"></i>
                                </div>
                                <p class="text-green-600 font-semibold text-sm">碳水化合物</p>
                                <p class="text-green-800 text-xl font-bold">${meal.nutrition.carbs}</p>
                                <p class="text-green-600 text-xs">g</p>
                            </div>
                            <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 p-4 rounded-2xl text-center">
                                <div class="w-8 h-8 bg-gradient-to-br from-yellow-400 to-yellow-500 rounded-xl flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-tint text-white text-sm"></i>
                                </div>
                                <p class="text-yellow-600 font-semibold text-sm">脂肪</p>
                                <p class="text-yellow-800 text-xl font-bold">${meal.nutrition.fat}</p>
                                <p class="text-yellow-600 text-xs">g</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // 添加每日總計卡片
            container.innerHTML += `
                <div class="bg-gradient-to-br from-primary-500 via-secondary-500 to-accent-500 text-white rounded-4xl p-8 shadow-apple-xl">
                    <div class="flex items-center mb-6">
                        <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center mr-4 backdrop-blur-sm">
                            <i class="fas fa-chart-line text-white text-2xl"></i>
                        </div>
                        <div>
                            <h4 class="text-2xl font-bold">每日營養總計</h4>
                            <p class="opacity-90">今天的營養攝取概覽</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white/10 backdrop-blur-sm p-4 rounded-2xl text-center border border-white/20">
                            <p class="opacity-90 text-sm mb-1">總熱量</p>
                            <p class="text-2xl font-bold">${totalNutrition.calories}</p>
                            <p class="opacity-75 text-xs">kcal</p>
                        </div>
                        <div class="bg-white/10 backdrop-blur-sm p-4 rounded-2xl text-center border border-white/20">
                            <p class="opacity-90 text-sm mb-1">總蛋白質</p>
                            <p class="text-2xl font-bold">${totalNutrition.protein}</p>
                            <p class="opacity-75 text-xs">g</p>
                        </div>
                        <div class="bg-white/10 backdrop-blur-sm p-4 rounded-2xl text-center border border-white/20">
                            <p class="opacity-90 text-sm mb-1">總碳水化合物</p>
                            <p class="text-2xl font-bold">${totalNutrition.carbs}</p>
                            <p class="opacity-75 text-xs">g</p>
                        </div>
                        <div class="bg-white/10 backdrop-blur-sm p-4 rounded-2xl text-center border border-white/20">
                            <p class="opacity-90 text-sm mb-1">總脂肪</p>
                            <p class="text-2xl font-bold">${totalNutrition.fat}</p>
                            <p class="opacity-75 text-xs">g</p>
                        </div>
                    </div>
                </div>
            `;
            
            // 添加進場動畫
            container.style.animation = 'fadeSlideUp 0.8s ease-out';
        }
        
        // 顯示通知訊息
        showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            const colors = {
                success: 'from-success-500 to-success-600',
                error: 'from-red-500 to-red-600',
                warning: 'from-yellow-500 to-orange-500',
                info: 'from-secondary-500 to-secondary-600'
            };
            
            notification.className = `fixed top-6 right-6 z-50 p-6 rounded-2xl text-white font-semibold transform translate-x-full transition-all duration-500 bg-gradient-to-r ${colors[type]} shadow-apple-xl max-w-sm`;
            notification.innerHTML = `
                <div class="flex items-start space-x-3">
                    <i class="${icons[type]} text-xl flex-shrink-0 mt-0.5"></i>
                    <p class="leading-relaxed">${message}</p>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(120%)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 500);
            }, 4000);
        }
        
        // 顯示彩蛋
        showEasterEgg() {
            const modal = document.getElementById('easterEggModal');
            const content = document.getElementById('modalContent');
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                content.style.transform = 'scale(1)';
                content.style.opacity = '1';
            }, 50);
        }
        
        // 隱藏彩蛋
        hideEasterEgg() {
            const modal = document.getElementById('easterEggModal');
            const content = document.getElementById('modalContent');
            
            content.style.transform = 'scale(0.95)';
            content.style.opacity = '0';
            
            setTimeout(() => {
                modal.classList.add('hidden');
                // 重置建議內容
                document.getElementById('adviceContent').classList.add('hidden');
            }, 300);
        }
        
        // 顯示飲食建議
        showAdvice() {
            const adviceContent = document.getElementById('adviceContent');
            const advice = this.getPersonalizedAdvice();
            
            adviceContent.querySelector('p').textContent = advice;
            adviceContent.classList.remove('hidden');
            adviceContent.style.animation = 'scaleIn 0.5s ease-out';
        }
        
        // 個人化飲食建議
        getPersonalizedAdvice() {
            const advices = [
                '🥗 試試看在每餐中加入至少三種不同顏色的蔬菜，讓餐桌變得更繽紛營養！',
                '💧 記得要多喝水哦！建議每天至少8杯水，可以在水中加入檸檬片增添風味。',
                '🥜 堅果是很棒的健康零食，每天一小把杏仁或核桃，提供優質脂肪和蛋白質。',
                '🐟 每週嘗試吃2-3次魚類，鮭魚、鯖魚富含Omega-3，對大腦和心臟都很好！',
                '🍓 把水果當作天然的甜點吧！莓果類富含抗氧化劑，既美味又健康。',
                '⏰ 試著規律用餐，讓身體建立良好的生理時鐘，有助於消化和新陳代謝。',
                '🥛 如果可以的話，選擇無糖或低糖的飲品，減少額外的熱量攝取。',
                '🌾 全穀類食品比精製澱粉更有營養價值，試試糙米、燕麥或全麥麵包吧！',
                '🥕 胡蘿蔔、南瓜等橙色蔬菜富含β胡蘿蔔素，對眼睛健康很有幫助呢！',
                '🍽️ 細嚼慢嚥不僅有助消化，還能讓大腦有時間接收飽足感的信號哦！'
            ];
            
            return advices[Math.floor(Math.random() * advices.length)];
        }
    }
    
    // 應用程式啟動
    document.addEventListener('DOMContentLoaded', () => {
        new CuteFoodDiaryApp();
    });
</script>


</body>
</html>