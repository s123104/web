<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>行程表</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
    body {
        margin: 0;
        font-family: 'Noto Sans TC', sans-serif;
        background: #f9f9f9;
        color: #333;
        -webkit-tap-highlight-color: transparent;
        overflow-x: hidden;
    }

    /* 頂部固定工具列 */
    .top-bar {
        position: fixed;
        top:0;left:0;right:0;
        background: linear-gradient(135deg, #4e54c8, #8f94fb);
        color:#fff;
        padding: 10px 20px;
        display:flex;
        align-items:center;
        justify-content: space-between;
        z-index:999;
        box-shadow:0 2px 8px rgba(0,0,0,0.15);
    }

    .top-bar h1 {
        margin:0;
        font-size:1.2rem;
        font-weight:600;
    }

    .add-event-btn {
        background: #fff;
        border: none;
        color: #4e54c8;
        padding: 8px 12px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 0.9rem;
        box-shadow:0 2px 6px rgba(0,0,0,0.1);
        transition:0.3s;
    }

    .add-event-btn:hover {
        background:#eee;
    }

    .container {
        max-width: 1000px;
        margin: 80px auto 0 auto;
        padding: 20px;
    }

    .schedule-day {
        background: #fff;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        border-radius: 12px;
        margin-bottom: 40px;
        overflow: hidden;
        position: relative;
        transition:0.3s;
    }

    .schedule-day-header {
        background: linear-gradient(135deg, #3e3e3e, #555);
        color: #fff;
        padding: 15px 20px;
        font-size: 1.2rem;
        font-weight: 600;
        display: flex;
        align-items: center;
    }

    .schedule-day-header .icon {
        margin-right: 10px;
    }

    .schedule-list {
        list-style: none;
        margin: 0;
        padding: 20px;
        counter-reset: event-counter;
        transition:0.3s;
    }

    .schedule-list li {
        margin-bottom: 15px;
        background: #fdfdfd;
        padding: 10px;
        border-radius: 8px;
        position: relative;
        display: flex;
        align-items: center;
        box-shadow:0 1px 3px rgba(0,0,0,0.1);
        transition:0.3s;
    }

    .schedule-list li:active {
        transform:scale(0.98);
    }

    .schedule-list li.dragging {
        opacity: 0.5;
        border: 2px dashed #ccc;
    }

    .schedule-list li .time {
        font-weight: 600;
        color: #555;
        margin-right: 5px;
    }

    .schedule-list li i {
        color: #777;
        margin-right: 8px;
    }

    .schedule-list li .location {
        display: inline-block;
        margin-left: 22px;
        color: #666;
        font-size: 0.9rem;
    }

    .delete-btn {
        color: #cc0000;
        margin-left: auto;
        cursor: pointer;
        padding:5px;
        border-radius:50%;
        transition:0.3s;
    }

    .delete-btn:hover {
        background:#f5f5f5;
    }

    /* RWD */
    @media(max-width:600px) {
        .schedule-day-header {
            font-size: 1rem;
        }
    }

    .footer-note {
        text-align: center;
        margin-top: 50px;
        font-size: 0.9rem;
        color: #666;
        padding-bottom:30px;
    }

    /* Modal Styles */
    .modal-overlay {
        position: fixed;
        top:0;left:0;right:0;bottom:0;
        background: rgba(0,0,0,0.4);
        display: none;
        justify-content: center;
        align-items: center;
        z-index:9999;
    }

    .modal {
        background: #fff;
        border-radius: 12px;
        padding: 20px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }

    .modal h2 {
        margin-top:0;
        margin-bottom:20px;
        font-size:1.2rem;
    }

    .modal label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
    }

    .modal input[type="text"], 
    .modal input[type="time"] {
        width: 100%;
        padding: 8px;
        margin-bottom:15px;
        box-sizing:border-box;
        border:1px solid #ccc;
        border-radius:4px;
        font-size:1rem;
    }

    .modal .modal-btns {
        text-align: right;
    }

    .modal-btns button {
        background: linear-gradient(135deg, #4e54c8, #8f94fb);
        color:#fff;
        border: none;
        padding: 8px 12px;
        border-radius:4px;
        cursor: pointer;
        margin-left:10px;
        font-size:0.9rem;
        transition:0.3s;
    }

    .modal-btns .cancel {
        background:#aaa;
        background: linear-gradient(135deg,#999,#bbb);
    }

    .modal-btns button:hover {
        opacity:0.9;
    }

    /* 讓新增行程的icon有點互動感 */
    .add-event-btn:active {
        transform:scale(0.95);
    }

</style>
</head>
<body>
<div class="top-bar">
    <h1>超屌行程表</h1>
    <button class="add-event-btn" id="global-add-event">＋新增行程</button>
</div>
<div class="container">
    <div class="schedule-container">
        <!-- 初次載入時這邊可以是空的，或是由使用者自行新增行程 -->
    </div>

    <div class="footer-note">
        © 幹你家行程表超長不耐煩有限公司 | 不要鬧欸😏🥵🤡
    </div>
</div>

<div class="modal-overlay">
    <div class="modal">
        <h2>新增行程</h2>
        <label>時間（選填）</label>
        <input type="time" id="new-time">
        <label>描述（必填）</label>
        <input type="text" id="new-desc" placeholder="行程描述">
        <label>地點（選填）</label>
        <input type="text" id="new-location" placeholder="地點">
        <div class="modal-btns">
            <button class="cancel">取消</button>
            <button class="confirm">新增</button>
        </div>
    </div>
</div>

<script>
    // 基本互動邏輯
    let currentList = null;

    const modalOverlay = document.querySelector('.modal-overlay');
    const cancelBtn = document.querySelector('.cancel');
    const confirmBtn = document.querySelector('.confirm');

    const scheduleContainer = document.querySelector('.schedule-container');
    const globalAddBtn = document.getElementById('global-add-event');

    cancelBtn.addEventListener('click', hideModal);
    confirmBtn.addEventListener('click', () => {
        const time = document.getElementById('new-time').value.trim();
        const desc = document.getElementById('new-desc').value.trim();
        const loc = document.getElementById('new-location').value.trim();

        if(!desc) {
            alert('描述必填，北七哦！');
            return;
        }

        // 如果沒有日期區塊，就先新增一個預設日期(例如今天日期)
        if(!currentList) {
            const today = new Date();
            const month = (today.getMonth()+1);
            const day = today.getDate();
            const dateStr = `${month}/${day}`;

            const dayDiv = document.createElement('div');
            dayDiv.className='schedule-day';
            dayDiv.setAttribute('data-date', dateStr);

            const dayHeader = document.createElement('div');
            dayHeader.className='schedule-day-header';
            dayHeader.innerHTML = `<i class="fas fa-calendar-day icon"></i>${dateStr}`;

            const ul = document.createElement('ul');
            ul.className = 'schedule-list';

            dayDiv.appendChild(dayHeader);
            dayDiv.appendChild(ul);
            scheduleContainer.appendChild(dayDiv);

            currentList = ul;
        }

        const li = document.createElement('li');
        li.setAttribute('draggable','true');
        let html='';
        if(time) {
            html+=`<span class="time">${formatTime(time)}</span><i class="fas fa-info-circle"></i>`;
        }
        html+=desc;
        if(loc) {
            html+=`<div class="location"><i class="fas fa-map-marker-alt"></i>${loc}</div>`;
        }
        html+=`<span class="delete-btn"><i class="fas fa-trash"></i></span>`;
        li.innerHTML=html;

        currentList.appendChild(li);

        hideModal();
        enableInteractions();
    });

    globalAddBtn.addEventListener('click', () => {
        currentList = null; // 全域新增時，清空currentList，之後會自動建立日期區塊
        showModal();
    });

    function showModal() {
        modalOverlay.style.display = 'flex';
        document.getElementById('new-time').value = '';
        document.getElementById('new-desc').value = '';
        document.getElementById('new-location').value = '';
    }

    function hideModal() {
        modalOverlay.style.display = 'none';
    }

    // 拖曳排序邏輯
    function enableInteractions() {
        const draggables = document.querySelectorAll('.schedule-list li');
        const lists = document.querySelectorAll('.schedule-list');

        draggables.forEach(li => {
            li.addEventListener('dragstart', () => {
                li.classList.add('dragging');
            });
            li.addEventListener('dragend', () => {
                li.classList.remove('dragging');
            });
        });

        lists.forEach(list => {
            list.addEventListener('dragover', e => {
                e.preventDefault();
                const afterElement = getDragAfterElement(list, e.clientY);
                const dragging = document.querySelector('.dragging');
                if (afterElement == null) {
                    list.appendChild(dragging);
                } else {
                    list.insertBefore(dragging, afterElement);
                }
            });
        });

        function getDragAfterElement(list, y) {
            const draggableElements = [...list.querySelectorAll('li:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height/2;
                if(offset < 0 && offset > closest.offset) {
                    return {offset:offset, element:child}
                } else {
                    return closest
                }
            }, {offset: Number.NEGATIVE_INFINITY}).element
        }

        // 刪除功能
        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.onclick = ()=>{
                const li = btn.closest('li');
                li.parentNode.removeChild(li);
            };
        });
    }

    function formatTime(timeStr) {
        // timeStr 格式為 "HH:MM"
        // 將其轉為 12小時制 + AM/PM
        let [hour, minute] = timeStr.split(':');
        hour = parseInt(hour,10);
        let ampm='AM';
        if(hour>=12) {
            ampm='PM';
            if(hour>12) hour=hour-12;
        }
        if(hour===0) hour=12;
        return `${hour}:${minute} ${ampm}`;
    }

    // 一開始如無內容，不主動加任何行程。用戶可透過頂部按鈕直接加
    // 若要有預設行程，可在此補上你想要的初始內容再呼叫 enableInteractions()

    enableInteractions(); // 假如日後有動態插入初始內容再呼叫

</script>
</body>
</html>