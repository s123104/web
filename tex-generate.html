<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <title>TeX 檔案生成器</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- 引入 Google 字體 -->
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap"
      rel="stylesheet"
    />
    <style>
      /* 全域樣式 */
      body {
        font-family: "Noto Sans TC", sans-serif;
        margin: 0;
        padding: 0;
        background-color: var(--bg-color);
        color: var(--text-color);
        transition: background-color 0.3s, color 0.3s;
      }
      :root {
        --bg-color: #ffffff;
        --text-color: #000000;
        --block-bg-color: #f5f5f5;
        --block-border-color: #cccccc;
        --button-bg-color: #007bff;
        --button-text-color: #ffffff;
        --button-hover-bg-color: #0056b3;
      }
      [data-theme="dark"] {
        --bg-color: #121212;
        --text-color: #e0e0e0;
        --block-bg-color: #1e1e1e;
        --block-border-color: #333333;
        --button-bg-color: #1a73e8;
        --button-text-color: #ffffff;
        --button-hover-bg-color: #185abc;
      }
      /* 版面配置 */
      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      /* 標題樣式 */
      h1,
      h2 {
        text-align: center;
      }
      /* 按鈕樣式 */
      .btn {
        background-color: var(--button-bg-color);
        color: var(--button-text-color);
        border: none;
        padding: 10px 15px;
        margin: 5px 5px 5px 0;
        cursor: pointer;
        border-radius: 5px;
        font-size: 16px;
        transition: background-color 0.3s;
        display: inline-block;
      }
      .btn:hover {
        background-color: var(--button-hover-bg-color);
      }
      /* 區塊樣式 */
      .block {
        background-color: var(--block-bg-color);
        border: 1px solid var(--block-border-color);
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 5px;
      }
      .block label {
        font-weight: bold;
        display: block;
        margin-bottom: 5px;
      }
      .block select,
      .block textarea {
        width: 100%;
        box-sizing: border-box;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid var(--block-border-color);
        border-radius: 5px;
        background-color: var(--bg-color);
        color: var(--text-color);
      }
      .block textarea {
        height: 100px;
        resize: vertical;
      }
      /* 切換模式按鈕 */
      #toggle-theme {
        float: right;
        background-color: transparent;
        color: var(--text-color);
        border: none;
        cursor: pointer;
        font-size: 24px;
        margin-top: -50px;
      }
      /* 生成的 TeX 內容 */
      #tex-output {
        width: 100%;
        height: 300px;
        padding: 10px;
        box-sizing: border-box;
        border: 1px solid var(--block-border-color);
        border-radius: 5px;
        background-color: var(--block-bg-color);
        color: var(--text-color);
        resize: vertical;
      }
      /* 解釋區塊樣式 */
      #explanation {
        background-color: var(--block-bg-color);
        border: 1px solid var(--block-border-color);
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
      }
      #explanation h3 {
        margin-top: 0;
      }
      /* 響應式設計 */
      @media screen and (max-width: 600px) {
        .btn {
          width: 100%;
          margin-bottom: 10px;
        }
        #toggle-theme {
          float: none;
          display: block;
          text-align: right;
          margin-top: -30px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>TeX 檔案生成器</h1>
      <button id="toggle-theme">🌙</button>

      <!-- 解釋區塊 -->
      <div id="explanation">
        <h3>區塊類型說明</h3>
        <p>
          <strong>題目 (Example)：</strong> 用於輸入題目的內容，會被包裹在
          <code>\\begin{Example}</code> 和 <code>\\end{Example}</code> 環境中。
        </p>
        <p>
          <strong>解答 (Answer)：</strong> 用於輸入題目的解答，會被包裹在
          <code>\\begin{Answer}</code> 和 <code>\\end{Answer}</code> 環境中。
        </p>
        <p>
          <strong>節 (Section)：</strong> 用於建立新的章節，對應到
          <code>\\section{...}</code>。
        </p>
        <p>
          <strong>小節 (Subsection)：</strong> 用於建立新的小節，對應到
          <code>\\subsection{...}</code>。
        </p>
        <p>
          <strong>其他 (Other)：</strong>
          用於輸入其他自定義的內容，不會被包裹在任何環境中，您可以直接輸入 LaTeX
          代碼。
        </p>
      </div>

      <div id="blocks">
        <!-- 區塊將被添加到這裡 -->
      </div>

      <button id="add-block" class="btn">➕ 新增區塊</button>
      <button id="generate-tex" class="btn">📄 生成 TeX 檔案</button>
      <button id="download-tex" class="btn">💾 下載 TeX 檔案</button>

      <h2>生成的 TeX 內容：</h2>
      <textarea id="tex-output" readonly></textarea>
    </div>

    <script>
      let blockCount = 0;

      function addBlock() {
        blockCount++;

        const blockDiv = document.createElement("div");
        blockDiv.className = "block";
        blockDiv.id = "block-" + blockCount;

        const label = document.createElement("label");
        label.textContent = "區塊 " + blockCount + ":";

        const select = document.createElement("select");
        select.innerHTML =
          '<option value="Example">題目 (Example)</option><option value="Answer">解答 (Answer)</option><option value="Section">節 (Section)</option><option value="Subsection">小節 (Subsection)</option><option value="Other">其他 (Other)</option>';

        const textarea = document.createElement("textarea");
        textarea.placeholder = "在此輸入內容...";

        const buttonContainer = document.createElement("div");

        const removeButton = document.createElement("button");
        removeButton.textContent = "🗑️ 移除區塊";
        removeButton.className = "btn";
        removeButton.onclick = function () {
          document.getElementById("blocks").removeChild(blockDiv);
        };

        buttonContainer.appendChild(removeButton);

        blockDiv.appendChild(label);
        blockDiv.appendChild(select);
        blockDiv.appendChild(textarea);
        blockDiv.appendChild(buttonContainer);

        document.getElementById("blocks").appendChild(blockDiv);
      }

      document.getElementById("add-block").onclick = addBlock;

      function generateTeX() {
        // TeX 模板的開頭
        let texContent = `% !Mode:: "TeX:UTF-8"
\\documentclass[12pt]{article}
\\usepackage{amsmath}%數學符號1
\\usepackage{CJKutf8}%中文表格
\\usepackage{amssymb}%數學符號2
\\usepackage{lmodern}%字型大小
\\usepackage{amsfonts}%數學字型
\\usepackage{natbib}%參考文獻
\\usepackage{graphics}%圖型
\\usepackage{epsfig}%EPS圖型
\\usepackage{subfigure}
\\usepackage{graphicx}
\\usepackage{fancybox}
\\usepackage{url}%輸入網址
\\usepackage{tikz}
\\usepackage[lastexercise]{exercise}
\\usepackage{chngcntr}
\\usepackage{tcolorbox}
\\usepackage{listings}
\\usepackage{multirow}%多列表格
\\usepackage[para,online,flushleft]{threeparttable}%表格註解
\\usepackage{rotating}%表格旋轉
\\usepackage{dcolumn}%讓表格小數點對齊
\\usepackage{caption}

\\newcommand{\\gfcb}[1]{%
    \\fcolorbox{white}{gray!10!}{\\quad\\strut #1\\quad}
} % gfcb := gray fcolorbox
\\newcommand{\\cop}[1]{%
    \\gfcb{\\texttt{\\detokenize{#1}}} 
    \\ensuremath{\\quad\\longrightarrow\\quad #1}
} % cop := code output

\\tcbset{arc=0mm,boxrule=1pt,colback=white,colframe=cyan,leftrule=3mm}
\\usepackage{float}
\\newtheorem{example}{Example}[subsection]
\\newtheorem{defin}{Definition}
\\usepackage{setspace} 
\\renewcommand{\\figurename}{圖}
\\renewcommand{\\tablename}{表}
\\renewcommand\\refname{參考文獻}
\\renewcommand{\\abstractname}{摘要}
\\definecolor{bisque}{rgb}{.996,.891,.755}
\\definecolor{mypink}{cmyk}{.1,.8,.4,.1}  % cmyk 模型的例子 
\\definecolor{Gray}{gray}{0.85}
\\definecolor{LightCyan}{rgb}{0.88,1,1}

\\newcolumntype{a}{>{\\columncolor{Gray}}c}
\\newcolumntype{b}{>{\\columncolor{white}}c}

\\title{微積分解答}
\\author{陳宏銘\\\\
    東海數學系.\\\\
}
\\date{\\today}

\\renewcommand{\\theExercise}{\\arabic{Exercise}}
\\renewcommand{\\AnswerHeader}{\\medskip\\noindent\\textcolor{red}{\\textbf{SOLUTION}}\\;}
\\renewcommand{\\ExerciseName}{EXAMPLE}
\\renewcommand{\\ExerciseHeader}{\\noindent\\textbf{\\ExerciseName\\;\\ExerciseHeaderNB}}
\\newenvironment{Example}{\\begin{tcolorbox}\\begin{Exercise}}{\\end{Exercise}\\end{tcolorbox}}
\\setlength{\\ExerciseSkipBefore}{0pt}
\\newcommand\\independent{\\protect\\mathpalette{\\protect\\independenT}{\\perp}}
\\def\\independenT#1#2{\\mathrel{\\rlap{$#1#2$}\\mkern2mu{#1#2}}}
\\begin{document}
    \\begin{CJK}{UTF8}{bsmi}
        
        \\maketitle

        \\setstretch{1.5}
`;

        // 取得所有區塊
        const blocks = document.getElementsByClassName("block");
        for (let i = 0; i < blocks.length; i++) {
          const select = blocks[i].getElementsByTagName("select")[0];
          const textarea = blocks[i].getElementsByTagName("textarea")[0];

          const blockType = select.value;
          const content = textarea.value;

          // 處理特殊字符
          const escapedContent = content.replace(/%/g, "\\%");

          if (blockType === "Example") {
            texContent += `
\\begin{Example}
${escapedContent}
\\end{Example}
`;
          } else if (blockType === "Answer") {
            texContent += `
\\begin{Answer}
${escapedContent}
\\end{Answer}
`;
          } else if (blockType === "Section") {
            texContent += `
\\section{${escapedContent}}
`;
          } else if (blockType === "Subsection") {
            texContent += `
\\subsection{${escapedContent}}
`;
          } else {
            // 其他自定義內容
            texContent += `
${escapedContent}
`;
          }
        }

        // TeX 模板的結尾
        texContent += `
    \\end{CJK}
\\end{document}
`;

        // 顯示生成的 TeX 內容
        document.getElementById("tex-output").value = texContent;
      }

      document.getElementById("generate-tex").onclick = generateTeX;

      function downloadTeX() {
        generateTeX(); // 確保內容是最新的
        const texContent = document.getElementById("tex-output").value;
        const blob = new Blob([texContent], {
          type: "text/plain;charset=utf-8",
        });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "output.tex";
        link.click();
      }

      document.getElementById("download-tex").onclick = downloadTeX;

      // 預設新增一個區塊
      addBlock();

      // 切換深淺模式
      const toggleThemeButton = document.getElementById("toggle-theme");
      toggleThemeButton.onclick = function () {
        if (document.documentElement.getAttribute("data-theme") === "dark") {
          document.documentElement.removeAttribute("data-theme");
          toggleThemeButton.textContent = "🌙";
        } else {
          document.documentElement.setAttribute("data-theme", "dark");
          toggleThemeButton.textContent = "☀️";
        }
      };
    </script>
  </body>
</html>
