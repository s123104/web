<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL 夜市大冒險 - 互動學習體驗</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash/4.17.21/lodash.min.js"></script>
    <style>
        :root {
            --primary: #ff4757;
            --secondary: #2ed573;
            --accent: #ffa502;
            --dark: #2f3542;
            --light: #f1f2f6;
            --text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans TC', sans-serif;
        }

        body {
            background: #1a1a1a;
            color: var(--light);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* 主要市場背景 */
        .market-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)),
                url('/api/placeholder/1920/1080') center/cover;
            z-index: -1;
        }

        /* 燈籠動畫 */
        .lantern {
            position: absolute;
            width: 40px;
            height: 60px;
            background: #ff4757;
            border-radius: 20px;
            box-shadow: 0 0 20px #ff4757;
            animation: swing 3s infinite ease-in-out;
        }

        @keyframes swing {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(10px); }
        }

        /* 頭部設計 */
        .header {
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.6));
            padding: 2rem;
            text-align: center;
            border-bottom: 3px solid var(--accent);
        }

        .header h1 {
            font-size: 3rem;
            color: var(--accent);
            text-shadow: var(--text-shadow);
            margin-bottom: 1rem;
        }

        .header p {
            color: var(--light);
            font-size: 1.2rem;
            text-shadow: var(--text-shadow);
        }

        /* 攤位容器 */
        .stalls-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* 攤位卡片設計 */
        .stall-card {
            background: rgba(47, 53, 66, 0.9);
            border-radius: 15px;
            padding: 1.5rem;
            transition: transform 0.3s ease;
            border: 2px solid var(--accent);
            position: relative;
            overflow: hidden;
        }

        .stall-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(255, 165, 2, 0.3);
        }

        .stall-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stall-icon {
            width: 50px;
            height: 50px;
            background: var(--accent);
            border-radius: 50%;
            margin-right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stall-title {
            font-size: 1.5rem;
            color: var(--accent);
            text-shadow: var(--text-shadow);
        }

        .stall-content {
            background: rgba(0,0,0,0.3);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        /* 互動按鈕設計 */
        .action-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-shadow: var(--text-shadow);
            width: 100%;
            margin-top: 0.5rem;
        }

        .action-btn:hover {
            background: #ff6b81;
            transform: translateY(-2px);
        }

        /* 對話框設計 */
        .dialog-box {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: rgba(47, 53, 66, 0.95);
            padding: 1.5rem;
            border-radius: 15px;
            max-width: 400px;
            border: 2px solid var(--accent);
            transform-origin: bottom right;
            animation: popIn 0.3s ease-out;
            z-index: 1000;
        }

        .character-dialog {
            display: flex;
            align-items: start;
            gap: 1rem;
        }

        .character-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid var(--accent);
        }

        .dialog-content {
            flex: 1;
        }

        .character-name {
            color: var(--accent);
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        /* 表格設計 */
        .sql-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background: rgba(0,0,0,0.3);
        }

        .sql-table th, .sql-table td {
            padding: 0.8rem;
            border: 1px solid var(--accent);
            text-align: left;
        }

        .sql-table th {
            background: var(--accent);
            color: var(--dark);
        }

        /* 動畫 */
        @keyframes popIn {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* RWD 設計 */
        @media (max-width: 768px) {
            .stalls-container {
                grid-template-columns: 1fr;
                padding: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .dialog-box {
                left: 1rem;
                right: 1rem;
                bottom: 1rem;
                max-width: none;
            }
        }

        /* 資料庫操作表單 */
        .operation-form {
            background: rgba(0,0,0,0.5);
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--accent);
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
            color: var(--light);
        }

        /* 結果展示區域 */
        .result-area {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            border: 1px solid var(--accent);
        }
    </style>
</head>
<body>
    <div class="market-background"></div>
    
    <!-- 燈籠裝飾 -->
    <div class="lantern" style="top: 20px; left: 10%"></div>
    <div class="lantern" style="top: 40px; left: 20%"></div>
    <div class="lantern" style="top: 30px; left: 80%"></div>
    
    <header class="header">
        <h1>SQL 夜市大冒險</h1>
        <p>和小狼、小兔一起探索SQL的奇妙世界！</p>
    </header>

    <main class="stalls-container">
        <!-- 基本操作攤位 -->
        <div class="stall-card" id="basic-operations">
            <div class="stall-header">
                <div class="stall-icon">📝</div>
                <h2 class="stall-title">基礎SQL操作</h2>
            </div>
            <div class="stall-content">
                <div class="operation-form">
                    <div class="form-group">
                        <input type="text" class="form-input" placeholder="輸入表格名稱" id="table-name">
                    </div>
                    <button class="action-btn" onclick="createTable()">建立新表格</button>
                </div>
                <div class="result-area" id="basic-result"></div>
            </div>
        </div>

        <!-- 查詢攤位 -->
        <div class="stall-card" id="query-stall">
            <div class="stall-header">
                <div class="stall-icon">🔍</div>
                <h2 class="stall-title">資料查詢攤</h2>
            </div>
            <div class="stall-content">
                <select class="form-input" id="query-type">
                    <option value="select">SELECT 查詢</option>
                    <option value="join">JOIN 查詢</option>
                    <option value="group">GROUP BY 查詢</option>
                </select>
                <button class="action-btn" onclick="performQuery()">執行查詢</button>
                <div class="result-area" id="query-result"></div>
            </div>
        </div>

        <!-- 進階功能攤位 -->
        <div class="stall-card" id="advanced-features">
            <div class="stall-header">
                <div class="stall-icon">⚡</div>
                <h2 class="stall-title">進階功能區</h2>
            </div>
            <div class="stall-content">
                <button class="action-btn" onclick="showTransaction()">交易示範</button>
                <button class="action-btn" onclick="showTrigger()">觸發器示範</button>
                <div class="result-area" id="advanced-result"></div>
            </div>
        </div>
    </main>

    <!-- 對話框 -->
    <div class="dialog-box" id="dialog" style="display: none;">
        <div class="character-dialog">
            <img src="/api/placeholder/60/60" alt="角色頭像" class="character-avatar">
            <div class="dialog-content">
                <div class="character-name" id="speaker-name">小狼</div>
                <div id="dialog-text">歡迎來到SQL夜市！</div>
            </div>
        </div>
    </div>

    <script>
        // 模擬資料庫
        let database = {
            tables: {},
            queries: [],
            transactions: []
        };

        // 顯示對話
        function showDialog(character, text) {
            const dialog = document.getElementById('dialog');
            const speakerName = document.getElementById('speaker-name');
            const dialogText = document.getElementById('dialog-text');
            
            speakerName.textContent = character;
            dialogText.textContent = text;
            dialog.style.display = 'block';
            
            setTimeout(() => {
                dialog.style.display = 'none';
            }, 3000);
        }

        // 建立表格
        function createTable() {
            const tableName = document.getElementById('table-name').value;
            if (!tableName) {
                showDialog('小狼', '欸～表格名稱不能為空啦！');
                return;
            }

            database.tables[tableName] = {
                columns: ['id', 'name', 'value'],
                data: []
            };

            const resultArea = document.getElementById('basic-result');
            resultArea.innerHTML = `
                <div style="animation: fadeIn 0.5s">
                    <h3>表格 ${tableName} 創建成功！</h3>
                    <div class="sql-code">
                        CREATE TABLE ${tableName} (
                            id INT PRIMARY KEY,
                            name VARCHAR(50),
                            value INT
                        );
                    </div>
                </div>
            `;

            showDialog('小狼', `表格 ${tableName} 建立成功！你終於開始展現實力了！`);
        }

        // 執行查詢
        function performQuery() {
            const queryType = document.getElementById('query-type').value;
            const resultArea = document.getElementById('query-result');
            let sqlQuery = '';
            let result = '';

            switch(queryType) {
                case 'select':
                    sqlQuery = 'SELECT * FROM users WHERE age > 20';
                    result = '模擬SELECT查詢結果';
                    break;
                case 'join':
                    sqlQuery = 'SELECT users.name, orders.total FROM users JOIN orders ON users.id = orders.user_id';
                    result = '模擬JOIN查詢結果';
                    break;
                case 'group':
                    sqlQuery = 'SELECT category, COUNT(*) as count FROM products GROUP BY category';
                    result = '模擬GROUP BY查詢結果';
                    break;
            }

            resultArea.innerHTML = `
                <div style="animation: fadeIn 0.5s">
                    <h3>SQL查詢</h3>
                    <code>${sqlQuery}</code>
                    <h3>查詢結果</h3>
                    <p>${result}</p>
                </div>
            `;

            showDialog('小兔', '哇！查詢結果也太完美了吧！');
        }

        // 展示交易
        function showTransaction() {
            const resultArea = document.getElementById('advanced-result');
            resultArea.innerHTML = `
                <div style="animation: fadeIn 0.5s">
                    <h3>交易示範</h3>
                    <code>
                        BEGIN TRANSACTION;</antArtifact>
                        [Previous HTML and CSS code remains the same until the script section]

<script>
        // 展示交易（續）
        function showTransaction() {
            const resultArea = document.getElementById('advanced-result');
            resultArea.innerHTML = `
                <div style="animation: fadeIn 0.5s">
                    <h3>交易示範</h3>
                    <code>
                        BEGIN TRANSACTION;
                        UPDATE accounts SET balance = balance - 500 WHERE user_id = 1;
                        UPDATE accounts SET balance = balance + 500 WHERE user_id = 2;
                        COMMIT;
                    </code>
                    <div class="transaction-simulation">
                        <h4>交易進行中...</h4>
                        <div class="progress-bar"></div>
                    </div>
                </div>
            `;

            showDialog('小狼', '交易處理得比老闆算錢還準確！');
        }

        // 展示觸發器
        function showTrigger() {
            const resultArea = document.getElementById('advanced-result');
            resultArea.innerHTML = `
                <div style="animation: fadeIn 0.5s">
                    <h3>觸發器示範</h3>
                    <code>
                        CREATE TRIGGER after_order_insert
                        AFTER INSERT ON orders
                        FOR EACH ROW
                        BEGIN
                            INSERT INTO notifications(message)
                            VALUES (CONCAT('新訂單：', NEW.order_id));
                        END;
                    </code>
                    <div class="trigger-demo">
                        <button onclick="simulateTrigger()" class="action-btn">模擬新訂單</button>
                    </div>
                </div>
            `;
        }

        // 模擬觸發器效果
        function simulateTrigger() {
            const orderId = Math.floor(Math.random() * 1000);
            showDialog('小兔', `觸發器成功！訂單 #${orderId} 已通知系統`);
        }

        // 隨機故事生成器
        const stories = [
            "SQL查詢比媽媽的滷肉飯還要香！",
            "這個JOIN操作比夜市牽手還要緊密～",
            "WHERE條件比挑水果還要挑剔！",
            "GROUP BY整理得比收攤還要快！"
        ];

        function tellStory() {
            const randomStory = stories[Math.floor(Math.random() * stories.length)];
            showDialog('小狼', randomStory);
        }

        // 新增資料模擬
        function insertData() {
            const table = document.querySelector('.sql-table');
            const newRow = table.insertRow(-1);
            const cells = [
                Math.floor(Math.random() * 1000),
                '商品_' + Math.floor(Math.random() * 100),
                Math.floor(Math.random() * 1000)
            ];

            cells.forEach(cellData => {
                const cell = newRow.insertCell(-1);
                cell.textContent = cellData;
            });

            showDialog('小兔', '新資料插入成功！比插隊還快！');
        }

        // 動態生成表格
        function generateTable(data) {
            return `
                <table class="sql-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>名稱</th>
                            <th>價格</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.map(row => `
                            <tr>
                                <td>${row.id}</td>
                                <td>${row.name}</td>
                                <td>${row.price}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // 視覺效果增強
        function addVisualEffects() {
            // 燈籠搖晃效果
            document.querySelectorAll('.lantern').forEach(lantern => {
                lantern.style.animationDelay = Math.random() * 2 + 's';
            });

            // 攤位卡片懸停效果
            document.querySelectorAll('.stall-card').forEach(card => {
                card.addEventListener('mouseenter', () => {
                    card.style.transform = 'translateY(-5px)';
                    card.style.boxShadow = '0 8px 15px rgba(255, 165, 2, 0.4)';
                });

                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'translateY(0)';
                    card.style.boxShadow = 'none';
                });
            });
        }

        // 模擬SQL執行動畫
        function simulateQueryExecution(query) {
            const resultArea = document.getElementById('query-result');
            resultArea.innerHTML = '<div class="loading">執行查詢中...</div>';
            
            setTimeout(() => {
                const sampleData = [
                    {id: 1, name: '炒麵', price: 60},
                    {id: 2, name: '滷肉飯', price: 45},
                    {id: 3, name: '珍珠奶茶', price: 50}
                ];
                
                resultArea.innerHTML = generateTable(sampleData);
                showDialog('小狼', '查詢結果出爐啦！比廚師炒菜還快！');
            }, 1000);
        }

        // 初始化應用
        document.addEventListener('DOMContentLoaded', () => {
            addVisualEffects();
            // 每隔一段時間隨機講故事
            setInterval(tellStory, 10000);
            
            // 初始化示範資料
            const sampleData = [
                {id: 1, name: '炒麵', price: 60},
                {id: 2, name: '滷肉飯', price: 45},
                {id: 3, name: '珍珠奶茶', price: 50}
            ];
            
            const queryResult = document.getElementById('query-result');
            queryResult.innerHTML = generateTable(sampleData);
        });

        // 新增響應式設計處理
        window.addEventListener('resize', () => {
            const width = window.innerWidth;
            const stallsContainer = document.querySelector('.stalls-container');
            
            if (width < 768) {
                stallsContainer.style.gridTemplateColumns = '1fr';
            } else {
                stallsContainer.style.gridTemplateColumns = 'repeat(auto-fit, minmax(300px, 1fr))';
            }
        });

        // 模擬實時數據更新
        setInterval(() => {
            const randomPrice = Math.floor(Math.random() * 100) + 30;
            const rows = document.querySelectorAll('.sql-table tbody tr');
            if (rows.length > 0) {
                const randomRow = rows[Math.floor(Math.random() * rows.length)];
                const priceCell = randomRow.cells[2];
                const oldPrice = parseInt(priceCell.textContent);
                priceCell.textContent = randomPrice;
                
                if (randomPrice > oldPrice) {
                    priceCell.style.color = '#2ed573';
                } else {
                    priceCell.style.color = '#ff4757';
                }
                
                setTimeout(() => {
                    priceCell.style.color = '';
                }, 1000);
            }
        }, 5000);
    </script>
</body>
</html>