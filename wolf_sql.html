<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SQL å¤œå¸‚å¤§å†’éšª - çµ±åˆç‰ˆ</title>
    <link rel="icon" href="img/wolf.ico" type="image/x-icon" />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- Animate.css å¼•å…¥ -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <style>
      :root {
        --dark-bg: #121212;
        --dark-overlay: rgba(0, 0, 0, 0.6);
        --light: #f8f9fa;
        --accent: #fed766;
        --primary: #ff577f;
        --secondary: #4ecdc4;
        /* æ”¤ä½é‚Šæ¡†é¡è‰² */
        --stall-select: #ff4d6d;
        --stall-insert: #32e0c4;
        --stall-delete: #f72585;
        --stall-update: #546de5;
        --stall-join: #00adb5;
        --stall-groupby: #ffc107;
        --stall-distinct: #ff6fb5;
        --stall-index: #af98ff;
        --stall-transaction: #ff7f50;
        --toast-bg: #444;
      }
      /* é‡ç½®èˆ‡å­—å‹ */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Noto Sans TC", sans-serif;
      }
      body {
        background: var(--dark-bg) url("img/bg.png") center/cover no-repeat
          fixed;
        color: var(--light);
        min-height: 100vh;
        position: relative;
      }
      @media (max-width: 768px) {
        body {
          background: var(--dark-bg) url("img/bg_l.png") center/cover no-repeat
            fixed;
          background-size: 100% auto;
          background-attachment: scroll;
        }
      }
      header {
        background: rgba(0, 0, 0, 0.895);
        box-shadow: 0 0 12px var(--light);
        border: 2px solid var(--light);
        border-radius: 6px;
        max-width: 800px;
        margin: 1rem auto;
        text-align: center;
        padding: 3rem 1rem;
      }
      .title {
        font-size: 2.2rem;
        margin-bottom: 1rem;
        color: var(--accent);
        text-shadow: 1px 1px 8px rgba(255, 255, 255, 0.5);
        font-family: "Press Start 2P", cursive;
      }
      .desc {
        font-size: 1.1rem;
        line-height: 1.6;
        max-width: 700px;
        margin: 0 auto;
        opacity: 0.9;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
      }
      .stall-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 2rem;
        max-width: 90%;
        margin: 2rem auto;
      }
      .stall-card {
        background: rgba(20, 20, 20, 0.909);
        border-radius: 10px;
        width: 550px;
        padding: 1rem;
        position: relative;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        backdrop-filter: blur(6px);
      }
      .stall-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
      }
      .stall-header {
        display: flex;
        gap: 0.6rem;
        justify-content: center;
        align-items: center;
        font-size: 1.3rem;
        margin-bottom: 0.8rem;
        position: relative;
      }
      .stall-header::after {
        content: "";
        position: absolute;
        bottom: -6px;
        left: 50%;
        transform: translateX(-50%);
        height: 2px;
        width: 40%;
        background: currentColor;
      }
      /* æ”¤ä½é‚Šæ¡† */
      .insert-stall {
        border: 2px solid var(--stall-insert);
        box-shadow: 0 0 12px var(--stall-insert);
      }
      .delete-stall {
        border: 2px solid var(--stall-delete);
        box-shadow: 0 0 12px var(--stall-delete);
      }
      .update-stall {
        border: 2px solid var(--stall-update);
        box-shadow: 0 0 12px var(--stall-update);
      }
      .select-stall {
        border: 2px solid var(--stall-select);
        box-shadow: 0 0 12px var(--stall-select);
      }
      .join-stall {
        border: 2px solid var(--stall-join);
        box-shadow: 0 0 12px var(--stall-join);
      }
      .groupby-stall {
        border: 2px solid var(--stall-groupby);
        box-shadow: 0 0 12px var(--stall-groupby);
      }
      .distinct-stall {
        border: 2px solid var(--stall-distinct);
        box-shadow: 0 0 12px var(--stall-distinct);
      }
      .index-stall {
        border: 2px solid var(--stall-index);
        box-shadow: 0 0 12px var(--stall-index);
      }
      .transaction-stall {
        border: 2px solid var(--stall-transaction);
        box-shadow: 0 0 12px var(--stall-transaction);
      }
      .product-shelf {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(4px);
      }
      .shelf-title {
        text-align: center;
        font-weight: bold;
        margin-bottom: 0.5rem;
      }
      .product-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 0.8rem;
        justify-content: center;
      }
      .product-item {
        width: 100px;
        background: rgba(0, 0, 0, 0.421);
        border-radius: 6px;
        text-align: center;
        padding: 0.6rem;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
        transition: transform 0.3s ease, opacity 0.3s ease;
        backdrop-filter: blur(4px);
      }
      .product-item:hover {
        transform: scale(1.05);
      }
      .icon-box {
        font-size: 1.4rem;
        margin-bottom: 0.3rem;
      }
      .product-name {
        font-weight: bold;
        font-size: 0.9rem;
      }
      .product-price {
        font-size: 0.8rem;
        opacity: 0.8;
      }
      .dialogue {
        background: var(--dark-overlay);
        border-radius: 8px;
        padding: 0.8rem;
        margin-bottom: 0.8rem;
        font-size: 0.9rem;
        overflow: auto;
        max-height: 150px;
        backdrop-filter: blur(4px);
      }
      .dialog-line {
        margin-bottom: 0.4rem;
        animation: fadeIn 0.5s ease;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      .speaker {
        font-weight: bold;
        color: var(--accent);
        margin-right: 0.3rem;
      }
      .stall-buttons {
        margin-bottom: 0.8rem;
      }
      .stall-btn {
        background: var(--accent);
        color: #000;
        border: none;
        border-radius: 6px;
        padding: 0.6rem 0.9rem;
        font-size: 0.85rem;
        font-weight: bold;
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
        cursor: pointer;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .stall-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 10px rgba(0, 0, 0, 0.4);
      }
      .inline-sql-box {
        background: #2e2e3e;
        margin: 0.5rem 0;
        border-radius: 6px;
        padding: 0.6rem;
        font-size: 0.85rem;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
        position: relative;
        white-space: pre-wrap;
      }
      .inline-sql-box pre {
        max-height: 200px;
        overflow-y: auto;
      }
      .inline-sql-title {
        font-weight: bold;
        margin-bottom: 0.3rem;
      }
      .inline-sql-copy {
        position: absolute;
        top: 8px;
        right: 8px;
        background: rgba(255, 255, 255, 0.15);
        border: none;
        font-size: 0.7rem;
        padding: 4px 6px;
        border-radius: 4px;
        cursor: pointer;
      }
      .inline-sql-copy:hover {
        background: rgba(255, 255, 255, 0.3);
      }
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 999;
      }
      .modal-overlay.show {
        display: flex;
      }
      .modal-content {
        background: #1e1e2e;
        color: #f8f8f2;
        padding: 1rem;
        border-radius: 8px;
        width: 80%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
        box-shadow: 0 5px 12px rgba(0, 0, 0, 0.5);
      }
      .modal-close {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255, 255, 255, 0.15);
        color: #fff;
        border: none;
        font-size: 0.9rem;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
      }
      .modal-close:hover {
        background: rgba(255, 255, 255, 0.3);
      }
      .modal-title {
        font-weight: bold;
        margin-bottom: 0.6rem;
        font-size: 1rem;
      }
      .modal-pre {
        background: #2e2e3e;
        border-radius: 6px;
        padding: 0.8rem;
        margin-bottom: 1rem;
        font-size: 0.85rem;
        position: relative;
        white-space: pre-wrap;
      }
      .modal-pre pre {
        max-height: 200px;
        overflow-y: auto;
      }
      .modal-pre .copy-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        background: rgba(255, 255, 255, 0.15);
        border: none;
        font-size: 0.7rem;
        padding: 4px 6px;
        border-radius: 4px;
        cursor: pointer;
      }
      .modal-pre .copy-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }
      .toast-container {
        position: fixed;
        top: 1rem;
        right: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        z-index: 9999;
      }
      .toast {
        background: var(--toast-bg);
        color: #fff;
        padding: 0.8rem 1rem;
        border-radius: 6px;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.5);
        animation: slideInToast 0.5s ease;
      }
      @keyframes slideInToast {
        from {
          transform: translateY(-100%);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 0.9;
        }
      }
      .toast.fade-out {
        animation: slideOutToast 0.5s ease forwards;
      }
      @keyframes slideOutToast {
        from {
          transform: translateY(0);
          opacity: 0.9;
        }
        to {
          transform: translateY(-100%);
          opacity: 0;
        }
      }
      /* è‡ªè¨‚å‹•ç•«æ•ˆæœ */
      @keyframes bounceIn {
        0% {
          transform: scale(0);
          opacity: 0;
        }
        60% {
          transform: scale(1.1);
          opacity: 1;
        }
        100% {
          transform: scale(1);
        }
      }
      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
          transform: scale(0.8);
        }
      }
      @keyframes flash {
        0%,
        100% {
          background: rgba(0, 0, 0, 0.421);
        }
        50% {
          background: rgba(255, 215, 0, 0.5);
        }
      }
      @keyframes highlight {
        0% {
          box-shadow: 0 0 10px var(--accent);
        }
        50% {
          box-shadow: 0 0 20px var(--accent);
        }
        100% {
          box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
        }
      }
      @media (max-width: 768px) {
        .stall-card {
          width: 95%;
        }
      }
    </style>
  </head>
  <body>
    <audio id="clickSound" src="click.mp3" preload="auto"></audio>
    <audio id="successSound" src="success.mp3" preload="auto"></audio>
    <div class="toast-container" id="toastContainer"></div>
    <header role="banner">
      <h1 class="title">SQL å¤œå¸‚å¤§å†’éšª</h1>
      <p class="desc">
        å°ç‹¼èˆ‡å°å…”èµ°é€²ç†±é¬§å¤œå¸‚ï¼Œç¾å ´æ¨¡æ“¬
        INSERTã€DELETEã€UPDATEã€SELECTã€JOINã€GROUP BYã€DISTINCT/UNIONã€INDEX èˆ‡
        Transaction å„å¼ SQL é­”æ³•æ“ä½œï¼Œä¸¦ä»¥ PHP ç¯„ä¾‹å®Œæ•´å‘ˆç¾ï¼é»æ“ŠæŒ‰éˆ•å³å¯çœ‹åˆ°
        SQL èªæ³•èˆ‡ PHP
        å¯¦ä¾‹ï¼Œé‚„æœ‰ä¸‹è¼‰åŠŸèƒ½ï¼Œè®“ä½ è¦ªèº«é«”é©—å¦‚ä½•æ‰“é€ æ­£ç¢ºçš„ç¶²ç«™ç¨‹å¼ï½<br />
        <span id="operationCount">å·²åŸ·è¡Œæ“ä½œï¼š0 æ¬¡</span>
      </p>
    </header>
    <main class="stall-container" id="stallArea" role="main"></main>
    <div class="modal-overlay" id="modalOverlay">
      <div
        class="modal-content"
        id="modalContent"
        role="dialog"
        aria-modal="true"
      >
        <button class="modal-close" id="modalClose" aria-label="é—œé–‰">
          é—œé–‰
        </button>
        <h3 class="modal-title" id="modalTitle"></h3>
      </div>
    </div>
    <script>
      // å…¨åŸŸè®Šæ•¸èˆ‡éŸ³æ•ˆ
      let operationCount = 0;
      const operationCountEl = document.getElementById("operationCount");
      const clickSound = document.getElementById("clickSound");
      const successSound = document.getElementById("successSound");

      // å»ºç«‹å„æ”¤è²©çš„ PHP å®Œæ•´ç¯„ä¾‹å°æ‡‰ï¼Œé åŒ—ï¼Œé€™æ‰ä¸æœƒæ··ä¸€å¡Šå…’ï¼Œçˆ½å•¦ï½ğŸ˜ˆ
      const phpCompleteExamples = {
        insert: `<?php
// é€£ç·šè³‡æ–™åº« (db_connect.php)
$conn = mysqli_connect("localhost", "root", "", "night_market");
if(!$conn){
    die("é€£ç·šå¤±æ•—ï¼š" . mysqli_connect_error());
}
// å–®ç­†é€²è²¨
$sql = "INSERT INTO inventory (item_name, price, stock, category) VALUES ('é›æ’', 70, 20, 'ä¸»é£Ÿ')";
if(mysqli_query($conn, $sql)){
    echo "æ–°å¢æˆåŠŸï¼å®¢äººè‚¯å®šæ„›ä¸Šé€™å£å‘³ï½";
} else {
    echo "æ–°å¢å¤±æ•—ï¼š" . mysqli_error($conn);
}
// æ‰¹é‡é€²è²¨
$sql = "INSERT INTO inventory (item_name, price, stock, category) VALUES ('çç å¥¶èŒ¶', 50, 30, 'é£²æ–™'), ('æ»·è›‹', 10, 50, 'å°åƒ')";
if(mysqli_query($conn, $sql)){
    echo "æ‰¹é‡æ–°å¢æˆåŠŸï¼å¤œå¸‚äººæ°£é£†å‡ï½";
} else {
    echo "æ‰¹é‡æ–°å¢å¤±æ•—ï¼š" . mysqli_error($conn);
}
// çµæŸé€£ç·š
mysqli_close($conn);
?>`,
        delete: `<?php
// é€£ç·šè³‡æ–™åº« (db_connect.php)
$conn = mysqli_connect("localhost", "root", "", "night_market");
if(!$conn){
    die("é€£ç·šå¤±æ•—ï¼š" . mysqli_connect_error());
}
// åˆªé™¤ä½åº«å­˜å•†å“
$sql = "DELETE FROM inventory WHERE stock < 10";
if(mysqli_query($conn, $sql)){
    echo "ä½åº«å­˜å•†å“å·²æ¸…é™¤ï¼";
} else {
    echo "åˆªé™¤å¤±æ•—ï¼š" . mysqli_error($conn);
}
// åˆªé™¤å°åƒé¡å•†å“
$sql = "DELETE FROM inventory WHERE category = 'å°åƒ'";
if(mysqli_query($conn, $sql)){
    echo "å°åƒé¡å•†å“å·²ä¸‹æ¶ï¼";
} else {
    echo "åˆªé™¤å¤±æ•—ï¼š" . mysqli_error($conn);
}
// çµæŸé€£ç·š
mysqli_close($conn);
?>`,
        update: `<?php
// é€£ç·šè³‡æ–™åº« (db_connect.php)
$conn = mysqli_connect("localhost", "root", "", "night_market");
if(!$conn){
    die("é€£ç·šå¤±æ•—ï¼š" . mysqli_connect_error());
}
// æ›´æ–°é£²æ–™åƒ¹æ ¼
$sql = "UPDATE inventory SET price = price + 5 WHERE category = 'é£²æ–™'";
if(mysqli_query($conn, $sql)){
    echo "é£²æ–™åƒ¹æ ¼èª¿æ•´æˆåŠŸï¼";
} else {
    echo "æ›´æ–°å¤±æ•—ï¼š" . mysqli_error($conn);
}
// æ›´æ–°é›æ’åº«å­˜
$sql = "UPDATE inventory SET stock = stock - 5 WHERE item_name = 'é›æ’'";
if(mysqli_query($conn, $sql)){
    echo "é›æ’åº«å­˜æ›´æ–°æˆåŠŸï¼";
} else {
    echo "æ›´æ–°å¤±æ•—ï¼š" . mysqli_error($conn);
}
// çµæŸé€£ç·š
mysqli_close($conn);
?>`,
        select: `<?php
// é€£ç·šè³‡æ–™åº« (db_connect.php)
$conn = mysqli_connect("localhost", "root", "", "night_market");
if(!$conn){
    die("é€£ç·šå¤±æ•—ï¼š" . mysqli_connect_error());
}
// æŸ¥å…¨éƒ¨å•†å“
$sql = "SELECT * FROM inventory";
$result = mysqli_query($conn, $sql);
echo "å…¨éƒ¨å•†å“ï¼š<br>";
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . " - " . $row['price'] . "å…ƒ, åº«å­˜ï¼š" . $row['stock'] . "<br>";
}
// æŸ¥ä¸»é£Ÿ
$sql = "SELECT * FROM inventory WHERE category = 'ä¸»é£Ÿ'";
$result = mysqli_query($conn, $sql);
echo "<br>ä¸»é£Ÿï¼š<br>";
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . " - " . $row['price'] . "å…ƒ, åº«å­˜ï¼š" . $row['stock'] . "<br>";
}
// æŸ¥ä¾¿å®œè²¨
$sql = "SELECT item_name, price FROM inventory WHERE price < 50 ORDER BY price ASC";
$result = mysqli_query($conn, $sql);
echo "<br>ä¾¿å®œè²¨ï¼š<br>";
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . ": " . $row['price'] . "å…ƒ<br>";
}
// æŸ¥é«˜åº«å­˜
$sql = "SELECT item_name, stock FROM inventory WHERE stock > (SELECT AVG(stock) FROM inventory)";
$result = mysqli_query($conn, $sql);
echo "<br>é«˜åº«å­˜ï¼š<br>";
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . ": " . $row['stock'] . "ä»½<br>";
}
// æŸ¥ç†±é–€å•†å“
$sql = "SELECT item_name, price FROM inventory ORDER BY price DESC";
$result = mysqli_query($conn, $sql);
echo "<br>ç†±é–€å•†å“ï¼š<br>";
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . ": " . $row['price'] . "å…ƒ<br>";
}
// çµæŸé€£ç·š
mysqli_close($conn);
?>`,
        join: `<?php
// é€£ç·šè³‡æ–™åº« (db_connect.php)
$conn = mysqli_connect("localhost", "root", "", "night_market");
if(!$conn){
    die("é€£ç·šå¤±æ•—ï¼š" . mysqli_connect_error());
}
// æŸ¥ä»Šæ—¥éŠ·å”®
$sql = "SELECT i.item_name, s.quantity FROM inventory i INNER JOIN sales s ON i.id = s.item_id WHERE s.sale_date = CURDATE()";
$result = mysqli_query($conn, $sql);
echo "ä»Šæ—¥éŠ·å”®ï¼š<br>";
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . ": " . $row['quantity'] . "ä»½<br>";
}
// æŸ¥é¡§å®¢è¨‚å–®
$sql = "SELECT i.item_name, c.name, s.quantity FROM inventory i JOIN sales s ON i.id = s.item_id JOIN customers c ON s.customer_id = c.id";
$result = mysqli_query($conn, $sql);
echo "<br>é¡§å®¢è¨‚å–®ï¼š<br>";
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . " - " . $row['name'] . ": " . $row['quantity'] . "ä»½<br>";
}
// çµæŸé€£ç·š
mysqli_close($conn);
?>`,
        groupby: `<?php
// é€£ç·šè³‡æ–™åº« (db_connect.php)
$conn = mysqli_connect("localhost", "root", "", "night_market");
if(!$conn){
    die("é€£ç·šå¤±æ•—ï¼š" . mysqli_connect_error());
}
// çµ±è¨ˆéŠ·å”®é¡
$sql = "SELECT category, SUM(price * stock) AS total_value FROM inventory GROUP BY category HAVING total_value > 1000";
$result = mysqli_query($conn, $sql);
echo "éŠ·å”®é¡çµ±è¨ˆï¼š<br>";
while($row = mysqli_fetch_assoc($result)){
    echo $row['category'] . ": " . $row['total_value'] . "å…ƒ<br>";
}
// åƒ¹æ ¼æ’å
$sql = "SELECT item_name, price, RANK() OVER (PARTITION BY category ORDER BY price DESC) AS rank FROM inventory";
$result = mysqli_query($conn, $sql);
echo "<br>åƒ¹æ ¼æ’åï¼š<br>";
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . ": " . $row['price'] . "å…ƒ, æ’å: " . $row['rank'] . "<br>";
}
// çµæŸé€£ç·š
mysqli_close($conn);
?>`,
        distinct: `<?php
// é€£ç·šè³‡æ–™åº« (db_connect.php)
$conn = mysqli_connect("localhost", "root", "", "night_market");
if(!$conn){
    die("é€£ç·šå¤±æ•—ï¼š" . mysqli_connect_error());
}
// å»é‡é¡åˆ¥
$sql = "SELECT DISTINCT category FROM inventory";
$result = mysqli_query($conn, $sql);
echo "ç¨ç‰¹é¡åˆ¥ï¼š<br>";
while($row = mysqli_fetch_assoc($result)){
    echo $row['category'] . "<br>";
}
// åˆä½µæŸ¥è©¢
$sql = "SELECT item_name FROM inventory WHERE stock > 0 UNION SELECT item_name FROM sold_items WHERE quantity > 0";
$result = mysqli_query($conn, $sql);
echo "<br>åˆä½µæŸ¥è©¢ï¼š<br>";
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . "<br>";
}
// çµæŸé€£ç·š
mysqli_close($conn);
?>`,
        index: `<?php
// é€£ç·šè³‡æ–™åº« (db_connect.php)
$conn = mysqli_connect("localhost", "root", "", "night_market");
if(!$conn){
    die("é€£ç·šå¤±æ•—ï¼š" . mysqli_connect_error());
}
// å»ºç«‹ç´¢å¼•
$sql = "CREATE INDEX idx_category ON inventory (category)";
if(mysqli_query($conn, $sql)){
    echo "ç´¢å¼•å»ºç«‹æˆåŠŸï¼ŒæŸ¥è©¢é€Ÿåº¦é£›å¿«ï¼";
} else {
    echo "ç´¢å¼•å»ºç«‹å¤±æ•—ï¼š" . mysqli_error($conn);
}
// ç§»é™¤ç´¢å¼•
$sql = "DROP INDEX idx_category ON inventory";
if(mysqli_query($conn, $sql)){
    echo "ç´¢å¼•ç§»é™¤æˆåŠŸï¼ŒæŸ¥è©¢é€Ÿåº¦å›å¾©æ­£å¸¸ï¼";
} else {
    echo "ç´¢å¼•ç§»é™¤å¤±æ•—ï¼š" . mysqli_error($conn);
}
// çµæŸé€£ç·š
mysqli_close($conn);
?>`,
        transaction: `<?php
// é€£ç·šè³‡æ–™åº« (db_connect.php)
$conn = mysqli_connect("localhost", "root", "", "night_market");
if(!$conn){
    die("é€£ç·šå¤±æ•—ï¼š" . mysqli_connect_error());
}
// çµå¸³æ“ä½œï¼šäº¤æ˜“æäº¤
mysqli_begin_transaction($conn);
try {
    mysqli_query($conn, "INSERT INTO sales (item_id, customer_id, quantity) VALUES (1, 1, 2)");
    mysqli_query($conn, "UPDATE inventory SET stock = stock - 2 WHERE id = 1");
    mysqli_commit($conn);
    echo "äº¤æ˜“æˆåŠŸï¼çµå¸³å®Œæˆï½";
} catch(Exception $e) {
    mysqli_rollback($conn);
    echo "äº¤æ˜“å¤±æ•—ï¼š" . $e->getMessage();
}
// å–æ¶ˆè¨‚å–®ï¼šäº¤æ˜“å›æ»¾
mysqli_begin_transaction($conn);
try {
    mysqli_query($conn, "UPDATE inventory SET stock = stock + 10 WHERE id = 2");
    throw new Exception("æ¨¡æ“¬éŒ¯èª¤");
    mysqli_commit($conn);
} catch(Exception $e) {
    mysqli_rollback($conn);
    echo "äº¤æ˜“å·²å›æ»¾ï¼Œè«‹é‡æ–°æ“ä½œï¼";
}
// çµæŸé€£ç·š
mysqli_close($conn);
?>`,
      };

      // ä¿®æ”¹ getPhpFullExample ä¾æ”¤è²© id å›å‚³å°æ‡‰çš„ PHP å®Œæ•´ç¯„ä¾‹
      function getPhpFullExample(stallId) {
        return phpCompleteExamples[stallId] || "";
      }

      // SQL èˆ‡ PHP ç¯„ä¾‹ç‰‡æ®µï¼ˆå„åŠŸèƒ½çš„èªæ³•ï¼Œæ›è¡Œæ’ç‰ˆï¼‰
      const codeSnippets = {
        insertSingle: {
          sql: "INSERT INTO inventory (item_name, price, stock, category) \nVALUES ('é›æ’', 70, 20, 'ä¸»é£Ÿ');",
          php: `<?php
// å–®ç­†é€²è²¨
$sql = "INSERT INTO inventory (item_name, price, stock, category) VALUES ('é›æ’', 70, 20, 'ä¸»é£Ÿ')";
if(mysqli_query($conn, $sql)){
    echo "æ–°å¢æˆåŠŸï¼å®¢äººè‚¯å®šæ„›ä¸Šé€™å£å‘³ï½";
} else {
    echo "æ–°å¢å¤±æ•—ï¼š" . mysqli_error($conn);
}
?>`,
        },
        insertBatch: {
          sql: "INSERT INTO inventory (item_name, price, stock, category) \nVALUES ('çç å¥¶èŒ¶', 50, 30, 'é£²æ–™'),\n('æ»·è›‹', 10, 50, 'å°åƒ');",
          php: `<?php
// æ‰¹é‡é€²è²¨
$sql = "INSERT INTO inventory (item_name, price, stock, category) VALUES ('çç å¥¶èŒ¶', 50, 30, 'é£²æ–™'), ('æ»·è›‹', 10, 50, 'å°åƒ')";
if(mysqli_query($conn, $sql)){
    echo "æ‰¹é‡æ–°å¢æˆåŠŸï¼å¤œå¸‚äººæ°£é£†å‡ï½";
} else {
    echo "æ‰¹é‡æ–°å¢å¤±æ•—ï¼š" . mysqli_error($conn);
}
?>`,
        },
        deleteLowStock: {
          sql: "DELETE FROM inventory \nWHERE stock < 10;",
          php: `<?php
// åˆªé™¤ä½åº«å­˜å•†å“ (åƒ…åˆªé™¤åº«å­˜ < 10 çš„)
$sql = "DELETE FROM inventory WHERE stock < 10";
if(mysqli_query($conn, $sql)){
    echo "ä½åº«å­˜å•†å“å·²æ¸…é™¤ï¼";
} else {
    echo "åˆªé™¤å¤±æ•—ï¼š" . mysqli_error($conn);
}
?>`,
        },
        deleteCategory: {
          sql: "DELETE FROM inventory \nWHERE category = 'å°åƒ';",
          php: `<?php
// åˆªé™¤å°åƒé¡å•†å“
$sql = "DELETE FROM inventory WHERE category = 'å°åƒ'";
if(mysqli_query($conn, $sql)){
    echo "å°åƒé¡å•†å“å·²ä¸‹æ¶ï¼";
} else {
    echo "åˆªé™¤å¤±æ•—ï¼š" . mysqli_error($conn);
}
?>`,
        },
        updatePrice: {
          sql: "UPDATE inventory \nSET price = price + 5 \nWHERE category = 'é£²æ–™';",
          php: `<?php
// æ›´æ–°é£²æ–™åƒ¹æ ¼
$sql = "UPDATE inventory SET price = price + 5 WHERE category = 'é£²æ–™'";
if(mysqli_query($conn, $sql)){
    echo "é£²æ–™åƒ¹æ ¼èª¿æ•´æˆåŠŸï¼";
} else {
    echo "æ›´æ–°å¤±æ•—ï¼š" . mysqli_error($conn);
}
?>`,
        },
        updateStock: {
          sql: "UPDATE inventory \nSET stock = stock - 5 \nWHERE item_name = 'é›æ’';",
          php: `<?php
// æ›´æ–°é›æ’åº«å­˜
$sql = "UPDATE inventory SET stock = stock - 5 WHERE item_name = 'é›æ’'";
if(mysqli_query($conn, $sql)){
    echo "é›æ’åº«å­˜æ›´æ–°æˆåŠŸï¼";
} else {
    echo "æ›´æ–°å¤±æ•—ï¼š" . mysqli_error($conn);
}
?>`,
        },
        selectCheap: {
          sql: "SELECT item_name, price \nFROM inventory \nWHERE price < 50 \nORDER BY price ASC;",
          php: `<?php
// æŸ¥è©¢ä¾¿å®œè²¨ (50å…ƒä»¥ä¸‹)
$sql = "SELECT item_name, price FROM inventory WHERE price < 50 ORDER BY price ASC";
$result = mysqli_query($conn, $sql);
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . ": " . $row['price'] . "å…ƒ<br>";
}
?>`,
        },
        selectSubquery: {
          sql: "SELECT item_name, stock \nFROM inventory \nWHERE stock > (SELECT AVG(stock) FROM inventory);",
          php: `<?php
// æŸ¥è©¢é«˜åº«å­˜å•†å“
$sql = "SELECT item_name, stock FROM inventory WHERE stock > (SELECT AVG(stock) FROM inventory)";
$result = mysqli_query($conn, $sql);
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . ": " . $row['stock'] . "ä»½<br>";
}
?>`,
        },
        selectPopular: {
          sql: "SELECT item_name, price \nFROM inventory \nORDER BY price DESC;",
          php: `<?php
// æŸ¥è©¢ç†±é–€å•†å“ï¼ˆä¾åƒ¹æ ¼æ’åºï¼‰
$sql = "SELECT item_name, price FROM inventory ORDER BY price DESC";
$result = mysqli_query($conn, $sql);
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . ": " . $row['price'] . "å…ƒ<br>";
}
?>`,
        },
        selectAll: {
          sql: "SELECT * \nFROM inventory;",
          php: `<?php
// æŸ¥è©¢å…¨éƒ¨å•†å“ï¼ˆæœ€åŸºç¤æŸ¥è©¢ï¼‰
$sql = "SELECT * FROM inventory";
$result = mysqli_query($conn, $sql);
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . " - " . $row['price'] . "å…ƒ, åº«å­˜ï¼š" . $row['stock'] . "<br>";
}
?>`,
        },
        selectMain: {
          sql: "SELECT * FROM inventory WHERE category = 'ä¸»é£Ÿ';",
          php: `<?php
// æŸ¥è©¢ä¸»é£Ÿé¡å•†å“
$sql = "SELECT * FROM inventory WHERE category = 'ä¸»é£Ÿ'";
$result = mysqli_query($conn, $sql);
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . " - " . $row['price'] . "å…ƒ, åº«å­˜ï¼š" . $row['stock'] . "<br>";
}
?>`,
        },
        joinSales: {
          sql: "SELECT i.item_name, s.quantity \nFROM inventory i \nINNER JOIN sales s ON i.id = s.item_id \nWHERE s.sale_date = CURDATE();",
          php: `<?php
// æŸ¥è©¢ä»Šæ—¥éŠ·å”®
$sql = "SELECT i.item_name, s.quantity FROM inventory i INNER JOIN sales s ON i.id = s.item_id WHERE s.sale_date = CURDATE()";
$result = mysqli_query($conn, $sql);
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . ": " . $row['quantity'] . "ä»½<br>";
}
?>`,
        },
        joinMulti: {
          sql: "SELECT i.item_name, c.name AS customer, s.quantity \nFROM inventory i \nJOIN sales s ON i.id = s.item_id \nJOIN customers c ON s.customer_id = c.id;",
          php: `<?php
// æŸ¥è©¢é¡§å®¢è¨‚å–®
$sql = "SELECT i.item_name, c.name, s.quantity FROM inventory i JOIN sales s ON i.id = s.item_id JOIN customers c ON s.customer_id = c.id";
$result = mysqli_query($conn, $sql);
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . " - " . $row['name'] . ": " . $row['quantity'] . "ä»½<br>";
}
?>`,
        },
        groupSales: {
          sql: "SELECT category, SUM(price * stock) AS total_value \nFROM inventory \nGROUP BY category \nHAVING total_value > 1000;",
          php: `<?php
// çµ±è¨ˆéŠ·å”®é¡
$sql = "SELECT category, SUM(price * stock) AS total_value FROM inventory GROUP BY category HAVING total_value > 1000";
$result = mysqli_query($conn, $sql);
while($row = mysqli_fetch_assoc($result)){
    echo $row['category'] . ": " . $row['total_value'] . "å…ƒ<br>";
}
?>`,
        },
        groupRank: {
          sql: "SELECT item_name, price, RANK() OVER (PARTITION BY category ORDER BY price DESC) AS rank \nFROM inventory;",
          php: `<?php
// åƒ¹æ ¼æ’å
$sql = "SELECT item_name, price, RANK() OVER (PARTITION BY category ORDER BY price DESC) AS rank FROM inventory";
$result = mysqli_query($conn, $sql);
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . ": " . $row['price'] . "å…ƒ, æ’å: " . $row['rank'] . "<br>";
}
?>`,
        },
        distinctCategories: {
          sql: "SELECT DISTINCT category \nFROM inventory;",
          php: `<?php
// å»é‡é¡åˆ¥
$sql = "SELECT DISTINCT category FROM inventory";
$result = mysqli_query($conn, $sql);
while($row = mysqli_fetch_assoc($result)){
    echo $row['category'] . "<br>";
}
?>`,
        },
        unionItems: {
          sql: "SELECT item_name \nFROM inventory \nWHERE stock > 0 \nUNION \nSELECT item_name \nFROM sold_items \nWHERE quantity > 0;",
          php: `<?php
// åˆä½µæŸ¥è©¢
$sql = "SELECT item_name FROM inventory WHERE stock > 0 UNION SELECT item_name FROM sold_items WHERE quantity > 0";
$result = mysqli_query($conn, $sql);
while($row = mysqli_fetch_assoc($result)){
    echo $row['item_name'] . "<br>";
}
?>`,
        },
        indexCreate: {
          sql: "CREATE INDEX idx_category \nON inventory (category);",
          php: `<?php
// å»ºç«‹ç´¢å¼•
$sql = "CREATE INDEX idx_category ON inventory (category)";
if(mysqli_query($conn, $sql)){
    echo "ç´¢å¼•å»ºç«‹æˆåŠŸï¼ŒæŸ¥è©¢é€Ÿåº¦é£›å¿«ï¼";
} else {
    echo "ç´¢å¼•å»ºç«‹å¤±æ•—ï¼š" . mysqli_error($conn);
}
?>`,
        },
        indexDrop: {
          sql: "DROP INDEX idx_category \nON inventory;",
          php: `<?php
// ç§»é™¤ç´¢å¼•
$sql = "DROP INDEX idx_category ON inventory";
if(mysqli_query($conn, $sql)){
    echo "ç´¢å¼•ç§»é™¤æˆåŠŸï¼ŒæŸ¥è©¢é€Ÿåº¦å›å¾©æ­£å¸¸ï¼";
} else {
    echo "ç´¢å¼•ç§»é™¤å¤±æ•—ï¼š" . mysqli_error($conn);
}
?>`,
        },
        transactionSale: {
          sql: "START TRANSACTION;\nINSERT INTO sales (item_id, customer_id, quantity) VALUES (1, 1, 2);\nUPDATE inventory SET stock = stock - 2 WHERE id = 1;\nCOMMIT;",
          php: `<?php
// äº¤æ˜“æäº¤
mysqli_begin_transaction($conn);
try {
    mysqli_query($conn, "INSERT INTO sales (item_id, customer_id, quantity) VALUES (1, 1, 2)");
    mysqli_query($conn, "UPDATE inventory SET stock = stock - 2 WHERE id = 1");
    mysqli_commit($conn);
    echo "äº¤æ˜“æˆåŠŸï¼çµå¸³å®Œæˆï½";
} catch(Exception $e) {
    mysqli_rollback($conn);
    echo "äº¤æ˜“å¤±æ•—ï¼š" . $e->getMessage();
}
?>`,
        },
        transactionRollback: {
          sql: "START TRANSACTION;\nUPDATE inventory SET stock = stock + 10 WHERE id = 2;\nROLLBACK;",
          php: `<?php
// äº¤æ˜“å›æ»¾
mysqli_begin_transaction($conn);
try {
    mysqli_query($conn, "UPDATE inventory SET stock = stock + 10 WHERE id = 2");
    throw new Exception("æ¨¡æ“¬éŒ¯èª¤");
    mysqli_commit($conn);
} catch(Exception $e) {
    mysqli_rollback($conn);
    echo "äº¤æ˜“å·²å›æ»¾ï¼Œè«‹é‡æ–°æ“ä½œï¼";
}
?>`,
        },
      };

      // æ ¹æ“šæ”¤è²© id å›å‚³å°æ‡‰çš„ PHP å®Œæ•´ç¯„ä¾‹åŠ SQL ç§˜æ–¹
      function getSecretCodeBlocks(stallId, stallSecretSQL) {
        const blocks = [
          {
            codeType: "SQL å»ºç«‹èˆ‡ç¯„ä¾‹è³‡æ–™ (db_setup.sql)",
            content:
              "CREATE DATABASE night_market;\nUSE night_market;\n" +
              stallSecretSQL,
          },
          {
            codeType: "PHP å®Œæ•´ç¯„ä¾‹ (store_example.php)",
            content: getPhpFullExample(stallId),
          },
        ];
        return blocks;
      }

      // é¡¯ç¤ºæ¨¡æ…‹çª—ï¼Œä¸¦åœ¨æ¨¡æ…‹çª—ä¸­åŠ å…¥ã€Œä¸‹è¼‰ PHP å®Œæ•´ç¯„ä¾‹ã€æŒ‰éˆ•
      function showModal(title, codeBlocks) {
        modalOverlay.classList.add("show");
        modalContent.querySelector("#modalTitle").textContent = title;
        modalContent
          .querySelectorAll(".modal-pre, #downloadPhpBtn")
          .forEach((el) => el.remove());
        codeBlocks.forEach((block) => {
          const preDiv = document.createElement("div");
          preDiv.className = "modal-pre";
          const copyBtn = document.createElement("button");
          copyBtn.className = "copy-btn";
          copyBtn.textContent = "è¤‡è£½";
          copyBtn.addEventListener("click", () =>
            copyCode(copyBtn, block.content)
          );
          const codeTitle = document.createElement("div");
          codeTitle.style.fontWeight = "bold";
          codeTitle.style.marginBottom = "0.5rem";
          codeTitle.textContent = block.codeType;
          const textPre = document.createElement("pre");
          textPre.innerHTML = escapeHTML(block.content);
          preDiv.appendChild(copyBtn);
          preDiv.appendChild(codeTitle);
          preDiv.appendChild(textPre);
          modalContent.appendChild(preDiv);
        });
        // åŠ å…¥ä¸‹è¼‰ PHP å®Œæ•´ç¯„ä¾‹æŒ‰éˆ•ï¼Œä½¿ç”¨å°æ‡‰æ”¤è²©çš„ PHP ç¨‹å¼ç¢¼
        const downloadBtn = document.createElement("button");
        downloadBtn.id = "downloadPhpBtn";
        downloadBtn.className = "stall-btn";
        downloadBtn.textContent = "ä¸‹è¼‰ PHP å®Œæ•´ç¯„ä¾‹";
        downloadBtn.addEventListener("click", () => {
          const element = document.createElement("a");
          element.setAttribute(
            "href",
            "data:text/plain;charset=utf-8," +
              encodeURIComponent(codeBlocks[1].content)
          );
          element.setAttribute("download", "store_example.php");
          element.style.display = "none";
          document.body.appendChild(element);
          element.click();
          document.body.removeChild(element);
        });
        modalContent.appendChild(downloadBtn);
      }

      // ä¿®æ”¹ showInlineSQLï¼Œä½¿ç”¨å‚³å…¥çš„ phpText è€Œéå…¨å±€ç¯„ä¾‹
      function showInlineSQL(stallObj, sqlText, phpText) {
        const container = document.getElementById(
          `${stallObj.id}-inline-sql-container`
        );
        container.innerHTML = "";
        const blocks = [
          { title: "SQL å»ºç«‹èˆ‡ç¯„ä¾‹è³‡æ–™", code: sqlText },
          { title: "PHP å®Œæ•´ç¯„ä¾‹", code: phpText },
        ];
        blocks.forEach((block) => {
          const div = document.createElement("div");
          div.className = "inline-sql-box";
          const copyBtn = document.createElement("button");
          copyBtn.className = "inline-sql-copy";
          copyBtn.textContent = "è¤‡è£½";
          copyBtn.addEventListener("click", () =>
            copyCode(copyBtn, block.code)
          );
          const titleEl = document.createElement("div");
          titleEl.className = "inline-sql-title";
          titleEl.textContent = block.title;
          const pre = document.createElement("pre");
          pre.innerHTML = escapeHTML(block.code);
          div.appendChild(copyBtn);
          div.appendChild(titleEl);
          div.appendChild(pre);
          container.appendChild(div);
        });
      }

      function copyCode(btn, text) {
        navigator.clipboard
          .writeText(text)
          .then(() => {
            btn.textContent = "å·²è¤‡è£½";
            setTimeout(() => (btn.textContent = "è¤‡è£½"), 1500);
          })
          .catch(() => showToast(null, "è¤‡è£½å¤±æ•—"));
      }

      const modalOverlay = document.getElementById("modalOverlay");
      const modalContent = document.getElementById("modalContent");
      const modalClose = document.getElementById("modalClose");
      modalClose.addEventListener("click", () =>
        modalOverlay.classList.remove("show")
      );
      modalOverlay.addEventListener("click", (e) => {
        if (e.target === modalOverlay) modalOverlay.classList.remove("show");
      });

      function escapeHTML(text) {
        const map = {
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#039;",
        };
        return text.replace(/[&<>"']/g, (m) => map[m]);
      }

      const stallsData = [
        {
          id: "insert",
          className: "insert-stall",
          icon: "fa-solid fa-plus",
          title: "é€²è²¨è£œçµ¦ç«™ (INSERT)",
          productShelfTitle: "åº«å­˜å•†å“",
          dialogues: [
            {
              speaker: "é€²è²¨è€é—†",
              text: "å°ç‹¼ã€å°å…”ï¼Œå¤œå¸‚é–‹å¼µå•¦ï¼Œè¶•å¿«é€²è²¨è®“é¡§å®¢æ»¿æ„ï¼",
            },
            { speaker: "å°å…”", text: "æ”¶åˆ°ï¼é›æ’èˆ‡å¥¶èŒ¶ï¼Œäººæ°£ä¿è­‰è³£ç¿»å¤©ï½" },
          ],
          products: [
            {
              id: 1,
              icon: "fa-solid fa-drumstick-bite",
              name: "é›æ’",
              price: 70,
              stock: 20,
              category: "ä¸»é£Ÿ",
            },
            {
              id: 2,
              icon: "fa-solid fa-mug-hot",
              name: "çç å¥¶èŒ¶",
              price: 50,
              stock: 30,
              category: "é£²æ–™",
            },
          ],
          operationButtons: [
            {
              label: "å–®ç­†é€²è²¨",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°å…”",
                  text: "é›æ’å†è£œä¸€æ³¢ï¼Œè®“è²¨æ¶æ›´è±å¯Œï¼",
                });
                const newItem = {
                  id: stallObj.products.length + 1,
                  icon: "fa-solid fa-drumstick-bite",
                  name: "é›æ’",
                  price: 70,
                  stock: 20,
                  category: "ä¸»é£Ÿ",
                };
                stallObj.products.push(newItem);
                stallObj.filtered = stallObj.products;
                stallObj.renderProducts("animate__animated animate__bounceIn");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.insertSingle.sql,
                  codeSnippets.insertSingle.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
            {
              label: "æ‰¹é‡é€²è²¨",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "é€²è²¨è€é—†",
                  text: "ä¸€æ¬¡é€²å…©æ¨£ï¼Œå¥¶èŒ¶èˆ‡æ»·è›‹ä¸Šæ¶ï¼",
                });
                const newItems = [
                  {
                    id: stallObj.products.length + 1,
                    icon: "fa-solid fa-mug-hot",
                    name: "çç å¥¶èŒ¶",
                    price: 50,
                    stock: 30,
                    category: "é£²æ–™",
                  },
                  {
                    id: stallObj.products.length + 2,
                    icon: "fa-solid fa-egg",
                    name: "æ»·è›‹",
                    price: 10,
                    stock: 50,
                    category: "å°åƒ",
                  },
                ];
                stallObj.products.push(...newItems);
                stallObj.filtered = stallObj.products;
                stallObj.renderProducts("animate__animated animate__bounceIn");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.insertBatch.sql,
                  codeSnippets.insertBatch.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
          ],
          secretSQL:
            "CREATE TABLE inventory (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  item_name VARCHAR(50),\n  price INT,\n  stock INT,\n  category VARCHAR(50)\n);\nINSERT INTO inventory (item_name, price, stock, category) VALUES ('é›æ’', 70, 20, 'ä¸»é£Ÿ'), ('çç å¥¶èŒ¶', 50, 30, 'é£²æ–™');",
        },
        {
          id: "delete",
          className: "delete-stall",
          icon: "fa-solid fa-trash",
          title: "åº«å­˜æ¸…ç†ç«™ (DELETE)",
          productShelfTitle: "å¾…æ¸…å•†å“",
          dialogues: [
            {
              speaker: "æ¸…ç†è€é—†",
              text: "å°ç‹¼ï¼Œåº«å­˜å †ç©å¦‚å±±ï¼Œå¾—å…ˆæ¸…é™¤æ²’äººæ°£çš„è²¨å“ï¼",
            },
            { speaker: "å°ç‹¼", text: "æ”¾å¿ƒï¼Œä½åº«å­˜ï¼ˆ<10ï¼‰èˆ‡å°åƒé¡å…¨éƒ¨ä¸‹æ¶ï¼" },
          ],
          products: [
            {
              id: 1,
              icon: "fa-solid fa-drumstick-bite",
              name: "é›ç¿…",
              price: 40,
              stock: 5,
              category: "ä¸»é£Ÿ",
            },
            {
              id: 2,
              icon: "fa-solid fa-egg",
              name: "æ»·è›‹",
              price: 10,
              stock: 10,
              category: "å°åƒ",
            },
            {
              id: 3,
              icon: "fa-solid fa-mug-hot",
              name: "ç¶ èŒ¶",
              price: 30,
              stock: 20,
              category: "é£²æ–™",
            },
            {
              id: 4,
              icon: "fa-solid fa-mug-hot",
              name: "ç´…èŒ¶",
              price: 30,
              stock: 3,
              category: "é£²æ–™",
            },
          ],
          operationButtons: [
            {
              label: "åˆªé™¤ä½åº«å­˜",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°ç‹¼",
                  text: "åªåˆªé™¤åº«å­˜ä½æ–¼10çš„å•†å“ï½",
                });
                stallObj.products = stallObj.products.filter(
                  (p) => p.stock >= 10
                );
                stallObj.filtered = stallObj.products;
                stallObj.renderProducts();
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.deleteLowStock.sql,
                  codeSnippets.deleteLowStock.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
            {
              label: "åˆªé™¤å°åƒé¡",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "æ¸…ç†è€é—†",
                  text: "ç§»é™¤æ‰€æœ‰å°åƒé¡å•†å“ï½",
                });
                stallObj.products = stallObj.products.filter(
                  (p) => p.category !== "å°åƒ"
                );
                stallObj.filtered = stallObj.products;
                stallObj.renderProducts();
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.deleteCategory.sql,
                  codeSnippets.deleteCategory.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
          ],
          secretSQL:
            "CREATE TABLE inventory (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  item_name VARCHAR(50),\n  price INT,\n  stock INT,\n  category VARCHAR(50)\n);\nINSERT INTO inventory (item_name, price, stock, category) VALUES ('é›ç¿…', 40, 5, 'ä¸»é£Ÿ'), ('æ»·è›‹', 10, 10, 'å°åƒ'), ('ç¶ èŒ¶', 30, 20, 'é£²æ–™'), ('ç´…èŒ¶', 30, 3, 'é£²æ–™');",
        },
        {
          id: "update",
          className: "update-stall",
          icon: "fa-solid fa-pen",
          title: "åƒ¹æ ¼èª¿æ•´ç«™ (UPDATE)",
          productShelfTitle: "å•†å“åƒ¹æ ¼",
          dialogues: [
            {
              speaker: "åƒ¹æ ¼è€é—†",
              text: "å°å…”ï¼Œé£²æ–™æˆæœ¬ä¸Šæ¼²äº†ï¼Œå¿…é ˆèª¿æ•´åƒ¹æ ¼ï¼›é›æ’éŠ·å”®ç«ç†±ï¼Œåº«å­˜ä¹Ÿè¦æ›´æ–°ï¼",
            },
            { speaker: "å°å…”", text: "é¦¬ä¸Šèª¿æ•´ï¼Œè®“åƒ¹æ ¼èˆ‡åº«å­˜æ›´è²¼è¿‘ç¾å¯¦ï½" },
          ],
          products: [
            {
              id: 1,
              icon: "fa-solid fa-mug-hot",
              name: "çç å¥¶èŒ¶",
              price: 50,
              stock: 30,
              category: "é£²æ–™",
            },
            {
              id: 2,
              icon: "fa-solid fa-drumstick-bite",
              name: "é›æ’",
              price: 70,
              stock: 20,
              category: "ä¸»é£Ÿ",
            },
          ],
          operationButtons: [
            {
              label: "æ›´æ–°é£²æ–™åƒ¹æ ¼",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°å…”",
                  text: "é£²æ–™æ¯æ¨£æ¼²5å…ƒï¼Œèª¿æ•´æˆåŠŸï¼",
                });
                stallObj.products = stallObj.products.map((p) =>
                  p.category === "é£²æ–™" ? { ...p, price: p.price + 5 } : p
                );
                stallObj.filtered = stallObj.products;
                stallObj.renderProducts("animate__animated animate__flash");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.updatePrice.sql,
                  codeSnippets.updatePrice.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
            {
              label: "æ›´æ–°é›æ’åº«å­˜",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°å…”",
                  text: "é›æ’è³£å‡º5ä»½ï¼Œåº«å­˜æ›´æ–°æˆåŠŸï¼",
                });
                stallObj.products = stallObj.products.map((p) =>
                  p.name === "é›æ’" ? { ...p, stock: p.stock - 5 } : p
                );
                stallObj.filtered = stallObj.products;
                stallObj.renderProducts("animate__animated animate__flash");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.updateStock.sql,
                  codeSnippets.updateStock.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
          ],
          secretSQL:
            "CREATE TABLE inventory (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  item_name VARCHAR(50),\n  price INT,\n  stock INT,\n  category VARCHAR(50)\n);\nINSERT INTO inventory (item_name, price, stock, category) VALUES ('çç å¥¶èŒ¶', 50, 30, 'é£²æ–™'), ('é›æ’', 70, 20, 'ä¸»é£Ÿ');",
        },
        {
          id: "select",
          className: "select-stall",
          icon: "fa-solid fa-search",
          title: "é¡§å®¢æŸ¥è©¢ç«™ (SELECT)",
          productShelfTitle: "æŸ¥è©¢ç¾é£Ÿ",
          dialogues: [
            {
              speaker: "æŸ¥è©¢è€é—†",
              text: "å°ç‹¼ï¼Œé¡§å®¢æƒ³çŸ¥é“å“ªäº›å•†å“ç‰©ç¾åƒ¹å»‰ï¼Œå…ˆæŸ¥ä¾¿å®œè²¨ï¼",
            },
            { speaker: "å°ç‹¼", text: "æ­¤å¤–ï¼Œé‚„æœ‰é«˜åº«å­˜ã€ç†±é–€åŠå…¨éƒ¨æŸ¥è©¢å–”ï¼" },
          ],
          products: [
            {
              id: 1,
              icon: "fa-solid fa-drumstick-bite",
              name: "é›æ’",
              price: 70,
              stock: 20,
              category: "ä¸»é£Ÿ",
            },
            {
              id: 2,
              icon: "fa-solid fa-egg",
              name: "æ»·è›‹",
              price: 10,
              stock: 50,
              category: "å°åƒ",
            },
            {
              id: 3,
              icon: "fa-solid fa-mug-hot",
              name: "ç¶ èŒ¶",
              price: 30,
              stock: 15,
              category: "é£²æ–™",
            },
          ],
          operationButtons: [
            {
              label: "æŸ¥å…¨éƒ¨å•†å“",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°ç‹¼",
                  text: "å…¨éƒ¨å•†å“æŸ¥è©¢å®Œæˆï¼",
                });
                stallObj.filtered = stallObj.products.slice();
                stallObj.renderProducts("animate__animated animate__bounceIn");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.selectAll.sql,
                  codeSnippets.selectAll.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
            {
              label: "æŸ¥ä¸»é£Ÿ",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°ç‹¼",
                  text: "ä¸»é£ŸæŸ¥è©¢å®Œæˆï¼",
                });
                stallObj.filtered = stallObj.products.filter(
                  (p) => p.category === "ä¸»é£Ÿ"
                );
                stallObj.renderProducts("animate__animated animate__bounceIn");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.selectMain.sql,
                  codeSnippets.selectMain.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
            {
              label: "æŸ¥ä¾¿å®œè²¨",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°ç‹¼",
                  text: "ä¾¿å®œè²¨ï¼ˆ50å…ƒä»¥ä¸‹ï¼‰æŸ¥è©¢å®Œæˆï¼",
                });
                stallObj.filtered = stallObj.products.filter(
                  (p) => p.price < 50
                );
                stallObj.renderProducts("animate__animated animate__highlight");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.selectCheap.sql,
                  codeSnippets.selectCheap.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
            {
              label: "æŸ¥é«˜åº«å­˜",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°ç‹¼",
                  text: "é«˜åº«å­˜ï¼ˆè¶…éå¹³å‡ï¼‰æŸ¥è©¢å®Œæˆï¼",
                });
                stallObj.filtered = stallObj.products.filter(
                  (p) =>
                    p.stock >
                    stallObj.products.reduce((sum, p) => sum + p.stock, 0) /
                      stallObj.products.length
                );
                stallObj.renderProducts("animate__animated animate__highlight");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.selectSubquery.sql,
                  codeSnippets.selectSubquery.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
            {
              label: "æŸ¥ç†±é–€å•†å“",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°ç‹¼",
                  text: "ç†±é–€å•†å“ä¾åƒ¹æ ¼æ’åºæŸ¥è©¢å®Œæˆï¼",
                });
                stallObj.filtered = stallObj.products
                  .slice()
                  .sort((a, b) => b.price - a.price);
                stallObj.renderProducts("animate__animated animate__highlight");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.selectPopular.sql,
                  codeSnippets.selectPopular.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
          ],
          secretSQL:
            "CREATE TABLE inventory (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  item_name VARCHAR(50),\n  price INT,\n  stock INT,\n  category VARCHAR(50)\n);\nINSERT INTO inventory (item_name, price, stock, category) VALUES ('é›æ’', 70, 20, 'ä¸»é£Ÿ'), ('æ»·è›‹', 10, 50, 'å°åƒ'), ('ç¶ èŒ¶', 30, 15, 'é£²æ–™');",
        },
        {
          id: "join",
          className: "join-stall",
          icon: "fa-solid fa-link",
          title: "éŠ·å”®é—œè¯ç«™ (JOIN)",
          productShelfTitle: "éŠ·å”®ç´€éŒ„",
          dialogues: [
            {
              speaker: "éŠ·å”®è€é—†",
              text: "å°å…”ï¼Œè«‹æŸ¥è©¢ä»Šæ—¥éŠ·å”®æ•¸æ“šï¼Œçœ‹çœ‹éŠ·é‡å¦‚ä½•ï¼",
            },
            { speaker: "å°å…”", text: "ä»Šæ—¥éŠ·å”®èˆ‡é¡§å®¢è¨‚å–®æ•¸æ“šé¦¬ä¸Šå‘ˆç¾ï½" },
          ],
          products: [
            {
              id: 1,
              icon: "fa-solid fa-drumstick-bite",
              name: "é›æ’",
              quantity: 5,
            },
            {
              id: 2,
              icon: "fa-solid fa-mug-hot",
              name: "çç å¥¶èŒ¶",
              quantity: 10,
            },
          ],
          operationButtons: [
            {
              label: "æŸ¥ä»Šæ—¥éŠ·å”®",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°å…”",
                  text: "ä»Šæ—¥éŠ·å”®æ•¸æ“šæŸ¥è©¢å®Œæˆï¼ŒéŠ·å”®ç«ç†±ï¼",
                });
                stallObj.filtered = stallObj.products.map((p) => ({
                  ...p,
                  name: p.name + " (ä»Šæ—¥)",
                }));
                stallObj.renderProducts("animate__animated animate__highlight");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.joinSales.sql,
                  codeSnippets.joinSales.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
            {
              label: "æŸ¥é¡§å®¢è¨‚å–®",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "éŠ·å”®è€é—†",
                  text: "é¡§å®¢è¨‚å–®æŸ¥è©¢å®Œæˆï¼Œè©³ç´°è³‡æ–™å¦‚ä¸‹ï½",
                });
                stallObj.filtered = [
                  {
                    id: 1,
                    icon: "fa-solid fa-drumstick-bite",
                    name: "é›æ’ - é˜¿æ˜",
                    quantity: 5,
                  },
                  {
                    id: 2,
                    icon: "fa-solid fa-mug-hot",
                    name: "çç å¥¶èŒ¶ - å°èŠ³",
                    quantity: 10,
                  },
                ];
                stallObj.renderProducts("animate__animated animate__highlight");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.joinMulti.sql,
                  codeSnippets.joinMulti.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
          ],
          secretSQL:
            "CREATE TABLE inventory (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  item_name VARCHAR(50)\n);\nCREATE TABLE customers (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(50)\n);\nCREATE TABLE sales (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  item_id INT,\n  customer_id INT,\n  quantity INT,\n  sale_date DATE,\n  FOREIGN KEY (item_id) REFERENCES inventory(id),\n  FOREIGN KEY (customer_id) REFERENCES customers(id)\n);\nINSERT INTO inventory (item_name) VALUES ('é›æ’'), ('çç å¥¶èŒ¶');\nINSERT INTO customers (name) VALUES ('é˜¿æ˜'), ('å°èŠ³');\nINSERT INTO sales (item_id, customer_id, quantity, sale_date) VALUES (1, 1, 5, CURDATE()), (2, 2, 10, CURDATE());",
        },
        {
          id: "groupby",
          className: "groupby-stall",
          icon: "fa-solid fa-chart-bar",
          title: "çµ±è¨ˆåˆ†æç«™ (GROUP BY)",
          productShelfTitle: "éŠ·å”®çµ±è¨ˆ",
          dialogues: [
            { speaker: "çµ±è¨ˆè€é—†", text: "å°ç‹¼ï¼Œçµ±è¨ˆå„é¡éŠ·å”®é¡ï¼Œè®“æ•¸æ“šèªªè©±ï¼" },
            { speaker: "å°ç‹¼", text: "çµ±è¨ˆæ•¸æ“šä¾†äº†ï¼Œç²¾å½©æ•¸å­—å‘ˆç¾ï½" },
          ],
          products: [
            {
              id: 1,
              icon: "fa-solid fa-drumstick-bite",
              name: "é›æ’",
              price: 70,
              stock: 20,
              category: "ä¸»é£Ÿ",
            },
            {
              id: 2,
              icon: "fa-solid fa-mug-hot",
              name: "çç å¥¶èŒ¶",
              price: 50,
              stock: 30,
              category: "é£²æ–™",
            },
            {
              id: 3,
              icon: "fa-solid fa-egg",
              name: "æ»·è›‹",
              price: 10,
              stock: 50,
              category: "å°åƒ",
            },
          ],
          operationButtons: [
            {
              label: "çµ±è¨ˆéŠ·å”®é¡",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°ç‹¼",
                  text: "éŠ·å”®é¡è¶…é1000å…ƒçš„é¡åˆ¥å¦‚ä¸‹ï½",
                });
                const salesByCategory = stallObj.products.reduce((acc, p) => {
                  acc[p.category] = (acc[p.category] || 0) + p.price * p.stock;
                  return acc;
                }, {});
                stallObj.filtered = Object.entries(salesByCategory)
                  .filter(([_, total]) => total > 1000)
                  .map(([cat, total]) => ({
                    id: cat,
                    icon: "fa-solid fa-chart-bar",
                    name: cat,
                    price: `${total} å…ƒ`,
                    stock: 0,
                    category: cat,
                  }));
                stallObj.renderProducts("animate__animated animate__highlight");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.groupSales.sql,
                  codeSnippets.groupSales.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
            {
              label: "åƒ¹æ ¼æ’å",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°ç‹¼",
                  text: "å„é¡å•†å“ä¾åƒ¹æ ¼æ’åï¼Œæ•¸æ“šå¦‚ä¸‹ï½",
                });
                const ranked = stallObj.products
                  .map((p) => ({ ...p, name: p.name + " (æ’å)" }))
                  .sort((a, b) => b.price - a.price);
                stallObj.filtered = ranked;
                stallObj.renderProducts("animate__animated animate__highlight");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.groupRank.sql,
                  codeSnippets.groupRank.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
          ],
          secretSQL:
            "CREATE TABLE inventory (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  item_name VARCHAR(50),\n  price INT,\n  stock INT,\n  category VARCHAR(50)\n);\nINSERT INTO inventory (item_name, price, stock, category) VALUES ('é›æ’', 70, 20, 'ä¸»é£Ÿ'), ('çç å¥¶èŒ¶', 50, 30, 'é£²æ–™'), ('æ»·è›‹', 10, 50, 'å°åƒ');",
        },
        {
          id: "distinct",
          className: "distinct-stall",
          icon: "fa-solid fa-filter",
          title: "é¡åˆ¥ç¯©é¸ç«™ (DISTINCT/UNION)",
          productShelfTitle: "å•†å“é¡åˆ¥",
          dialogues: [
            {
              speaker: "ç¯©é¸è€é—†",
              text: "å°å…”ï¼Œå¸‚å ´ä¸Šé‡è¤‡çš„å“é …å¤ªå¤šï¼Œå…ˆå»é‡é¡åˆ¥ï¼",
            },
            { speaker: "å°å…”", text: "ç¨ç‰¹çš„é¡åˆ¥é¦¬ä¸Šå‘ˆç¾ï¼Œè²¨æ¶ä¹¾æ·¨æ•´æ½”ï½" },
          ],
          products: [
            {
              id: 1,
              icon: "fa-solid fa-drumstick-bite",
              name: "é›æ’",
              price: 70,
              stock: 20,
              category: "ä¸»é£Ÿ",
            },
            {
              id: 2,
              icon: "fa-solid fa-drumstick-bite",
              name: "é›ç¿…",
              price: 40,
              stock: 5,
              category: "ä¸»é£Ÿ",
            },
            {
              id: 3,
              icon: "fa-solid fa-mug-hot",
              name: "çç å¥¶èŒ¶",
              price: 50,
              stock: 30,
              category: "é£²æ–™",
            },
          ],
          operationButtons: [
            {
              label: "å»é‡é¡åˆ¥",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°å…”",
                  text: "ç¨ç‰¹é¡åˆ¥å‘ˆç¾ï¼Œå¸‚å ´æ›´æ¸…æ™°ï½",
                });
                const uniqueCategories = [
                  ...new Set(stallObj.products.map((p) => p.category)),
                ];
                stallObj.filtered = uniqueCategories.map((cat, i) => ({
                  id: i + 1,
                  icon: "fa-solid fa-box",
                  name: cat,
                  price: "-",
                  stock: "-",
                  category: cat,
                }));
                stallObj.renderProducts("animate__animated animate__highlight");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.distinctCategories.sql,
                  codeSnippets.distinctCategories.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
            {
              label: "åˆä½µå·²å”®",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "ç¯©é¸è€é—†",
                  text: "åˆä½µè³£å‡ºè³‡æ–™ï¼Œè®“æ¸…å–®æ›´å®Œæ•´ï½",
                });
                const soldItems = [
                  {
                    id: 4,
                    icon: "fa-solid fa-egg",
                    name: "æ»·è›‹",
                    price: 10,
                    stock: 0,
                    category: "å°åƒ",
                  },
                ];
                stallObj.filtered = [...stallObj.products, ...soldItems];
                stallObj.renderProducts("animate__animated animate__bounceIn");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.unionItems.sql,
                  codeSnippets.unionItems.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
          ],
          secretSQL:
            "CREATE TABLE inventory (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  item_name VARCHAR(50),\n  price INT,\n  stock INT,\n  category VARCHAR(50)\n);\nCREATE TABLE sold_items (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  item_name VARCHAR(50),\n  quantity INT\n);\nINSERT INTO inventory (item_name, price, stock, category) VALUES ('é›æ’', 70, 20, 'ä¸»é£Ÿ'), ('é›ç¿…', 40, 5, 'ä¸»é£Ÿ'), ('çç å¥¶èŒ¶', 50, 30, 'é£²æ–™');\nINSERT INTO sold_items (item_name, quantity) VALUES ('æ»·è›‹', 10);",
        },
        {
          id: "index",
          className: "index-stall",
          icon: "fa-solid fa-tachometer-alt",
          title: "å¿«é€ŸæŸ¥è©¢ç«™ (INDEX)",
          productShelfTitle: "åº«å­˜æŸ¥è©¢",
          dialogues: [
            { speaker: "æŸ¥è©¢è€é—†", text: "å°ç‹¼ï¼ŒæŸ¥è©¢é€Ÿåº¦å¤ªæ…¢ï¼Œå…ˆä¾†å»ºç«‹ç´¢å¼•ï¼" },
            { speaker: "å°ç‹¼", text: "ç´¢å¼•å»ºç«‹å¾Œï¼ŒæŸ¥è©¢å¿«å¦‚é–ƒé›»ï½" },
          ],
          products: [
            {
              id: 1,
              icon: "fa-solid fa-drumstick-bite",
              name: "é›æ’",
              price: 70,
              stock: 20,
              category: "ä¸»é£Ÿ",
            },
            {
              id: 2,
              icon: "fa-solid fa-mug-hot",
              name: "çç å¥¶èŒ¶",
              price: 50,
              stock: 30,
              category: "é£²æ–™",
            },
          ],
          operationButtons: [
            {
              label: "å»ºç«‹ç´¢å¼•",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°ç‹¼",
                  text: "ç´¢å¼•å»ºç«‹ä¸­ï¼ŒæŸ¥è©¢é€Ÿåº¦é¦¬ä¸Šæé€Ÿï½",
                });
                stallObj.products.push({
                  id: 3,
                  icon: "fa-solid fa-bolt",
                  name: "ç´¢å¼•å•Ÿç”¨",
                  price: "-",
                  stock: "-",
                  category: "-",
                });
                stallObj.filtered = stallObj.products;
                stallObj.renderProducts("animate__animated animate__bounceIn");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.indexCreate.sql,
                  codeSnippets.indexCreate.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
            {
              label: "ç§»é™¤ç´¢å¼•",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°ç‹¼",
                  text: "ç´¢å¼•ç§»é™¤ï¼ŒæŸ¥è©¢é€Ÿåº¦æ¢å¾©æ­£å¸¸ï½",
                });
                stallObj.products = stallObj.products.filter(
                  (p) => p.name !== "ç´¢å¼•å•Ÿç”¨"
                );
                stallObj.filtered = stallObj.products;
                stallObj.renderProducts("animate__animated animate__fadeOut");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.indexDrop.sql,
                  codeSnippets.indexDrop.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
          ],
          secretSQL:
            "CREATE TABLE inventory (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  item_name VARCHAR(50),\n  price INT,\n  stock INT,\n  category VARCHAR(50)\n);\nINSERT INTO inventory (item_name, price, stock, category) VALUES ('é›æ’', 70, 20, 'ä¸»é£Ÿ'), ('çç å¥¶èŒ¶', 50, 30, 'é£²æ–™');",
        },
        {
          id: "transaction",
          className: "transaction-stall",
          icon: "fa-solid fa-exchange-alt",
          title: "äº¤æ˜“çµå¸³ç«™ (TRANSACTION)",
          productShelfTitle: "çµå¸³ç´€éŒ„",
          dialogues: [
            {
              speaker: "çµå¸³è€é—†",
              text: "å°å…”ï¼Œé¡§å®¢çµå¸³å‹™å¿…å…¨é¡æˆåŠŸï¼Œè«‹åŸ·è¡Œäº¤æ˜“æ“ä½œï¼",
            },
            {
              speaker: "å°å…”",
              text: "äº¤æ˜“åŒ…è£å®Œç•¢ï¼ŒæˆåŠŸå°±çµå¸³ï¼Œå¤±æ•—å‰‡å…¨æ•¸å›æ»¾ï½",
            },
          ],
          products: [
            {
              id: 1,
              icon: "fa-solid fa-drumstick-bite",
              name: "é›æ’",
              price: 70,
              stock: 20,
              status: "å¾…çµå¸³",
            },
          ],
          operationButtons: [
            {
              label: "çµå¸³é›æ’",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "å°å…”",
                  text: "è³£å‡º2ä»½é›æ’ï¼Œçµå¸³å®Œæˆï¼",
                });
                stallObj.products = stallObj.products.map((p) =>
                  p.name === "é›æ’"
                    ? { ...p, stock: p.stock - 2, status: "å·²çµå¸³" }
                    : p
                );
                stallObj.filtered = stallObj.products;
                stallObj.renderProducts("animate__animated animate__flash");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.transactionSale.sql,
                  codeSnippets.transactionSale.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
            {
              label: "å–æ¶ˆè¨‚å–®",
              onClick: (stallObj) => {
                clickSound.play();
                addDialogue(stallObj, {
                  speaker: "çµå¸³è€é—†",
                  text: "é¡§å®¢åæ‚”ï¼Œè¨‚å–®å–æ¶ˆï¼",
                });
                stallObj.products = stallObj.products.map((p) => ({
                  ...p,
                  status: "å·²å–æ¶ˆ",
                }));
                stallObj.filtered = stallObj.products;
                stallObj.renderProducts("animate__animated animate__fadeOut");
                resetAutoRevert(stallObj);
                showInlineSQL(
                  stallObj,
                  codeSnippets.transactionRollback.sql,
                  codeSnippets.transactionRollback.php
                );
                incrementOperationCount();
                successSound.play();
              },
            },
          ],
          secretSQL:
            "CREATE TABLE customers (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(50),\n  balance INT\n);\nCREATE TABLE inventory (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  item_name VARCHAR(50),\n  price INT,\n  stock INT\n);\nCREATE TABLE sales (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  item_id INT,\n  customer_id INT,\n  quantity INT,\n  FOREIGN KEY (item_id) REFERENCES inventory(id),\n  FOREIGN KEY (customer_id) REFERENCES customers(id)\n);\nINSERT INTO customers (name, balance) VALUES ('é˜¿æ˜', 100);\nINSERT INTO inventory (item_name, price, stock) VALUES ('é›æ’', 70, 20);",
        },
      ];

      const stallArea = document.getElementById("stallArea");
      stallsData.forEach((stall) => {
        const stallCard = document.createElement("section");
        stallCard.className = `stall-card ${stall.className}`;
        stallCard.id = `${stall.id}-card`;
        stallCard.setAttribute("role", "region");
        stallCard.setAttribute("aria-label", stall.title);

        const headerDiv = document.createElement("div");
        headerDiv.className = "stall-header";
        headerDiv.innerHTML = `<i class="${stall.icon}" aria-hidden="true"></i> <span>${stall.title}</span>`;
        stallCard.appendChild(headerDiv);

        const shelf = document.createElement("div");
        shelf.className = "product-shelf";
        shelf.innerHTML = `<div class="shelf-title">${stall.productShelfTitle}</div>`;
        const productGrid = document.createElement("div");
        productGrid.className = "product-grid";

        stall.filtered = stall.products.slice();
        stall.original = stall.products.slice();

        stall.renderProducts = function (animation = "") {
          productGrid.innerHTML = "";
          this.filtered.forEach((item) => {
            const itemDiv = document.createElement("div");
            itemDiv.className = `product-item ${animation}`;
            const displayText = item.status
              ? item.status
              : item.price !== undefined
              ? `${item.price} å…ƒ${
                  item.stock !== undefined
                    ? `, åº«å­˜: ${item.stock}`
                    : item.quantity !== undefined
                    ? `, æ•¸é‡: ${item.quantity}`
                    : ""
                }`
              : "";
            itemDiv.innerHTML = `
              <div class="icon-box"><i class="${item.icon}" aria-hidden="true"></i></div>
              <div class="product-name">${item.name}</div>
              <div class="product-price">${displayText}</div>
            `;
            itemDiv.setAttribute("aria-label", `${item.name} ${displayText}`);
            productGrid.appendChild(itemDiv);
          });
        };
        stall.renderProducts();
        shelf.appendChild(productGrid);
        stallCard.appendChild(shelf);

        const dialogueDiv = document.createElement("div");
        dialogueDiv.className = "dialogue";
        dialogueDiv.id = `${stall.id}-dialogue`;
        dialogueDiv.setAttribute("aria-live", "polite");
        let dHTML = "";
        stall.dialogues.forEach((d) => {
          dHTML += `<div class="dialog-line"><span class="speaker">${d.speaker}</span>ï¼š${d.text}</div>`;
        });
        dialogueDiv.innerHTML = dHTML;
        stallCard.appendChild(dialogueDiv);

        const btnContainer = document.createElement("div");
        btnContainer.className = "stall-buttons";
        stall.btnContainer = btnContainer;

        const secretBtn = document.createElement("button");
        secretBtn.className = "stall-btn";
        secretBtn.textContent = "æŸ¥çœ‹ç§˜æ–¹";
        secretBtn.addEventListener("click", () => {
          clickSound.play();
          const codeBlocks = getSecretCodeBlocks(stall.id, stall.secretSQL);
          showModal(stall.title + " - ç§˜æ–¹ç¤ºç¯„", codeBlocks);
        });
        btnContainer.appendChild(secretBtn);

        stall.operationButtons.forEach((op) => {
          const opBtn = document.createElement("button");
          opBtn.className = "stall-btn";
          opBtn.textContent = op.label;
          opBtn.addEventListener("click", () => {
            clickSound.play();
            op.onClick(stall);
          });
          btnContainer.appendChild(opBtn);
        });

        const revertBtn = document.createElement("button");
        revertBtn.className = "stall-btn";
        revertBtn.textContent = "å¾©åŸæ”¤è²©";
        revertBtn.addEventListener("click", () => revertStall(stall));
        btnContainer.appendChild(revertBtn);

        stallCard.appendChild(btnContainer);

        const timerDiv = document.createElement("div");
        timerDiv.className = "timer";
        timerDiv.id = `${stall.id}-timer`;
        timerDiv.textContent = "è‡ªå‹•å¾©åŸå€’æ•¸ï¼š30 ç§’";
        stallCard.appendChild(timerDiv);

        const inlineSQLContainer = document.createElement("div");
        inlineSQLContainer.id = `${stall.id}-inline-sql-container`;
        stallCard.appendChild(inlineSQLContainer);

        stallArea.appendChild(stallCard);
      });

      function addDialogue(stallObj, { speaker, text }) {
        const dialogueEl = document.getElementById(`${stallObj.id}-dialogue`);
        const lineDiv = document.createElement("div");
        lineDiv.className = "dialog-line";
        lineDiv.innerHTML = `<span class="speaker">${speaker}</span>ï¼š${text}`;
        dialogueEl.appendChild(lineDiv);
        dialogueEl.scrollTop = dialogueEl.scrollHeight;
      }

      let revertTimers = {};
      let timerIntervals = {};
      function resetAutoRevert(stallObj) {
        const sid = stallObj.id;
        if (revertTimers[sid]) clearTimeout(revertTimers[sid]);
        if (timerIntervals[sid]) clearInterval(timerIntervals[sid]);
        let timeLeft = 30;
        const timerEl = document.getElementById(`${sid}-timer`);
        timerEl.textContent = `è‡ªå‹•å¾©åŸå€’æ•¸ï¼š${timeLeft} ç§’`;
        timerIntervals[sid] = setInterval(() => {
          timeLeft--;
          timerEl.textContent = `è‡ªå‹•å¾©åŸå€’æ•¸ï¼š${timeLeft} ç§’`;
          if (timeLeft <= 0) clearInterval(timerIntervals[sid]);
        }, 1000);
        revertTimers[sid] = setTimeout(() => revertStall(stallObj), 30000);
      }

      function revertStall(stallObj) {
        clickSound.play();
        stallObj.products = stallObj.original.slice();
        stallObj.filtered = stallObj.original.slice();
        stallObj.renderProducts();
        const dialogueEl = document.getElementById(`${stallObj.id}-dialogue`);
        dialogueEl.innerHTML = "";
        stallObj.dialogues.forEach((d) => {
          const lineDiv = document.createElement("div");
          lineDiv.className = "dialog-line";
          lineDiv.innerHTML = `<span class="speaker">${d.speaker}</span>ï¼š${d.text}`;
          dialogueEl.appendChild(lineDiv);
        });
        const container = document.getElementById(
          `${stallObj.id}-inline-sql-container`
        );
        container.innerHTML = "";
        showToast(stallObj, "æ”¤è²©å·²å¾©åŸï¼Œå¤§å®¶é‡æ–°å‡ºç™¼ï¼");
        const sid = stallObj.id;
        if (timerIntervals[sid]) clearInterval(timerIntervals[sid]);
        document.getElementById(`${sid}-timer`).textContent =
          "è‡ªå‹•å¾©åŸå€’æ•¸ï¼š30 ç§’";
      }

      function incrementOperationCount() {
        operationCount++;
        operationCountEl.textContent = `å·²åŸ·è¡Œæ“ä½œï¼š${operationCount} æ¬¡`;
      }

      const toastContainer = document.getElementById("toastContainer");
      function showToast(stallObj, message) {
        const toast = document.createElement("div");
        toast.className = "toast";
        toast.textContent = stallObj
          ? `[${stallObj.title}] ${message}`
          : `[ç³»çµ±] ${message}`;
        toastContainer.appendChild(toast);
        setTimeout(() => {
          toast.classList.add("fade-out");
          setTimeout(() => toastContainer.removeChild(toast), 500);
        }, 2000);
      }
    </script>

    <script
      src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs"
      type="module"
    ></script>
    <script src="DinoRunner.js"></script>
  </body>
</html>
