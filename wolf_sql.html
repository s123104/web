<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SQL 夜市大冒險：全能攤位秀</title>
  <style>
    /* Reset 與基本樣式 */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: '微軟正黑體', sans-serif;
      background: #fdf6e3;
      color: #333;
      line-height: 1.6;
    }
    header {
      background: #ff9800;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 1.8em;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    .container {
      display: flex;
      min-height: calc(100vh - 80px);
    }
    /* 左側：資料庫結構展示 */
    .sidebar {
      width: 25%;
      background: #fff3e0;
      border-right: 2px solid #ffcc80;
      padding: 20px;
      overflow-y: auto;
    }
    .sidebar h2 {
      margin-bottom: 15px;
      color: #e65100;
    }
    .db-table {
      margin-bottom: 15px;
      padding: 10px;
      border: 1px solid #ffcc80;
      background: #fff8e1;
      border-radius: 5px;
    }
    .db-table h3 {
      margin-bottom: 5px;
      font-size: 1.1em;
      color: #bf360c;
    }
    .db-table ul {
      list-style: none;
      padding-left: 10px;
    }
    .db-table li {
      font-size: 0.9em;
      color: #5d4037;
    }
    /* 右側：互動區 */
    .main-content {
      flex: 1;
      padding: 20px;
      background: #fffde7;
      display: flex;
      flex-direction: column;
    }
    .action-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    .action-buttons button {
      flex: 1 1 150px;
      padding: 10px;
      font-size: 1em;
      border: none;
      background: #ff9800;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .action-buttons button:hover {
      background: #e65100;
    }
    .output {
      flex: 1;
      background: #fff;
      border: 2px dashed #ffcc80;
      padding: 15px;
      border-radius: 5px;
      overflow-y: auto;
      font-family: monospace;
      white-space: pre-wrap;
      margin-bottom: 20px;
    }
    .dialogue {
      background: #ffe0b2;
      border: 1px solid #ffcc80;
      padding: 10px;
      border-radius: 5px;
      font-style: italic;
      color: #bf360c;
    }
    footer {
      text-align: center;
      padding: 10px;
      background: #ff9800;
      color: white;
    }
    /* RWD */
    @media (max-width: 768px) {
      .container { flex-direction: column; }
      .sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 2px solid #ffcc80;
      }
    }
    /* 簡單的淡入動畫 */
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <header>
    SQL 夜市大冒險：全能攤位秀
  </header>
  <div class="container">
    <!-- 資料庫結構展示區 -->
    <aside class="sidebar">
      <h2>NightMarket 資料庫結構</h2>
      <div id="dbStructure">
        <!-- 動態注入內容 -->
      </div>
    </aside>
    <!-- 互動主區 -->
    <main class="main-content">
      <div class="action-buttons">
        <button id="btnCreateDB">建立夜市資料庫</button>
        <button id="btnCreateTables">建立攤位</button>
        <button id="btnAlterTable">修改攤位</button>
        <button id="btnDropTable">刪除攤位</button>
        <button id="btnInsertData">上新商品</button>
        <button id="btnSelectData">查詢攤位</button>
        <button id="btnUpdateData">調價更新</button>
        <button id="btnDeleteData">下架清空</button>
        <button id="btnSortData">排序展示</button>
        <button id="btnJoinUnion">聯盟套餐</button>
        <button id="btnGroupBy">銷量排行榜</button>
        <button id="btnSubQuery">內幕查詢</button>
        <button id="btnWindowFunc">排名功能</button>
        <button id="btnTransaction">交易控制</button>
        <button id="btnProcTrigger">自動促銷</button>
        <button id="btnIndexPerm">索引與權限</button>
      </div>
      <div class="output" id="outputArea">
        <!-- 顯示模擬 SQL 指令輸出 -->
      </div>
      <div class="dialogue" id="dialogueBox">
        <!-- 劇情對話 -->
        小狼：嗨嗨～各位資料庫狂人，歡迎來到 SQL 夜市！<br>
        小兔：靠夭～小狼，你這話說得跟我媽的夜市攤位一樣有味道！
      </div>
    </main>
  </div>
  <footer>
    SQL 夜市大冒險 &copy; 2025
  </footer>

  <script>
    // =============================
    // 模擬 SQL 夜市大冒險的 JS 部分
    // =============================
    
    const outputArea = document.getElementById('outputArea');
    const dialogueBox = document.getElementById('dialogueBox');
    const dbStructureDiv = document.getElementById('dbStructure');
    
    // 模擬資料庫物件
    let db = {
      name: "",
      tables: {}
    };
    
    // 更新輸出區域（模擬 SQL 指令輸出）
    function logOutput(text) {
      outputArea.textContent += text + "\n";
      outputArea.scrollTop = outputArea.scrollHeight;
    }
    
    // 更新劇情對話
    function updateDialogue(speaker, message) {
      dialogueBox.innerHTML = `<strong>${speaker}</strong>：${message}`;
    }
    
    // 更新左側資料庫結構展示
    function updateDBStructure() {
      dbStructureDiv.innerHTML = "";
      if (!db.name) {
        dbStructureDiv.innerHTML = "<p>資料庫尚未建立！</p>";
        return;
      }
      const dbTitle = document.createElement("p");
      dbTitle.textContent = "資料庫：" + db.name;
      dbTitle.style.fontWeight = "bold";
      dbStructureDiv.appendChild(dbTitle);
      for (let tableName in db.tables) {
        const tableDiv = document.createElement("div");
        tableDiv.className = "db-table fade-in";
        const tableTitle = document.createElement("h3");
        tableTitle.textContent = tableName;
        tableDiv.appendChild(tableTitle);
        const ul = document.createElement("ul");
        db.tables[tableName].columns.forEach(col => {
          const li = document.createElement("li");
          li.textContent = col;
          ul.appendChild(li);
        });
        tableDiv.appendChild(ul);
        dbStructureDiv.appendChild(tableDiv);
      }
    }
    
    // -------------------------------
    // 1. 資料庫結構（DDL）模擬
    // -------------------------------
    
    // 建立夜市資料庫
    document.getElementById('btnCreateDB').addEventListener('click', () => {
      db.name = "NightMarket";
      db.tables = {};  // 重置所有攤位
      logOutput("CREATE DATABASE NightMarket;\nUSE NightMarket;");
      updateDialogue("小狼", "夜市資料庫建立成功，你這 SQL 小白，趕緊動手！");
      updateDBStructure();
    });
    
    // 建立攤位（建立 users 與 orders 表）
    document.getElementById('btnCreateTables').addEventListener('click', () => {
      if (!db.name) {
        logOutput("請先建立資料庫！");
        updateDialogue("小狼", "沒夜市資料庫，哪來攤位？先建立再說！");
        return;
      }
      // 建立 users 攤位
      db.tables["users"] = {
        columns: [
          "user_id INT PRIMARY KEY AUTO_INCREMENT",
          "name VARCHAR(50) NOT NULL",
          "email VARCHAR(100) UNIQUE",
          "reg_date DATE DEFAULT CURRENT_DATE"
        ]
      };
      // 建立 orders 攤位
      db.tables["orders"] = {
        columns: [
          "order_id INT PRIMARY KEY AUTO_INCREMENT",
          "order_date DATETIME DEFAULT CURRENT_TIMESTAMP",
          "user_id INT",
          "total DECIMAL(10,2) CHECK(total >= 0)",
          "FOREIGN KEY (user_id) REFERENCES users(user_id)"
        ]
      };
      logOutput(`-- 創建 "users" 攤位
CREATE TABLE users (
    user_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE,
    reg_date DATE DEFAULT CURRENT_DATE
);
-- 創建 "orders" 攤位
CREATE TABLE orders (
    order_id INT PRIMARY KEY AUTO_INCREMENT,
    order_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    user_id INT,
    total DECIMAL(10,2) CHECK(total >= 0),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);`);
      updateDialogue("小狼", "攤位創建成功，每個攤位的菜單都整整齊齊！");
      updateDBStructure();
    });
    
    // 修改攤位（ALTER TABLE，新增聯絡電話）
    document.getElementById('btnAlterTable').addEventListener('click', () => {
      if (!db.tables["users"]) {
        logOutput("尚未建立 'users' 攤位！");
        updateDialogue("小狼", "沒有攤位怎麼改？先創建攤位再來動手！");
        return;
      }
      db.tables["users"].columns.push("phone VARCHAR(20)");
      logOutput("ALTER TABLE users ADD COLUMN phone VARCHAR(20);");
      updateDialogue("小狼", "聯絡電話已加，攤位菜單更完整了！");
      updateDBStructure();
    });
    
    // 刪除攤位（DROP TABLE 模擬）
    document.getElementById('btnDropTable').addEventListener('click', () => {
      logOutput("DROP TABLE IF EXISTS old_products;");
      updateDialogue("小狼", "舊攤位已收攤，記得別手滑砍掉重要攤位！");
    });
    
    // -------------------------------
    // 2. 資料操作（DML）模擬
    // -------------------------------
    
    // 新增資料（INSERT 模擬）
    document.getElementById('btnInsertData').addEventListener('click', () => {
      logOutput("-- 新增使用者（攤主上新貨）\nINSERT INTO users (name, email, phone) VALUES ('Alice', 'alice@example.com', '0912345678');");
      logOutput("-- 新增訂單：客人下單，總金額 199.99 元\nINSERT INTO orders (user_id, total) VALUES (1, 199.99);");
      updateDialogue("小狼", "新貨到！攤位上的小吃上架成功！");
    });
    
    // 查詢資料（SELECT 模擬）
    document.getElementById('btnSelectData').addEventListener('click', () => {
      logOutput("-- 查詢攤位上的所有使用者資料\nSELECT * FROM users;");
      updateDialogue("小狼", "查詢完成，攤位清單已展示！");
    });
    
    // 更新資料（UPDATE 模擬）
    document.getElementById('btnUpdateData').addEventListener('click', () => {
      logOutput("-- 更新：Alice 的聯絡電話改版\nUPDATE users SET phone = '0987654321' WHERE name = 'Alice';");
      updateDialogue("小狼", "電話更新成功，就像換新號碼一樣！");
    });
    
    // 刪除資料（DELETE 模擬）
    document.getElementById('btnDeleteData').addEventListener('click', () => {
      logOutput("-- 刪除：某筆訂單取消，下架清空\nDELETE FROM orders WHERE order_id = 1;");
      updateDialogue("小狼", "訂單下架成功，操作時務必小心！");
    });
    
    // -------------------------------
    // 3. 進階功能模擬
    // -------------------------------
    
    // 3.1 排序功能（ORDER BY）
    document.getElementById('btnSortData').addEventListener('click', () => {
      logOutput("-- 按使用者名稱升冪排序\nSELECT * FROM users ORDER BY name ASC;");
      logOutput("-- 多層排序：先依訂單總金額降冪，再按訂單日期升冪\nSELECT * FROM orders ORDER BY total DESC, order_date ASC;");
      updateDialogue("小狼", "排序完成！這排列比明星紅毯還有條理！");
    });
    
    // 3.2 JOIN 與 UNION
    document.getElementById('btnJoinUnion').addEventListener('click', () => {
      logOutput("-- 內部聯結：查詢每個訂單的攤主姓名與訂單日期\nSELECT u.name, o.order_date, o.total FROM users u INNER JOIN orders o ON u.user_id = o.user_id;");
      logOutput("-- UNION：合併兩個攤位資料，去除重複\nSELECT name, email FROM users UNION SELECT name, email FROM old_users;");
      updateDialogue("小狼", "攤位聯手，套餐組合搞定！");
    });
    
    // 3.3 群組統計與篩選（GROUP BY / HAVING）
    document.getElementById('btnGroupBy').addEventListener('click', () => {
      logOutput("-- 統計每個攤位的訂單數量，只顯示有銷售的攤位\nSELECT u.name, COUNT(o.order_id) AS order_count FROM users u LEFT JOIN orders o ON u.user_id = o.user_id GROUP BY u.user_id, u.name HAVING COUNT(o.order_id) > 0;");
      updateDialogue("小狼", "統計完畢！哪家攤位人氣爆棚，排行榜出爐！");
    });
    
    // 3.4 子查詢與嵌套查詢
    document.getElementById('btnSubQuery').addEventListener('click', () => {
      logOutput("-- 查詢訂單總金額大於所有訂單平均值的攤主\nSELECT name, total FROM orders WHERE total > (SELECT AVG(total) FROM orders);");
      updateDialogue("小狼", "內幕查詢完成，這查詢深度比夜市迷宮還複雜！");
    });
    
    // 3.5 Window Functions（即時排名）
    document.getElementById('btnWindowFunc').addEventListener('click', () => {
      logOutput("-- 為訂單按總金額排名，顯示累計排名\nSELECT order_id, total, RANK() OVER (ORDER BY total DESC) AS rank FROM orders;");
      updateDialogue("小狼", "即時排行榜展示中！");
    });
    
    // 3.6 交易控制（Transaction）
    document.getElementById('btnTransaction').addEventListener('click', () => {
      logOutput("-- 模擬轉帳交易\nSTART TRANSACTION;\n    UPDATE accounts SET balance = balance - 500 WHERE user_id = 1;\n    UPDATE accounts SET balance = balance + 500 WHERE user_id = 2;\nCOMMIT;");
      updateDialogue("小狼", "交易控制成功，所有操作全有或全無！");
    });
    
    // 3.7 儲存程序、觸發器與檢視表
    document.getElementById('btnProcTrigger').addEventListener('click', () => {
      logOutput("-- 儲存程序：設定自動折扣促銷\nDELIMITER $$\nCREATE PROCEDURE auto_discount()\nBEGIN\n    UPDATE products SET price = price * 0.9 WHERE stock > 100;\nEND $$\nDELIMITER ;");
      logOutput("-- 觸發器：新訂單插入後自動通知\nDELIMITER $$\nCREATE TRIGGER after_order_insert\nAFTER INSERT ON orders\nFOR EACH ROW\nBEGIN\n    INSERT INTO notifications(message) VALUES (CONCAT('新訂單來了！訂單編號：', NEW.order_id));\nEND $$\nDELIMITER ;");
      logOutput("-- 檢視表：建立人氣排行榜檢視表\nCREATE VIEW popular_users AS\nSELECT u.name, COUNT(o.order_id) AS orders_count FROM users u JOIN orders o ON u.user_id = o.user_id GROUP BY u.user_id, u.name HAVING COUNT(o.order_id) > 5;");
      updateDialogue("小狼", "自動促銷與觸發器設定完畢，完全自動化！");
    });
    
    // 3.8 索引與權限管理
    document.getElementById('btnIndexPerm').addEventListener('click', () => {
      logOutput("-- 建立索引，加速查詢\nCREATE INDEX idx_users_email ON users (email);");
      logOutput("-- 權限管理：授權攤位助理操作\nGRANT SELECT, INSERT, UPDATE ON NightMarket.* TO 'assistant_user'@'localhost' IDENTIFIED BY 'secret';");
      logOutput("-- 收回權限\nREVOKE UPDATE ON NightMarket.orders FROM 'assistant_user'@'localhost';");
      updateDialogue("小狼", "索引與權限管理搞定，資料庫運行如夜市保全！");
    });
    
    // -------------------------------
    // 4. PHP 與 SQL 整合示範（僅展示程式碼）
    // -------------------------------
    // 此部分僅供參考，不作互動
    function showPHPCode() {
      logOutput(`<?php
// 資料庫連線設定
$host = 'localhost';
$user = 'root';
$pass = '你的密碼';
$db   = 'NightMarket';

$conn = new mysqli($host, $user, $pass, $db);
if ($conn->connect_error) {
    die('連線失敗: ' . $conn->connect_error);
}

// 查詢所有使用者
$sql = 'SELECT * FROM users ORDER BY name ASC';
$result = $conn->query($sql);

// 新增、更新、刪除操作...
$conn->close();
?>`);
      updateDialogue("小狼", "PHP 與 SQL 整合示範展示完畢，點外賣操作簡單高效！");
    }
    
    // 如果需要，可額外新增一個按鈕來呼叫 showPHPCode()
    
  </script>
</body>
</html>