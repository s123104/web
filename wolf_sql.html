<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL 夜市大冒險 - ICON 風格版</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Caveat:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash/4.17.21/lodash.min.js"></script>
    <style>
        /* CSS 樣式整合到 HTML 檔案中 */
        :root {
            --stall-primary: #ff9234;
            --stall-secondary: #ffcd3c;
            --text-light: #f1f2f6;
            --text-dark: #2f3542;
            --neon-red: #ff4757;
            --neon-blue: #70a1ff;
            --neon-green: #2ed573;
            --neon-red-rgb: 255, 71, 87;
            --neon-blue-rgb: 112, 161, 255;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans TC', sans-serif;
            scroll-behavior: smooth;
        }

        body {
            background: #1a1a1a url('images/bg_nightmarket_simplified.jpg') center/cover fixed; /* 簡化夜市背景圖 */
            color: var(--text-light);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        .game-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: -1;
        }

        .game-background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('images/bg_lights_simplified.jpg') center/cover; /* 簡化燈光效果疊加圖 */
            opacity: 0.4;
            animation: subtleLightMovement 30s linear infinite;
        }

        @keyframes subtleLightMovement {
            0% { transform: translateX(0); }
            50% { transform: translateX(10%); }
            100% { transform: translateX(0); }
        }

        .game-ui {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .screen {
            display: none;
            width: 90%;
            max-width: 960px;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }


        /* 入口畫面樣式 */
        #entrance-screen {
            background-color: rgba(20, 20, 20, 0.9);
            border: 2px solid var(--neon-red);
            box-shadow: 0 0 50px var(--neon-red);
        }

        .game-logo {
            font-size: 4rem;
            font-family: 'Caveat', cursive;
            font-weight: bold;
            color: var(--text-light);
            text-shadow:
                0 0 8px var(--neon-red),
                0 0 15px var(--neon-red),
                0 0 30px var(--neon-red);
            margin-bottom: 2rem;
            animation: neonFlickerLogo 2s infinite alternate, increaseSizeLogo 4s ease-in-out infinite alternate;
        }

        @keyframes increaseSizeLogo {
            0% { transform: scale(1); }
            100% { transform: scale(1.03); }
        }

        @keyframes neonFlickerLogo {
            0%, 15%, 20%, 23%, 48%, 53%, 100% {
                text-shadow:
                    0 0 8px var(--neon-red),
                    0 0 15px var(--neon-red),
                    0 0 30px var(--neon-red);
            }
            18%, 21%, 50% {
                text-shadow: none;
                color: var(--text-light);
            }
        }


        #start-game-btn {
            background-color: var(--neon-green);
            color: var(--text-dark);
            border: none;
            padding: 1.5rem 3rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.5rem;
            font-weight: bold;
            transition: all 0.3s ease;
            letter-spacing: 1px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.5);
        }

        #start-game-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.6);
        }

        #start-game-btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        }


        /* 地圖畫面樣式 */
        #map-screen {
            background-color: rgba(20, 20, 20, 0.9);
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 40px var(--neon-blue);
            position: relative;
        }

        #map-screen::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: inherit;
            box-shadow: 0 0 30px var(--neon-blue);
            opacity: 0.6;
            z-index: -1;
        }


        .map-area {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
            justify-content: center;
        }

        .stall-icon {
            background-color: rgba(255,255,255,0.08);
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            font-size: 1.2rem;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-light);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.6);
            display: flex; /* 讓 icon 和 文字垂直對齊 */
            flex-direction: column; /* 垂直排列 icon 和 文字 */
            align-items: center;
            justify-content: center;
        }

        .stall-icon i {
            font-size: 2.5rem; /* ICON 尺寸 */
            margin-bottom: 0.5rem; /* ICON 和文字間距 */
        }


        .stall-icon:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 15px rgba(0,0,0,0.4);
            background-color: rgba(255,255,255,0.15);
        }

        .stall-icon:active {
            transform: translateY(0) scale(1);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }


        .database-info-icon, .progress-tracker {
            background-color: rgba(20, 20, 20, 0.8);
            color: var(--text-light);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            margin: 0.5rem;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
            display: inline-flex; /* 讓 icon 和 文字水平對齊 */
            align-items: center; /* 垂直置中對齊 */
            gap: 0.5rem; /* icon 和文字間距 */
        }

        .database-info-icon:hover, .progress-tracker:hover {
            background-color: rgba(20, 20, 20, 0.95);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.4);
        }

        .database-info-icon:active, .progress-tracker:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }


        /* 攤位畫面樣式 */
        .stall-screen {
            background-color: rgba(20, 20, 20, 0.9);
            border: 2px solid var(--neon-red);
            box-shadow: 0 0 50px var(--neon-red);
            position: relative;
            overflow: hidden;
        }

        .stall-screen::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: inherit;
            box-shadow: 0 0 40px var(--neon-red);
            opacity: 0.7;
            z-index: -1;
        }

        .stall-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 30%; /* 背景高度 */
            background-size: cover;
            background-position: center bottom;
            opacity: 0.7;
            filter: grayscale(80%); /* 灰階化背景，更強調ICON人物 */
        }

        .select-bg { background-image: url('images/stall_ramen_simplified.jpg'); } /* 簡化攤位背景圖 */
        .join-bg { background-image: url('images/stall_sushi_simplified.jpg'); }
        .drink-bg { background-image: url('images/stall_drink_simplified.jpg'); }
        .icecream-bg { background-image: url('images/stall_icecream_simplified.jpg'); }
        .tea-bg { background-image: url('images/stall_tea_simplified.jpg'); }
        .bbq-bg { background-image: url('images/stall_bbq_simplified.jpg'); }


        .stall-boss {
            position: absolute;
            top: 15%;
            left: 10%;
            transform: translateY(-50%);
            width: 120px; /* 老闆頭像寬度調整 */
            display: flex; /* 使用 Flexbox 讓 ICON 置中 */
            justify-content: center;
            align-items: center;
            height: 120px; /*  老闆頭像高度調整, 與寬度一致以維持圓形 */
            border-radius: 50%;
            background-color: rgba(255,255,255,0.1); /* ICON 頭像背景 */
            border: 3px solid var(--stall-secondary);
            box-shadow: 0 5px 10px rgba(0,0,0,0.5);
        }

        .stall-boss i {
            font-size: 4rem; /* 老闆ICON 尺寸 */
            color: var(--stall-primary); /* 老闆ICON 顏色 */
            text-shadow: 0 0 5px var(--stall-secondary); /*  ICON 陰影 */
        }


        .dialogue-box {
            background-color: rgba(30, 30, 30, 0.95);
            color: var(--text-light);
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 1rem;
            box-shadow: 0 5px 10px rgba(0,0,0,0.6);
            position: relative;
        }

        .dialogue-box::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 30px;
            border-bottom: 10px solid rgba(30, 30, 30, 0.95);
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
        }


        .dialogue-text {
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 1rem;
        }

        .task-description {
            background-color: rgba(255,255,255,0.05);
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--neon-green);
            border: 1px dashed var(--neon-green);
        }


        /* SQL 編輯器樣式 */
        .sql-editor-area {
            background-color: rgba(20, 20, 20, 0.9);
            border-radius: 10px;
            margin-top: 2rem;
            padding: 1.5rem;
            box-shadow: inset 0 3px 6px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
        }

        .sql-input {
            background-color: #3a4252;
            color: #f8f8f2;
            border: none;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            line-height: 1.5;
            min-height: 100px;
            resize: vertical;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
            outline: none; /* 移除 focus 時的預設邊框 */
        }

        .sql-input:focus {
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5); /* focus 時陰影更明顯 */
        }


        .run-sql-btn, .hint-btn {
            background-color: var(--neon-blue);
            color: var(--text-dark);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-top: 1rem;
            align-self: flex-start; /* 按鈕靠左對齊 */
            box-shadow: 0 3px 6px rgba(0,0,0,0.4);
        }

        .run-sql-btn:hover, .hint-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.5);
        }

        .run-sql-btn:active, .hint-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.4);
        }

        .hint-btn {
            background-color: var(--stall-secondary); /* 提示按鈕顏色不同 */
            color: var(--text-dark);
            margin-left: 0.5rem;
        }


        /* 結果展示區樣式 */
        .result-area {
            background-color: rgba(20, 20, 20, 0.95);
            border: 2px solid var(--neon-green);
            border-radius: 10px;
            margin-top: 2rem;
            padding: 1.5rem;
            box-shadow: 0 0 30px rgba(var(--neon-green-rgb), 0.5);
            overflow-x: auto; /* 水平滾動條 */
        }

        .result-title {
            color: var(--text-light);
            font-size: 1.2rem;
            margin-bottom: 1rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .sample-result table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .sample-result th, .sample-result td {
            border: 1px solid rgba(255,255,255,0.1);
            padding: 0.7rem;
            text-align: left;
            font-size: 0.95rem;
        }

        .sample-result th {
            background-color: rgba(255,255,255,0.05);
            font-weight: bold;
        }


        /* 獎勵顯示樣式 */
        .reward-display {
            background-color: var(--stall-secondary);
            color: var(--text-dark);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-top: 1.5rem;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
            animation: rewardPopUp 0.5s ease-out; /* 獎勵彈出動畫 */
        }

        @keyframes rewardPopUp {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }


        /* 資料庫結構畫面樣式 */
        #database-screen {
            background-color: rgba(20, 20, 20, 0.95);
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 40px var(--neon-blue);
            text-align: left; /* 調整文字對齊方式 */
            overflow-y: auto; /* 垂直滾動條，如果內容過長 */
        }


        .database-title {
            font-size: 2rem;
            color: var(--text-light);
            margin-bottom: 1.5rem;
            text-align: center; /* 標題置中 */
            text-shadow: 2px 2px 3px rgba(0,0,0,0.5);
        }

        .er-diagram-area {
            max-width: 100%;
            overflow-x: auto; /* 水平滾動條，如果圖片過寬 */
            margin-bottom: 1.5rem;
            text-align: center; /* 圖片置中 */
        }

        .er-diagram-area img {
            max-width: 100%;
            height: auto;
            box-shadow: 0 5px 10px rgba(0,0,0,0.5);
            border-radius: 8px;
        }

        .table-browser-area {
            margin-bottom: 2rem;
        }

        .table-selector {
            display: flex;
            flex-wrap: wrap; /* 手機上自動換行 */
            gap: 0.5rem;
            margin-bottom: 1rem;
            justify-content: center; /* 按鈕置中 */
        }

        .table-selector button {
            background-color: var(--neon-blue);
            color: var(--text-dark);
            border: none;
            padding: 0.7rem 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.3s ease;
            font-size: 0.9rem;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
        }

        .table-selector button:hover {
            background-color: var(--neon-blue-rgb); /* Hover 時稍微變亮 */
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.4);
        }

        .table-selector button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }


        .table-schema-display {
            background-color: rgba(30, 30, 30, 0.9);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.6;
            overflow-x: auto; /* 表格寬度超出時顯示水平滾動條 */
            white-space: pre-wrap; /* 保留換行和空格 */
            font-family: 'Courier New', monospace; /* 使用等寬字體 */
        }


        .back-to-map-btn {
            background-color: var(--neon-green);
            color: var(--text-dark);
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            letter-spacing: 1px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            margin-top: 2rem;
        }

        .back-to-map-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        .back-to-map-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }


        /* 提示訊息框樣式 */
        #hint-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(20, 20, 20, 0.98);
            border: 2px solid var(--stall-secondary);
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 8px 20px rgba(0,0,0,0.7);
            z-index: 100;
            min-width: 300px;
            text-align: center;
            animation: hintPopIn 0.3s ease-out; /* 提示彈入動畫 */
        }

        @keyframes hintPopIn {
            0% {
                transform: translate(-50%, -60%) scale(0.8);
                opacity: 0;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }


        .hint-content {
            color: var(--text-light);
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        #close-hint-btn {
            background-color: var(--stall-primary);
            color: var(--text-dark);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 3px 6px rgba(0,0,0,0.4);
        }

        #close-hint-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.5);
        }

        #close-hint-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.4);
        }


        /* 隱藏和顯示通用類別 */
        .hidden {
            display: none !important;
        }

        /* 完成攤位樣式 */
        .stall-icon.completed {
            opacity: 0.7; /* 完成攤位稍微降低不透明度 */
            filter: grayscale(100%); /* 完成攤位灰階化 */
        }


        /* 行動裝置適配 */
        @media (max-width: 768px) {
            .screen {
                width: 95%;
                padding: 1.5rem;
                border-radius: 10px;
            }

            .game-logo {
                font-size: 3rem;
                margin-bottom: 1.5rem;
            }

            #start-game-btn {
                padding: 1.2rem 2.5rem;
                font-size: 1.2rem;
            }

            .map-area {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 1rem;
                margin-bottom: 1.5rem;
            }

            .stall-icon {
                padding: 1rem;
                font-size: 1rem;
            }

            .database-info-icon, .progress-tracker {
                padding: 0.8rem 1.2rem;
                font-size: 0.9rem;
                margin: 0.3rem;
            }

            .stall-boss {
                width: 120px;
                top: 10%;
            }

            .dialogue-box {
                padding: 1.2rem;
                border-radius: 8px;
                margin-top: 1rem;
            }

            .dialogue-text {
                font-size: 1rem;
            }

            .task-description {
                padding: 0.8rem;
                font-size: 0.8rem;
            }

            .sql-editor-area {
                padding: 1.2rem;
                margin-top: 1.5rem;
            }

            .sql-input {
                padding: 0.8rem;
                font-size: 0.9rem;
                min-height: 80px;
            }

            .run-sql-btn, .hint-btn {
                padding: 0.7rem 1.2rem;
                font-size: 1rem;
                margin-top: 0.8rem;
            }

            .result-area {
                border-radius: 8px;
                margin-top: 1.5rem;
                padding: 1.2rem;
            }

            .result-title {
                font-size: 1.1rem;
                margin-bottom: 0.8rem;
            }

            .sample-result th, .sample-result td {
                padding: 0.6rem;
                font-size: 0.9rem;
            }

            .reward-display {
                padding: 0.8rem 1.2rem;
                font-size: 0.9rem;
                margin-top: 1rem;
            }

            #database-screen {
                padding: 1.5rem;
            }

            .database-title {
                font-size: 1.8rem;
                margin-bottom: 1.2rem;
            }

            .table-selector button {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
            }

            .table-schema-display {
                padding: 1.2rem;
                font-size: 0.9rem;
            }

            .back-to-map-btn {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
                margin-top: 1.5rem;
            }

            #hint-box {
                padding: 1.5rem;
                border-radius: 8px;
                min-width: auto; /* 移除最小寬度限制 */
                width: 85%; /* 螢幕寬度的 85% */
                max-width: 400px; /* 最大寬度限制 */
            }

            .hint-content {
                font-size: 0.95rem;
                margin-bottom: 1.2rem;
            }

            #close-hint-btn {
                padding: 0.7rem 1.2rem;
                font-size: 0.9rem;
            }
        }


    </style>

</head>
<body>
    <div class="game-container">
        <div class="game-background"></div>

        <div class="game-ui">
            <div id="entrance-screen" class="screen active">
                <h1 class="game-logo">SQL 夜市大冒險</h1>
                <button id="start-game-btn">開始冒險</button>
            </div>

            <div id="map-screen" class="screen hidden">
                <div class="map-area">
                    <div class="stall-icon select-stall" data-stall="select-stall" onclick="showStall('select-stall')">
                        <i class="fa-solid fa-bowl-food"></i>  查詢小館
                    </div>
                    <div class="stall-icon join-stall" data-stall="join-stall" onclick="showStall('join-stall')">
                        <i class="fa-solid fa-handshake-angle"></i> 關聯餐館
                    </div>
                    <div class="stall-icon groupby-stall" data-stall="groupby-stall" onclick="showStall('groupby-stall')">
                        <i class="fa-solid fa-filter"></i> 特調飲品吧
                    </div>
                    <div class="stall-icon insert-stall" data-stall="insert-stall" onclick="showStall('insert-stall')">
                        <i class="fa-solid fa-plus"></i> 創意冰品店
                    </div>
                    <div class="stall-icon update-stall" data-stall="update-stall" onclick="showStall('update-stall')">
                        <i class="fa-solid fa-pen-to-square"></i> 復古茶飲鋪
                    </div>
                    <div class="stall-icon delete-stall" data-stall="delete-stall" onclick="showStall('delete-stall')">
                        <i class="fa-solid fa-trash-can"></i> 香辣串烤攤
                    </div>
                </div>
                <div class="database-info-icon" onclick="showDatabaseInfo()"> <i class="fa-solid fa-database"></i> 資料庫結構</div>
                <div class="progress-tracker">進度： <span id="progress-count">0</span> / 6 關卡完成</div>
            </div>

            <div id="select-stall" class="stall-screen screen hidden" data-stall-type="select">
                <div class="stall-background select-bg"></div>
                <div class="stall-boss">
                    <i class="fa-solid fa-user-chef"></i>  </div>
                <div class="dialogue-box">
                    <p class="dialogue-text">歡迎來到查詢小館！想學點厲害的 SQL 查詢術嗎？今天先從基礎的 `SELECT` 語法開始，讓我來考考你！</p>
                    <div class="task-description">任務：學習使用 SELECT 語法查詢菜單</div>
                </div>

                <div class="sql-editor-area">
                    <textarea id="sql-input-select" class="sql-input" placeholder="請輸入 SQL 語法"></textarea>
                    <button class="run-sql-btn" onclick="demonstrateSelect('select-stall')">執行 SQL</button>
                    <button class="hint-btn" onclick="showHint('select')">提示</button>
                </div>

                <div id="sql-result-select-stall" class="result-area hidden">
                    <h4 class="result-title">範例結果</h4>
                    <div class="sample-result">
                        <p>點擊 "執行 SQL" 按鈕，即可在此區域顯示 SQL 語法和執行結果範例。</p>
                    </div>
                </div>
                <div id="reward-select-stall" class="reward-display hidden">獎勵：夜市幣 +10</div>
            </div>

             <div id="join-stall" class="stall-screen screen hidden" data-stall-type="join">
                <div class="stall-background join-bg"></div>
                <div class="stall-boss">
                    <i class="fa-solid fa-fish-burger"></i> </div>
                <div class="dialogue-box">
                    <p class="dialogue-text">歡迎光臨關聯餐館！想讓你的查詢更上一層樓嗎？`JOIN` 語法是必學的技巧！準備好挑戰了嗎？</p>
                    <div class="task-description">任務：學習使用 JOIN 語法關聯不同表格</div>
                </div>

                <div class="sql-editor-area">
                    <textarea id="sql-input-join" class="sql-input" placeholder="請輸入 SQL 語法"></textarea>
                    <button class="run-sql-btn" onclick="demonstrateJoin('join-stall')">執行 SQL</button>
                    <button class="hint-btn" onclick="showHint('join')">提示</button>
                </div>

                <div id="sql-result-join-stall" class="result-area hidden">
                    <h4 class="result-title">範例結果</h4>
                    <div class="sample-result">
                        <p>點擊 "執行 SQL" 按鈕，即可在此區域顯示 SQL 語法和執行結果範例。</p>
                    </div>
                </div>
                <div id="reward-join-stall" class="reward-display hidden">獎勵：夜市幣 +15</div>
            </div>

            <div id="groupby-stall" class="stall-screen screen hidden" data-stall-type="groupby">
                <div class="stall-background drink-bg"></div>
                <div class="stall-boss">
                    <i class="fa-solid fa-cocktail"></i> </div>
                <div class="dialogue-box">
                    <p class="dialogue-text">歡迎來到特調飲品吧！想知道如何整理分析銷售資料嗎？`GROUP BY` 語法讓你一目瞭然！來試試看吧！</p>
                    <div class="task-description">任務：學習使用 GROUP BY 語法進行分組查詢</div>
                </div>

                <div class="sql-editor-area">
                    <textarea id="sql-input-groupby" class="sql-input" placeholder="請輸入 SQL 語法"></textarea>
                    <button class="run-sql-btn" onclick="demonstrateGroupBy('groupby-stall')">執行 SQL</button>
                    <button class="hint-btn" onclick="showHint('groupby')">提示</button>
                </div>

                <div id="sql-result-groupby-stall" class="result-area hidden">
                    <h4 class="result-title">範例結果</h4>
                    <div class="sample-result">
                        <p>點擊 "執行 SQL" 按鈕，即可在此區域顯示 SQL 語法和執行結果範例。</p>
                    </div>
                </div>
                <div id="reward-groupby-stall" class="reward-display hidden">獎勵：夜市幣 +20</div>
            </div>

            <div id="insert-stall" class="stall-screen screen hidden" data-stall-type="insert">
                <div class="stall-background icecream-bg"></div>
                <div class="stall-boss">
                    <i class="fa-solid fa-ice-cream"></i> </div>
                <div class="dialogue-box">
                    <p class="dialogue-text">歡迎來到創意冰品店！想讓你的資料庫更有活力嗎？學會 `INSERT` 語法，為你的資料庫添加新成員吧！準備好了嗎？</p>
                    <div class="task-description">任務：學習使用 INSERT 語法新增資料</div>
                </div>

                <div class="sql-editor-area">
                    <textarea id="sql-input-insert" class="sql-input" placeholder="請輸入 SQL 語法"></textarea>
                    <button class="run-sql-btn" onclick="demonstrateInsert('insert-stall')">執行 SQL</button>
                    <button class="hint-btn" onclick="showHint('insert')">提示</button>
                </div>

                <div id="sql-result-insert-stall" class="result-area hidden">
                    <h4 class="result-title">範例結果</h4>
                    <div class="sample-result">
                        <p>點擊 "執行 SQL" 按鈕，即可在此區域顯示 SQL 語法和執行結果範例。</p>
                    </div>
                </div>
                <div id="reward-insert-stall" class="reward-display hidden">獎勵：夜市幣 +20</div>
            </div>

            <div id="update-stall" class="stall-screen screen hidden" data-stall-type="update">
                <div class="stall-background tea-bg"></div>
                <div class="stall-boss">
                    <i class="fa-solid fa-mug-hot"></i> </div>
                <div class="dialogue-box">
                    <p class="dialogue-text">歡迎來到復古茶飲鋪！有時候資料也需要更新，才能跟上時代的潮流！`UPDATE` 語法讓你輕鬆修改資料！來試試身手吧！</p>
                    <div class="task-description">任務：學習使用 UPDATE 語法更新資料</div>
                </div>

                <div class="sql-editor-area">
                    <textarea id="sql-input-update" class="sql-input" placeholder="請輸入 SQL 語法"></textarea>
                    <button class="run-sql-btn" onclick="demonstrateUpdate('update-stall')">執行 SQL</button>
                    <button class="hint-btn" onclick="showHint('update')">提示</button>
                </div>

                <div id="sql-result-update-stall" class="result-area hidden">
                    <h4 class="result-title">範例結果</h4>
                    <div class="sample-result">
                        <p>點擊 "執行 SQL" 按鈕，即可在此區域顯示 SQL 語法和執行結果範例。</p>
                    </div>
                </div>
                <div id="reward-update-stall" class="reward-display hidden">獎勵：夜市幣 +25</div>
            </div>

            <div id="delete-stall" class="stall-screen screen hidden" data-stall-type="delete">
                <div class="stall-background bbq-bg"></div>
                <div class="stall-boss">
                    <i class="fa-solid fa-fire"></i> </div>
                <div class="dialogue-box">
                    <p class="dialogue-text">歡迎來到香辣串烤攤！資料庫也需要定期清理，才能保持乾淨整潔！`DELETE` 語法讓你學會如何移除不再需要的資料！準備好面對挑戰了嗎？</p>
                    <div class="task-description">任務：學習使用 DELETE 語法刪除資料</div>
                </div>

                <div class="sql-editor-area">
                    <textarea id="sql-input-delete" class="sql-input" placeholder="請輸入 SQL 語法"></textarea>
                    <button class="run-sql-btn" onclick="demonstrateDelete('delete-stall')">執行 SQL</button>
                    <button class="hint-btn" onclick="showHint('delete')">提示</button>
                </div>

                <div id="sql-result-delete-stall" class="result-area hidden">
                    <h4 class="result-title">範例結果</h4>
                    <div class="sample-result">
                        <p>點擊 "執行 SQL" 按鈕，即可在此區域顯示 SQL 語法和執行結果範例。</p>
                    </div>
                </div>
                <div id="reward-delete-stall" class="reward-display hidden">獎勵：夜市幣 +30</div>
            </div>

            <div id="database-screen" class="screen hidden">
                <h2 class="database-title">資料庫結構</h2>
                <div class="er-diagram-area">
                    <img src="images/er_diagram_simplified.png" alt="夜市資料庫 ER 圖"> </div>
                <div class="table-browser-area">
                    <div class="table-selector">
                        <button onclick="showTableSchema('menu')">菜單表 (menu)</button>
                        <button onclick="showTableSchema('categories')">分類表 (categories)</button>
                        <button onclick="showTableSchema('orders')">訂單表 (orders)</button>
                        <button onclick="showTableSchema('products')">產品表 (products)</button>
                        <button onclick="showTableSchema('customers')">顧客表 (customers)</button>
                    </div>
                    <div id="table-schema-display" class="table-schema-display">
                        <p>點擊上方按鈕，即可顯示表格結構。</p>
                    </div>
                </div>
                 <button class="back-to-map-btn" onclick="showMap()">返回地圖</button>
            </div>

            <div id="hint-box" class="hint-box hidden">
                <div class="hint-content">
                    <p id="hint-text">提示訊息會在這裡顯示。</p>
                    <button id="close-hint-btn">關閉提示</button>
                </div>
            </div>


        </div>
    </div>

    <script>
        // JavaScript 程式碼整合到 HTML 檔案中
        let completedStalls = []; // 追蹤已完成的攤位
        let nightMarketCoins = 0; // 夜市幣 (未來擴充用)

        document.addEventListener('DOMContentLoaded', () => {
            // 開始遊戲按鈕事件
            document.getElementById('start-game-btn').addEventListener('click', startGame);

            // 關閉提示訊息框按鈕事件
            document.getElementById('close-hint-btn').addEventListener('click', closeHint);

            // 初始化進度計數
            updateProgressCounter();
        });

        function startGame() {
            showMap(); // 顯示地圖畫面
        }

        function showMap() {
            hideAllScreens(); // 隱藏所有畫面
            document.getElementById('map-screen').classList.remove('hidden'); // 顯示地圖畫面
        }

        function showStall(stallId) {
            hideAllScreens(); // 隱藏所有畫面
            document.getElementById(stallId).classList.remove('hidden'); // 顯示特定攤位畫面
        }

        function showDatabaseInfo() {
            hideAllScreens();
            document.getElementById('database-screen').classList.remove('hidden'); // 顯示資料庫結構畫面
            showTableSchema('menu'); // 預設顯示菜單表結構
        }

        function hideAllScreens() {
            // 隱藏所有畫面
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => screen.classList.add('hidden'));
            // 隱藏所有結果展示區和獎勵訊息
            const results = document.querySelectorAll('.result-area, .reward-display');
            results.forEach(result => result.classList.add('hidden'));
        }

        function showHint(stallType) {
            const hintBox = document.getElementById('hint-box');
            const hintTextElement = document.getElementById('hint-text');
            let hintText = '';

            switch (stallType) {
                case 'select':
                    hintText = "提示：`SELECT` 語法用於從表格中選取欄位。試試看 `SELECT 菜名, 價格 FROM 菜單表;` ";
                    break;
                case 'join':
                    hintText = "提示：`JOIN` 語法用於聯結多個表格。想想看如何將 `菜單表` 和 `分類表` 聯結起來，顯示菜名和分類？";
                    break;
                case 'groupby':
                    hintText = "提示：`GROUP BY` 語法用於分組統計資料。試著用 `GROUP BY 產品類別` 來計算各類別的產品數量。";
                    break;
                 case 'insert':
                    hintText = "提示：`INSERT INTO` 語法用於新增資料。想想看語法結構 `INSERT INTO 表格名稱 (欄位1, 欄位2) VALUES (值1, 值2);` ";
                    break;
                case 'update':
                    hintText = "提示：`UPDATE` 語法用於更新資料。使用 `UPDATE 表格名稱 SET 欄位名稱 = 新值 WHERE 條件;` 來修改價格。";
                    break;
                case 'delete':
                    hintText = "提示：`DELETE FROM` 語法用於刪除資料。小心使用 `WHERE` 條件，避免誤刪所有資料！";
                    break;
                default:
                    hintText = "沒有提示。";
            }

            hintTextElement.textContent = hintText;
            hintBox.classList.remove('hidden'); // 顯示提示訊息框
        }

        function closeHint() {
            document.getElementById('hint-box').classList.add('hidden'); // 隱藏提示訊息框
        }


        function demonstrateSelect(stallId) {
            const resultDisplay = document.getElementById(`sql-result-${stallId}`);
            const rewardDisplay = document.getElementById(`reward-${stallId}`);
            let query = '';
            let explanation = '';
            let sampleTable = '';
            let stallType = document.getElementById(stallId).dataset.stallType; // 取得攤位類型

            if (stallType === 'select') {
                query = `SELECT 菜名, 價格 FROM 菜單表;`;
                explanation = '這個查詢會從 `菜單表` 中選取 `菜名` 和 `價格` 兩個欄位，顯示所有菜品的名稱和價格。';
                sampleTable = `
                    <table>
                        <tr><th>菜名</th><th>價格</th></tr>
                        <tr><td>炒飯</td><td>70</td></tr>
                        <tr><td>牛肉麵</td><td>120</td></tr>
                        <tr><td>珍珠奶茶</td><td>55</td></tr>
                    </table>
                `;
            }

            displayResult(resultDisplay, rewardDisplay, query, explanation, sampleTable, stallId);
        }


        function demonstrateJoin(stallId) {
            const resultDisplay = document.getElementById(`sql-result-${stallId}`);
            const rewardDisplay = document.getElementById(`reward-${stallId}`);
            let query = '';
            let explanation = '';
            let sampleTable = '';
             let stallType = document.getElementById(stallId).dataset.stallType; // 取得攤位類型

            if (stallType === 'join') {
                query = `SELECT m.菜名, c.分類名稱
                        FROM 菜單表 m
                        JOIN 分類表 c ON m.分類ID = c.分類ID;`;
                explanation = '這個查詢會聯結 `菜單表` 和 `分類表`，選取菜名和對應的分類名稱，顯示每道菜屬於哪個類別。';
                sampleTable = `
                    <table>
                        <tr><th>菜名</th><th>分類</th></tr>
                        <tr><td>炒飯</td><td>主食</td></tr>
                        <tr><td>牛肉麵</td><td>麵食</td></tr>
                        <tr><td>珍珠奶茶</td><td>飲品</td></tr>
                    </table>
                `;
            }
             displayResult(resultDisplay, rewardDisplay, query, explanation, sampleTable, stallId);
        }


        function demonstrateGroupBy(stallId) {
            const resultDisplay = document.getElementById(`sql-result-${stallId}`);
            const rewardDisplay = document.getElementById(`reward-${stallId}`);
            let query = '';
            let explanation = '';
            let sampleTable = '';
             let stallType = document.getElementById(stallId).dataset.stallType; // 取得攤位類型

            if (stallType === 'groupby') {
                query = `SELECT 分類, COUNT(*) AS 產品數量
                        FROM 產品表
                        GROUP BY 分類
                        ORDER BY 產品數量 DESC;`;
                explanation = '這個查詢會將 `產品表` 中的產品依照 `分類` 欄位分組，並計算每個分類的產品數量，再依產品數量由多到少排序。';
                sampleTable = `
                    <table>
                        <tr><th>分類</th><th>產品數量</th></tr>
                        <tr><td>串烤</td><td>12</td></tr>
                        <tr><td>飲品</td><td>8</td></tr>
                        <tr><td>冰品</td><td>5</td></tr>
                    </table>
                `;
            }
             displayResult(resultDisplay, rewardDisplay, query, explanation, sampleTable, stallId);
        }


        function demonstrateInsert(stallId) {
            const resultDisplay = document.getElementById(`sql-result-${stallId}`);
            const rewardDisplay = document.getElementById(`reward-${stallId}`);
            let query = '';
            let explanation = '';
            let sampleResult = '';
             let stallType = document.getElementById(stallId).dataset.stallType; // 取得攤位類型

            if (stallType === 'insert') {
                query = `INSERT INTO 顧客表 (姓名, 城市) VALUES ('小明', '高雄');`;
                explanation = '這個語法會在 `顧客表` 中新增一筆資料，姓名為 "小明"，城市為 "高雄"。';
                sampleResult = `<p>成功新增一筆顧客資料。</p><p>你可以到顧客表中查看新增的資料。</p>`;
            }
             displayResult(resultDisplay, rewardDisplay, query, explanation, sampleResult, stallId);
        }


        function demonstrateUpdate(stallId) {
            const resultDisplay = document.getElementById(`sql-result-${stallId}`);
            const rewardDisplay = document.getElementById(`reward-${stallId}`);
            let query = '';
            let explanation = '';
            let sampleResult = '';
             let stallType = document.getElementById(stallId).dataset.stallType; // 取得攤位類型

            if (stallType === 'update') {
                query = `UPDATE 產品表 SET 價格 = 65 WHERE 產品名稱 = '珍珠奶茶';`;
                explanation = '這個語法會將 `產品表` 中，產品名稱為 "珍珠奶茶" 的價格更新為 65 元。';
                sampleResult = `<p>成功更新產品資料。</p><p>你可以到產品表中查看珍珠奶茶的價格是否已更新。</p>`;
            }
             displayResult(resultDisplay, rewardDisplay, query, explanation, sampleResult, stallId);
        }


        function demonstrateDelete(stallId) {
            const resultDisplay = document.getElementById(`sql-result-${stallId}`);
            const rewardDisplay = document.getElementById(`reward-${stallId}`);
            let query = '';
            let explanation = '';
            let sampleResult = '';
             let stallType = document.getElementById(stallId).dataset.stallType; // 取得攤位類型

            if (stallType === 'delete') {
                query = `DELETE FROM 訂單表 WHERE 訂單日期 < '2023-01-01';`;
                explanation = '這個語法會從 `訂單表` 中，刪除所有訂單日期在 2023 年 1 月 1 日之前的訂單紀錄。';
                sampleResult = `<p>成功刪除符合條件的訂單紀錄。</p><p>你可以到訂單表中查看舊訂單是否已刪除。</p>`;
            }
             displayResult(resultDisplay, rewardDisplay, query, explanation, sampleResult, stallId);
        }


        function displayResult(resultDisplay, rewardDisplay, query, explanation, sampleContent, stallId) {
            resultDisplay.innerHTML = `
                <h4 class="result-title">SQL 語法範例：</h4>
                <div class="sql-code">${query}</div>
                <p>${explanation}</p>
                <div class="sample-result">${sampleContent}</div>
            `;
            resultDisplay.classList.remove('hidden'); // 顯示結果展示區
            rewardDisplay.classList.remove('hidden'); // 顯示獎勵訊息
            rewardDisplay.addEventListener('animationend', function() {
                rewardDisplay.classList.add('hidden'); // 動畫結束後隱藏獎勵訊息
            }, { once: true }); //  動畫只執行一次

            markStallAsComplete(stallId); // 標記攤位為已完成
            updateProgressCounter(); // 更新進度計數器
            scrollToResult(resultDisplay); // 滑動到結果區域
        }


        function scrollToResult(resultElement) {
            resultElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }


        function markStallAsComplete(stallId) {
            if (!completedStalls.includes(stallId)) {
                completedStalls.push(stallId); // 加入已完成攤位列表
            }
            const stallIcon = document.querySelector(`.stall-icon.${stallId}`);
            if (stallIcon) {
                stallIcon.classList.add('completed'); //  可以透過 CSS 加上完成標記
            }
        }

        function updateProgressCounter() {
            const progressCountElement = document.getElementById('progress-count');
            progressCountElement.textContent = completedStalls.length;
        }


        function showTableSchema(tableName) {
            const schemaDisplay = document.getElementById('table-schema-display');
            let schemaText = '';

            switch (tableName) {
                case 'menu':
                    schemaText = `表格名稱: 菜單表 (menu)\n\n欄位:\n- 菜名 (DishName) - VARCHAR\n- 價格 (Price) - INT\n- 分類ID (CategoryID) - INT (FK)`;
                    break;
                case 'categories':
                    schemaText = `表格名稱: 分類表 (categories)\n\n欄位:\n- 分類ID (CategoryID) - INT (PK)\n- 分類名稱 (CategoryName) - VARCHAR`;
                    break;
                case 'orders':
                    schemaText = `表格名稱: 訂單表 (orders)\n\n欄位:\n- 訂單ID (OrderID) - INT (PK)\n- 顧客ID (CustomerID) - INT (FK)\n- 菜單ID (MenuID) - INT (FK)\n- 訂單日期 (OrderDate) - DATE\n- 訂單數量 (OrderCount) - INT`;
                    break;
                 case 'products':
                    schemaText = `表格名稱: 產品表 (products)\n\n欄位:\n- 產品ID (ProductID) - INT (PK)\n- 產品名稱 (ProductName) - VARCHAR\n- 分類 (Category) - VARCHAR\n- 價格 (Price) - INT`;
                    break;
                case 'customers':
                    schemaText = `表格名稱: 顧客表 (customers)\n\n欄位:\n- 顧客ID (CustomerID) - INT (PK)\n- 姓名 (Name) - VARCHAR\n- 城市 (City) - VARCHAR`;
                    break;
                default:
                    schemaText = '點擊上方按鈕，即可顯示表格結構。';
            }

            schemaDisplay.textContent = schemaText;
        }

        function showMap() {
            hideAllScreens();
            document.getElementById('map-screen').classList.remove('hidden');
        }


    </script>
</body>
</html>
