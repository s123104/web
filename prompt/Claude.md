# 智慧 Prompt 生成器專案文件

## 概述
「智慧 Prompt 生成器」是一個純本地運行的網頁工具，旨在幫助使用者整理專案檔案並生成結構化的 Markdown 提示文件，供 AI（如 Claude）處理。工具無需網路連接，確保資料安全。

## 功能
- **檔案上傳與分析**：支援拖放或選擇檔案/資料夾，自動分類檔案（設定檔、腳本檔、日誌檔等）。
- **檔案過濾**：排除敏感檔案（.pem、.env 等）、大型檔案（>5MB）及 .gitignore 定義檔案。
- **內容處理**：讀取檔案內容並生成帶語法高亮的 Markdown。
- **版本控制**：使用 localStorage 保存與管理版本。
- **時間過濾**：針對日誌檔案提供時間範圍篩選。
- **輸出格式**：生成 LLM 友好的結構化 Markdown。

## 檔案結構
```
prompt/
├── Claude.md         # 專案說明
├── css/style.css     # 樣式表
├── img/ai.ico        # 圖標
├── js/
│   ├── app.js        # 主邏輯
│   ├── fileHandler.js # 檔案處理
│   ├── folderAnalyzer.js # 資料夾分析
│   ├── outputHandler.js # 輸出生成
│   └── ui.js         # UI 功能
└── index.html        # 主頁面
```

## 技術實現
- **前端**：純 HTML/CSS/JavaScript，無框架。
- **庫**：JSZip（檔案壓縮）、Web File API（檔案讀取）。
- **安全**：本地處理，無資料上傳，過濾敏感檔案並顯示原因。

## 更新日誌（截至 2025-03-29）
### 核心改進
1. **HTML 渲染修復**
   - 問題：HTML/CSS/JS 被瀏覽器渲染而非顯示純文字，變數重複宣告與函數未定義。
   - 解決：使用 `<textarea>` 顯示內容，調整 JS 檔案載入順序（`outputHandler.js` 優先），重構變數作用域並註冊全域函數（如 `window.updateOutput`）。
   - 文件：`outputHandler.js`, `app.js`, `style.css`。

2. **LLM 友好輸出**
   - 問題：原始輸出缺乏結構與視覺標記，對 LLM 不友好。
   - 解決：
     - 採用帶符號樹狀結構（如 `📁 docker-site/.env # ✅ 環境變數`）。
     - 添加動態符號說明（如 `⚙️ 設定檔`），根據檔案類型生成。
     - 精簡冗餘資訊，JS 目錄（如 `/js`）避免重複「腳本檔」描述，非 JS 目錄保留檔案清單。
     - 從 `innerHTML` 改用 `textContent`，最終採用 `<textarea>`。
   - 文件：`outputHandler.js`。
   - 最終結構：
     ```
     # 專案說明
     這是 {專案名稱} 專案的檔案結構與核心程式碼：
     ## 📁 專案資料夾結構
     ```
     {樹狀結構}
     ```
     ## 🔢 檔案符號說明
     - {符號列表}
     ## 核心檔案
     ### {檔案名稱}
     ```{副檔名}
     {內容}
     ```
     ```

3. **純文字顯示優化**
   - 問題：複雜 HTML 仍被渲染，複製按鈕偶爾消失。
   - 解決：
     - 嘗試 `textContent`、`createTextNode` 與 `pre` 元素，最終採用 `<textarea>` 確保純文字。
     - 重構 DOM 操作保留複製按鈕（內嵌於容器 HTML）。
     - CSS 優化（如 `white-space: pre`、`scrollbar-width: thin`）確保一致性與可讀性。
   - 文件：`outputHandler.js`, `style.css`。

### 其他改進
- **檔案選擇邏輯**：頂層資料夾預設勾選，內層超 20 個檔案取消勾選。
- **UI 增強**：分類面板樣式區分，模態窗支援點擊外部關閉。
- **過濾透明度**：顯示被過濾檔案及原因。
- **錯誤處理**：增強 try-catch 與函數存在性檢查。

## 安全性與隱私

**本應用程式完全在本地端運行，無需網路連接，不會上傳任何資料到雲端或伺服器。**

- 所有檔案操作只在您的瀏覽器中進行
- 不含任何上傳功能或遠端 API 呼叫
- 敏感資訊（如密鑰、憑證和環境變數）會被自動過濾
- 您可將此工具下載到本機，離線使用同樣功能

### 檔案過濾機制
當您選擇要匯入的檔案或資料夾後，「智慧 Prompt 生成器」會自動過濾以下類型的檔案：

1. **敏感檔案**：軟體憑證、金鑰、SSH相關檔案
2. **環境變數**：.env 檔案及非演示用的環境變數檔
3. **大型檔案**：超過 5MB 的檔案及二進位可執行檔
4. **.gitignore定義**：符合 .gitignore 規則的檔案

處理完成後會顯示被過濾的檔案及原因，提供透明度。所有過濾僅在本地瀏覽器進行，不傳送到任何外部伺服器。

## 使用方式
1. 拖放或選擇檔案/資料夾。
2. 在樹狀視圖中選擇目標檔案。
3. 生成並複製 Markdown 輸出。

## 未來規劃
- 支援自定義過濾與檔案編輯。
- 優化大型資料夾處理速度。
- 替換 localStorage 為 IndexedDB，支援更大容量。
- 添加暗黑模式及更多自定設置。