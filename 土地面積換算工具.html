<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🏡 面積換算工具</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#eff6ff',
              500: '#3b82f6',
              600: '#2563eb',
              700: '#1d4ed8'
            },
            accent: {
              active: '#fef3c7',
              result: '#ecfdf5'
            }
          },
          fontFamily: {
            sans: ['Inter', 'Noto Sans TC', 'sans-serif']
          }
        }
      }
    }
  </script>
  
  <style>
    .input-mobile {
      @apply w-full h-12 text-base font-medium rounded-2xl border-2 border-gray-200;
      @apply bg-white px-4 transition-all duration-300 ease-out;
      @apply focus:border-primary-500 focus:ring-4 focus:ring-primary-100;
      @apply shadow-sm hover:shadow-md focus:shadow-lg;
    }
    
    .input-active {
      @apply border-amber-400 bg-accent-active ring-4 ring-amber-100;
    }
    
    .input-result {
      @apply border-green-300 bg-accent-result;
    }
    
    .unit-card {
      @apply bg-white rounded-2xl p-4 shadow-sm border border-gray-100;
      @apply transition-all duration-300 ease-out;
      @apply hover:shadow-md;
    }
    
    .unit-card.active {
      @apply shadow-lg ring-2 ring-amber-400 ring-opacity-50;
      @apply bg-gradient-to-br from-amber-50 to-orange-50;
    }
    
    .unit-card.result {
      @apply bg-gradient-to-br from-green-50 to-emerald-50;
      @apply border-green-200;
    }
    
    .easter-egg {
      @apply fixed bottom-20 right-6 w-16 h-16 rounded-full;
      @apply bg-gradient-to-r from-purple-500 to-pink-500;
      @apply flex items-center justify-center shadow-lg;
      @apply opacity-70 hover:opacity-100 transition-all duration-300;
      @apply hover:scale-110 cursor-pointer;
      position: relative;
    }
    
    .easter-egg::before {
      content: '';
      position: absolute;
      inset: -4px;
      border-radius: 50%;
      background: linear-gradient(45deg, #8b5cf6, #ec4899, #8b5cf6);
      opacity: 0;
      animation: pulse-ring 2s ease-in-out infinite;
    }
    
    .easter-egg:hover::before {
      opacity: 0.6;
    }
    
    .toast {
      @apply fixed top-6 left-1/2 transform -translate-x-1/2;
      @apply bg-white rounded-xl shadow-xl border px-6 py-3;
      @apply transition-all duration-300 z-50;
      @apply translate-y-[-100px] opacity-0;
    }
    
    .toast.show {
      @apply translate-y-0 opacity-100;
    }
    
    .modal {
      @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50;
      @apply opacity-0 pointer-events-none transition-all duration-300;
    }
    
    .modal.show {
      @apply opacity-100 pointer-events-auto;
    }
    
    .modal-content {
      @apply transform scale-75 transition-all duration-300 ease-out;
    }
    
    .modal.show .modal-content {
      @apply scale-100;
    }
    
    .shake {
      animation: shake 0.5s ease-in-out;
    }
    
    @keyframes pulse-ring {
      0%, 100% { 
        opacity: 0; 
        transform: scale(0.8); 
      }
      50% { 
        opacity: 0.6; 
        transform: scale(1.2); 
      }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    
    .animate-pulse-soft {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
  </style>
</head>

<body class="bg-gradient-to-br from-blue-50 via-white to-green-50 min-h-screen font-sans">
  
  <!-- Header -->
  <header class="bg-white/80 backdrop-blur-sm border-b border-gray-100 sticky top-0 z-40">
    <div class="max-w-md mx-auto px-4 py-4">
      <div class="text-center">
        <div class="inline-flex items-center space-x-2 text-primary-600">
          <div class="w-8 h-8 bg-primary-500 rounded-xl flex items-center justify-center">
            <i class="fas fa-ruler-combined text-white text-sm"></i>
          </div>
          <h1 class="text-xl font-bold">面積換算</h1>
        </div>
        <p class="text-sm text-gray-500 mt-1">即時精準轉換</p>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-md mx-auto px-4 py-6">
    
    <!-- Instructions -->
    <div class="bg-primary-50 rounded-2xl p-4 mb-6 border border-primary-100">
      <div class="flex items-start space-x-3">
        <i class="fas fa-lightbulb text-primary-500 mt-1"></i>
        <div>
          <h3 class="font-semibold text-primary-800 mb-1">使用說明</h3>
          <p class="text-sm text-primary-700">輸入任一單位數值，其他單位會即時換算顯示</p>
        </div>
      </div>
    </div>

    <!-- Input Cards -->
    <div class="space-y-4" id="converter-container">
      
      <!-- 平方公尺 -->
      <div class="unit-card" data-unit="sqm">
        <div class="flex items-center justify-between mb-2">
          <label class="flex items-center space-x-2 font-medium text-gray-700">
            <i class="fas fa-square text-primary-500"></i>
            <span>平方公尺</span>
          </label>
          <span class="text-sm text-gray-400 font-mono">㎡</span>
        </div>
        <input 
          type="number" 
          inputmode="decimal"
          step="any"
          class="input-mobile" 
          placeholder="請輸入數值"
          data-unit="sqm"
          autocomplete="off"
          onwheel="this.blur()"
        >
      </div>

      <!-- 坪 -->
      <div class="unit-card" data-unit="ping">
        <div class="flex items-center justify-between mb-2">
          <label class="flex items-center space-x-2 font-medium text-gray-700">
            <i class="fas fa-home text-primary-500"></i>
            <span>坪</span>
          </label>
          <span class="text-sm text-gray-400 font-mono">坪</span>
        </div>
        <input 
          type="number" 
          inputmode="decimal"
          step="any"
          class="input-mobile" 
          placeholder="請輸入數值"
          data-unit="ping"
          autocomplete="off"
          onwheel="this.blur()"
        >
      </div>

      <!-- 公頃 -->
      <div class="unit-card" data-unit="hectare">
        <div class="flex items-center justify-between mb-2">
          <label class="flex items-center space-x-2 font-medium text-gray-700">
            <i class="fas fa-map text-primary-500"></i>
            <span>公頃</span>
          </label>
          <span class="text-sm text-gray-400 font-mono">ha</span>
        </div>
        <input 
          type="number" 
          inputmode="decimal"
          step="any"
          class="input-mobile" 
          placeholder="請輸入數值"
          data-unit="hectare"
          autocomplete="off"
          onwheel="this.blur()"
        >
      </div>

      <!-- 甲 -->
      <div class="unit-card" data-unit="jia">
        <div class="flex items-center justify-between mb-2">
          <label class="flex items-center space-x-2 font-medium text-gray-700">
            <i class="fas fa-seedling text-primary-500"></i>
            <span>甲</span>
          </label>
          <span class="text-sm text-gray-400 font-mono">甲</span>
        </div>
        <input 
          type="number" 
          inputmode="decimal"
          step="any"
          class="input-mobile" 
          placeholder="請輸入數值"
          data-unit="jia"
          autocomplete="off"
          onwheel="this.blur()"
        >
      </div>

      <!-- 分 -->
      <div class="unit-card" data-unit="fen">
        <div class="flex items-center justify-between mb-2">
          <label class="flex items-center space-x-2 font-medium text-gray-700">
            <i class="fas fa-leaf text-primary-500"></i>
            <span>分</span>
          </label>
          <span class="text-sm text-gray-400 font-mono">分</span>
        </div>
        <input 
          type="number" 
          inputmode="decimal"
          step="any"
          class="input-mobile" 
          placeholder="請輸入數值"
          data-unit="fen"
          autocomplete="off"
          onwheel="this.blur()"
        >
      </div>

      <!-- 公畝 -->
      <div class="unit-card" data-unit="are">
        <div class="flex items-center justify-between mb-2">
          <label class="flex items-center space-x-2 font-medium text-gray-700">
            <i class="fas fa-chart-area text-primary-500"></i>
            <span>公畝</span>
          </label>
          <span class="text-sm text-gray-400 font-mono">a</span>
        </div>
        <input 
          type="number" 
          inputmode="decimal"
          step="any"
          class="input-mobile" 
          placeholder="請輸入數值"
          data-unit="are"
          autocomplete="off"
          onwheel="this.blur()"
        >
      </div>

      <!-- 英畝 -->
      <div class="unit-card" data-unit="acre">
        <div class="flex items-center justify-between mb-2">
          <label class="flex items-center space-x-2 font-medium text-gray-700">
            <i class="fas fa-flag text-primary-500"></i>
            <span>英畝</span>
          </label>
          <span class="text-sm text-gray-400 font-mono">acre</span>
        </div>
        <input 
          type="number" 
          inputmode="decimal"
          step="any"
          class="input-mobile" 
          placeholder="請輸入數值"
          data-unit="acre"
          autocomplete="off"
          onwheel="this.blur()"
        >
      </div>

      <!-- 市畝 -->
      <div class="unit-card" data-unit="mu">
        <div class="flex items-center justify-between mb-2">
          <label class="flex items-center space-x-2 font-medium text-gray-700">
            <i class="fas fa-landmark text-primary-500"></i>
            <span>市畝</span>
          </label>
          <span class="text-sm text-gray-400 font-mono">市畝</span>
        </div>
        <input 
          type="number" 
          inputmode="decimal"
          step="any"
          class="input-mobile" 
          placeholder="請輸入數值"
          data-unit="mu"
          autocomplete="off"
          onwheel="this.blur()"
        >
      </div>

    </div>

    <!-- Clear Button -->
    <button 
      id="clear-btn"
      class="w-full mt-6 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-4 rounded-2xl transition-all duration-200 shadow-sm hover:shadow-md"
    >
      <i class="fas fa-eraser mr-2"></i>
      全部清除
    </button>

    <!-- Info Section -->
    <div class="mt-8 space-y-4">
      <details class="bg-white rounded-2xl border border-gray-100 overflow-hidden">
        <summary class="p-4 cursor-pointer select-none font-medium text-gray-700 hover:bg-gray-50">
          <i class="fas fa-info-circle text-primary-500 mr-2"></i>
          備註說明
        </summary>
        <div class="px-4 pb-4 border-t border-gray-100 text-sm text-gray-600 space-y-2">
          <p>1. 請先選擇換算的原始單位欄位，輸入數字資料。</p>
          <p>2. 系統會即時換算其他單位數值。</p>
          <p class="text-red-600 font-medium">本查詢系統資料以各地政事務所為準，本系統資料僅供參考。</p>
        </div>
      </details>
      
      <details class="bg-white rounded-2xl border border-gray-100 overflow-hidden">
        <summary class="p-4 cursor-pointer select-none font-medium text-gray-700 hover:bg-gray-50">
          <i class="fas fa-calculator text-primary-500 mr-2"></i>
          換算係數
        </summary>
        <div class="px-4 pb-4 border-t border-gray-100 text-xs text-gray-600 grid grid-cols-1 gap-1">
          <div>• 1 公頃 = 10,000 ㎡</div>
          <div>• 1 ㎡ = 0.3025 坪</div>
          <div>• 1 甲 = 3,305.785 ㎡</div>
          <div>• 1 分 = 330.578 ㎡</div>
          <div>• 1 公畝 = 100 ㎡</div>
          <div>• 1 英畝 = 4,046.8564224 ㎡</div>
          <div>• 1 市畝 = 666.6667 ㎡</div>
        </div>
      </details>
    </div>

  </main>

  <!-- Footer -->
  <footer class="text-center py-6 text-sm text-gray-500">
    <p>© 2024 面積換算工具</p>
  </footer>

  <!-- Easter Egg -->
  <div class="easter-egg" id="easter-egg">
    <i class="fas fa-magic text-white animate-pulse-soft"></i>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast">
    <div class="flex items-center space-x-2">
      <i id="toast-icon" class="fas fa-check-circle text-green-500"></i>
      <span id="toast-message">訊息</span>
    </div>
  </div>

  <!-- Easter Egg Modal -->
  <div class="modal" id="easter-modal">
    <div class="bg-white rounded-2xl p-6 mx-4 max-w-sm shadow-2xl modal-content">
      <div class="text-center">
        <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-rocket text-white text-xl"></i>
        </div>
        <h3 class="text-lg font-bold text-gray-800 mb-2">🎉 發現彩蛋！</h3>
        <p class="text-gray-600 text-sm mb-4" id="easter-knowledge">你知道嗎？一個標準籃球場約為 420 平方公尺，相當於 127 坪！</p>
        <div class="flex gap-2">
          <button onclick="randomDemo()" class="flex-1 bg-primary-500 text-white py-2 rounded-xl text-sm font-medium">
            隨機示範
          </button>
          <button onclick="closeEasterEgg()" class="flex-1 bg-gray-400 text-white py-2 rounded-xl text-sm font-medium">
            關閉
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 換算係數 (以平方公尺為基準)
    const FACTORS = {
      sqm: 1,
      ping: 0.3025,
      hectare: 10000,
      jia: 3305.785,
      fen: 330.578,
      are: 100,
      acre: 4046.8564224,
      mu: 666.6667
    };

    // 彩蛋知識庫
    const EASTER_KNOWLEDGE = [
      '你知道嗎？一個標準籃球場約為 420 平方公尺，相當於 127 坪！',
      '有趣事實：台北 101 大樓的土地面積約為 3,056 坪，相當於 1.01 公頃！',
      '小知識：一個足球場約為 7,140 平方公尺，大約等於 2.16 甲！'
    ];

    let currentActive = null;
    let debounceTimer = null;
    let longPressTimer = null;
    let easterEggUnlocked = false;
    let currentKnowledgeIndex = 0;

    // DOM 元素
    const inputs = {};
    const cards = {};
    
    // 初始化
    document.addEventListener('DOMContentLoaded', () => {
      // 獲取所有輸入框和卡片
      document.querySelectorAll('[data-unit]').forEach(el => {
        const unit = el.dataset.unit;
        if (el.tagName === 'INPUT') {
          inputs[unit] = el;
        } else {
          cards[unit] = el;
        }
      });

      // 綁定事件
      Object.entries(inputs).forEach(([unit, input]) => {
        input.addEventListener('input', (e) => handleInput(unit, e.target.value));
        input.addEventListener('focus', () => setActive(unit));
        
        // 處理 placeholder 行為
        input.addEventListener('focus', (e) => {
          if (e.target.value) {
            e.target.placeholder = '';
          }
        });
        
        input.addEventListener('blur', (e) => {
          if (!e.target.value) {
            e.target.placeholder = '請輸入數值';
          }
        });
      });

      document.getElementById('clear-btn').addEventListener('click', clearAll);
      
      // 彩蛋長按事件
      const easterEgg = document.getElementById('easter-egg');
      easterEgg.addEventListener('mousedown', startLongPress);
      easterEgg.addEventListener('mouseup', cancelLongPress);
      easterEgg.addEventListener('mouseleave', cancelLongPress);
      easterEgg.addEventListener('touchstart', startLongPress);
      easterEgg.addEventListener('touchend', cancelLongPress);

      showToast('歡迎使用面積換算工具！', 'info');
    });

    // 處理輸入 (防抖 + 改進驗證)
    function handleInput(sourceUnit, value) {
      clearTimeout(debounceTimer);
      
      // 如果輸入為空或0，清除所有結果
      if (!value || parseFloat(value) <= 0) {
        clearResults();
        return;
      }

      // 檢查是否為有效數字
      const numValue = parseFloat(value);
      if (isNaN(numValue) || numValue < 0) {
        clearAll();
        showToast('請輸入有效的正數值', 'error');
        return;
      }

      debounceTimer = setTimeout(() => {
        calculate(sourceUnit, numValue);
      }, 300);
    }

    // 設定當前活動單位
    function setActive(unit) {
      // 清除所有狀態
      Object.entries(cards).forEach(([u, card]) => {
        card.classList.remove('active', 'result');
        inputs[u].classList.remove('input-active', 'input-result');
      });

      // 設定活動狀態
      currentActive = unit;
      cards[unit].classList.add('active');
      inputs[unit].classList.add('input-active');
    }

    // 執行計算
    function calculate(sourceUnit, sourceValue) {
      if (!sourceValue || sourceValue <= 0) return;

      // 轉換為平方公尺
      const sqmValue = sourceUnit === 'sqm' 
        ? sourceValue 
        : sourceValue * FACTORS[sourceUnit];

      // 計算其他單位
      Object.keys(FACTORS).forEach(unit => {
        if (unit !== sourceUnit) {
          const value = unit === 'sqm' 
            ? sqmValue 
            : sqmValue / FACTORS[unit];
          
          inputs[unit].value = formatNumber(value);
          cards[unit].classList.add('result');
          inputs[unit].classList.add('input-result');
        }
      });
    }

    // 清除結果
    function clearResults() {
      Object.entries(cards).forEach(([unit, card]) => {
        if (unit !== currentActive) {
          card.classList.remove('result');
          inputs[unit].classList.remove('input-result');
          inputs[unit].value = '';
        }
      });
    }

    // 清除全部
    function clearAll() {
      Object.entries(inputs).forEach(([unit, input]) => {
        input.value = '';
        input.placeholder = '請輸入數值';
        cards[unit].classList.remove('active', 'result');
        input.classList.remove('input-active', 'input-result');
      });
      currentActive = null;
      showToast('已清除所有數值', 'info');
    }

    // 格式化數字
    function formatNumber(value) {
      return parseFloat(value.toFixed(6)).toString();
    }

    // 顯示 Toast
    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      const icon = document.getElementById('toast-icon');
      const messageEl = document.getElementById('toast-message');

      const icons = {
        success: 'fa-check-circle text-green-500',
        error: 'fa-exclamation-circle text-red-500',
        info: 'fa-info-circle text-blue-500'
      };

      icon.className = `fas ${icons[type] || icons.info}`;
      messageEl.textContent = message;

      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // 彩蛋長按處理
    function startLongPress(e) {
      e.preventDefault();
      
      longPressTimer = setTimeout(() => {
        if (easterEggUnlocked) {
          showToast('已解鎖，點我再看一次！', 'info');
        } else {
          easterEggUnlocked = true;
        }
        showEasterEgg();
      }, 2000);
    }

    function cancelLongPress() {
      clearTimeout(longPressTimer);
    }

    function showEasterEgg() {
      // 隨機顯示知識
      const knowledge = EASTER_KNOWLEDGE[currentKnowledgeIndex];
      document.getElementById('easter-knowledge').textContent = knowledge;
      currentKnowledgeIndex = (currentKnowledgeIndex + 1) % EASTER_KNOWLEDGE.length;
      
      // 顯示 Modal
      const modal = document.getElementById('easter-modal');
      modal.classList.add('show');
    }

    function closeEasterEgg() {
      document.getElementById('easter-modal').classList.remove('show');
    }

    function randomDemo() {
      const units = Object.keys(inputs);
      const randomUnit = units[Math.floor(Math.random() * units.length)];
      const randomValue = Math.floor(Math.random() * 1000) + 1;

      clearAll();
      setActive(randomUnit);
      inputs[randomUnit].value = randomValue;
      calculate(randomUnit, randomValue);
      
      closeEasterEgg();
      showToast(`隨機示範：${randomValue} 單位換算`, 'success');
    }

    // 鍵盤快捷鍵
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeEasterEgg();
      }
    });

    // 點擊外部關閉 Modal (帶晃動效果)
    document.getElementById('easter-modal').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) {
        const modalContent = e.target.querySelector('.modal-content');
        modalContent.classList.add('shake');
        
        setTimeout(() => {
          modalContent.classList.remove('shake');
          closeEasterEgg();
        }, 500);
      }
    });
  </script>

</body>
</html>