<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🏡 面積換算工具 - 精準快速轉換</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#eff6ff',
              100: '#dbeafe', 
              200: '#bfdbfe',
              300: '#93c5fd',
              400: '#60a5fa',
              500: '#2B76F9',
              600: '#2563eb',
              700: '#1d4ed8',
              800: '#1e40af',
              900: '#1e3a8a'
            },
            secondary: {
              50: '#f8fafc',
              100: '#f1f5f9',
              200: '#e2e8f0',
              300: '#cbd5e1',
              400: '#94A3B8',
              500: '#64748b',
              600: '#475569',
              700: '#334155',
              800: '#1e293b',
              900: '#0f172a'
            },
            accent: {
              highlight: '#FEF7C3',
              success: '#10b981',
              warning: '#f59e0b',
              error: '#ef4444'
            }
          },
          fontFamily: {
            sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
            display: ['Inter', 'sans-serif']
          },
          spacing: {
            '0.25': '0.0625rem',
            '0.5': '0.125rem', 
            '1.25': '0.3125rem',
            '2.5': '0.625rem',
            '3.5': '0.875rem',
            '4.5': '1.125rem',
            '5.5': '1.375rem',
            '6.5': '1.625rem',
            '7.5': '1.875rem',
            '8.5': '2.125rem',
            '9.5': '2.375rem'
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'scale-in': 'scaleIn 0.3s ease-out',
            'slide-up': 'slideUp 0.4s ease-out',
            'bounce-gentle': 'bounceGentle 0.6s ease-in-out',
            'pulse-soft': 'pulseSoft 2s infinite'
          }
        }
      }
    }
  </script>
  
  <style>
    /* 自定義 CSS 增強 Tailwind 功能 */
    
    /* 動畫關鍵幀 */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes bounceGentle {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes pulseSoft {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    /* 輸入框增強樣式 */
    .input-enhanced {
      @apply transition-all duration-300 ease-in-out;
      @apply border border-secondary-200 rounded-lg px-4 py-3;
      @apply focus:ring-2 focus:ring-primary-500 focus:border-transparent;
      @apply hover:border-secondary-300;
      @apply bg-white shadow-sm;
    }
    
    .input-highlighted {
      @apply bg-accent-highlight border-primary-400 shadow-md;
      @apply ring-2 ring-primary-200;
    }
    
    /* 按鈕漸變效果 */
    .btn-primary {
      @apply bg-gradient-to-r from-primary-500 to-primary-600;
      @apply hover:from-primary-600 hover:to-primary-700;
      @apply transform transition-all duration-200 ease-out;
      @apply hover:scale-105 active:scale-95;
      @apply shadow-lg hover:shadow-xl;
    }
    
    .btn-secondary {
      @apply bg-gradient-to-r from-secondary-400 to-secondary-500;
      @apply hover:from-secondary-500 hover:to-secondary-600;
      @apply transform transition-all duration-200 ease-out;
      @apply hover:scale-105 active:scale-95;
      @apply shadow-md hover:shadow-lg;
    }
    
    /* 卡片容器效果 */
    .card-modern {
      @apply bg-white rounded-2xl shadow-lg;
      @apply border border-secondary-100;
      @apply transition-all duration-300 ease-in-out;
      @apply hover:shadow-xl hover:scale-[1.02];
    }
    
    /* 響應式網格佈局 */
    .grid-responsive {
      @apply grid gap-4;
      @apply grid-cols-1 sm:grid-cols-2 lg:grid-cols-4;
    }
    
    /* 文字後綴 UI */
    .input-with-suffix {
      @apply relative;
    }
    
    .input-suffix {
      @apply absolute right-3 top-1/2 transform -translate-y-1/2;
      @apply text-secondary-500 font-medium pointer-events-none;
      @apply text-sm;
    }
    
    /* 隱藏彩蛋按鈕 */
    .easter-egg-btn {
      @apply fixed bottom-6 right-6 z-50;
      @apply w-12 h-12 rounded-full;
      @apply bg-gradient-to-r from-pink-400 to-purple-500;
      @apply shadow-lg hover:shadow-xl;
      @apply transform transition-all duration-300 ease-out;
      @apply hover:scale-110 active:scale-95;
      @apply opacity-60 hover:opacity-100;
      @apply flex items-center justify-center;
      @apply cursor-pointer;
    }
    
    /* 彩蛋 Modal */
    .easter-modal {
      @apply fixed inset-0 z-[100] flex items-center justify-center;
      @apply bg-black bg-opacity-50 backdrop-blur-sm;
      @apply opacity-0 pointer-events-none;
      @apply transition-all duration-300 ease-out;
    }
    
    .easter-modal.active {
      @apply opacity-100 pointer-events-auto;
    }
    
    .easter-content {
      @apply bg-white rounded-2xl p-8 max-w-md mx-4;
      @apply transform scale-95 transition-all duration-300 ease-out;
      @apply shadow-2xl;
    }
    
    .easter-modal.active .easter-content {
      @apply scale-100;
    }
    
    /* 無障礙焦點樣式 */
    .focus-visible {
      @apply focus:outline-none focus:ring-2 focus:ring-primary-500;
    }
    
    /* 響應式字體 */
    .text-responsive {
      @apply text-sm sm:text-base lg:text-lg;
    }
    
    /* 進場動畫 */
    .animate-on-scroll {
      @apply opacity-0 translate-y-8;
      @apply transition-all duration-600 ease-out;
    }
    
    .animate-on-scroll.visible {
      @apply opacity-100 translate-y-0;
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 font-sans">
  
  <!-- Header 區塊 -->
  <header class="bg-white shadow-sm border-b border-secondary-100 sticky top-0 z-40">
    <div class="container mx-auto px-4 py-4 lg:py-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-gradient-to-r from-primary-500 to-primary-600 rounded-xl flex items-center justify-center">
            <i class="fas fa-ruler-combined text-white text-lg"></i>
          </div>
          <div>
            <h1 class="text-xl lg:text-2xl font-bold text-secondary-800">面積換算工具</h1>
            <p class="text-sm text-secondary-500 hidden sm:block">精準快速的土地面積單位轉換</p>
          </div>
        </div>
        
        <!-- 主題切換按鈕 (裝飾用) -->
        <button class="p-2 rounded-lg hover:bg-secondary-100 transition-colors duration-200">
          <i class="fas fa-palette text-secondary-600"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- 主要內容區 -->
  <main class="container mx-auto px-4 py-8 lg:py-12">
    
    <!-- 頁面介紹卡片 -->
    <div class="card-modern p-6 lg:p-8 mb-8 animate-on-scroll">
      <div class="text-center mb-6">
        <h2 class="text-2xl lg:text-3xl font-bold text-secondary-800 mb-3">
          <i class="fas fa-calculator text-primary-500 mr-2"></i>
          快速面積單位換算
        </h2>
        <p class="text-secondary-600 text-responsive leading-relaxed max-w-2xl mx-auto">
          支援8種常用面積單位互相轉換，採用精確換算係數，適用於土地測量、房地產估價等專業用途
        </p>
      </div>
      
      <!-- 使用提示 -->
      <div class="bg-primary-50 border border-primary-200 rounded-xl p-4 mb-6">
        <div class="flex items-start space-x-3">
          <i class="fas fa-info-circle text-primary-500 mt-0.5"></i>
          <div>
            <h3 class="font-semibold text-primary-800 mb-2">使用說明</h3>
            <ol class="text-sm text-primary-700 space-y-1 list-decimal list-inside">
              <li>選擇任一單位欄位輸入數值（該欄位會自動高亮顯示）</li>
              <li>點擊「計算」按鈕或按 Enter 鍵進行換算</li>
              <li>其他單位會自動填入對應的換算結果</li>
              <li>使用「全部清除」可重置所有數值</li>
            </ol>
          </div>
        </div>
      </div>
    </div>

    <!-- 換算工具主介面 -->
    <div class="card-modern p-6 lg:p-8 mb-8 animate-on-scroll">
      <form id="converter-form" class="space-y-6">
        
        <!-- 輸入欄位網格 -->
        <div class="grid-responsive" id="input-grid">
          
          <!-- 平方公尺 -->
          <div class="input-with-suffix">
            <label for="sqm" class="block text-sm font-medium text-secondary-700 mb-2">
              <i class="fas fa-square text-primary-500 mr-1"></i>
              平方公尺
            </label>
            <input 
              type="number" 
              id="sqm" 
              class="input-enhanced w-full pr-12 focus-visible" 
              placeholder="0.00"
              step="any"
              aria-label="平方公尺數值輸入"
              autocomplete="off"
            >
            <span class="input-suffix">㎡</span>
          </div>

          <!-- 坪 -->
          <div class="input-with-suffix">
            <label for="ping" class="block text-sm font-medium text-secondary-700 mb-2">
              <i class="fas fa-home text-primary-500 mr-1"></i>
              坪
            </label>
            <input 
              type="number" 
              id="ping" 
              class="input-enhanced w-full pr-12 focus-visible" 
              placeholder="0.00"
              step="any"
              aria-label="坪數值輸入"
              autocomplete="off"
            >
            <span class="input-suffix">坪</span>
          </div>

          <!-- 公頃 -->
          <div class="input-with-suffix">
            <label for="hectare" class="block text-sm font-medium text-secondary-700 mb-2">
              <i class="fas fa-map text-primary-500 mr-1"></i>
              公頃
            </label>
            <input 
              type="number" 
              id="hectare" 
              class="input-enhanced w-full pr-12 focus-visible" 
              placeholder="0.00"
              step="any"
              aria-label="公頃數值輸入"
              autocomplete="off"
            >
            <span class="input-suffix">ha</span>
          </div>

          <!-- 甲 -->
          <div class="input-with-suffix">
            <label for="jia" class="block text-sm font-medium text-secondary-700 mb-2">
              <i class="fas fa-seedling text-primary-500 mr-1"></i>
              甲
            </label>
            <input 
              type="number" 
              id="jia" 
              class="input-enhanced w-full pr-12 focus-visible" 
              placeholder="0.00"
              step="any"
              aria-label="甲數值輸入"
              autocomplete="off"
            >
            <span class="input-suffix">甲</span>
          </div>

          <!-- 分 -->
          <div class="input-with-suffix">
            <label for="fen" class="block text-sm font-medium text-secondary-700 mb-2">
              <i class="fas fa-leaf text-primary-500 mr-1"></i>
              分
            </label>
            <input 
              type="number" 
              id="fen" 
              class="input-enhanced w-full pr-12 focus-visible" 
              placeholder="0.00"
              step="any"
              aria-label="分數值輸入"
              autocomplete="off"
            >
            <span class="input-suffix">分</span>
          </div>

          <!-- 公畝 -->
          <div class="input-with-suffix">
            <label for="are" class="block text-sm font-medium text-secondary-700 mb-2">
              <i class="fas fa-chart-area text-primary-500 mr-1"></i>
              公畝
            </label>
            <input 
              type="number" 
              id="are" 
              class="input-enhanced w-full pr-12 focus-visible" 
              placeholder="0.00"
              step="any"
              aria-label="公畝數值輸入"
              autocomplete="off"
            >
            <span class="input-suffix">a</span>
          </div>

          <!-- 英畝 -->
          <div class="input-with-suffix">
            <label for="acre" class="block text-sm font-medium text-secondary-700 mb-2">
              <i class="fas fa-flag text-primary-500 mr-1"></i>
              英畝
            </label>
            <input 
              type="number" 
              id="acre" 
              class="input-enhanced w-full pr-12 focus-visible" 
              placeholder="0.00"
              step="any"
              aria-label="英畝數值輸入"
              autocomplete="off"
            >
            <span class="input-suffix">acre</span>
          </div>

          <!-- 市畝 -->
          <div class="input-with-suffix">
            <label for="mu" class="block text-sm font-medium text-secondary-700 mb-2">
              <i class="fas fa-landmark text-primary-500 mr-1"></i>
              市畝
            </label>
            <input 
              type="number" 
              id="mu" 
              class="input-enhanced w-full pr-12 focus-visible" 
              placeholder="0.00"
              step="any"
              aria-label="市畝數值輸入"
              autocomplete="off"
            >
            <span class="input-suffix">市畝</span>
          </div>

        </div>

        <!-- 操作按鈕組 -->
        <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-secondary-100">
          <button 
            type="submit" 
            class="btn-primary text-white font-semibold py-3 px-8 rounded-lg focus-visible flex-1 sm:flex-none"
            aria-label="執行面積換算計算"
          >
            <i class="fas fa-calculator mr-2"></i>
            計算
          </button>
          
          <button 
            type="button" 
            id="clear-btn"
            class="btn-secondary text-white font-semibold py-3 px-8 rounded-lg focus-visible flex-1 sm:flex-none"
            aria-label="清除所有輸入數值"
          >
            <i class="fas fa-eraser mr-2"></i>
            全部清除
          </button>
          
          <!-- 結果複製按鈕 (隱藏，計算後顯示) -->
          <button 
            type="button" 
            id="copy-btn"
            class="hidden btn-secondary text-white font-semibold py-3 px-8 rounded-lg focus-visible flex-1 sm:flex-none"
            aria-label="複製換算結果"
          >
            <i class="fas fa-copy mr-2"></i>
            複製結果
          </button>
        </div>

      </form>
    </div>

    <!-- 備註說明與免責條款 -->
    <div class="card-modern p-6 animate-on-scroll">
      <details class="group" open>
        <summary class="cursor-pointer select-none">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold text-secondary-800 flex items-center">
              <i class="fas fa-info-circle text-primary-500 mr-2"></i>
              備註說明與免責條款
            </h3>
            <i class="fas fa-chevron-down text-secondary-400 transform transition-transform duration-200 group-open:rotate-180"></i>
          </div>
        </summary>
        
        <div class="mt-4 pt-4 border-t border-secondary-100 space-y-4">
          <div class="bg-accent-highlight bg-opacity-50 border border-yellow-200 rounded-lg p-4">
            <h4 class="font-semibold text-secondary-800 mb-2">備註說明：</h4>
            <ol class="text-sm text-secondary-700 space-y-1 list-decimal list-inside">
              <li>請先選擇換算的原始單位欄位，輸入數字資料。</li>
              <li>點擊 [計算]，會將輸入值(黃色)，換算為各種其他的單位值。</li>
            </ol>
          </div>
          
          <div class="bg-red-50 border border-red-200 rounded-lg p-4">
            <p class="text-sm text-red-700">
              <i class="fas fa-exclamation-triangle mr-1"></i>
              <strong>免責聲明：</strong>本查詢系統資料以各地政事務所為準，本系統資料僅供參考。
            </p>
          </div>
          
          <!-- 換算係數參考表 -->
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <h4 class="font-semibold text-blue-800 mb-3">
              <i class="fas fa-table mr-1"></i>
              換算係數參考
            </h4>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs text-blue-700">
              <div>• 1 公頃 = 10,000 ㎡</div>
              <div>• 1 ㎡ = 0.3025 坪</div>
              <div>• 1 甲 = 3,305.785 ㎡</div>
              <div>• 1 分 = 330.578 ㎡</div>
              <div>• 1 公畝 = 100 ㎡</div>
              <div>• 1 英畝 = 4,046.8564224 ㎡</div>
              <div>• 1 市畝 = 666.6667 ㎡</div>
            </div>
          </div>
        </div>
      </details>
    </div>

  </main>

  <!-- Footer -->
  <footer class="bg-secondary-800 text-white py-8 mt-16">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row items-center justify-between">
        <div class="flex items-center space-x-3 mb-4 md:mb-0">
          <div class="w-8 h-8 bg-primary-500 rounded-lg flex items-center justify-center">
            <i class="fas fa-ruler-combined text-white"></i>
          </div>
          <span class="font-semibold">面積換算工具</span>
        </div>
        
        <div class="text-sm text-secondary-300 text-center md:text-right">
          <p>© 2024 精準面積換算系統</p>
          <p class="mt-1">專業土地測量 • 快速單位轉換</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- 隱藏彩蛋按鈕 -->
  <div class="easter-egg-btn" id="easter-egg">
    <i class="fas fa-magic text-white text-lg animate-pulse-soft"></i>
  </div>

  <!-- 彩蛋 Modal -->
  <div class="easter-modal" id="easter-modal">
    <div class="easter-content">
      <div class="text-center">
        <div class="w-16 h-16 bg-gradient-to-r from-pink-400 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-rocket text-white text-2xl"></i>
        </div>
        <h3 class="text-xl font-bold text-secondary-800 mb-3">🎉 恭喜發現隱藏功能！</h3>
        <p class="text-secondary-600 mb-6">你發現了我們的小秘密！這裡有個特別的面積換算小知識：</p>
        
        <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 mb-6">
          <h4 class="font-semibold text-secondary-800 mb-2">💡 有趣的面積比較</h4>
          <p class="text-sm text-secondary-700">
            台北101大樓的土地面積約為 <span class="font-bold text-primary-600">3,056 坪</span>，
            相當於 <span class="font-bold text-primary-600">10,100 平方公尺</span>，
            大約是 <span class="font-bold text-primary-600">1.01 公頃</span>！
          </p>
        </div>
        
        <div class="flex gap-3">
          <button class="btn-primary text-white px-6 py-2 rounded-lg text-sm flex-1" onclick="generateRandomConversion()">
            <i class="fas fa-dice mr-1"></i>
            隨機換算
          </button>
          <button class="btn-secondary text-white px-6 py-2 rounded-lg text-sm flex-1" onclick="closeEasterEgg()">
            <i class="fas fa-times mr-1"></i>
            關閉
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 通知 Toast -->
  <div id="toast" class="fixed top-4 right-4 z-50 transform translate-x-full opacity-0 transition-all duration-300 ease-out">
    <div class="bg-white border border-secondary-200 rounded-lg shadow-xl p-4 min-w-72">
      <div class="flex items-center space-x-3">
        <div class="flex-shrink-0">
          <i id="toast-icon" class="fas fa-check-circle text-accent-success"></i>
        </div>
        <div class="flex-1">
          <p id="toast-message" class="text-sm font-medium text-secondary-800"></p>
        </div>
        <button onclick="hideToast()" class="flex-shrink-0 text-secondary-400 hover:text-secondary-600">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
  </div>

  <script>
    // ===== 核心變數與設定 =====
    
    // 換算係數 (以平方公尺為基準單位)
    const CONVERSION_FACTORS = {
      sqm: 1,                    // 平方公尺 (基準)
      ping: 0.3025,              // 坪 (1㎡ = 0.3025坪)
      hectare: 10000,            // 公頃 (1ha = 10,000㎡)
      jia: 3305.785,             // 甲 (1甲 = 3,305.785㎡)
      fen: 330.578,              // 分 (1分 = 330.578㎡)
      are: 100,                  // 公畝 (1a = 100㎡)
      acre: 4046.8564224,        // 英畝 (1acre = 4,046.8564224㎡)
      mu: 666.6667               // 市畝 (1市畝 = 666.6667㎡)
    };
    
    // 全域狀態
    let currentActiveInput = null;
    let lastCalculatedValues = {};
    
    // ===== DOM 元素引用 =====
    const form = document.getElementById('converter-form');
    const clearBtn = document.getElementById('clear-btn');
    const copyBtn = document.getElementById('copy-btn');
    const easterEgg = document.getElementById('easter-egg');
    const easterModal = document.getElementById('easter-modal');
    
    // 所有輸入欄位
    const inputs = {
      sqm: document.getElementById('sqm'),
      ping: document.getElementById('ping'),
      hectare: document.getElementById('hectare'),
      jia: document.getElementById('jia'),
      fen: document.getElementById('fen'),
      are: document.getElementById('are'),
      acre: document.getElementById('acre'),
      mu: document.getElementById('mu')
    };

    // ===== 核心換算邏輯 =====
    
    /**
     * 執行面積單位換算計算
     * @param {string} sourceUnit - 來源單位鍵值
     * @param {number} sourceValue - 來源數值
     */
    function calculateConversions(sourceUnit, sourceValue) {
      if (!sourceValue || sourceValue <= 0) {
        showToast('請輸入有效的正數值', 'error');
        return;
      }
      
      // 先轉換為平方公尺 (基準單位)
      const sqmValue = sourceUnit === 'sqm' 
        ? sourceValue 
        : sourceValue * CONVERSION_FACTORS[sourceUnit];
      
      // 計算所有其他單位的數值
      const results = {};
      
      Object.keys(CONVERSION_FACTORS).forEach(unit => {
        if (unit === sourceUnit) {
          results[unit] = sourceValue; // 保持原始輸入值
        } else if (unit === 'sqm') {
          results[unit] = sqmValue;
        } else {
          results[unit] = sqmValue / CONVERSION_FACTORS[unit];
        }
      });
      
      // 更新所有輸入欄位
      Object.keys(results).forEach(unit => {
        if (unit !== sourceUnit) {
          // 格式化數值：保留6位小數，移除尾隨0
          let formattedValue = parseFloat(results[unit].toFixed(6));
          inputs[unit].value = formattedValue;
        }
      });
      
      // 儲存計算結果供複製功能使用
      lastCalculatedValues = results;
      
      // 顯示複製按鈕
      copyBtn.classList.remove('hidden');
      
      // 顯示成功提示
      showToast('換算完成！', 'success');
      
      // 添加結果動畫效果
      Object.keys(inputs).forEach(unit => {
        if (unit !== sourceUnit) {
          inputs[unit].classList.add('animate-bounce-gentle');
          setTimeout(() => {
            inputs[unit].classList.remove('animate-bounce-gentle');
          }, 600);
        }
      });
    }
    
    /**
     * 清除所有輸入欄位並重置狀態
     */
    function clearAllInputs() {
      Object.values(inputs).forEach(input => {
        input.value = '';
        input.classList.remove('input-highlighted');
      });
      
      currentActiveInput = null;
      lastCalculatedValues = {};
      copyBtn.classList.add('hidden');
      
      showToast('已清除所有數值', 'info');
    }
    
    /**
     * 複製換算結果到剪貼簿
     */
    async function copyResults() {
      if (Object.keys(lastCalculatedValues).length === 0) {
        showToast('沒有可複製的結果', 'error');
        return;
      }
      
      // 格式化結果文字
      const resultText = Object.entries(lastCalculatedValues)
        .map(([unit, value]) => {
          const unitNames = {
            sqm: '平方公尺',
            ping: '坪',
            hectare: '公頃',
            jia: '甲',
            fen: '分',
            are: '公畝',
            acre: '英畝',
            mu: '市畝'
          };
          
          const formattedValue = parseFloat(value.toFixed(6));
          return `${unitNames[unit]}: ${formattedValue}`;
        })
        .join('\n');
      
      try {
        await navigator.clipboard.writeText(resultText);
        showToast('結果已複製到剪貼簿！', 'success');
      } catch (err) {
        console.error('複製失敗:', err);
        showToast('複製失敗，請手動選取文字', 'error');
      }
    }

    // ===== 事件處理器 =====
    
    /**
     * 處理輸入欄位焦點與互斥邏輯
     */
    Object.entries(inputs).forEach(([unit, input]) => {
      // 輸入欄位獲得焦點時
      input.addEventListener('focus', () => {
        setActiveInput(unit);
      });
      
      // 輸入內容變化時
      input.addEventListener('input', (e) => {
        if (e.target.value) {
          setActiveInput(unit);
        }
      });
      
      // Enter 鍵快速計算
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          form.dispatchEvent(new Event('submit'));
        }
      });
    });
    
    /**
     * 設定當前活動的輸入欄位 (互斥機制)
     * @param {string} activeUnit - 要設為活動的單位
     */
    function setActiveInput(activeUnit) {
      // 移除所有高亮樣式
      Object.values(inputs).forEach(input => {
        input.classList.remove('input-highlighted');
      });
      
      // 清空其他欄位 (互斥機制)
      Object.entries(inputs).forEach(([unit, input]) => {
        if (unit !== activeUnit) {
          input.value = '';
        }
      });
      
      // 高亮當前活動欄位
      inputs[activeUnit].classList.add('input-highlighted');
      currentActiveInput = activeUnit;
      
      // 隱藏複製按鈕
      copyBtn.classList.add('hidden');
    }
    
    // 表單提交處理
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      
      if (!currentActiveInput) {
        showToast('請先選擇一個單位欄位並輸入數值', 'warning');
        return;
      }
      
      const sourceValue = parseFloat(inputs[currentActiveInput].value);
      
      if (isNaN(sourceValue) || sourceValue <= 0) {
        showToast('請輸入有效的正數值', 'error');
        inputs[currentActiveInput].focus();
        return;
      }
      
      calculateConversions(currentActiveInput, sourceValue);
    });
    
    // 清除按鈕
    clearBtn.addEventListener('click', clearAllInputs);
    
    // 複製按鈕
    copyBtn.addEventListener('click', copyResults);

    // ===== 通知系統 =====
    
    /**
     * 顯示通知 Toast
     * @param {string} message - 通知訊息
     * @param {string} type - 通知類型 ('success', 'error', 'warning', 'info')
     */
    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      const icon = document.getElementById('toast-icon');
      const messageEl = document.getElementById('toast-message');
      
      // 設定圖示與樣式
      const styles = {
        success: { icon: 'fa-check-circle', color: 'text-accent-success' },
        error: { icon: 'fa-exclamation-circle', color: 'text-accent-error' },
        warning: { icon: 'fa-exclamation-triangle', color: 'text-accent-warning' },
        info: { icon: 'fa-info-circle', color: 'text-primary-500' }
      };
      
      const style = styles[type] || styles.info;
      icon.className = `fas ${style.icon} ${style.color}`;
      messageEl.textContent = message;
      
      // 顯示動畫
      toast.classList.remove('translate-x-full', 'opacity-0');
      toast.classList.add('translate-x-0', 'opacity-100');
      
      // 3秒後自動隱藏
      setTimeout(() => {
        hideToast();
      }, 3000);
    }
    
    /**
     * 隱藏通知 Toast
     */
    function hideToast() {
      const toast = document.getElementById('toast');
      toast.classList.remove('translate-x-0', 'opacity-100');
      toast.classList.add('translate-x-full', 'opacity-0');
    }

    // ===== 隱藏彩蛋功能 =====
    
    let easterEggClicks = 0;
    let easterEggTimeout;
    
    // 彩蛋按鈕點擊事件
    easterEgg.addEventListener('click', () => {
      easterEggClicks++;
      
      // 清除之前的計時器
      clearTimeout(easterEggTimeout);
      
      // 3次點擊觸發彩蛋
      if (easterEggClicks >= 3) {
        showEasterEgg();
        easterEggClicks = 0;
      } else {
        // 1秒內沒有繼續點擊就重置計數
        easterEggTimeout = setTimeout(() => {
          easterEggClicks = 0;
        }, 1000);
      }
    });
    
    // 鍵盤彩蛋：輸入 "AREA" 觸發
    let keySequence = '';
    document.addEventListener('keydown', (e) => {
      keySequence += e.key.toLowerCase();
      
      if (keySequence.length > 4) {
        keySequence = keySequence.slice(-4);
      }
      
      if (keySequence === 'area') {
        showEasterEgg();
        keySequence = '';
      }
    });
    
    /**
     * 顯示彩蛋 Modal
     */
    function showEasterEgg() {
      easterModal.classList.add('active');
      document.body.style.overflow = 'hidden';
      
      // 播放慶祝動畫
      easterEgg.classList.add('animate-bounce-gentle');
      setTimeout(() => {
        easterEgg.classList.remove('animate-bounce-gentle');
      }, 600);
    }
    
    /**
     * 關閉彩蛋 Modal
     */
    function closeEasterEgg() {
      easterModal.classList.remove('active');
      document.body.style.overflow = '';
    }
    
    /**
     * 產生隨機換算示範
     */
    function generateRandomConversion() {
      const units = Object.keys(inputs);
      const randomUnit = units[Math.floor(Math.random() * units.length)];
      const randomValue = Math.floor(Math.random() * 1000) + 1;
      
      // 清除所有輸入
      clearAllInputs();
      
      // 設定隨機值
      inputs[randomUnit].value = randomValue;
      setActiveInput(randomUnit);
      
      // 執行計算
      calculateConversions(randomUnit, randomValue);
      
      // 關閉彩蛋
      closeEasterEgg();
      
      showToast(`隨機產生：${randomValue} 單位的換算結果`, 'success');
    }
    
    // 點擊 Modal 背景關閉
    easterModal.addEventListener('click', (e) => {
      if (e.target === easterModal) {
        closeEasterEgg();
      }
    });
    
    // ESC 鍵關閉彩蛋
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && easterModal.classList.contains('active')) {
        closeEasterEgg();
      }
    });

    // ===== 無障礙與 UX 增強 =====
    
    /**
     * 滾動進場動畫觀察器
     */
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, observerOptions);
    
    // 觀察所有需要動畫的元素
    document.querySelectorAll('.animate-on-scroll').forEach(el => {
      observer.observe(el);
    });
    
    /**
     * 鍵盤導航增強
     */
    document.addEventListener('keydown', (e) => {
      // Ctrl+D 快速清除
      if (e.ctrlKey && e.key === 'd') {
        e.preventDefault();
        clearAllInputs();
      }
      
      // Ctrl+Enter 快速計算
      if (e.ctrlKey && e.key === 'Enter') {
        e.preventDefault();
        form.dispatchEvent(new Event('submit'));
      }
    });
    
    /**
     * 視窗大小變化時的響應式調整
     */
    window.addEventListener('resize', () => {
      // 確保 Modal 在小螢幕上正確居中
      if (easterModal.classList.contains('active')) {
        // 重新計算位置 (如需要)
      }
    });
    
    // ===== 初始化 =====
    
    /**
     * 頁面載入完成後的初始化
     */
    document.addEventListener('DOMContentLoaded', () => {
      // 預設焦點到第一個輸入欄位
      inputs.sqm.focus();
      
      // 顯示歡迎訊息
      setTimeout(() => {
        showToast('歡迎使用面積換算工具！', 'info');
      }, 500);
      
      // 載入動畫
      document.body.classList.add('animate-fade-in');
    });
    
    // 防止表單重複提交
    let isCalculating = false;
    const originalSubmitHandler = form.onsubmit;
    
    form.addEventListener('submit', (e) => {
      if (isCalculating) {
        e.preventDefault();
        return;
      }
      
      isCalculating = true;
      setTimeout(() => {
        isCalculating = false;
      }, 500);
    });
    
    // ===== 輔助函數 =====
    
    /**
     * 格式化數字顯示
     * @param {number} value - 要格式化的數值
     * @param {number} precision - 小數點位數
     * @returns {string} 格式化後的字串
     */
    function formatNumber(value, precision = 6) {
      return parseFloat(value.toFixed(precision)).toString();
    }
    
    /**
     * 驗證輸入值
     * @param {string} value - 輸入值
     * @returns {boolean} 是否為有效數值
     */
    function validateInput(value) {
      const num = parseFloat(value);
      return !isNaN(num) && num > 0 && num < Infinity;
    }
    
    // ===== 開發者工具 (僅開發模式) =====
    
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
      // 開發者快捷鍵
      window.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.shiftKey && e.key === 'D') {
          console.log('當前狀態:', {
            activeInput: currentActiveInput,
            lastValues: lastCalculatedValues,
            conversionFactors: CONVERSION_FACTORS
          });
        }
      });
      
      // 暴露函數到全域 (方便除錯)
      window.areaConverter = {
        calculateConversions,
        clearAllInputs,
        showToast,
        inputs,
        CONVERSION_FACTORS
      };
    }
    
  </script>

</body>
</html>