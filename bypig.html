<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>加密貨幣交易平台</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <!-- 引入 Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
      /* ===== 基本重置與字型 ===== */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      }
      :root {
        --primary-bg: #0a0e17;
        --secondary-bg: #151b29;
        --tertiary-bg: #1c2536;
        --border-color: #2c3647;
        --text-color: #e5e5e5;
        --text-secondary: #8c8c8c;
        --green-color: #28a745;
        --red-color: #dc3545;
        --accent-color: #3a7bd5;
        --support-area: rgba(51, 153, 255, 0.1);
      }
      body {
        background-color: var(--primary-bg);
        color: var(--text-color);
        height: 100vh;
        overflow: hidden;
      }
      .app-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        max-width: 100%;
        margin: 0 auto;
      }
      /* ===== 頂部信息 ===== */
      .header {
        padding: 10px 15px;
        background-color: var(--secondary-bg);
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .symbol-info h1 {
        font-size: 18px;
        margin-bottom: 4px;
      }
      .price-info {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .current-price {
        font-size: 16px;
        font-weight: bold;
      }
      .price-change {
        font-size: 14px;
        padding: 2px 6px;
        border-radius: 4px;
      }
      .price-change.positive {
        color: var(--green-color);
        background-color: rgba(40, 167, 69, 0.1);
      }
      .price-change.negative {
        color: var(--red-color);
        background-color: rgba(220, 53, 69, 0.1);
      }
      .tab-switcher {
        display: flex;
        gap: 10px;
      }
      .tab-btn {
        padding: 8px 15px;
        background-color: transparent;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        color: var(--text-color);
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s ease;
      }
      .tab-btn:hover {
        background-color: var(--tertiary-bg);
      }
      .tab-btn.active {
        background-color: var(--tertiary-bg);
        border-color: var(--accent-color);
      }
      /* ===== 主內容 ===== */
      .main-content {
        flex: 1;
        overflow-y: auto;
        position: relative;
      }
      .content-section {
        display: none;
        height: 100%;
      }
      .content-section.active {
        display: block;
      }
      /* ===== 圖表區 ===== */
      .timeframe-selector {
        display: flex;
        gap: 2px;
        padding: 10px;
        background-color: var(--secondary-bg);
        overflow-x: auto;
        white-space: nowrap;
      }
      .timeframe-btn {
        padding: 5px 10px;
        background-color: transparent;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        color: var(--text-color);
        font-size: 12px;
        cursor: pointer;
      }
      .timeframe-btn.active {
        background-color: var(--tertiary-bg);
        border-color: var(--accent-color);
      }
      #chart {
        width: 100%;
        height: 70vh;
        background-color: var(--secondary-bg);
        margin-bottom: 1rem;
      }
      .indicators {
        display: flex;
        flex-wrap: wrap;
        padding: 10px;
        background-color: var(--secondary-bg);
        border-top: 1px solid var(--border-color);
      }
      .indicator {
        margin-right: 15px;
        font-size: 12px;
      }
      .indicator-name {
        color: var(--text-secondary);
      }
      /* ===== 交易區 ===== */
      .trade-tabs {
        display: flex;
        padding: 10px;
        background-color: var(--secondary-bg);
        border-bottom: 1px solid var(--border-color);
      }
      .trade-tab-btn {
        flex: 1;
        padding: 8px;
        background-color: transparent;
        border: none;
        color: var(--text-color);
        font-size: 14px;
        cursor: pointer;
        border-bottom: 2px solid transparent;
      }
      .trade-tab-btn.active {
        border-bottom: 2px solid var(--accent-color);
        font-weight: bold;
      }
      .trade-content {
        display: none;
        padding: 15px;
        background-color: var(--secondary-bg);
      }
      .trade-content.active {
        display: block;
      }
      .leverage-slider {
        margin-bottom: 20px;
      }
      .leverage-slider label {
        display: block;
        margin-bottom: 10px;
        font-size: 14px;
      }
      .slider {
        width: 100%;
        height: 5px;
        background: var(--tertiary-bg);
        border-radius: 5px;
        outline: none;
        -webkit-appearance: none;
      }
      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background: var(--accent-color);
        cursor: pointer;
      }
      .leverage-marks {
        display: flex;
        justify-content: space-between;
        margin-top: 5px;
        font-size: 12px;
        color: var(--text-secondary);
      }
      .order-input {
        margin-bottom: 15px;
      }
      .order-input label {
        display: block;
        margin-bottom: 5px;
        font-size: 14px;
      }
      .order-input input {
        width: 100%;
        padding: 10px;
        background-color: var(--tertiary-bg);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        color: var(--text-color);
        font-size: 14px;
      }
      .available-balance {
        margin-bottom: 15px;
        font-size: 13px;
        color: var(--text-secondary);
      }
      .order-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      .btn-long, .btn-short {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        font-weight: bold;
        color: white;
        cursor: pointer;
      }
      .btn-long {
        background-color: var(--green-color);
      }
      .btn-short {
        background-color: var(--red-color);
      }
      /* ===== 持倉區塊 ===== */
      .positions-section {
        padding: 15px;
        background-color: var(--secondary-bg);
        border-top: 1px solid var(--border-color);
        border-bottom: 1px solid var(--border-color);
      }
      .positions-section h3 {
        margin-bottom: 15px;
        font-size: 16px;
      }
      .position-card {
        background-color: var(--tertiary-bg);
        border-radius: 6px;
        overflow: hidden;
        margin-bottom: 10px;
      }
      .position-header {
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: rgba(255, 255, 255, 0.05);
      }
      .position-symbol {
        font-weight: bold;
      }
      .position-type {
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 12px;
      }
      .position-type.long {
        background-color: rgba(40, 167, 69, 0.2);
        color: var(--green-color);
      }
      .position-type.short {
        background-color: rgba(220, 53, 69, 0.2);
        color: var(--red-color);
      }
      .position-details {
        padding: 10px;
      }
      .position-info {
        margin-bottom: 15px;
      }
      .info-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 13px;
      }
      .info-row span:first-child {
        color: var(--text-secondary);
      }
      .profit {
        color: var(--green-color);
      }
      .loss {
        color: var(--red-color);
      }
      .position-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }
      .position-btn {
        flex: 1;
        padding: 8px;
        background-color: var(--secondary-bg);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        color: var(--text-color);
        font-size: 12px;
        cursor: pointer;
      }
      .position-btn.close-btn {
        background-color: rgba(220, 53, 69, 0.1);
        border-color: var(--red-color);
        color: var(--red-color);
      }
      /* ===== 訂單簿 ===== */
      .orderbook-section {
        padding: 15px;
        background-color: var(--secondary-bg);
      }
      .orderbook-section h3 {
        margin-bottom: 15px;
        font-size: 16px;
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .orderbook-section h3 i {
        font-size: 14px;
        cursor: pointer;
        color: var(--text-secondary);
      }
      .orderbook {
        position: relative;
      }
      .orderbook-header {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        padding: 8px 0;
        font-size: 13px;
        color: var(--text-secondary);
        border-bottom: 1px solid var(--border-color);
      }
      .orderbook-asks, .orderbook-bids {
        position: relative;
      }
      .orderbook-row {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        padding: 6px 0;
        font-size: 13px;
        position: relative;
        z-index: 1;
      }
      .depth-bar {
        position: absolute;
        top: 0;
        right: 0;
        height: 100%;
        z-index: -1;
      }
      .depth-bar.sell {
        background-color: rgba(220, 53, 69, 0.1);
      }
      .depth-bar.buy {
        background-color: rgba(40, 167, 69, 0.1);
      }
      .price.sell {
        color: var(--red-color);
      }
      .price.buy {
        color: var(--green-color);
      }
      .orderbook-current-price {
        text-align: center;
        padding: 8px 0;
        background-color: var(--tertiary-bg);
        margin: 5px 0;
      }
      .current {
        font-weight: bold;
        font-size: 14px;
      }
      /* ===== 底部導航欄 ===== */
      .bottom-nav {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        background-color: var(--secondary-bg);
        border-top: 1px solid var(--border-color);
        padding: 8px 0;
      }
      .nav-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 4px;
        background-color: transparent;
        border: none;
        color: var(--text-secondary);
        font-size: 12px;
        cursor: pointer;
        padding: 8px;
      }
      .nav-btn i {
        font-size: 16px;
      }
      .nav-btn.active {
        color: var(--accent-color);
      }
      /* ===== 響應式 ===== */
      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }
        .tab-switcher {
          width: 100%;
        }
        .tab-btn {
          flex: 1;
          text-align: center;
        }
        .position-actions {
          flex-direction: column;
        }
        .position-btn {
          width: 100%;
        }
      }
      /* ===== 平滑過渡 ===== */
      .tab-btn, .trade-tab-btn, .position-btn, .btn-long, .btn-short, .nav-btn {
        transition: all 0.2s ease;
      }
      /* ===== 支撐區域 ===== */
      .support-area {
        background-color: var(--support-area);
        position: absolute;
        z-index: 1;
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <!-- 頂部交易對信息 -->
      <div class="header">
        <div class="symbol-info">
          <h1>ETHUSDT</h1>
          <div class="price-info">
            <span class="current-price" id="currentPrice">1842.35</span>
            <span class="price-change positive" id="priceChange">+2.45%</span>
          </div>
        </div>
        <div class="tab-switcher">
          <button class="tab-btn active" data-tab="chart">
            <i class="fas fa-chart-line"></i> 走勢圖
          </button>
          <button class="tab-btn" data-tab="trade">
            <i class="fas fa-exchange-alt"></i> 交易
          </button>
        </div>
      </div>

      <!-- 主內容區 -->
      <div class="main-content">
        <!-- 圖表區域 -->
        <div class="content-section active" id="chart-section">
          <div class="timeframe-selector">
            <button class="timeframe-btn" onclick="changeTimeFrame('1M')">1月</button>
            <button class="timeframe-btn" onclick="changeTimeFrame('3M')">3月</button>
            <button class="timeframe-btn" onclick="changeTimeFrame('6M')">6月</button>
            <button class="timeframe-btn" onclick="changeTimeFrame('1Y')">1年</button>
            <button class="timeframe-btn active" onclick="changeTimeFrame('ALL')">全部</button>
          </div>
          <!-- Plotly K線圖表 -->
          <div class="chart-container" id="chart"></div>
          <div class="indicators">
            <div class="indicator">
              <span class="indicator-name">MA7:</span>
              <span class="indicator-value" id="ma7Value">--</span>
            </div>
            <div class="indicator">
              <span class="indicator-name">MA14:</span>
              <span class="indicator-value" id="ma14Value">--</span>
            </div>
            <div class="indicator">
              <span class="indicator-name">MA28:</span>
              <span class="indicator-value" id="ma28Value">--</span>
            </div>
            <div class="indicator">
              <span class="indicator-name">RSI:</span>
              <span class="indicator-value">65.3</span>
            </div>
          </div>
        </div>

        <!-- 交易區域 -->
        <div class="content-section" id="trade-section">
          <div class="trade-tabs">
            <button class="trade-tab-btn active" data-trade-tab="market">市價單</button>
            <button class="trade-tab-btn" data-trade-tab="limit">限價單</button>
          </div>

          <div class="trade-content active" id="market-tab">
            <div class="leverage-slider">
              <label>槓桿倍數: <span id="leverage-value">10x</span></label>
              <input type="range" min="1" max="75" value="10" class="slider" id="leverage-slider">
              <div class="leverage-marks">
                <span>1x</span>
                <span>25x</span>
                <span>50x</span>
                <span>75x</span>
              </div>
            </div>
            <div class="order-input">
              <label>數量 (ETH)</label>
              <input type="number" step="0.001" value="0.01" min="0.001">
            </div>
            <div class="available-balance">
              <span>可用資金: 31.35 USDT</span>
            </div>
            <div class="order-buttons">
              <button class="btn-long"><i class="fas fa-arrow-up"></i> 做多</button>
              <button class="btn-short"><i class="fas fa-arrow-down"></i> 做空</button>
            </div>
          </div>

          <div class="trade-content" id="limit-tab">
            <div class="leverage-slider">
              <label>槓桿倍數: <span id="leverage-value-limit">10x</span></label>
              <input type="range" min="1" max="75" value="10" class="slider" id="leverage-slider-limit">
              <div class="leverage-marks">
                <span>1x</span>
                <span>25x</span>
                <span>50x</span>
                <span>75x</span>
              </div>
            </div>
            <div class="order-input">
              <label>價格 (USDT)</label>
              <input type="number" step="0.01" value="1842.35" min="0.01">
            </div>
            <div class="order-input">
              <label>數量 (ETH)</label>
              <input type="number" step="0.001" value="0.01" min="0.001">
            </div>
            <div class="available-balance">
              <span>可用資金: 31.35 USDT</span>
            </div>
            <div class="order-buttons">
              <button class="btn-long"><i class="fas fa-arrow-up"></i> 做多</button>
              <button class="btn-short"><i class="fas fa-arrow-down"></i> 做空</button>
            </div>
          </div>

          <!-- 持倉區塊 -->
          <div class="positions-section">
            <h3>持倉</h3>
            <div class="position-card">
              <div class="position-header">
                <span class="position-symbol">ETHUSDT</span>
                <span class="position-type long">做多 10x</span>
              </div>
              <div class="position-details">
                <div class="position-info">
                  <div class="info-row">
                    <span>持倉數量:</span>
                    <span>0.025 ETH</span>
                  </div>
                  <div class="info-row">
                    <span>入場價格:</span>
                    <span>1820.45 USDT</span>
                  </div>
                  <div class="info-row">
                    <span>標記價格:</span>
                    <span id="tradeMarkPrice">1842.35 USDT</span>
                  </div>
                  <div class="info-row">
                    <span>強平價格:</span>
                    <span>1638.40 USDT</span>
                  </div>
                  <div class="info-row">
                    <span>未結盈虧:</span>
                    <span class="profit">+5.47 USDT (+1.20%)</span>
                  </div>
                </div>
                <div class="position-actions">
                  <button class="position-btn"><i class="fas fa-stop-circle"></i> 止盈止損</button>
                  <button class="position-btn"><i class="fas fa-chart-area"></i> 追蹤出場</button>
                  <button class="position-btn close-btn"><i class="fas fa-hand-holding-usd"></i> 平倉</button>
                </div>
              </div>
            </div>
          </div>

          <!-- 訂單簿 -->
          <div class="orderbook-section">
            <h3>訂單簿 <i class="fas fa-sort"></i> <i class="fas fa-align-justify"></i></h3>
            <div class="orderbook">
              <div class="orderbook-header">
                <span>價格</span>
                <span>數量</span>
                <span>總額</span>
              </div>
              <div class="orderbook-asks">
                <div class="orderbook-row">
                  <span class="price sell">1845.20</span>
                  <span class="amount">0.542</span>
                  <span class="total">999.54</span>
                  <div class="depth-bar sell" style="width: 15%;"></div>
                </div>
                <div class="orderbook-row">
                  <span class="price sell">1844.85</span>
                  <span class="amount">0.231</span>
                  <span class="total">426.16</span>
                  <div class="depth-bar sell" style="width: 8%;"></div>
                </div>
                <div class="orderbook-row">
                  <span class="price sell">1844.10</span>
                  <span class="amount">0.867</span>
                  <span class="total">1598.83</span>
                  <div class="depth-bar sell" style="width: 25%;"></div>
                </div>
                <div class="orderbook-row">
                  <span class="price sell">1843.75</span>
                  <span class="amount">0.325</span>
                  <span class="total">599.22</span>
                  <div class="depth-bar sell" style="width: 12%;"></div>
                </div>
                <div class="orderbook-row">
                  <span class="price sell">1843.00</span>
                  <span class="amount">0.423</span>
                  <span class="total">779.59</span>
                  <div class="depth-bar sell" style="width: 18%;"></div>
                </div>
              </div>
              <div class="orderbook-current-price">
                <span class="current" id="orderBookPrice">1842.35</span>
              </div>
              <div class="orderbook-bids">
                <div class="orderbook-row">
                  <span class="price buy">1842.00</span>
                  <span class="amount">0.356</span>
                  <span class="total">655.75</span>
                  <div class="depth-bar buy" style="width: 16%;"></div>
                </div>
                <div class="orderbook-row">
                  <span class="price buy">1841.50</span>
                  <span class="amount">0.725</span>
                  <span class="total">1335.09</span>
                  <div class="depth-bar buy" style="width: 30%;"></div>
                </div>
                <div class="orderbook-row">
                  <span class="price buy">1840.85</span>
                  <span class="amount">0.218</span>
                  <span class="total">401.31</span>
                  <div class="depth-bar buy" style="width: 9%;"></div>
                </div>
                <div class="orderbook-row">
                  <span class="price buy">1840.25</span>
                  <span class="amount">0.542</span>
                  <span class="total">997.42</span>
                  <div class="depth-bar buy" style="width: 22%;"></div>
                </div>
                <div class="orderbook-row">
                  <span class="price buy">1839.75</span>
                  <span class="amount">0.320</span>
                  <span class="total">588.72</span>
                  <div class="depth-bar buy" style="width: 14%;"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 底部導航欄 -->
      <div class="bottom-nav">
        <button class="nav-btn"><i class="fas fa-home"></i><span>首頁</span></button>
        <button class="nav-btn"><i class="fas fa-chart-bar"></i><span>行情</span></button>
        <button class="nav-btn active"><i class="fas fa-exchange-alt"></i><span>交易</span></button>
        <button class="nav-btn"><i class="fas fa-wallet"></i><span>資產</span></button>
        <button class="nav-btn"><i class="fas fa-cog"></i><span>設置</span></button>
      </div>
    </div>

    <script>
      // 模擬參數設定：將原本15分鐘間隔調為5秒間隔，方便測試
      let candleInterval = 5000; // 5秒一根K線
      let simulationInterval = 2000; // 每2秒更新當前價格
      let lastTimestamp = Date.now(); // 新K線起始時間

      // 全局圖表資料
      let chartData = []; // 模擬K線資料陣列

      // 產生初始50根K線資料
      function generateInitialData() {
        chartData = [];
        const count = 50;
        let currentTime = Date.now() - count * candleInterval;
        let price = 1842.35;
        for (let i = 0; i < count; i++) {
          let open = price + (Math.random() - 0.5) * 10;
          let close = open + (Math.random() - 0.5) * 10;
          let high = Math.max(open, close) + Math.random() * 5;
          let low = Math.min(open, close) - Math.random() * 5;
          let volume = Math.random() * 5000 + 1000;
          // 使用 ISO 格式日期字串
          let date = new Date(currentTime).toISOString();
          chartData.push({ date, open: parseFloat(open.toFixed(2)), high: parseFloat(high.toFixed(2)), low: parseFloat(low.toFixed(2)), close: parseFloat(close.toFixed(2)), volume: parseFloat(volume.toFixed(2)) });
          price = close;
          currentTime += candleInterval;
        }
      }

      // 更新 Plotly 圖表
      function updateChart() {
        // Candlestick trace
        let traceCandlestick = {
          x: chartData.map(d => d.date),
          open: chartData.map(d => d.open),
          high: chartData.map(d => d.high),
          low: chartData.map(d => d.low),
          close: chartData.map(d => d.close),
          type: 'candlestick',
          xaxis: 'x',
          yaxis: 'y1',
          increasing: { line: { color: '#26a69a' } },
          decreasing: { line: { color: '#ef5350' } },
          name: '價格'
        };

        // 成交量 trace
        let traceVolume = {
          x: chartData.map(d => d.date),
          y: chartData.map(d => d.volume / 1000), // 顯示單位 K
          type: 'bar',
          xaxis: 'x',
          yaxis: 'y2',
          marker: { color: chartData.map(d => d.close >= d.open ? '#26a69a' : '#ef5350') },
          opacity: 0.5,
          name: '成交量'
        };

        let traces = [traceCandlestick, traceVolume];

        let layout = {
          dragmode: 'pan',
          showlegend: false,
          xaxis: {
            rangeslider: { visible: false },
            type: 'date',
            range: null
          },
          yaxis: {
            title: '價格',
            side: 'right',
            domain: [0.2, 1],
            fixedrange: false
          },
          yaxis2: {
            title: '成交量 (K)',
            side: 'right',
            domain: [0, 0.15],
            fixedrange: false,
            anchor: 'x'
          },
          grid: { rows: 2, columns: 1, subplots: [['xy1'], ['xy2']], roworder: 'top to bottom' },
          margin: { t: 50, b: 50, l: 60, r: 60 },
          plot_bgcolor: '#151b29',
          paper_bgcolor: '#151b29',
          font: { family: 'Noto Sans TC, sans-serif', color: '#e5e5e5' },
          hovermode: 'x unified'
        };

        Plotly.react('chart', traces, layout, { responsive: true, displayModeBar: false });
      }

      // 計算移動平均線（僅用於顯示在UI上，模擬計算）
      function calculateMA(period) {
        if (chartData.length < period) return '--';
        let sum = 0;
        for (let i = chartData.length - period; i < chartData.length; i++) {
          sum += chartData[i].close;
        }
        return (sum / period).toFixed(2);
      }

      // 更新 UI 上的 MA 數值
      function updateMAIndicators() {
        document.getElementById('ma7Value').textContent = calculateMA(7);
        document.getElementById('ma14Value').textContent = calculateMA(14);
        document.getElementById('ma28Value').textContent = calculateMA(28);
      }

      // 更新價格顯示
      function updatePriceDisplay(latestPrice) {
        document.getElementById('currentPrice').textContent = latestPrice.toFixed(2);
        document.getElementById('orderBookPrice').textContent = latestPrice.toFixed(2);
        document.getElementById('tradeMarkPrice').textContent = latestPrice.toFixed(2) + " USDT";
      }

      // 更新「數據更新時間」
      function updateLastUpdated() {
        const now = new Date();
        document.getElementById("lastUpdated").textContent =
          "數據更新時間: " + now.toLocaleString("zh-TW", { timeZone: "Asia/Taipei" });
      }

      // 模擬新增一根新K線
      function simulateNewCandle(newPrice) {
        const lastCandle = chartData[chartData.length - 1];
        const newCandle = {
          date: new Date(lastTimestamp).toISOString(),
          open: lastCandle.close,
          high: newPrice,
          low: newPrice,
          close: newPrice,
          volume: Math.random() * 5000 + 1000
        };
        chartData.push(newCandle);
        if (chartData.length > 100) {
          chartData.shift();
        }
        lastTimestamp += candleInterval;
        updateChart();
        updateMAIndicators();
        updateLastUpdated();
      }

      // 模擬實時數據更新
      function simulateRealTimeUpdates() {
        generateInitialData();
        updateChart();
        updateMAIndicators();
        updateLastUpdated();
        // 初始當前價格取自最後一根K線
        let currentPrice = chartData[chartData.length - 1].close;
        setInterval(() => {
          // 模擬當前K線內價格波動
          const volatility = Math.random() * 10;
          const direction = Math.random() > 0.5 ? 1 : -1;
          let newPrice = currentPrice + direction * volatility;
          newPrice = parseFloat(newPrice.toFixed(2));
          // 如果當前時間已達到下一根K線時間，則生成新K線
          if (Date.now() >= lastTimestamp) {
            simulateNewCandle(newPrice);
            currentPrice = newPrice;
          } else {
            // 更新最後一根K線的價格
            const lastCandle = chartData[chartData.length - 1];
            lastCandle.close = newPrice;
            if (newPrice > lastCandle.high) lastCandle.high = newPrice;
            if (newPrice < lastCandle.low) lastCandle.low = newPrice;
            updateChart();
            updateMAIndicators();
            currentPrice = newPrice;
          }
          updatePriceDisplay(newPrice);
        }, simulationInterval);
      }

      // 時間範圍按鈕功能（簡單設定 xRange，Plotly可用）
      function changeTimeFrame(frame) {
        const endDate = new Date(chartData[chartData.length - 1].date);
        let startDate = new Date(endDate);
        switch (frame) {
          case "1M":
            startDate.setMonth(endDate.getMonth() - 1);
            break;
          case "3M":
            startDate.setMonth(endDate.getMonth() - 3);
            break;
          case "6M":
            startDate.setMonth(endDate.getMonth() - 6);
            break;
          case "1Y":
            startDate.setFullYear(endDate.getFullYear() - 1);
            break;
          default:
            startDate = new Date(chartData[0].date);
        }
        // 更新圖表x軸範圍
        Plotly.relayout('chart', {
          'xaxis.range': [startDate.toISOString().split("T")[0], endDate.toISOString().split("T")[0]]
        });
      }

      // 初始化
      simulateRealTimeUpdates();
    </script>
  </body>
</html>